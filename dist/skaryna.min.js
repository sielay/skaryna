!function t(e,n,r){function o(a,u){if(!n[a]){if(!e[a]){var l="function"==typeof require&&require;if(!u&&l)return l(a,!0);if(i)return i(a,!0);var s=new Error("Cannot find module '"+a+"'");throw s.code="MODULE_NOT_FOUND",s}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return o(n?n:t)},c,c.exports,t,e,n,r)}return n[a].exports}for(var i="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(t,e,n){"use strict";var r=t("./index"),o=t("./editor"),i=t("./repository"),a=t("./xhr");r.Skaryna.Editor=o.Editor,r.Skaryna.repository=i.repository,r.Skaryna.XHR=a.XHR,window.Skaryna=r.Skaryna,Array.isArray(window.___Skaryna)&&window.___Skaryna.forEach(function(t){t.apply(window)})},{"./editor":3,"./index":5,"./repository":10,"./xhr":15}],2:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t){return String(t).replace(/([.*+?=^!:${}()|[\]\/\\])/g,"\\$1")}function u(t,e){var n,r=null;return t.forEach(function(t){var o=new RegExp(a(t).replace(/\\\*/g,"(.+)")),i=t.split("*").filter(function(t){return t.length}).length,u=e.match(o);u&&(null===r||u.length-i<r)&&(r=u.length-i,n=t)}),n}function l(t){return m[t]}function s(t){if(!t)return null;var e=t.getAttribute("data-skaryna-id");return l(e)}function c(t){for(var e="abcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;5>r;r++)n+=e.charAt(Math.floor(Math.random()*e.length));return-1===Object.keys(m).indexOf(n)?(m[n]=m[n]||t,n):c(t)}Object.defineProperty(n,"__esModule",{value:!0}),n.Variants=n.Fields=n.StaticBlockNode=n.Heading=n.Image=n.Paragraph=n.TextNode=n.Quote=n.Document=n.BlockNode=n.Node=void 0;var f=function O(t,e,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var o=Object.getPrototypeOf(t);return null===o?void 0:O(o,e,n)}if("value"in r)return r.value;var i=r.get;if(void 0!==i)return i.call(n)},h=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.escapeRegexp=a,n.bestMatch=u,n.getById=l,n.getByNode=s,n.randomID=c;var p=t("./emitter"),d=t("./util"),y=t("./serializer/toHTML"),m={},v=n.Node=function(t){function e(){r(this,e);var t=o(this,Object.getPrototypeOf(e).call(this));return t.name=c(t),t.__locked=!1,t}return i(e,t),h(e,[{key:"lock",value:function(){this.__locked=!0}},{key:"attr",value:function(){return this.attrs}},{key:"get",value:function(){throw new Error("Should be implemented")}},{key:"toJSON",value:function(){var t=new Error("Should be implemented");throw t}},{key:"locked",get:function(){return this.__locked}},{key:"defaultNewItem",get:function(){return null}},{key:"allowedNewItems",get:function(){return[]}}]),e}(p.Emitter),g=n.BlockNode=function(t){function e(t,n,i){r(this,e);var a=o(this,Object.getPrototypeOf(e).call(this));return a._type=t,a.items=n||[],a.attrs=i,a}return i(e,t),h(e,[{key:"get",value:function(t){var e=t.split("."),n=e.shift(),r=e.join("."),o=void 0;return isNaN(n)?null:(o=this.items[+n],r.length&&o?o.get(r):o)}},{key:"toJSON",value:function(){var t={type:this.type,items:this.items.map(function(t){return t.toJSON()})};return this.attrs&&(t.attrs=JSON.parse(JSON.stringify(this.attrs))),t}},{key:"decorate",value:function(t){return(0,y.toHTML)(this,{edit:!0}).then(function(e){t.innerHTML="",(0,d.arraize)(e.children).forEach(function(e){t.appendChild(e)})})}},{key:"empty",get:function(){return this.items.length<=0}},{key:"type",get:function(){return this._type}}]),e}(v),b=(n.Document=function(t){function e(t){return r(this,e),o(this,Object.getPrototypeOf(e).call(this,"document",t))}return i(e,t),h(e,[{key:"defaultNewItem",get:function(){return w}},{key:"allowedNewItems",get:function(){return[w,k]}}]),e}(g),n.Quote=function(t){function e(t){return r(this,e),o(this,Object.getPrototypeOf(e).call(this,"quote",t))}return i(e,t),e}(g),n.TextNode=function(t){function e(t,n,i){r(this,e);var a=o(this,Object.getPrototypeOf(e).call(this));return a.text=t&&t.toString?t.toString():"",a.formats=n||null,a.attrs=i,a}return i(e,t),h(e,[{key:"attr",value:function(){return"text"===this.type?{}:f(Object.getPrototypeOf(e.prototype),"attr",this).call(this)}},{key:"type",get:function(){return"text"}},{key:"empty",get:function(){return!this.text||!this.text.replace(/^([\s\n\r\t]+)|([\s\n\r\t]+)$/,"").length}},{key:"absoluteEmpty",get:function(){return 0===this.text.length}}],[{key:"type",get:function(){return"text"}}]),h(e,[{key:"toJSON",value:function(){var t={type:this.type,text:this.text};return this.formats&&(t.formats=JSON.parse(JSON.stringify(this.formats))),this.attrs&&"text"!==this.type&&(t.attrs=JSON.parse(JSON.stringify(this.attrs))),t}},{key:"append",value:function(t){var n=this;if(!(t instanceof e))throw new Error("Only text nodes can be joined");t.formats&&(this.formats=this.formats||[],t.formats.forEach(function(t){n.formats.push({slice:[t.slice[0]+n.text.length,t.slice[1]],apply:t.apply})})),this.text+=t.text}},{key:"decorate",value:function(t){return(0,y.toHTML)(this,{edit:!0}).then(function(e){t.innerHTML=e.textContent})}}]),e}(v)),w=n.Paragraph=function(t){function e(t,n,i){return r(this,e),o(this,Object.getPrototypeOf(e).call(this,t,n,i))}return i(e,t),h(e,[{key:"type",get:function(){return"paragraph"}}],[{key:"type",get:function(){return"paragraph"}}]),h(e,[{key:"nextNodeType",get:function(){return e}}]),e}(b),k=n.Image=function(t){function e(t,n,i){r(this,e);var a=o(this,Object.getPrototypeOf(e).call(this,"image"));return a.src=t,a.title=n,a.alt=i,a}return i(e,t),h(e,[{key:"attr",value:function(){var t=f(Object.getPrototypeOf(e.prototype),"attr",this).call(this)||{};return this.src&&(t.src=this.src),this.title&&(t.title=this.title),this.alt&&(t.alt=this.title),t}},{key:"toJSON",value:function(){var t={type:"image",src:this.src};return this.title&&(t.title=this.title),this.alt&&(t.alt=this.alt),t}},{key:"type",get:function(){return"image"}}],[{key:"type",get:function(){return"image"}}]),e}(v);n.Heading=function(t){function e(t,n,i,a){r(this,e);var u=o(this,Object.getPrototypeOf(e).call(this,n,i,a));return u.level=Math.min(6,t||0),u}return i(e,t),h(e,[{key:"attr",value:function(){return f(Object.getPrototypeOf(e.prototype),"attr",this).call(this)}},{key:"toJSON",value:function(){var t=f(Object.getPrototypeOf(e.prototype),"toJSON",this).call(this);return t.level=this.level,t}},{key:"type",get:function(){return"heading"}}],[{key:"type",get:function(){return"heading"}}]),e}(b),n.StaticBlockNode=function(t){function e(){return r(this,e),o(this,Object.getPrototypeOf(e).apply(this,arguments))}return i(e,t),h(e,[{key:"locked",get:function(){return!0}},{key:"defaultNewItem",get:function(){return w}},{key:"allowedNewItems",get:function(){return[w,k]}}]),e}(g),n.Fields=function(t){function e(t){r(this,e);var n=o(this,Object.getPrototypeOf(e).call(this));return n._map=t,n}return i(e,t),h(e,[{key:"get",value:function(t){var e=t.split("."),n=e.shift(),r=e.join("."),o=void 0;return o=this._map[n],r.length&&o?o.get(r):o}},{key:"toJSON",value:function(){return(0,d.clone)([this._map,{type:"Fields"}])}},{key:"type",get:function(){return"Fields"}}],[{key:"type",get:function(){return"Fields"}}]),e}(v),n.Variants=function(t){function e(t){r(this,e);var n=o(this,Object.getPrototypeOf(e).call(this));return n._variants=t,n}return i(e,t),h(e,[{key:"best",value:function n(t){var n=u(Object.keys(this._variants),t);return this._variants[n]}},{key:"toJSON",value:function(){return(0,d.clone)([this._map,{type:"Variants"}])}},{key:"type",get:function(){return"Variants"}}],[{key:"type",get:function(){return"Variants"}}]),e}(v)},{"./emitter":4,"./serializer/toHTML":12,"./util":14}],3:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0}),n.Editor=void 0;var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("./emitter"),l=t("./util"),s=t("./repository"),c=t("./serializer/toHTML"),f=t("./parser/fromHTML"),h=t("./parser/fromPOM"),p=t("./xhr"),d=t("./document"),y=t("./toolbar"),m=t("./injector"),v=13,g=[v],b=new y.Toolbar,w=void 0,k=(n.Editor=function(t){function e(t){r(this,e);var n=o(this,Object.getPrototypeOf(e).call(this));return n.element=t,n.documentPath=t.getAttribute("data-skaryna-path")||null,n.document=t.getAttribute("data-skaryna-doc")||s.DEFAULT_DOCUMENT,n.variant=t.getAttribute("data-skaryna-variant")||null,n._pendingState=null,n._rendering=!1,n.init(),n}return i(e,t),a(e,null,[{key:"factory",value:function(t){var n=new e(t);return n.inited}},{key:"initEditors",value:function(t){return Promise.all((0,l.arraize)(t.querySelectorAll("[data-skaryna]")).map(function(t){return e.factory(t)}))}},{key:"registerDocument",value:function(t,e){s.repository.set(e||s.DEFAULT_DOCUMENT,t)}},{key:"load",value:function(t,e){return p.XHR.get(t).then(function(t){return(0,h.fromPOM)(JSON.parse(t))}).then(function(t){s.repository.set(e||s.DEFAULT_DOCUMENT,t)})}}]),a(e,[{key:"init",value:function(){var t=this;return this.inited?this.inited:void(this.inited=(0,f.fromHTML)(this.element,{edit:!0}).then(function(e){if(e.lock(),s.repository.has(t.document)){var n=s.repository.get(t.document);t.documentPath&&(n=n.get(t.documentPath),n&&"Variants"===n.type&&n.best&&(n=n.best(t.variant||"*"))),t.content=n}else e.empty||(s.repository.set(t.document,e),t.content=e)}).then(function(){t.render()})["catch"](function(t){console.log(t),console.log(t.stack)}))}},{key:"getCaretCharacterOffsetWithin",value:function(t){var e=0,n=t.ownerDocument||t.document,r=n.defaultView||n.parentWindow,o=void 0;if("undefined"!=typeof r.getSelection){if(o=r.getSelection(),o.rangeCount>0){var i=r.getSelection().getRangeAt(0),a=i.cloneRange();a.selectNodeContents(t),a.setEnd(i.endContainer,i.endOffset),e=a.toString().length}}else if((o=n.selection)&&"Control"!=o.type){var u=o.createRange(),l=n.body.createTextRange();l.moveToElementText(t),l.setEndPoint("EndToEnd",u),e=l.text.length}return e}},{key:"getSelectionLength",value:function(t){}},{key:"getCurrentElement",value:function(t){var e=t.ownerDocument||t.document,n=e.defaultView||e.parentWindow,r=void 0,o=void 0;return r="undefined"!=typeof n.getSelection?n.getSelection():e.selection,o=r.focusNode,o===this.element?this.element:this.getEditableNode(o)}},{key:"getEditableNode",value:function(t){for(;t&&(!t.hasAttribute||!t.hasAttribute("data-skaryna-id"));)t=t.parentNode;return t}},{key:"onDOM",value:function(t,e,n){var r=this;t=t instanceof HTMLElement?[t]:(0,l.arraize)(this.element.querySelectorAll(t)),t.forEach(function(t){t.addEventListener(e,function(t){n.apply(r,[t])},!0)})}},{key:"render",value:function(){var t=this;this._rendering=!0;var e=this,n=void 0;return this.content?n=this.content.decorate(this.element).then(function(){t._rendering=!1}):(this._rendering=!1,n=Promise.resolve()),n.then(function(){e.element.setAttribute("data-skaryna-id",e.content?e.content.name:(0,d.randomID)(!0)),e.element.setAttribute("contentEditable",""),e.element.addEventListener("keydown",function(t){e.onKeyUp(t)},!0),e.onDOM("[data-skaryna-id]","mouseup",e.focus),e.onDOM(e.element,"mouseup",e.focus)})}},{key:"onSelect",value:function(t){}},{key:"showToolbar",value:function(){b.anchor()}},{key:"focus",value:function(t){var e=this,n=this.getEditableNode(t.target),r=(0,d.getByNode)(n),o=(0,d.getByNode)(n.parentNode),i=void 0,a=void 0;i=o?o.allowedNewItems:r.allowedNewItems,this.hideInjector(),i.length>0&&(a=o?this.showInjector(n,i):this.showInjector(n.parentNode.lastChild,i),a.on("injectnode",function(t){if(o){var n=o.items.indexOf(r);o.items.splice(n,0,new t.data)}else o.items.push(new t.data);e.render()}))}},{key:"showInjector",value:function(t,e){var n=new m.Injector(e),r=t.getBoundingClientRect(),o=void 0;return w=n.element,document.body.appendChild(w),setTimeout(function(){o=w.getBoundingClientRect(),w.style.top=r.top+"px",w.style.left=r.left-o.width+"px"},0),n}},{key:"hideInjector",value:function(){w&&(w.parentNode&&w.parentNode.removeChild(w),w=null)}},{key:"strong",value:function(){var t=this.getCurrentElement(event.target),e=window.getSelection?window.getSelection().toString():document.selection.createRange().text,n=e.length,r=this.getCaretCharacterOffsetWithin(t)-n;(0,f.fromHTML)(t).then(function(t){return t.formats=t.formats||[],t.formats.push({slice:[r,n],apply:["strong"]}),(0,c.toHTML)(t)}).then(function(e){t.innerHTML=e.innerHTML})}},{key:"onExternalChange",value:function(t){return this._rendering?void(this._pendingState=!0):void this.render()}},{key:"newItem",value:function(t){for(var e=t,n=(0,d.getByNode)(e),r=this;null!==n;){if(!n)return;if(n.defaultNewItem){var o=new n.defaultNewItem;return n.items.push(o),void(0,c.toHTML)(o,{edit:!0}).then(function(t){e.appendChild(t),r.editNode(t)})}e=e.parentNode,n=(0,d.getByNode)(e)}}},{key:"editNode",value:function(t){var e=document.createRange(),n=window.getSelection();e.setStart(t,0),e.collapse(!0),n.removeAllRanges(),n.addRange(e)}},{key:"ownAction",value:function(t,e){return t===v?this.newItem(e):void 0}},{key:"onKeyUp",value:function(t){-1!==g.indexOf(t.keyCode)&&(t.stopPropagation(),t.preventDefault(),this.ownAction(t.keyCode,this.getCurrentElement(t.target)))}}]),e}(u.Emitter),document.createElement("style"));k.innerText="\n        p[data-skaryna-id]:empty {\n                display: block;\n                height: 1em;\n            }\n        }\n        ",document.body.appendChild(k)},{"./document":2,"./emitter":4,"./injector":6,"./parser/fromHTML":8,"./parser/fromPOM":9,"./repository":10,"./serializer/toHTML":12,"./toolbar":13,"./util":14,"./xhr":15}],4:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){var n=e.fn,r=e.context,o=e.args,i=[t].concat(o);n.apply(r||null,i)}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),a=n.Event=function(){function t(e,n,o,i){r(this,t),Object.defineProperties(this,{name:{value:e,writable:!1},data:{value:n,writable:!1},source:{value:o,writable:!1},parent:{value:i,writable:!1}})}return i(t,[{key:"toJSON",value:function(){return{name:this.name,data:this.data,source:this.source,parent:this.parent}}},{key:"toString",value:function(){return"Event: "+JSON.stringify(this.toJSON())}}]),t}();n.Emitter=function(){function t(){r(this,t)}return i(t,[{key:"on",value:function(t,e,n,r,o){this.__listeners=this.__listeners||{},this.__listeners[t]=this.__listeners[t]||[],this.__listeners[t].push({fn:e,context:n,args:r,once:!!o})}},{key:"once",value:function(t,e,n,r){this.on(t,e,n,r,!0)}},{key:"off",value:function(t,e,n,r,o){var i=this;this.__listeners&&this.__listeners[t]&&this.getListeners(t,e,n,r,o).forEach(function(e){i.__listeners[t].splice(i.__listeners[t].indexOf(e),1)})}},{key:"emit",value:function(t,e,n){if(this.__listeners&&this.__listeners[t]){var r=this,i=new a(t,e,this,n);this.getListeners(t).forEach(function(e){e.once===!0&&r.off(t,e.fn,e.context,e.args,e.once),o(i,e)})}}},{key:"bubbleEvent",value:function(t,e){this.on(t,function(n){e.emit(t,n.data,n)})}},{key:"getListeners",value:function(t,e,n,r){return this.__listeners&&this.__listeners[t]?this.__listeners[t].map(function(t){return void 0!==e&&t.fn!==e?!1:void 0!==n&&t.context!==n?!1:void 0!==r&&t.args!==r?!1:t}).filter(function(t){return!!t}):null}}]),t}()},{}],5:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=t("./emitter");Object.defineProperty(n,"Event",{enumerable:!0,get:function(){return o.Event}}),Object.defineProperty(n,"Emitter",{enumerable:!0,get:function(){return o.Emitter}});n.Skaryna=function i(){r(this,i)}},{"./emitter":4}],6:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0}),n.Injector=void 0;var a=t("./emitter"),u=void 0,l={paragraph:"M832 320v704q0 104-40.5 198.5t-109.5 163.5-163.5 109.5-198.5 40.5h-64q-26 0-45-19t-19-45v-128q0-26 19-45t45-19h64q106 0 181-75t75-181v-32q0-40-28-68t-68-28h-224q-80 0-136-56t-56-136v-384q0-80 56-136t136-56h384q80 0 136 56t56 136zm896 0v704q0 104-40.5 198.5t-109.5 163.5-163.5 109.5-198.5 40.5h-64q-26 0-45-19t-19-45v-128q0-26 19-45t45-19h64q106 0 181-75t75-181v-32q0-40-28-68t-68-28h-224q-80 0-136-56t-56-136v-384q0-80 56-136t136-56h384q80 0 136 56t56 136z",image:"M576 576q0 80-56 136t-136 56-136-56-56-136 56-136 136-56 136 56 56 136zm1024 384v448h-1408v-192l320-320 160 160 512-512zm96-704h-1600q-13 0-22.5 9.5t-9.5 22.5v1216q0 13 9.5 22.5t22.5 9.5h1600q13 0 22.5-9.5t9.5-22.5v-1216q0-13-9.5-22.5t-22.5-9.5zm160 32v1216q0 66-47 113t-113 47h-1600q-66 0-113-47t-47-113v-1216q0-66 47-113t113-47h1600q66 0 113 47t47 113z",dimensions:"0 0 1792 1792"};n.Injector=function(t){function e(t){r(this,e);var n=o(this,Object.getPrototypeOf(e).call(this)),i=n,a=document.createElement("div");return a.innerHTML='<div data-skaryna-tooltip="left"><div></div><div></div></div>',n.element=a.firstChild,t.forEach(function(t){var e=document.createElement("a"),r=document.createElementNS("http://www.w3.org/2000/svg","svg"),o=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("width",30),r.setAttribute("height",30),r.setAttribute("viewBox",l.dimensions),r.setAttribute("xmlns","http://www.w3.org/2000/svg"),o.setAttribute("d",l[t.type]),o.setAttribute("fill","#fff"),r.appendChild(o),e.appendChild(r),e.addEventListener("mousedown",function(e){e.preventDefault(),e.stopPropagation(),console.log(t),i.emit("injectnode",t)},!0),n.element.children[1].appendChild(e)}),u||(u=document.createElement("style"),u.innerText='\n        [data-skaryna-tooltip] {\n            position: absolute;\n            z-index: 1070;\n            display: block;\n            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;\n            font-size: 12px;\n            font-style: normal;\n            font-weight: 400;\n            line-height: 1.42857143;\n            text-align: left;\n            text-align: start;\n            text-decoration: none;\n            text-shadow: none;\n            text-transform: none;\n            letter-spacing: normal;\n            word-break: normal;\n            word-spacing: normal;\n            word-wrap: normal;\n            white-space: normal;\n            /*filter: alpha(opacity=0);\n            opacity: 0;*/\n            line-break: auto;\n            transition: opacity 0.5s;\n        }\n        [data-skaryna-tooltip] div:nth-child(2) {\n            max-width: 200px;\n            padding: 3px 8px;\n            color: #fff;\n            text-align: center;\n            background-color: #000;\n            border-radius: 4px;\n        }\n        [data-skaryna-tooltip] div:nth-child(1) {\n            position: absolute;\n            width: 0;\n            height: 0;\n            border-color: transparent;\n            border-style: solid;\n        }\n        [data-skaryna-tooltip="left"] {\n            padding: 0 5px;\n            margin-left: -3px;\n        }\n        [data-skaryna-tooltip="top"] {\n            padding: 5px 0;\n            margin-top: -3px;\n        }\n        [data-skaryna-tooltip="bottom"] {\n            padding: 5px 0;\n            margin-top: 3px;\n        }\n        [data-skaryna-tooltip="right"] {\n            padding: 0 5px;\n            margin-left: 3px;\n        }\n        [data-skaryna-tooltip="left"] div:nth-child(1) {\n            top: 50%;\n            right: 0;\n            margin-top: -5px;\n            border-width: 5px 0 5px 5px;\n            border-left-color: #000;\n        }\n        [data-skaryna-tooltip="top"] div:nth-child(1) {\n            bottom: 0;\n            left: 50%;\n            margin-left: -5px;\n            border-width: 5px 5px 0;\n            border-top-color: #000;\n        }\n        [data-skaryna-tooltip="bottom"] div:nth-child(1) {\n            top: 0;\n            left: 50%;\n            margin-left: -5px;\n            border-width: 0 5px 5px;\n            border-bottom-color: #000;\n        }\n        [data-skaryna-tooltip="right"] div:nth-child(1) {\n            top: 50%;\n            left: 0;\n            margin-top: -5px;\n            border-width: 5px 5px 5px 0;\n            border-right-color: #000;\n        }\n        [data-skaryna-tooltip] a {\n            margin-left: 10px;\n        }\n        [data-skaryna-tooltip] a:first-child{\n            margin-left: 0px;\n        }',document.body.appendChild(u)),n}return i(e,t),e}(a.Emitter)},{"./emitter":4}],7:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(){r(this,t)}return o(t,[{key:"parse",value:function(t,e,n,r){return e?this.handle(t,e,n,r):Promise.reject(new Error("Model is empty"))}},{key:"on",value:function(t,e,n){this._handlers=this._handlers||{},this._handlers[t]=this._handlers[t]||{},this._handlers[t][e]=n}},{key:"handle",value:function(t,e,n,r){var o=this._handlers&&this._handlers[t]&&this._handlers[t][e]?this._handlers[t][e]:null;return o||(o=this._handlers&&this._handlers[t]&&this._handlers[t]["*"]?this._handlers[t]["*"]:null)?o(e,n,r).then(function(t){return t}):Promise.reject(new Error("No handler defined for "+t+" : "+e))}}]),t}();n.parser=new i},{}],8:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t){switch(t){case"td":case"th":return"tr";case"tr":return"table";default:return"div"}}function u(t,e){return t&&t.childNodes?Promise.all((0,g.arraize)(t.childNodes).map(function(t){return 1===t.nodeType||3===t.nodeType?l(t,e):null})).then(function(t){return t.filter(function(t){return t.constructor===b.TextNode?!t.absoluteEmpty:null!==t})}):Promise.resolve([])}function l(t,e){if(!t)return Promise.resolve(null);if("string"==typeof t){if(0===t.length)return Promise.resolve(null);var n=document.createElement(a(t.replace("/^(s*)<([a-zA-Z0-9_-]+)","$2").toLowerCase()));return n.innerHTML=t,u(n,e).then(function(t){if(1===t.length)return t[0];if(t.filter(function(t){return!(t instanceof b.TextNode||t instanceof w)}).length)return t.map(function(t){return t instanceof b.BlockNode}).length?new b.Document(t.map(function(t){return"text"===t.type?new b.Paragraph(t.text,t.formats,t.attrs,e):t})):new b.Document(t);var n=t.map(function(t){if(t instanceof w){var n=c([t]),r=m(n,2),o=r[0],i=r[1];return new b.TextNode(o,i,e)}return t}),r=n.shift();return n.forEach(function(t){r.append(t)}),r})}return v.parser.parse("html",3===t.nodeType?"text":t.nodeName,t)}function s(t,e){return"A"===t.type?{type:"A",title:t.attrs.title||e,href:t.attrs.href}:t.type}function c(t){var e="",n=[],r=0;return t.forEach(function(t){if(t instanceof w){var o=c(t.items),i=m(o,2),a=i[0],u=i[1],l={slice:[r,a.length],apply:[s(t,a)]};n.push(l),u.forEach(function(t){n.push({slice:[r+t.slice[0],t.slice[1]],apply:t.apply})}),n.forEach(function(t){n.forEach(function(e,r){t!==e&&t.slice[0]===e.slice[0]&&t.slice[1]===e.slice[1]&&(t.apply=t.apply.concat(e.apply),n.splice(r,1))})}),e+=a,r+=a.length}else t instanceof b.TextNode&&(e+=t.text,r+=t.text.length)}),[e,n]}function f(t,e,n){return u(e,n).then(function(e){var r=c(e),o=m(r,2),i=o[0],a=o[1];return Promise.resolve(new b.Heading(t[1].toLowerCase(),i||"",a.length?a:null,n))})}function h(t,e,n){return u(e,n).then(function(t){var e=c(t),n=m(e,2),r=n[0],o=n[1];return Promise.resolve(new b.Paragraph(r,o.length?o:null))})}function p(t){var e=null;return(0,g.arraize)(t).forEach(function(t){e=e||{},t.value&&t.value.length&&(e[t.name]=t.value)}),e}function d(t){return t&&t.length?t:null}function y(t,e,n){return u(e,n).then(function(t){var e=[],r=[];if(t.forEach(function(o){if(o instanceof b.Paragraph){if(r.length){var i=c(t),a=m(i,2),u=a[0],l=a[1];e.push(Promise.resolve(new b.Paragraph(u,l.length?l:null,n))),r=[]}e.push(Promise.resolve(o))}else r.push(o)}),r.length){var o=c(t),i=m(o,2),a=i[0],u=i[1];e.push(Promise.resolve(new b.Paragraph(a,u.length?u:null,n)))}return Promise.all(e)}).then(function(t){return Promise.resolve(new b.Quote(t))})}Object.defineProperty(n,"__esModule",{value:!0});var m=function(){function t(t,e){var n=[],r=!0,o=!1,i=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(l){o=!0,i=l}finally{try{!r&&u["return"]&&u["return"]()}finally{if(o)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();n.fromHTML=l;var v=t("./../parser"),g=t("./../util"),b=t("./../document"),w=function(t){function e(){return r(this,e),o(this,Object.getPrototypeOf(e).apply(this,arguments))}return i(e,t),e}(b.BlockNode);v.parser.on("html","text",function(t,e,n){return Promise.resolve(new b.TextNode(e.textContent,null,n))}),v.parser.on("html","H1",f),v.parser.on("html","H2",f),v.parser.on("html","H3",f),v.parser.on("html","H4",f),v.parser.on("html","H5",f),v.parser.on("html","H6",f),v.parser.on("html","P",h),v.parser.on("html","BLOCKQUOTE",y),v.parser.on("html","IMG",function(t,e,n){return Promise.resolve(new b.Image(e.src,d(e.getAttribute("title")),d(e.getAttribute("alt")),(0,g.clone)([p(e.attributes)],["src","title","alt"])),n)}),["ADDRESS","ARTICLE","ASIDE","DIV","FIGURE","FOOTER","HEADER","MAIN","NAV","SECTION"].forEach(function(t){v.parser.on("html",t,function(t,e,n){return u(e,n).then(function(r){return Promise.resolve(new b.StaticBlockNode(t,r,p(e.attributes)),n)})})}),v.parser.on("html","*",function(t,e,n){return u(e,n).then(function(r){return Promise.resolve(new w(t,r,p(e.attributes)),n)})})},{"./../document":2,"./../parser":7,"./../util":14}],9:[function(t,e,n){"use strict";function r(t){return t?i.parser.parse("pom",t.type,t):Promise.resolve(null)}function o(t){return Array.isArray(t)?Promise.all(t.map(function(t){return r(t)})).then(function(t){return t.filter(function(t){return!!t})}):Promise.resolve([])}Object.defineProperty(n,"__esModule",{value:!0}),n.fromPOM=r;var i=t("./../parser"),a=t("./../document");i.parser.on("pom","document",function(t,e){return o(e.items).then(function(t){return new a.Document(t)})}),i.parser.on("pom","heading",function(t,e){return Promise.resolve(new a.Heading(e.level,e.text,e.formats,e.attrs))}),i.parser.on("pom","paragraph",function(t,e){return Promise.resolve(new a.Paragraph(e.text,e.formats,e.attrs))}),i.parser.on("pom","text",function(t,e){return Promise.resolve(new a.TextNode(e.text,e.formats))}),i.parser.on("pom","image",function(t,e){return Promise.resolve(new a.Image(e.src,e.title,e.alt))}),i.parser.on("pom","Fields",function(t,e){var n={};return Promise.all(Object.keys(e).filter(function(t){return"type"!==t}).map(function(t){return r(e[t]).then(function(e){n[t]=e})})).then(function(){return Promise.resolve(new a.Fields(n))})}),i.parser.on("pom","Variants",function(t,e){var n={};return Promise.all(Object.keys(e).filter(function(t){return"type"!==t}).map(function(t){return r(e[t]).then(function(e){n[t]=e})})).then(function(){return Promise.resolve(new a.Variants(n))})})},{"./../document":2,"./../parser":7}],10:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}Object.defineProperty(n,"__esModule",{value:!0}),n.repository=n.DEFAULT_DOCUMENT=n.CHANGE=void 0;var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("./emitter"),l=n.CHANGE="change",s=n.DEFAULT_DOCUMENT="#default",c=function(t){function e(){r(this,e);var t=o(this,Object.getPrototypeOf(e).call(this));return t._documents={},t}return i(e,t),a(e,[{key:"get",value:function(t){return this._documents[t]?this._documents[t].content:void 0}},{key:"set",value:function(t,e){this._documents[t]={content:e},this.emit(l,{id:t})}},{key:"has",value:function(t){return!!this._documents[t]}},{key:"toJSON",value:function(){var t=this,e={};return Object.keys(this._documents).forEach(function(n){e[n]={id:n,content:t._documents[n].content.toJSON()}}),e}},{key:"main",get:function(){return this._documents[s]}}]),e}(u.Emitter);n.repository=new c},{"./emitter":4}],11:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,
"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),i=function(){function t(){r(this,t)}return o(t,[{key:"serialize",value:function(t,e,n){return e?e.type?this.handle(t,e.type,e,n):Promise.reject(new Error("Undefined node type")):Promise.reject(new Error("Model is empty"))}},{key:"on",value:function(t,e,n){this._handlers=this._handlers||{},this._handlers[t]=this._handlers[t]||{},this._handlers[t][e]=n}},{key:"handle",value:function(t,e,n,r){var o=this._handlers&&this._handlers[t]&&this._handlers[t][e]?this._handlers[t][e]:null;return o||(o=this._handlers&&this._handlers[t]&&this._handlers[t]["*"]?this._handlers[t]["*"]:null)?o(n,r).then(function(t){return t}):Promise.reject(new Error("No handler defined for "+t+" : "+e))}},{key:"handleContents",value:function(t,e,n){var r=this;return Promise.all(e.map(function(t){return r.serialize("html",t,n)}))}}]),t}();n.serializer=new i},{}],12:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){return l.serializer.serialize("html",t,e)}function i(t,e){var n=document.createElement("p"),r=t.split("").map(function(t){return{"char":t,apply:[]}});return r.push({"char":"",apply:[]}),console.log(t),e.forEach(function(t){var e=t.slice[0],n=e+t.slice[1];console.log(e,n,r.length),t.apply.forEach(function(t){-1==r[e].apply.indexOf(t)&&r[e].apply.push(t),-1==r[n].apply.indexOf("/"+t)&&r[n].apply.push("/"+t)})}),n.innerHTML=r.map(function(t){return t.apply.map(function(t){return"<"+t+">"}).join("")+t["char"]}).join(""),(0,c.arraize)(n.childNodes)}function a(t,e,n,r,o){var a=void 0;return a=r?l.serializer.handleContents("html",r||[],o):Promise.resolve(null),a.then(function(r){t.formats&&t.formats.length&&(r=i(r[0].nodeValue,t.formats));var a=document.createElement(e);return o&&o.edit&&a.setAttribute("data-skaryna-id",t.name),n&&Object.keys(n).forEach(function(t){a.setAttribute(t,n[t])}),Array.isArray(r)&&r.forEach(function(t){return a.appendChild(t)}),a})}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.toHTML=o,n.element=a;var l=t("./../serializer"),s=t("./../document"),c=t("./../util"),f=function(){function t(){r(this,t),this.children=[]}return u(t,[{key:"appendChild",value:function(t){this.children.push(t)}},{key:"outerHTML",get:function(){var t="";return this.children.forEach(function(e){t+=1===e.nodeType?e.outerHTML:e.textContent}),t}}]),t}();l.serializer.on("html","document",function(t,e){return l.serializer.handleContents("html",t.items||[],e).then(function(t){var e=new f;return Array.isArray(t)&&t.forEach(function(t){return e.appendChild(t)}),e})}),l.serializer.on("html","heading",function(t,e){return a(t,"h"+(t.level||1),t.attr(),[new s.TextNode(t.text,t.formats)],e)}),l.serializer.on("html","paragraph",function(t,e){return a(t,"p",t.attr(),[new s.TextNode(t.text,t.formats)],e)}),l.serializer.on("html","image",function(t,e){return a(t,"img",t.attr(),null,e)}),l.serializer.on("html","text",function(t,e){var n=document.createTextNode(t.text);return e&&e.edit,Promise.resolve(n)}),l.serializer.on("html","*",function(t,e){return a(t,t._type,t.attr(),t.items,e)})},{"./../document":2,"./../serializer":11,"./../util":14}],13:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.Toolbar=function(){function t(){r(this,t),this.element=document.createElement("div"),this.element.setAttribute("data-skaryna-toolbar",""),this.element.innerHTML="<div data-skaryna-toolbar-actions>aaaaaaaaa</div><div data-skaryna-toolbar-arrow><span></span></div>",this.arrow=this.element.querySelector("[data-skaryna-toolbar-arrow]");var e=document.createElement("style");e.innerText="\n            [data-skaryna-toolbar] {\n                position: absolute;\n                visibility: hidden;\n                display: none;\n                z-index: 10000;\n                transition: none;\n                top: 0;\n                left: 0;\n            }\n\n            [data-skaryna-toolbar-actions] {\n                position: relative;\n                background-image: linear-gradient(to bottom,rgba(49,49,47,.99),#262625);\n                background-repeat: repeat-x;\n                border-radius: 5px;\n            }\n\n            [data-skaryna-toolbar-arrow] {\n                position: absolute;\n                bottom: -10px;\n                left: 50%;\n                clip: rect(10px 20px 20px 0);\n                margin-left: -10px;\n            }\n\n            [data-skaryna-toolbar-arrow] > span {\n                display: block;\n                width: 20px;\n                height: 20px;\n                background-color: #262625;\n                transform: rotate(45deg) scale(.5);\n            }\n            ",document.body.appendChild(e),document.body.appendChild(this.element)}return o(t,[{key:"getSelectionCoords",value:function(t){var e=t||window,n=e.document,r=n.selection,o=void 0,i=void 0,a=void 0,u=0,l=0;if(r)"Control"!=r.type&&(o=r.createRange(),o.collapse(!0),u=o.boundingLeft,l=o.boundingTop);else if(e.getSelection&&(r=e.getSelection(),r.rangeCount&&(o=r.getRangeAt(0).cloneRange(),o.getClientRects&&(o.collapse(!0),i=o.getClientRects(),i.length>0&&(a=i[0]),u=a.left,l=a.top),0==u&&0==l))){var s=n.createElement("span");if(s.getClientRects){s.appendChild(n.createTextNode("â€‹")),o.insertNode(s),a=s.getClientRects()[0],u=a.left,l=a.top;var c=s.parentNode;c.removeChild(s),c.normalize()}}return{x:u,y:l}}},{key:"anchor",value:function(){var t=this,e=this.getSelectionCoords(),n=void 0,r=void 0;this.element.style.display="block",this.element.style.visibility="visible",setTimeout(function(){n=t.element.getBoundingClientRect(),r=t.arrow.getBoundingClientRect(),console.log(n,e,r),t.show(e.x,e.y-n.height-10)},1)}},{key:"show",value:function(t,e){this.element.style.top=e+"px",this.element.style.left=t+"px"}},{key:"hide",value:function(){this.element.style.display=null,this.element.style.visibility=null}}]),t}()},{}],14:[function(t,e,n){"use strict";function r(t){return[].slice.apply(t)}function o(t,e){var n={};return t.forEach(function(t){"object"===("undefined"==typeof t?"undefined":i(t))&&Object.keys(t).forEach(function(r){e&&-1!==e.indexOf(r)||(n[r]=JSON.parse(JSON.stringify(t[r])))})}),n}Object.defineProperty(n,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};n.arraize=r,n.clone=o},{}],15:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.XHR=function(){function t(){r(this,t)}return o(t,null,[{key:"ajax",value:function(t,e,n,r){return new Promise(function(o,i){var a=new XMLHttpRequest,u=e.toLowerCase();a.open(u,t),"post"!==u&&"put"!==u||a.setRequestHeader("Content-type","application/json"),a.onreadystatechange=function(){var t=4,e=200;a.readyState===t&&(a.status===e?o(a.responseText):"204"===a.status?o(null):i(new Error("Error: "+a.status)))},a.send(n?r?n:JSON.stringify(n):null)})}},{key:"get",value:function(e,n){return t.ajax(e,"get",null,n)}},{key:"post",value:function(e,n,r){return t.ajax(e,"post",n,r)}},{key:"put",value:function(e,n,r){return t.ajax(e,"put",n,r)}},{key:"delete",value:function(e,n){return t.ajax(e,"delete",null,n)}}]),t}()},{}]},{},[1]);
//# sourceMappingURL=skaryna.min.js.map
