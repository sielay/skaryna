!function t(e,n,r){function i(a,u){if(!n[a]){if(!e[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(o)return o(a,!0);var l=new Error("Cannot find module '"+a+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[a]={exports:{}};e[a][0].call(c.exports,function(t){var n=e[a][1][t];return i(n?n:t)},c,c.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t){return String(t).replace(/([.*+?=^!:${}()|[\]\/\\])/g,"\\$1")}function u(t,e){var n,r=null;return t.forEach(function(t){var i=new RegExp(a(t).replace(/\\\*/g,"(.+)")),o=t.split("*").filter(function(t){return t.length}).length,u=e.match(i);u&&(null===r||u.length-o<r)&&(r=u.length-o,n=t)}),n}function s(t){return m[t]}function l(t){if(!t)return null;var e=t.getAttribute("data-skaryna-id");return s(e)}function c(t){for(var e="abcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;r<5;r++)n+=e.charAt(Math.floor(Math.random()*e.length));return Object.keys(m).indexOf(n)===-1?(m[n]=m[n]||t,n):c(t)}Object.defineProperty(n,"__esModule",{value:!0}),n.Variants=n.Fields=n.StaticBlockNode=n.Heading=n.Image=n.Paragraph=n.TextNode=n.Quote=n.Document=n.BlockNode=n.Node=void 0;var f=function _(t,e,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var i=Object.getPrototypeOf(t);return null===i?void 0:_(i,e,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},h=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.escapeRegexp=a,n.bestMatch=u,n.getById=s,n.getByNode=l,n.randomID=c;var p=t("./emitter"),y=t("./util"),d=t("./serializer/toHTML"),m={},v=n.Node=function(t){function e(t){r(this,e);var n=i(this,Object.getPrototypeOf(e).call(this));return n.name=t||c(n),n.__locked=!1,n}return o(e,t),h(e,[{key:"lock",value:function(){this.__locked=!0}},{key:"attr",value:function(){return this.attrs}},{key:"get",value:function(){throw new Error("Should be implemented")}},{key:"set",value:function(){throw new Error("Should be implemented")}},{key:"toJSON",value:function(){var t=new Error("Should be implemented");throw t}},{key:"locked",get:function(){return this.__locked}},{key:"defaultNewItem",get:function(){return null}},{key:"allowedNewItems",get:function(){return[]}}]),e}(p.Emitter),g=n.BlockNode=function(t){function e(t,n,o){r(this,e);var a=i(this,Object.getPrototypeOf(e).call(this));return a._type=t,a.items=n||[],a.attrs=o,a}return o(e,t),h(e,[{key:"get",value:function(t){var e=t.split("."),n=e.shift(),r=e.join("."),i=void 0;return isNaN(n)?null:(i=this.items[+n],r.length&&i?i.get(r):i)}},{key:"setById",value:function(t,e){var n=this,r=!1;return this.items.forEach(function(i,o){if(!r)return i.name===t?(n.items[o]=e,void(r=!0)):void(r=!!i.setById&&i.setById(t,e))}),r}},{key:"set",value:function(t,e){if("@"===t[0])return this.setById(t.slice(1),e);var n=t.split("."),r=n.shift(),i=n.join("."),o=void 0;return isNaN(r)?null:i.length&&o?this.items[+r].set(i,e):void this.items.splice(+r,0,e)}},{key:"toJSON",value:function(){var t={type:this.type,items:this.items.map(function(t){return t.toJSON()})};return this.attrs&&(t.attrs=JSON.parse(JSON.stringify(this.attrs))),t}},{key:"decorate",value:function(t){return(0,d.toHTML)(this,{edit:!0}).then(function(e){t.innerHTML="",(0,y.arraize)(e.children).forEach(function(e){t.appendChild(e)})})}},{key:"empty",get:function(){return this.items.length<=0}},{key:"type",get:function(){return this._type}}]),e}(v),b=(n.Document=function(t){function e(t){return r(this,e),i(this,Object.getPrototypeOf(e).call(this,"document",t))}return o(e,t),h(e,[{key:"defaultNewItem",get:function(){return k}},{key:"allowedNewItems",get:function(){return[k,O]}}]),e}(g),n.Quote=function(t){function e(t){return r(this,e),i(this,Object.getPrototypeOf(e).call(this,"quote",t))}return o(e,t),e}(g),n.TextNode=function(t){function e(t,n,o){r(this,e);var a=i(this,Object.getPrototypeOf(e).call(this));return a.text=t&&t.toString?t.toString():"",a.formats=n||null,a.attrs=o,a}return o(e,t),h(e,[{key:"attr",value:function(){return"text"===this.type?{}:f(Object.getPrototypeOf(e.prototype),"attr",this).call(this)}},{key:"type",get:function(){return"text"}},{key:"empty",get:function(){return!this.text||!this.text.replace(/^([\s\n\r\t]+)|([\s\n\r\t]+)$/,"").length}},{key:"absoluteEmpty",get:function(){return 0===this.text.length}}],[{key:"type",get:function(){return"text"}}]),h(e,[{key:"toJSON",value:function(){var t={type:this.type,text:this.text};return this.formats&&(t.formats=JSON.parse(JSON.stringify(this.formats))),this.attrs&&"text"!==this.type&&(t.attrs=JSON.parse(JSON.stringify(this.attrs))),t}},{key:"append",value:function(t){var n=this;if(!(t instanceof e))throw new Error("Only text nodes can be joined");t.formats&&(this.formats=this.formats||[],t.formats.forEach(function(t){n.formats.push({slice:[t.slice[0]+n.text.length,t.slice[1]],apply:t.apply})})),this.text+=t.text}},{key:"decorate",value:function(t){var e=this;return(0,d.toHTML)(this,{edit:!0}).then(function(n){t.setAttribute("contenteditable",!0),t.setAttribute("data-skaryna-id",e.name),t.innerHTML=n.textContent})}}]),e}(v)),k=n.Paragraph=function(t){function e(t,n,o){return r(this,e),i(this,Object.getPrototypeOf(e).call(this,t,n,o))}return o(e,t),h(e,[{key:"type",get:function(){return"paragraph"}}],[{key:"type",get:function(){return"paragraph"}}]),h(e,[{key:"nextNodeType",get:function(){return e}}]),e}(b),O=n.Image=function(t){function e(t,n,o){r(this,e);var a=i(this,Object.getPrototypeOf(e).call(this,"image"));return a.src=t,a.title=n,a.alt=o,a}return o(e,t),h(e,[{key:"attr",value:function(){var t=f(Object.getPrototypeOf(e.prototype),"attr",this).call(this)||{};return this.src&&(t.src=this.src),this.title&&(t.title=this.title),this.alt&&(t.alt=this.title),t}},{key:"toJSON",value:function(){var t={type:"image",src:this.src};return this.title&&(t.title=this.title),this.alt&&(t.alt=this.alt),t}},{key:"type",get:function(){return"image"}}],[{key:"type",get:function(){return"image"}}]),e}(v);n.Heading=function(t){function e(t,n,o,a){r(this,e);var u=i(this,Object.getPrototypeOf(e).call(this,n,o,a));return u.level=Math.min(6,t||1),u}return o(e,t),h(e,[{key:"attr",value:function(){return f(Object.getPrototypeOf(e.prototype),"attr",this).call(this)}},{key:"toJSON",value:function(){var t=f(Object.getPrototypeOf(e.prototype),"toJSON",this).call(this);return t.level=this.level,t}},{key:"type",get:function(){return"heading"}}],[{key:"type",get:function(){return"heading"}}]),e}(b),n.StaticBlockNode=function(t){function e(){return r(this,e),i(this,Object.getPrototypeOf(e).apply(this,arguments))}return o(e,t),h(e,[{key:"locked",get:function(){return!0}},{key:"defaultNewItem",get:function(){return k}},{key:"allowedNewItems",get:function(){return[k,O]}}]),e}(g),n.Fields=function(t){function e(t){r(this,e);var n=i(this,Object.getPrototypeOf(e).call(this));return n._map=t||{},n}return o(e,t),h(e,[{key:"get",value:function(t){var e=t.split("."),n=e.shift(),r=e.join("."),i=void 0;return i=this._map[n],r.length&&i?i.get(r):i}},{key:"set",value:function(t,e){var n=t.split("."),r=n.shift(),i=n.join("."),o=void 0;return i.length&&o?this._map[r].get(i,e):void(this._map[r]=e)}},{key:"toJSON",value:function(){return(0,y.clone)([this._map,{type:"Fields"}])}},{key:"type",get:function(){return"Fields"}}],[{key:"type",get:function(){return"Fields"}}]),e}(v),n.Variants=function(t){function e(t){r(this,e);var n=i(this,Object.getPrototypeOf(e).call(this));return n._variants=t,n}return o(e,t),h(e,[{key:"best",value:function n(t){var n=u(Object.keys(this._variants),t);return this._variants[n]}},{key:"toJSON",value:function(){return(0,y.clone)([this._map,{type:"Variants"}])}},{key:"type",get:function(){return"Variants"}}],[{key:"type",get:function(){return"Variants"}}]),e}(v)},{"./emitter":2,"./serializer/toHTML":7,"./util":8}],2:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){var n=e.fn,r=e.context,i=e.args,o=[t].concat(i);n.apply(r||null,o)}function o(t,e,n,r,i){this.__listeners=this.__listeners||{},this.__listeners[t]=this.__listeners[t]||[],this.__listeners[t].push({fn:e,context:n,args:r,once:!!i})}function a(t,e,n,r){this.on(t,e,n,r,!0)}function u(t,e,n,r,i){var o=this;this.__listeners&&this.__listeners[t]&&this.getListeners(t,e,n,r,i).forEach(function(e){o.__listeners[t].splice(o.__listeners[t].indexOf(e),1)})}function s(t,e,n){if(this.__listeners&&this.__listeners[t]){var r=this,o=new h(t,e,this,n);this.getListeners(t).forEach(function(e){e.once===!0&&r.off(t,e.fn,e.context,e.args,e.once),i(o,e)})}}function l(t,e){this.on(t,function(n){e.emit(t,n.data,n)})}function c(t,e,n,r){return this.__listeners&&this.__listeners[t]?this.__listeners[t].map(function(t){return(void 0===e||t.fn===e)&&((void 0===n||t.context===n)&&((void 0===r||t.args===r)&&t))}).filter(function(t){return!!t}):null}Object.defineProperty(n,"__esModule",{value:!0});var f=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),h=n.Event=function(){function t(e,n,i,o){r(this,t),Object.defineProperties(this,{name:{value:e,writable:!1},data:{value:n,writable:!1},source:{value:i,writable:!1},parent:{value:o,writable:!1}})}return f(t,[{key:"toJSON",value:function(){return{name:this.name,data:this.data,source:this.source,parent:this.parent}}},{key:"toString",value:function(){return"Event: "+JSON.stringify(this.toJSON())}}]),t}();n.Emitter=function(){function t(){r(this,t)}return f(t,[{key:"on",value:function(){o.apply(this,arguments)}},{key:"once",value:function(){a.apply(this,arguments)}},{key:"off",value:function(){u.apply(this,arguments)}},{key:"emit",value:function(){s.apply(this,arguments)}},{key:"bubbleEvent",value:function(){l.apply(this,arguments)}},{key:"getListeners",value:function(){return c.apply(this,arguments)}}],[{key:"on",value:function(){o.apply(this,arguments)}},{key:"once",value:function(){a.apply(this,arguments)}},{key:"off",value:function(){u.apply(this,arguments)}},{key:"emit",value:function(){s.apply(this,arguments)}},{key:"bubbleEvent",value:function(){l.apply(this,arguments)}},{key:"getListeners",value:function(){return c.apply(this,arguments)}}]),t}()},{}],3:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(){r(this,t)}return i(t,[{key:"parse",value:function(t,e,n,r){return e?this.handle(t,e,n,r):Promise.reject(new Error("Model is empty"))}},{key:"on",value:function(t,e,n){this._handlers=this._handlers||{},this._handlers[t]=this._handlers[t]||{},this._handlers[t][e]=n}},{key:"handle",value:function(t,e,n,r){var i=this._handlers&&this._handlers[t]&&this._handlers[t][e]?this._handlers[t][e]:null;return i||(i=this._handlers&&this._handlers[t]&&this._handlers[t]["*"]?this._handlers[t]["*"]:null)?i(e,n,r).then(function(t){return t}):Promise.reject(new Error("No handler defined for "+t+" : "+e))}}]),t}();n.parser=new o},{}],4:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t){switch(t){case"td":case"th":return"tr";case"tr":return"table";default:return"div"}}function u(t,e){return t&&t.childNodes?Promise.all((0,g.arraize)(t.childNodes).map(function(t){return 1===t.nodeType||3===t.nodeType?s(t,e):null})).then(function(t){return t.filter(function(t){return t.constructor===b.TextNode?!t.absoluteEmpty:null!==t})}):Promise.resolve([])}function s(t,e){if(!t)return Promise.resolve(null);if("string"==typeof t){if(0===t.length)return Promise.resolve(null);var n=document.createElement(a(t.replace("/^(s*)<([a-zA-Z0-9_-]+)","$2").toLowerCase()));return n.innerHTML=t,u(n,e).then(function(t){if(1===t.length)return t[0];if(t.filter(function(t){return!(t instanceof b.TextNode||t instanceof k)}).length)return t.map(function(t){return t instanceof b.BlockNode}).length?new b.Document(t.map(function(t){return"text"===t.type?new b.Paragraph(t.text,t.formats,t.attrs,e):t})):new b.Document(t);var n=t.map(function(t){if(t instanceof k){var n=c([t]),r=m(n,2),i=r[0],o=r[1];return new b.TextNode(i,o,e)}return t}),r=n.shift();return n.forEach(function(t){r.append(t)}),r})}return v.parser.parse("html",3===t.nodeType?"text":t.nodeName,t)}function l(t,e){return"A"===t.type?{type:"A",title:t.attrs.title||e,href:t.attrs.href}:t.type}function c(t){var e="",n=[],r=0;return t.forEach(function(t){if(t instanceof k){var i=c(t.items),o=m(i,2),a=o[0],u=o[1],s={slice:[r,a.length],apply:[l(t,a)]};n.push(s),u.forEach(function(t){n.push({slice:[r+t.slice[0],t.slice[1]],apply:t.apply})}),n.forEach(function(t){n.forEach(function(e,r){t!==e&&t.slice[0]===e.slice[0]&&t.slice[1]===e.slice[1]&&(t.apply=t.apply.concat(e.apply),n.splice(r,1))})}),e+=a,r+=a.length}else t instanceof b.TextNode&&(e+=t.text,r+=t.text.length)}),[e,n]}function f(t,e,n){return u(e,n).then(function(e){var r=c(e),i=m(r,2),o=i[0],a=i[1];return Promise.resolve(new b.Heading(t[1].toLowerCase(),o||"",a.length?a:null,n))})}function h(t,e,n){return u(e,n).then(function(t){var e=c(t),n=m(e,2),r=n[0],i=n[1];return Promise.resolve(new b.Paragraph(r,i.length?i:null))})}function p(t){var e=null;return(0,g.arraize)(t).forEach(function(t){e=e||{},t.value&&t.value.length&&(e[t.name]=t.value)}),e}function y(t){return t&&t.length?t:null}function d(t,e,n){return u(e,n).then(function(t){var e=[],r=[];if(t.forEach(function(i){if(i instanceof b.Paragraph){if(r.length){var o=c(t),a=m(o,2),u=a[0],s=a[1];e.push(Promise.resolve(new b.Paragraph(u,s.length?s:null,n))),r=[]}e.push(Promise.resolve(i))}else r.push(i)}),r.length){var i=c(t),o=m(i,2),a=o[0],u=o[1];e.push(Promise.resolve(new b.Paragraph(a,u.length?u:null,n)))}return Promise.all(e)}).then(function(t){return Promise.resolve(new b.Quote(t))})}Object.defineProperty(n,"__esModule",{value:!0});var m=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var a,u=t[Symbol.iterator]();!(r=(a=u.next()).done)&&(n.push(a.value),!e||n.length!==e);r=!0);}catch(s){i=!0,o=s}finally{try{!r&&u["return"]&&u["return"]()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();n.fromHTML=s;var v=t("./../parser"),g=t("./../util"),b=t("./../document"),k=function(t){function e(){return r(this,e),i(this,Object.getPrototypeOf(e).apply(this,arguments))}return o(e,t),e}(b.BlockNode);v.parser.on("html","text",function(t,e,n){return Promise.resolve(new b.TextNode(e.textContent,null,n))}),v.parser.on("html","H1",f),v.parser.on("html","H2",f),v.parser.on("html","H3",f),v.parser.on("html","H4",f),v.parser.on("html","H5",f),v.parser.on("html","H6",f),v.parser.on("html","P",h),v.parser.on("html","BLOCKQUOTE",d),v.parser.on("html","IMG",function(t,e,n){return Promise.resolve(new b.Image(e.src,y(e.getAttribute("title")),y(e.getAttribute("alt")),(0,g.clone)([p(e.attributes)],["src","title","alt"])),n)}),["ADDRESS","ARTICLE","ASIDE","DIV","FIGURE","FOOTER","HEADER","MAIN","NAV","SECTION"].forEach(function(t){v.parser.on("html",t,function(t,e,n){return u(e,n).then(function(r){return Promise.resolve(new b.StaticBlockNode(t,r,p(e.attributes)),n)})})}),v.parser.on("html","*",function(t,e,n){return u(e,n).then(function(r){return Promise.resolve(new k(t,r,p(e.attributes)),n)})})},{"./../document":1,"./../parser":3,"./../util":8}],5:[function(t,e,n){"use strict";function r(t){return t?o.parser.parse("pom",t.type,t):Promise.resolve(null)}function i(t){return Array.isArray(t)?Promise.all(t.map(function(t){return r(t)})).then(function(t){return t.filter(function(t){return!!t})}):Promise.resolve([])}Object.defineProperty(n,"__esModule",{value:!0}),n.fromPOM=r;var o=t("./../parser"),a=t("./../document");o.parser.on("pom","document",function(t,e){return i(e.items).then(function(t){return new a.Document(t)})}),o.parser.on("pom","heading",function(t,e){return Promise.resolve(new a.Heading(e.level,e.text,e.formats,e.attrs))}),o.parser.on("pom","paragraph",function(t,e){return Promise.resolve(new a.Paragraph(e.text,e.formats,e.attrs))}),o.parser.on("pom","text",function(t,e){return Promise.resolve(new a.TextNode(e.text,e.formats))}),o.parser.on("pom","image",function(t,e){return Promise.resolve(new a.Image(e.src,e.title,e.alt))}),o.parser.on("pom","Fields",function(t,e){var n={};return Promise.all(Object.keys(e).filter(function(t){return"type"!==t}).map(function(t){return r(e[t]).then(function(e){n[t]=e})})).then(function(){return Promise.resolve(new a.Fields(n))})}),o.parser.on("pom","Variants",function(t,e){var n={};return Promise.all(Object.keys(e).filter(function(t){return"type"!==t}).map(function(t){return r(e[t]).then(function(e){n[t]=e})})).then(function(){return Promise.resolve(new a.Variants(n))})})},{"./../document":1,"./../parser":3}],6:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(){r(this,t)}return i(t,[{key:"serialize",value:function(t,e,n){return e?e.type?this.handle(t,e.type,e,n):Promise.reject(new Error("Undefined node type")):Promise.reject(new Error("Model is empty"))}},{key:"on",value:function(t,e,n){this._handlers=this._handlers||{},this._handlers[t]=this._handlers[t]||{},this._handlers[t][e]=n}},{key:"handle",value:function(t,e,n,r){var i=this._handlers&&this._handlers[t]&&this._handlers[t][e]?this._handlers[t][e]:null;return i||(i=this._handlers&&this._handlers[t]&&this._handlers[t]["*"]?this._handlers[t]["*"]:null)?i(n,r).then(function(t){return t}):Promise.reject(new Error("No handler defined for "+t+" : "+e))}},{key:"handleContents",value:function(t,e,n){var r=this;return Promise.all(e.map(function(t){return r.serialize("html",t,n)}))}}]),t}();n.serializer=new o},{}],7:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){return s.serializer.serialize("html",t,e)}function o(t,e){var n=document.createElement("p"),r=t.split("").map(function(t){return{"char":t,apply:[]}});return r.push({"char":"",apply:[]}),e.forEach(function(t){var e=t.slice[0],n=e+t.slice[1];t.apply.forEach(function(t){r[e].apply.indexOf(t)==-1&&r[e].apply.push(t),r[n].apply.indexOf("/"+t)==-1&&r[n].apply.push("/"+t)})}),n.innerHTML=r.map(function(t){return t.apply.map(function(t){return"<"+t+">"}).join("")+t["char"]}).join(""),(0,c.arraize)(n.childNodes)}function a(t,e,n,r,i){var a=void 0;return a=r?s.serializer.handleContents("html",r||[],i):Promise.resolve(null),a.then(function(r){t.formats&&t.formats.length&&(r=o(r[0].nodeValue,t.formats));var a=document.createElement(e);return i&&i.edit&&(a.setAttribute("data-skaryna-id",t.name),t instanceof l.TextNode&&a.setAttribute("contenteditable","true")),n&&Object.keys(n).forEach(function(t){a.setAttribute(t,n[t])}),Array.isArray(r)&&r.forEach(function(t){return a.appendChild(t)}),a})}Object.defineProperty(n,"__esModule",{value:!0});var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.toHTML=i,n.element=a;var s=t("./../serializer"),l=t("./../document"),c=t("./../util"),f=function(){function t(){r(this,t),this.children=[]}return u(t,[{key:"appendChild",value:function(t){this.children.push(t)}},{key:"outerHTML",get:function(){var t="";return this.children.forEach(function(e){t+=1===e.nodeType?e.outerHTML:e.textContent}),t}}]),t}();s.serializer.on("html","document",function(t,e){return s.serializer.handleContents("html",t.items||[],e).then(function(t){var e=new f;return Array.isArray(t)&&t.forEach(function(t){return e.appendChild(t)}),e})}),s.serializer.on("html","heading",function(t,e){return a(t,"h"+(t.level||1),t.attr(),[new l.TextNode(t.text,t.formats)],e)}),s.serializer.on("html","paragraph",function(t,e){return a(t,"p",t.attr(),[new l.TextNode(t.text,t.formats)],e)}),s.serializer.on("html","image",function(t,e){return a(t,"img",t.attr(),null,e)}),s.serializer.on("html","text",function(t,e){var n=document.createTextNode(t.text);return e&&e.edit,Promise.resolve(n)}),s.serializer.on("html","*",function(t,e){return a(t,t._type,t.attr(),t.items,e)})},{"./../document":1,"./../serializer":6,"./../util":8}],8:[function(t,e,n){"use strict";function r(t){return[].slice.apply(t)}function i(t,e){return r(t.querySelectorAll(e))}function o(t,e){var n={};return t.forEach(function(t){"object"===("undefined"==typeof t?"undefined":a(t))&&Object.keys(t).forEach(function(r){e&&e.indexOf(r)!==-1||(n[r]=JSON.parse(JSON.stringify(t[r])))})}),n}Object.defineProperty(n,"__esModule",{value:!0});var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};n.arraize=r,n.query=i,n.clone=o},{}],9:[function(t,e,n){"use strict";var r=t("./skaryna"),i=t("pageobjectmodel/src/util");(0,i.query)(document.body,"[data-skaryna]").forEach(function(t){return r.Skaryna.initEditor(t)}),window.Skaryna=r.Skaryna},{"./skaryna":10,"pageobjectmodel/src/util":8}],10:[function(t,e,n){"use strict";function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e,n){return t.hasAttribute(e)?t.getAttribute(e).toString():n}Object.defineProperty(n,"__esModule",{value:!0}),n.Skaryna=n.Repository=n.XHR=void 0;var u=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=t("pageobjectmodel/src/parser/fromHTML"),l=t("pageobjectmodel/src/parser/fromPOM"),c=(t("pageobjectmodel/src/serializer/toHTML"),t("pageobjectmodel/src/document")),f=t("pageobjectmodel/src/emitter"),h="#default",p=13,y=[p],d=n.XHR=function(){function t(){o(this,t)}return u(t,null,[{key:"ajax",value:function(t,e,n,r){return new Promise(function(i,o){var a=new XMLHttpRequest,u=e.toLowerCase();a.open(u,t),"post"!==u&&"put"!==u||a.setRequestHeader("Content-type","application/json"),a.onreadystatechange=function(){var t=4,e=200;a.readyState===t&&(a.status===e?i(a.responseText):"204"===a.status?i(null):o(new Error("Error: "+a.status)))},a.send(n?r?n:JSON.stringify(n):null)})}},{key:"get",value:function(e,n){return t.ajax(e,"get",null,n)}},{key:"post",value:function(e,n,r){return t.ajax(e,"post",n,r)}},{key:"put",value:function(e,n,r){return t.ajax(e,"put",n,r)}},{key:"delete",value:function(e,n){return t.ajax(e,"delete",null,n)}}]),t}(),m=n.Repository=function(t){function e(){return o(this,e),r(this,Object.getPrototypeOf(e).apply(this,arguments))}return i(e,t),u(e,null,[{key:"report",value:function(t,e,n){var r=this.documents;void 0===e?r[t]=n:(r.hasOwnProperty(t)||(r[t]=new c.Fields),r[t].set(e,n)),this.emit("change",{doc:t,path:e,id:n.name}),document.querySelector("#pom").innerText=JSON.stringify(this.documents,null,2)}},{key:"documents",get:function(){return this._documents=this._documents||{},this._documents}}]),e}(f.Emitter);n.Skaryna=function(){function t(e,n){o(this,t),this._config=n,this.element=e,m.on("change",this.onRepositoryUpdate.bind(this)),this.ready=(0,s.fromHTML)(e).then(function(t){m.report(n.doc,n.path,t)})}return u(t,null,[{key:"initEditor",value:function(e){var n={allow:a(e,"data-skaryna-allow","*").split(/\s*,\s*/),path:a(e,"data-skaryna-path"),placeholder:a(e,"placeholder"),doc:a(e,"data-skaryna-doc",h),variant:a(e,"data-skaryna-variant")},r=new t(e,n);return t.editors.push(r),r}},{key:"load",value:function(t,e){return d.get(t).then(function(t){return(0,l.fromPOM)(JSON.parse(t))}).then(function(t){return m.report(e||h,void 0,t)})}},{key:"editors",get:function(){return this._editors=this._editors||[],this._editors}}]),u(t,[{key:"redrawEditor",value:function(){var t=this,e=m.documents[this._config.doc];if(this._config.path&&(e=e.get(this._config.path)),e&&"Variants"===e.type&&e.best&&(e=e.best(this._config.variant||"*")),e)return e.decorate(t.element).then(function(){t.element.addEventListener("keydown",t.onKeyUp.bind(t))})}},{key:"getCurrentElement",value:function(t){var e=t.ownerDocument||t.document,n=e.defaultView||e.parentWindow,r=void 0,i=void 0;return r="undefined"!=typeof n.getSelection?n.getSelection():e.selection,i=r.focusNode,i===this.element?this.element:(i=this.getEditableNode(i),document.querySelector("#current-element").innerText=i.outerHTML,i)}},{key:"getEditableNode",value:function(t){for(;t&&(!t.hasAttribute||!t.hasAttribute("data-skaryna-id"));)t=t.parentNode;return t}},{key:"onKeyUp",value:function(t){var e=this,n=this.getCurrentElement(t.target);y.indexOf(t.keyCode)!==-1?(t.stopPropagation(),t.preventDefault()):setTimeout(function(){return e.elementUpdated(n)},0)}},{key:"onRepositoryUpdate",value:function(t){t.data.doc===this._config.doc&&void 0===t.data.path&&this.redrawEditor()}},{key:"elementUpdated",value:function(t){var e=this;(0,s.fromHTML)(t).then(function(n){n.name=t.getAttribute("data-skaryna-id").toString(),m.report(e._config.doc,"@"+n.name,n)})}}]),t}()},{"pageobjectmodel/src/document":1,"pageobjectmodel/src/emitter":2,"pageobjectmodel/src/parser/fromHTML":4,"pageobjectmodel/src/parser/fromPOM":5,"pageobjectmodel/src/serializer/toHTML":7}]},{},[9]);
//# sourceMappingURL=skaryna.min.js.map
