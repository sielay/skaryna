{"version":3,"sources":["node_modules/browser-pack/_prelude.js","skaryna.min.js","../pom/src/document.js","../pom/src/emitter.js","../pom/src/parser.js","../pom/src/parser/fromHTML.js","../pom/src/parser/fromPOM.js","../pom/src/serializer.js","../pom/src/serializer/toHTML.js","../pom/src/util.js","src/index.js","src/skaryna.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","_classCallCheck","instance","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","prototype","Object","create","constructor","value","enumerable","writable","configurable","setPrototypeOf","__proto__","escapeRegexp","str","String","replace","bestMatch","list","filter","best","lowest","forEach","rule","regexp","RegExp","weight","split","part","match","getById","id","elementMap","getByNode","element","getAttribute","randomID","setValue","possible","text","charAt","Math","floor","random","keys","indexOf","defineProperty","Variants","Fields","StaticBlockNode","Heading","Image","Paragraph","TextNode","Quote","Document","BlockNode","Node","undefined","_get","get","object","property","receiver","Function","desc","getOwnPropertyDescriptor","parent","getPrototypeOf","getter","_createClass","defineProperties","target","props","descriptor","key","protoProps","staticProps","_emitter","_util","_toHTML","_Emitter","this","_this","name","__locked","attrs","error","Emitter","_Node","type","items","_this2","_type","path","elements","index","shift","rest","join","child","isNaN","_this3","found","setById","slice","set","splice","output","map","item","toJSON","JSON","parse","stringify","toHTML","edit","then","html","innerHTML","arraize","children","appendChild","_BlockNode","_BlockNode2","_Node2","formats","_this6","toString","node","_this7","format","push","apply","setAttribute","textContent","_TextNode","_Node3","source","title","alt","_this9","src","attributes","_TextNode2","level","_this10","min","json","_BlockNode3","arguments","_Node4","data","_this12","_map","clone","_Node5","_this13","_variants","variant","./emitter","./serializer/toHTML","./util","2","execute","event","config","fn","context","args","params","concat","_on","eventName","handler","once","__listeners","_once","on","_off","getListeners","_emit","Event","off","_bubbleEvent","toEmitter","emit","_getListeners","result","3","Parser","token","options","handle","Promise","reject","_handlers","POM","parser","4","whatWrapper","rootNode","processChildren","childNodes","all","nodeType","fromHTML","_document","absoluteEmpty","resolve","input","wrapper","document","createElement","toLowerCase","InlineNode","_stringify","_stringify2","_slicedToArray","first","append","_parser","nodeName","formatType","href","_stringify3","_stringify4","innerText","innerFormats","otherFormat","idx","heading","_stringify5","_stringify6","paragraph","_stringify7","_stringify8","attribute","ifAttr","quote","paragraphs","lastParagraph","_stringify9","_stringify10","_stringify11","_stringify12","sliceIterator","arr","_arr","_n","_d","_e","_s","_i","Symbol","iterator","next","done","err","Array","isArray","./../document","./../parser","./../util","5","fromPOM","model","processChildNodes","fields","variants","6","Serializer","array","content","serialize","serializer","7","_serializer","string","slices","char","from","to","tag","promise","handleContents","nodeValue","elem","attributeName","FakeDoc","outerHTML","contents","attr","createTextNode","./../serializer","8","iterable","query","querySelectorAll","inputs","except","_typeof","obj","9","_skaryna","body","Skaryna","initEditor","window","./skaryna","pageobjectmodel/src/util","10","fallback","hasAttribute","Repository","XHR","_fromHTML","_fromPOM","DEFAULT_DOCUMENT","ENTER","PREVENT","method","raw","xhr","XMLHttpRequest","httpMethod","open","setRequestHeader","onreadystatechange","DONE","OK","readyState","status","responseText","send","ajax","doc","docs","documents","hasOwnProperty","querySelector","_documents","_config","onRepositoryUpdate","bind","ready","report","allow","placeholder","editor","editors","asDocument","pom","_editors","decorate","addEventListener","onKeyUp","ownerDocument","win","defaultView","parentWindow","sel","getSelection","selection","focusNode","getEditableNode","parentNode","current","getCurrentElement","keyCode","stopPropagation","preventDefault","setTimeout","elementUpdated","redrawEditor","pageobjectmodel/src/document","pageobjectmodel/src/emitter","pageobjectmodel/src/parser/fromHTML","pageobjectmodel/src/parser/fromPOM","pageobjectmodel/src/serializer/toHTML"],"mappings":"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","file":"skaryna.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.Variants = exports.Fields = exports.StaticBlockNode = exports.Heading = exports.Image = exports.Paragraph = exports.TextNode = exports.Quote = exports.Document = exports.BlockNode = exports.Node = undefined;\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nexports.escapeRegexp = escapeRegexp;\nexports.bestMatch = bestMatch;\nexports.getById = getById;\nexports.getByNode = getByNode;\nexports.randomID = randomID;\n\nvar _emitter = require('./emitter');\n\nvar _util = require('./util');\n\nvar _toHTML = require('./serializer/toHTML');\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; } /* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nvar elementMap = {};\n\n/**\n * @see https://github.com/component/escape-regexp\n * @param   {string} str\n * @returns {string}\n */\nfunction escapeRegexp(str) {\n    return String(str).replace(/([.*+?=^!:${}()|[\\]\\/\\\\])/g, '\\\\$1');\n}\n\n/**\n * @see App\n * @param   {array} list\n * @param   {string}   filter\n * @returns {string}\n */\nfunction bestMatch(list, filter) {\n    var lowest = null,\n        best;\n\n    list.forEach(function (rule) {\n        var regexp = new RegExp(escapeRegexp(rule).replace(/\\\\\\*/g, '(.+)')),\n            weight = rule.split('*').filter(function (part) {\n            return part.length;\n        }).length,\n            match = filter.match(regexp);\n\n        if (match && (lowest === null || match.length - weight < lowest)) {\n            lowest = match.length - weight;\n            best = rule;\n        }\n    });\n    return best;\n}\n\nfunction getById(id) {\n    return elementMap[id];\n}\n\nfunction getByNode(element) {\n    if (!element) {\n        return null;\n    }\n    var id = element.getAttribute('data-skaryna-id');\n    return getById(id);\n}\n\nfunction randomID(setValue) {\n    var possible = 'abcdefghijklmnopqrstuvwxyz0123456789',\n        text = '';\n\n    for (var i = 0; i < 5; i++) {\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n\n    if (Object.keys(elementMap).indexOf(text) === -1) {\n        elementMap[text] = elementMap[text] || setValue;\n        return text;\n    }\n    return randomID(setValue);\n}\n\n/**\n * @class\n */\n\nvar Node = exports.Node = function (_Emitter) {\n    _inherits(Node, _Emitter);\n\n    /**\n     * @constructs Node\n     */\n    function Node(id) {\n        _classCallCheck(this, Node);\n\n        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(Node).call(this));\n\n        _this.name = id || randomID(_this);\n\n        _this.__locked = false;\n        return _this;\n    }\n\n    _createClass(Node, [{\n        key: 'lock',\n        value: function lock() {\n            this.__locked = true;\n        }\n    }, {\n        key: 'attr',\n        value: function attr() {\n            return this.attrs;\n        }\n    }, {\n        key: 'get',\n        value: function get() {\n            throw new Error('Should be implemented');\n        }\n    }, {\n        key: 'set',\n        value: function set() {\n            throw new Error('Should be implemented');\n        }\n\n        /**\n         * @abstract\n         * @throws {Error}\n         */\n\n    }, {\n        key: 'toJSON',\n        value: function toJSON() {\n            var error = new Error('Should be implemented');\n            throw error;\n        }\n    }, {\n        key: 'locked',\n        get: function get() {\n            return this.__locked;\n        }\n    }, {\n        key: 'defaultNewItem',\n        get: function get() {\n            return null;\n        }\n    }, {\n        key: 'allowedNewItems',\n        get: function get() {\n            return [];\n        }\n    }]);\n\n    return Node;\n}(_emitter.Emitter);\n\n/**\n * @class\n * Defined for Image, Video, Embed, Table, HorizonalRule, Table, List or Component\n */\n\n\nvar BlockNode = exports.BlockNode = function (_Node) {\n    _inherits(BlockNode, _Node);\n\n    function BlockNode(type, items, attrs) {\n        _classCallCheck(this, BlockNode);\n\n        var _this2 = _possibleConstructorReturn(this, Object.getPrototypeOf(BlockNode).call(this));\n\n        _this2._type = type;\n        _this2.items = items || [];\n        _this2.attrs = attrs;\n        return _this2;\n    }\n\n    _createClass(BlockNode, [{\n        key: 'get',\n        value: function get(path) {\n            var elements = path.split('.'),\n                index = elements.shift(),\n                rest = elements.join('.'),\n                child = void 0;\n\n            if (isNaN(index)) {\n                return null;\n            }\n\n            child = this.items[+index];\n\n            if (rest.length && child) {\n                return child.get(rest);\n            }\n\n            return child;\n        }\n    }, {\n        key: 'setById',\n        value: function setById(id, value) {\n            var _this3 = this;\n\n            var found = false;\n            this.items.forEach(function (child, index) {\n                if (found) return;\n                if (child.name === id) {\n                    _this3.items[index] = value;\n                    found = true;\n                    return;\n                }\n                found = child.setById ? child.setById(id, value) : false;\n            });\n            return found;\n        }\n    }, {\n        key: 'set',\n        value: function set(path, value) {\n\n            if (path[0] === '@') {\n                return this.setById(path.slice(1), value);\n            }\n\n            var elements = path.split('.'),\n                index = elements.shift(),\n                rest = elements.join('.'),\n                child = void 0;\n\n            if (isNaN(index)) {\n                return null;\n            }\n\n            if (rest.length && child) {\n                return this.items[+index].set(rest, value);\n            }\n\n            this.items.splice(+index, 0, value);\n        }\n    }, {\n        key: 'toJSON',\n        value: function toJSON() {\n            var output = {\n                type: this.type,\n                items: this.items.map(function (item) {\n                    return item.toJSON();\n                })\n            };\n            if (this.attrs) {\n                output.attrs = JSON.parse(JSON.stringify(this.attrs));\n            }\n            return output;\n        }\n    }, {\n        key: 'decorate',\n        value: function decorate(element) {\n            return (0, _toHTML.toHTML)(this, {\n                edit: true\n            }).then(function (html) {\n                element.innerHTML = '';\n                (0, _util.arraize)(html.children).forEach(function (child) {\n                    element.appendChild(child);\n                });\n            });\n        }\n    }, {\n        key: 'empty',\n        get: function get() {\n            return this.items.length <= 0;\n        }\n    }, {\n        key: 'type',\n        get: function get() {\n            return this._type;\n        }\n    }]);\n\n    return BlockNode;\n}(Node);\n\nvar Document = exports.Document = function (_BlockNode) {\n    _inherits(Document, _BlockNode);\n\n    function Document(items) {\n        _classCallCheck(this, Document);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(Document).call(this, 'document', items));\n    }\n\n    _createClass(Document, [{\n        key: 'defaultNewItem',\n        get: function get() {\n            return Paragraph;\n        }\n    }, {\n        key: 'allowedNewItems',\n        get: function get() {\n            return [Paragraph, Image];\n        }\n    }]);\n\n    return Document;\n}(BlockNode);\n\nvar Quote = exports.Quote = function (_BlockNode2) {\n    _inherits(Quote, _BlockNode2);\n\n    function Quote(items) {\n        _classCallCheck(this, Quote);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(Quote).call(this, 'quote', items));\n    }\n\n    return Quote;\n}(BlockNode);\n\n/**\n * @class\n * Defined for Text, Paragraph, ListItem, Quote and Heading\n */\n\n\nvar TextNode = exports.TextNode = function (_Node2) {\n    _inherits(TextNode, _Node2);\n\n    _createClass(TextNode, [{\n        key: 'attr',\n        value: function attr() {\n            if (this.type === 'text') {\n                return {};\n            }\n            return _get(Object.getPrototypeOf(TextNode.prototype), 'attr', this).call(this);\n        }\n    }, {\n        key: 'type',\n        get: function get() {\n            return 'text';\n        }\n    }, {\n        key: 'empty',\n        get: function get() {\n            return !this.text || !this.text.replace(/^([\\s\\n\\r\\t]+)|([\\s\\n\\r\\t]+)$/, '').length;\n        }\n    }, {\n        key: 'absoluteEmpty',\n        get: function get() {\n            return this.text.length === 0;\n        }\n    }], [{\n        key: 'type',\n        get: function get() {\n            return 'text';\n        }\n    }]);\n\n    function TextNode(text, formats, attrs) {\n        _classCallCheck(this, TextNode);\n\n        var _this6 = _possibleConstructorReturn(this, Object.getPrototypeOf(TextNode).call(this));\n\n        _this6.text = text && text.toString ? text.toString() : '';\n        _this6.formats = formats || null;\n        _this6.attrs = attrs;\n        return _this6;\n    }\n\n    _createClass(TextNode, [{\n        key: 'toJSON',\n        value: function toJSON() {\n            var output = {\n                type: this.type,\n                text: this.text\n            };\n            if (this.formats) {\n                output.formats = JSON.parse(JSON.stringify(this.formats));\n            }\n            if (this.attrs && this.type !== 'text') {\n                output.attrs = JSON.parse(JSON.stringify(this.attrs));\n            }\n            return output;\n        }\n    }, {\n        key: 'append',\n        value: function append(node) {\n            var _this7 = this;\n\n            if (!(node instanceof TextNode)) {\n                throw new Error('Only text nodes can be joined');\n            }\n            if (node.formats) {\n                this.formats = this.formats || [];\n                node.formats.forEach(function (format) {\n                    _this7.formats.push({\n                        slice: [format.slice[0] + _this7.text.length, format.slice[1]],\n                        apply: format.apply\n                    });\n                });\n            }\n            this.text += node.text;\n        }\n    }, {\n        key: 'decorate',\n        value: function decorate(element) {\n            var self = this;\n            return (0, _toHTML.toHTML)(this, {\n                edit: true\n            }).then(function (html) {\n                element.setAttribute('contenteditable', true);\n                element.setAttribute('data-skaryna-id', self.name);\n                element.innerHTML = html.textContent;\n            });\n        }\n    }]);\n\n    return TextNode;\n}(Node);\n\nvar Paragraph = exports.Paragraph = function (_TextNode) {\n    _inherits(Paragraph, _TextNode);\n\n    _createClass(Paragraph, [{\n        key: 'type',\n        get: function get() {\n            return 'paragraph';\n        }\n    }], [{\n        key: 'type',\n        get: function get() {\n            return 'paragraph';\n        }\n    }]);\n\n    function Paragraph(text, formats, attrs) {\n        _classCallCheck(this, Paragraph);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(Paragraph).call(this, text, formats, attrs));\n    }\n\n    _createClass(Paragraph, [{\n        key: 'nextNodeType',\n        get: function get() {\n            return Paragraph;\n        }\n    }]);\n\n    return Paragraph;\n}(TextNode);\n\nvar Image = exports.Image = function (_Node3) {\n    _inherits(Image, _Node3);\n\n    function Image(source, title, alt) {\n        _classCallCheck(this, Image);\n\n        var _this9 = _possibleConstructorReturn(this, Object.getPrototypeOf(Image).call(this, 'image'));\n\n        _this9.src = source;\n        _this9.title = title;\n        _this9.alt = alt;\n        return _this9;\n    }\n\n    _createClass(Image, [{\n        key: 'attr',\n        value: function attr() {\n            var attributes = _get(Object.getPrototypeOf(Image.prototype), 'attr', this).call(this) || {};\n            if (this.src) {\n                attributes.src = this.src;\n            }\n            if (this.title) {\n                attributes.title = this.title;\n            }\n            if (this.alt) {\n                attributes.alt = this.title;\n            }\n            return attributes;\n        }\n    }, {\n        key: 'toJSON',\n        value: function toJSON() {\n            var output = {\n                type: 'image',\n                src: this.src\n            };\n            if (this.title) {\n                output.title = this.title;\n            }\n            if (this.alt) {\n                output.alt = this.alt;\n            }\n            return output;\n        }\n    }, {\n        key: 'type',\n        get: function get() {\n            return 'image';\n        }\n    }], [{\n        key: 'type',\n        get: function get() {\n            return 'image';\n        }\n    }]);\n\n    return Image;\n}(Node);\n\nvar Heading = exports.Heading = function (_TextNode2) {\n    _inherits(Heading, _TextNode2);\n\n    function Heading(level, text, formats, attrs) {\n        _classCallCheck(this, Heading);\n\n        var _this10 = _possibleConstructorReturn(this, Object.getPrototypeOf(Heading).call(this, text, formats, attrs));\n\n        _this10.level = Math.min(6, level || 1);\n        return _this10;\n    }\n\n    _createClass(Heading, [{\n        key: 'attr',\n        value: function attr() {\n            return _get(Object.getPrototypeOf(Heading.prototype), 'attr', this).call(this);\n        }\n    }, {\n        key: 'toJSON',\n        value: function toJSON() {\n            var json = _get(Object.getPrototypeOf(Heading.prototype), 'toJSON', this).call(this);\n            json.level = this.level;\n            return json;\n        }\n    }, {\n        key: 'type',\n        get: function get() {\n            return 'heading';\n        }\n    }], [{\n        key: 'type',\n        get: function get() {\n            return 'heading';\n        }\n    }]);\n\n    return Heading;\n}(TextNode);\n\nvar StaticBlockNode = exports.StaticBlockNode = function (_BlockNode3) {\n    _inherits(StaticBlockNode, _BlockNode3);\n\n    function StaticBlockNode() {\n        _classCallCheck(this, StaticBlockNode);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(StaticBlockNode).apply(this, arguments));\n    }\n\n    _createClass(StaticBlockNode, [{\n        key: 'locked',\n        get: function get() {\n            return true;\n        }\n    }, {\n        key: 'defaultNewItem',\n        get: function get() {\n            return Paragraph;\n        }\n    }, {\n        key: 'allowedNewItems',\n        get: function get() {\n            return [Paragraph, Image];\n        }\n    }]);\n\n    return StaticBlockNode;\n}(BlockNode);\n\nvar Fields = exports.Fields = function (_Node4) {\n    _inherits(Fields, _Node4);\n\n    function Fields(data) {\n        _classCallCheck(this, Fields);\n\n        var _this12 = _possibleConstructorReturn(this, Object.getPrototypeOf(Fields).call(this));\n\n        _this12._map = data || {};\n        return _this12;\n    }\n\n    _createClass(Fields, [{\n        key: 'get',\n        value: function get(path) {\n            var elements = path.split('.'),\n                index = elements.shift(),\n                rest = elements.join('.'),\n                child = void 0;\n\n            child = this._map[index];\n\n            if (rest.length && child) {\n                return child.get(rest);\n            }\n\n            return child;\n        }\n    }, {\n        key: 'set',\n        value: function set(path, value) {\n            var elements = path.split('.'),\n                index = elements.shift(),\n                rest = elements.join('.'),\n                child = void 0;\n\n            if (rest.length && child) {\n                return this._map[index].get(rest, value);\n            }\n\n            this._map[index] = value;\n        }\n    }, {\n        key: 'toJSON',\n        value: function toJSON() {\n            return (0, _util.clone)([this._map, {\n                type: 'Fields'\n            }]);\n        }\n    }, {\n        key: 'type',\n        get: function get() {\n            return 'Fields';\n        }\n    }], [{\n        key: 'type',\n        get: function get() {\n            return 'Fields';\n        }\n    }]);\n\n    return Fields;\n}(Node);\n\nvar Variants = exports.Variants = function (_Node5) {\n    _inherits(Variants, _Node5);\n\n    function Variants(data) {\n        _classCallCheck(this, Variants);\n\n        var _this13 = _possibleConstructorReturn(this, Object.getPrototypeOf(Variants).call(this));\n\n        _this13._variants = data;\n        return _this13;\n    }\n\n    _createClass(Variants, [{\n        key: 'best',\n        value: function best(variant) {\n            var best = bestMatch(Object.keys(this._variants), variant);\n            return this._variants[best];\n        }\n    }, {\n        key: 'toJSON',\n        value: function toJSON() {\n            return (0, _util.clone)([this._map, {\n                type: 'Variants'\n            }]);\n        }\n    }, {\n        key: 'type',\n        get: function get() {\n            return 'Variants';\n        }\n    }], [{\n        key: 'type',\n        get: function get() {\n            return 'Variants';\n        }\n    }]);\n\n    return Variants;\n}(Node);\n\n},{\"./emitter\":2,\"./serializer/toHTML\":7,\"./util\":8}],2:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\n/**\n * @namespace skaryna\n *\n * @class EventConfig\n * @property {function} fn listener\n * @property {object} context\n * @property {array} args arguments to be passed\n * @property {boolean} once if should be fired only once\n */\n\n/**\n * @class Event\n */\nvar Event = exports.Event = function () {\n    /**\n     * Contructor\n     * @constructs Event\n     * @param {string} name\n     * @param {mixed} data\n     * @param {object} source\n     * @param {Event} parent\n     */\n    function Event(name, data, source, parent) {\n        _classCallCheck(this, Event);\n\n        Object.defineProperties(this, {\n            /**\n             * @property {string}\n             * @name Event#name\n             */\n            name: {\n                value: name,\n                writable: false\n            },\n            /**\n             * @property {mixed}\n             * @name Event#data\n             */\n            data: {\n                value: data,\n                writable: false\n            },\n            /**\n             * @property {object}\n             * @name Event#source\n             */\n            source: {\n                value: source,\n                writable: false\n            },\n            /**\n             * @property {Event|null}\n             * @name Event#parent\n             */\n            parent: {\n                value: parent,\n                writable: false\n            }\n        });\n    }\n\n    _createClass(Event, [{\n        key: 'toJSON',\n        value: function toJSON() {\n            return {\n                name: this.name,\n                data: this.data,\n                source: this.source,\n                parent: this.parent\n            };\n        }\n    }, {\n        key: 'toString',\n        value: function toString() {\n            return 'Event: ' + JSON.stringify(this.toJSON());\n        }\n    }]);\n\n    return Event;\n}();\n\n/**\n * [[Description]]\n * @param {Event} cofnig\n * @param {EventConfig} thisObject\n */\n\n\nfunction execute(event, config) {\n    var fn = config.fn;\n    var context = config.context;\n    var args = config.args;\n    var params = [event].concat(args);\n\n    fn.apply(context || null, params);\n}\n\n/**\n * Adds listener for an event\n * @param {string} eventName\n * @param {function} handler\n * @param {object} context\n * @param {array} args\n * @param {boolean} once\n */\nfunction _on(eventName, handler, context, args, once) {\n    this.__listeners = this.__listeners || {};\n    this.__listeners[eventName] = this.__listeners[eventName] || [];\n    this.__listeners[eventName].push({\n        fn: handler,\n        context: context,\n        args: args,\n        once: !!once\n    });\n}\n\n/**\n * Adds listener for an event that should be called once\n * @param {string} eventName\n * @param {function} handler\n * @param {object} context\n * @param {array} args\n */\nfunction _once(eventName, handler, context, args) {\n    this.on(eventName, handler, context, args, true);\n}\n\n/**\n * Adds listener for an event\n * @param {string} eventName\n * @param {function} handler\n * @param {object} context\n * @param {array} args\n * @param {boolean} once\n */\nfunction _off(eventName, handler, context, args, once) {\n    var _this = this;\n\n    if (!this.__listeners || !this.__listeners[eventName]) {\n        return;\n    }\n    this.getListeners(eventName, handler, context, args, once).forEach(function (config) {\n        _this.__listeners[eventName].splice(_this.__listeners[eventName].indexOf(config), 1);\n    });\n}\n\n/**\n * Emits an event\n * @param {string} eventName\n * @param {mixed} data\n * @param {Event|null} parent\n */\nfunction _emit(eventName, data, parent) {\n    if (!this.__listeners || !this.__listeners[eventName]) {\n        return;\n    }\n\n    var self = this,\n        event = new Event(eventName, data, this, parent);\n\n    this.getListeners(eventName).forEach(function (config) {\n        if (config.once === true) {\n            self.off(eventName, config.fn, config.context, config.args, config.once);\n        }\n        execute(event, config);\n    });\n}\n\n/**\n * Bubbles event to other emitter\n * @param {string} eventName\n * @param {object} toEmitter\n */\nfunction _bubbleEvent(eventName, toEmitter) {\n    this.on(eventName, function (event) {\n        toEmitter.emit(eventName, event.data, event);\n    });\n}\n\n/**\n * Gets all listeners that match criteria\n * @param   {string} eventName required\n * @param   {function} handler   if defined will be used for match\n * @param   {object} context   if defined will be used for match\n * @param   {array} args      if defined will be used for match\n * @returns {array<EventConfig>|null}\n */\nfunction _getListeners(eventName, handler, context, args) {\n    if (!this.__listeners || !this.__listeners[eventName]) {\n        return null;\n    }\n\n    return this.__listeners[eventName].map(function (config) {\n        if (handler !== undefined && config.fn !== handler) {\n            return false;\n        }\n        if (context !== undefined && config.context !== context) {\n            return false;\n        }\n        if (args !== undefined && config.args !== args) {\n            return false;\n        }\n        return config;\n    }).filter(function (result) {\n        return !!result;\n    });\n}\n\n/*\n * @class Emitter\n */\n\nvar Emitter = exports.Emitter = function () {\n    function Emitter() {\n        _classCallCheck(this, Emitter);\n    }\n\n    _createClass(Emitter, [{\n        key: 'on',\n        value: function on() {\n            _on.apply(this, arguments);\n        }\n    }, {\n        key: 'once',\n        value: function once() {\n            _once.apply(this, arguments);\n        }\n    }, {\n        key: 'off',\n        value: function off() {\n            _off.apply(this, arguments);\n        }\n    }, {\n        key: 'emit',\n        value: function emit() {\n            _emit.apply(this, arguments);\n        }\n    }, {\n        key: 'bubbleEvent',\n        value: function bubbleEvent() {\n            _bubbleEvent.apply(this, arguments);\n        }\n    }, {\n        key: 'getListeners',\n        value: function getListeners() {\n            return _getListeners.apply(this, arguments);\n        }\n    }], [{\n        key: 'on',\n        value: function on() {\n            _on.apply(this, arguments);\n        }\n    }, {\n        key: 'once',\n        value: function once() {\n            _once.apply(this, arguments);\n        }\n    }, {\n        key: 'off',\n        value: function off() {\n            _off.apply(this, arguments);\n        }\n    }, {\n        key: 'emit',\n        value: function emit() {\n            _emit.apply(this, arguments);\n        }\n    }, {\n        key: 'bubbleEvent',\n        value: function bubbleEvent() {\n            _bubbleEvent.apply(this, arguments);\n        }\n    }, {\n        key: 'getListeners',\n        value: function getListeners() {\n            return _getListeners.apply(this, arguments);\n        }\n    }]);\n\n    return Emitter;\n}();\n\n},{}],3:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nvar Parser = function () {\n    function Parser() {\n        _classCallCheck(this, Parser);\n    }\n\n    _createClass(Parser, [{\n        key: 'parse',\n        value: function parse(format, token, data, options) {\n\n            if (!token) {\n                return Promise.reject(new Error('Model is empty'));\n            }\n\n            return this.handle(format, token, data, options);\n        }\n    }, {\n        key: 'on',\n        value: function on(format, token, handler) {\n            this._handlers = this._handlers || {};\n            this._handlers[format] = this._handlers[format] || {};\n            this._handlers[format][token] = handler;\n        }\n    }, {\n        key: 'handle',\n        value: function handle(format, token, data, options) {\n\n            var handler = this._handlers && this._handlers[format] && this._handlers[format][token] ? this._handlers[format][token] : null;\n            if (!handler) {\n                handler = this._handlers && this._handlers[format] && this._handlers[format]['*'] ? this._handlers[format]['*'] : null;\n                if (!handler) {\n                    return Promise.reject(new Error('No handler defined for ' + format + ' : ' + token));\n                }\n            }\n\n            return handler(token, data, options).then(function (POM) {\n                return POM;\n            });\n        }\n    }]);\n\n    return Parser;\n}();\n\nvar parser = exports.parser = new Parser();\n\n},{}],4:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }(); /* jslint esnext:true, node:true */\n/* globals document */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nexports.fromHTML = fromHTML;\n\nvar _parser = require('./../parser');\n\nvar _util = require('./../util');\n\nvar _document = require('./../document');\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction whatWrapper(rootNode) {\n    switch (rootNode) {\n        case 'td':\n        case 'th':\n            return 'tr';\n        case 'tr':\n            return 'table';\n        default:\n            return 'div';\n    }\n}\n\nfunction editMode(node, element, options) {\n    if (options && options.edit) {\n        element.setAttribute('data-skaryna-id', node.name);\n        node.__element = element;\n    }\n    return node;\n}\n\nfunction processChildren(element, options) {\n    if (!element || !element.childNodes) {\n        return Promise.resolve([]);\n    }\n    return Promise.all((0, _util.arraize)(element.childNodes).map(function (child) {\n        if (child.nodeType === 1 || child.nodeType === 3) {\n            return fromHTML(child, options);\n        } else {\n            return null;\n        }\n    })).then(function (items) {\n        return items.filter(function (item) {\n            if (item.constructor === _document.TextNode) {\n                return !item.absoluteEmpty;\n            }\n            return item !== null;\n        });\n    });\n}\n\n/**\n * Parse POM JSON representation\n * @param   {string|HTMLElement}   model\n * @param   {options} options\n * @returns {Promise<Node>}\n */\nfunction fromHTML(input, options) {\n\n    if (!input) {\n        return Promise.resolve(null);\n    }\n\n    if (typeof input === 'string') {\n        if (input.length === 0) {\n            return Promise.resolve(null);\n        }\n        var wrapper = document.createElement(whatWrapper(input.replace('/^(\\s*)<([a-zA-Z0-9_-]+)', '$2').toLowerCase()));\n        wrapper.innerHTML = input;\n        return processChildren(wrapper, options).then(function (children) {\n\n            if (children.length === 1) {\n                return children[0];\n            }\n            if (children.filter(function (item) {\n                return !(item instanceof _document.TextNode || item instanceof InlineNode);\n            }).length) {\n                if (children.map(function (item) {\n                    return item instanceof _document.BlockNode;\n                }).length) {\n                    return new _document.Document(children.map(function (item) {\n                        if (item.type === 'text') {\n                            return new _document.Paragraph(item.text, item.formats, item.attrs, options);\n                        }\n                        return item;\n                    }));\n                }\n                return new _document.Document(children);\n            }\n            var items = children.map(function (item) {\n                if (item instanceof InlineNode) {\n                    var _stringify = stringify([item]);\n\n                    var _stringify2 = _slicedToArray(_stringify, 2);\n\n                    var text = _stringify2[0];\n                    var formats = _stringify2[1];\n\n                    return new _document.TextNode(text, formats, options);\n                }\n\n                return item;\n            }),\n                first = items.shift();\n            items.forEach(function (item) {\n                first.append(item);\n            });\n            return first;\n        });\n    }\n    return _parser.parser.parse('html', input.nodeType === 3 ? 'text' : input.nodeName, input);\n}\n\nvar InlineNode = function (_BlockNode) {\n    _inherits(InlineNode, _BlockNode);\n\n    function InlineNode() {\n        _classCallCheck(this, InlineNode);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(InlineNode).apply(this, arguments));\n    }\n\n    return InlineNode;\n}(_document.BlockNode);\n\nfunction formatType(item, text) {\n    if (item.type === 'A') {\n        return {\n            type: 'A',\n            title: item.attrs.title || text,\n            href: item.attrs.href\n        };\n    }\n    return item.type;\n}\n\nfunction stringify(items) {\n    var text = '',\n        formats = [],\n        index = 0;\n\n    items.forEach(function (item) {\n        if (item instanceof InlineNode) {\n            var _stringify3 = stringify(item.items);\n\n            var _stringify4 = _slicedToArray(_stringify3, 2);\n\n            var innerText = _stringify4[0];\n            var innerFormats = _stringify4[1];\n            var format = {\n                slice: [index, innerText.length],\n                apply: [formatType(item, innerText)]\n            };\n            formats.push(format);\n            innerFormats.forEach(function (format) {\n                formats.push({\n                    slice: [index + format.slice[0], format.slice[1]],\n                    apply: format.apply\n                });\n            });\n            formats.forEach(function (format) {\n                formats.forEach(function (otherFormat, idx) {\n                    if (format !== otherFormat && format.slice[0] === otherFormat.slice[0] && format.slice[1] === otherFormat.slice[1]) {\n                        format.apply = format.apply.concat(otherFormat.apply);\n                        formats.splice(idx, 1);\n                    }\n                });\n            });\n            text += innerText;\n            index += innerText.length;\n        } else if (item instanceof _document.TextNode) {\n            text += item.text;\n            index += item.text.length;\n        } else {}\n    });\n\n    return [text, formats];\n}\n\nfunction heading(token, data, options) {\n\n    return processChildren(data, options).then(function (items) {\n        var _stringify5 = stringify(items);\n\n        var _stringify6 = _slicedToArray(_stringify5, 2);\n\n        var text = _stringify6[0];\n        var formats = _stringify6[1];\n\n        return Promise.resolve(new _document.Heading(token[1].toLowerCase(), text || '', formats.length ? formats : null, options));\n    });\n}\n\nfunction paragraph(token, data, options) {\n    return processChildren(data, options).then(function (items) {\n        var _stringify7 = stringify(items);\n\n        var _stringify8 = _slicedToArray(_stringify7, 2);\n\n        var text = _stringify8[0];\n        var formats = _stringify8[1];\n\n        return Promise.resolve(new _document.Paragraph(text, formats.length ? formats : null));\n    });\n}\n\nfunction attributes(input) {\n    var output = null;\n    (0, _util.arraize)(input).forEach(function (attribute) {\n        output = output || {};\n        if (attribute.value && attribute.value.length) {\n            output[attribute.name] = attribute.value;\n        }\n    });\n    return output;\n}\n\nfunction ifAttr(value) {\n    if (value && value.length) {\n        return value;\n    }\n    return null;\n}\n\nfunction quote(token, data, options) {\n    return processChildren(data, options).then(function (items) {\n\n        var paragraphs = [],\n            lastParagraph = [];\n        items.forEach(function (item) {\n            if (item instanceof _document.Paragraph) {\n                if (lastParagraph.length) {\n                    var _stringify9 = stringify(items);\n\n                    var _stringify10 = _slicedToArray(_stringify9, 2);\n\n                    var text = _stringify10[0];\n                    var formats = _stringify10[1];\n\n                    paragraphs.push(Promise.resolve(new _document.Paragraph(text, formats.length ? formats : null, options)));\n                    lastParagraph = [];\n                }\n                paragraphs.push(Promise.resolve(item));\n            } else {\n                lastParagraph.push(item);\n            }\n        });\n        if (lastParagraph.length) {\n            var _stringify11 = stringify(items);\n\n            var _stringify12 = _slicedToArray(_stringify11, 2);\n\n            var text = _stringify12[0];\n            var formats = _stringify12[1];\n\n            paragraphs.push(Promise.resolve(new _document.Paragraph(text, formats.length ? formats : null, options)));\n        }\n\n        return Promise.all(paragraphs);\n    }).then(function (items) {\n        return Promise.resolve(new _document.Quote(items));\n    });\n}\n\n_parser.parser.on('html', 'text', function (token, data, options) {\n    return Promise.resolve(new _document.TextNode(data.textContent, null, options));\n});\n_parser.parser.on('html', 'H1', heading);\n_parser.parser.on('html', 'H2', heading);\n_parser.parser.on('html', 'H3', heading);\n_parser.parser.on('html', 'H4', heading);\n_parser.parser.on('html', 'H5', heading);\n_parser.parser.on('html', 'H6', heading);\n_parser.parser.on('html', 'P', paragraph);\n_parser.parser.on('html', 'BLOCKQUOTE', quote);\n\n_parser.parser.on('html', 'IMG', function (token, data, options) {\n    return Promise.resolve(new _document.Image(data.src, ifAttr(data.getAttribute('title')), ifAttr(data.getAttribute('alt')), (0, _util.clone)([attributes(data.attributes)], ['src', 'title', 'alt'])), options);\n});\n\n['ADDRESS', 'ARTICLE', 'ASIDE', 'DIV', 'FIGURE', 'FOOTER', 'HEADER', 'MAIN', 'NAV', 'SECTION'].forEach(function (nodeName) {\n    _parser.parser.on('html', nodeName, function (token, data, options) {\n        return processChildren(data, options).then(function (items) {\n            return Promise.resolve(new _document.StaticBlockNode(token, items, attributes(data.attributes)), options);\n        });\n    });\n});\n\n_parser.parser.on('html', '*', function (token, data, options) {\n    return processChildren(data, options).then(function (items) {\n        return Promise.resolve(new InlineNode(token, items, attributes(data.attributes)), options);\n    });\n});\n/*\nparser.on('html', '#text', (token, data) => {\n    return Promise.resolve(new TextNode(data.textContent));\n});\n\n[\n    ['b', 'strong'],\n    ['big', 'strong'],\n    ['i', 'em'],\n    'small',\n    ['tt', 'code'],\n    ['abbr', 'semantic', 'abbr'],\n    ['acronym', 'abbr', 'abbr'],\n    ['cite', 'semantic', 'cite'],\n    'code',\n    ['dfn', 'semantic', 'definition'],\n    'em',\n    ['time', 'semantic', 'time'],\n    ['var', 'code', 'var'],\n    ['kbd', 'code', 'kbd'],\n    'strong',\n    ['samp', 'code', 'sample'],\n    'bdo',\n    'a',\n    //'br',\n    //'img,\n    //'map',\n    //'object',\n    ['q', 'semantic', 'quotation'],\n    //script\n    'span',\n    del,\n    s\n    'sub',\n    'sup',\n    //button\n    //input\n    //label\n    //select\n    //textarea\n].forEach((inlineRule) => {\n\n    let input = typeof inlineRule === 'string' ? inlineRule : inlineRule[0];\n\n    parser.on('html', input, (token, data) => {\n        return processChildren(data)\n            .then((items) => {\n\n            });\n    });\n\n});\n*/\n\n},{\"./../document\":1,\"./../parser\":3,\"./../util\":8}],5:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.fromPOM = fromPOM;\n\nvar _parser = require('./../parser');\n\nvar _document = require('./../document');\n\n/**\n * Parse POM JSON representation\n * @param   {object}   model\n * @param   {options} options\n * @returns {Promise<Node>}\n */\n/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nfunction fromPOM(model) {\n    if (!model) {\n        return Promise.resolve(null);\n    }\n    return _parser.parser.parse('pom', model.type, model);\n}\n\nfunction processChildNodes(items) {\n    if (!Array.isArray(items)) {\n        return Promise.resolve([]);\n    }\n    return Promise.all(items.map(function (item) {\n        return fromPOM(item);\n    })).then(function (items) {\n        return items.filter(function (item) {\n            return !!item;\n        });\n    });\n}\n\n_parser.parser.on('pom', 'document', function (token, data) {\n    return processChildNodes(data.items).then(function (items) {\n        return new _document.Document(items);\n    });\n});\n\n_parser.parser.on('pom', 'heading', function (token, data) {\n    return Promise.resolve(new _document.Heading(data.level, data.text, data.formats, data.attrs));\n});\n\n_parser.parser.on('pom', 'paragraph', function (token, data) {\n    return Promise.resolve(new _document.Paragraph(data.text, data.formats, data.attrs));\n});\n\n_parser.parser.on('pom', 'text', function (token, data) {\n    return Promise.resolve(new _document.TextNode(data.text, data.formats));\n});\n\n_parser.parser.on('pom', 'image', function (token, data) {\n    return Promise.resolve(new _document.Image(data.src, data.title, data.alt));\n});\n\n_parser.parser.on('pom', 'Fields', function (token, data) {\n    var fields = {};\n    return Promise.all(Object.keys(data).filter(function (key) {\n        return key !== 'type';\n    }).map(function (key) {\n        return fromPOM(data[key]).then(function (POM) {\n            fields[key] = POM;\n        });\n    })).then(function () {\n        return Promise.resolve(new _document.Fields(fields));\n    });\n});\n\n_parser.parser.on('pom', 'Variants', function (token, data) {\n    var variants = {};\n    return Promise.all(Object.keys(data).filter(function (key) {\n        return key !== 'type';\n    }).map(function (key) {\n        return fromPOM(data[key]).then(function (POM) {\n            variants[key] = POM;\n        });\n    })).then(function () {\n        return Promise.resolve(new _document.Variants(variants));\n    });\n});\n\n},{\"./../document\":1,\"./../parser\":3}],6:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nvar Serializer = function () {\n    function Serializer() {\n        _classCallCheck(this, Serializer);\n    }\n\n    _createClass(Serializer, [{\n        key: 'serialize',\n        value: function serialize(format, node, options) {\n\n            if (!node) {\n                return Promise.reject(new Error('Model is empty'));\n            }\n\n            if (!node.type) {\n                return Promise.reject(new Error('Undefined node type'));\n            }\n\n            return this.handle(format, node.type, node, options);\n        }\n    }, {\n        key: 'on',\n        value: function on(format, nodeType, handler) {\n            this._handlers = this._handlers || {};\n            this._handlers[format] = this._handlers[format] || {};\n            this._handlers[format][nodeType] = handler;\n        }\n    }, {\n        key: 'handle',\n        value: function handle(format, nodeType, node, options) {\n\n            var handler = this._handlers && this._handlers[format] && this._handlers[format][nodeType] ? this._handlers[format][nodeType] : null;\n            if (!handler) {\n                handler = this._handlers && this._handlers[format] && this._handlers[format]['*'] ? this._handlers[format]['*'] : null;\n                if (!handler) {\n                    return Promise.reject(new Error('No handler defined for ' + format + ' : ' + nodeType));\n                }\n            }\n            return handler(node, options).then(function (html) {\n                return html;\n            });\n        }\n    }, {\n        key: 'handleContents',\n        value: function handleContents(format, array, options) {\n            var self = this;\n            return Promise.all(array.map(function (content) {\n                return self.serialize('html', content, options);\n            }));\n        }\n    }]);\n\n    return Serializer;\n}();\n\nvar serializer = exports.serializer = new Serializer();\n\n},{}],7:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /* jslint esnext:true, node:true */\n/* globals document */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nexports.toHTML = toHTML;\nexports.element = element;\n\nvar _serializer = require('./../serializer');\n\nvar _document = require('./../document');\n\nvar _util = require('./../util');\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction toHTML(model, options) {\n    return _serializer.serializer.serialize('html', model, options);\n}\n\nfunction otherAttrs(object, except) {\n    var result = {};\n    Object.keys(object).filter(function (key) {\n        return except.indexOf(key) === -1;\n    }).forEach(function (key) {\n        result[key] = object[key];\n    });\n    return result;\n}\n\nfunction format(string, formats) {\n    var wrapper = document.createElement('p'),\n        slices = string.split('').map(function (char) {\n        return {\n            char: char,\n            apply: []\n        };\n    });\n\n    slices.push({\n        char: '',\n        apply: []\n    });\n\n    formats.forEach(function (format) {\n        var from = format.slice[0],\n            to = from + format.slice[1];\n\n        format.apply.forEach(function (apply) {\n            if (slices[from].apply.indexOf(apply) == -1) {\n                slices[from].apply.push(apply);\n            }\n            if (slices[to].apply.indexOf('/' + apply) == -1) {\n                slices[to].apply.push('/' + apply);\n            }\n        });\n    });\n    wrapper.innerHTML = slices.map(function (char) {\n        return char.apply.map(function (tag) {\n            return '<' + tag + '>';\n        }).join('') + char.char;\n    }).join('');\n    return (0, _util.arraize)(wrapper.childNodes);\n}\n\nfunction element(node, nodeType, attributes, content, options) {\n\n    var promise = void 0;\n\n    if (content) {\n\n        promise = _serializer.serializer.handleContents('html', content || [], options);\n    } else {\n        promise = Promise.resolve(null);\n    }\n\n    return promise.then(function (content) {\n\n        if (node.formats && node.formats.length) {\n            content = format(content[0].nodeValue, node.formats);\n        }\n\n        var elem = document.createElement(nodeType);\n        if (options && options.edit) {\n            elem.setAttribute('data-skaryna-id', node.name);\n            if (node instanceof _document.TextNode) {\n                elem.setAttribute('contenteditable', 'true');\n            }\n        }\n        if (attributes) {\n            Object.keys(attributes).forEach(function (attributeName) {\n                elem.setAttribute(attributeName, attributes[attributeName]);\n            });\n        }\n        if (Array.isArray(content)) {\n            content.forEach(function (child) {\n                return elem.appendChild(child);\n            });\n        }\n        return elem;\n    });\n}\n\nvar FakeDoc = function () {\n    function FakeDoc() {\n        _classCallCheck(this, FakeDoc);\n\n        this.children = [];\n    }\n\n    _createClass(FakeDoc, [{\n        key: 'appendChild',\n        value: function appendChild(child) {\n            this.children.push(child);\n        }\n    }, {\n        key: 'outerHTML',\n        get: function get() {\n            var str = '';\n            this.children.forEach(function (child) {\n                if (child.nodeType === 1) {\n                    str += child.outerHTML;\n                } else {\n                    str += child.textContent;\n                }\n            });\n            return str;\n        }\n    }]);\n\n    return FakeDoc;\n}();\n\n_serializer.serializer.on('html', 'document', function (node, options) {\n    return _serializer.serializer.handleContents('html', node.items || [], options).then(function (contents) {\n        var output = new FakeDoc();\n        if (Array.isArray(contents)) {\n            contents.forEach(function (child) {\n                return output.appendChild(child);\n            });\n        }\n        return output;\n    });\n});\n\n_serializer.serializer.on('html', 'heading', function (node, options) {\n    return element(node, 'h' + (node.level || 1), node.attr(), [new _document.TextNode(node.text, node.formats)], options);\n});\n\n_serializer.serializer.on('html', 'paragraph', function (node, options) {\n    return element(node, 'p', node.attr(), [new _document.TextNode(node.text, node.formats)], options);\n});\n\n_serializer.serializer.on('html', 'image', function (node, options) {\n    return element(node, 'img', node.attr(), null, options);\n});\n\n_serializer.serializer.on('html', 'text', function (node, options) {\n    var element = document.createTextNode(node.text);\n    if (options && options.edit) {\n        //element.setAttribute('name', node.name);\n    }\n    return Promise.resolve(element);\n});\n\n_serializer.serializer.on('html', '*', function (node, options) {\n    return element(node, node._type, node.attr(), node.items, options);\n});\n\n},{\"./../document\":1,\"./../serializer\":6,\"./../util\":8}],8:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\nexports.arraize = arraize;\nexports.query = query;\nexports.clone = clone;\n/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\n/**\n * Convert iterable objects into arrays\n * @param   {Iterable} iterable\n * @returns {Array}\n */\nfunction arraize(iterable) {\n    return [].slice.apply(iterable);\n}\n\nfunction query(node, query) {\n    return arraize(node.querySelectorAll(query));\n}\n\nfunction clone(inputs, except) {\n    var result = {};\n    inputs.forEach(function (input) {\n        if ((typeof input === 'undefined' ? 'undefined' : _typeof(input)) !== 'object') {\n            return;\n        }\n        Object.keys(input).forEach(function (key) {\n            if (except && except.indexOf(key) !== -1) {\n                return;\n            }\n            result[key] = JSON.parse(JSON.stringify(input[key]));\n        });\n    });\n    return result;\n}\n\n},{}],9:[function(require,module,exports){\n'use strict';\n\nvar _skaryna = require('./skaryna');\n\nvar _util = require('pageobjectmodel/src/util');\n\n/* jslint esnext:true, node:true, browser:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\n(0, _util.query)(document.body, '[data-skaryna]').forEach(function (element) {\n    return _skaryna.Skaryna.initEditor(element);\n});\n\nwindow.Skaryna = _skaryna.Skaryna;\n\n},{\"./skaryna\":10,\"pageobjectmodel/src/util\":8}],10:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.Skaryna = exports.Repository = exports.XHR = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /* jslint esnext:true, node:true, browser:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nvar _fromHTML = require('pageobjectmodel/src/parser/fromHTML');\n\nvar _fromPOM = require('pageobjectmodel/src/parser/fromPOM');\n\nvar _toHTML = require('pageobjectmodel/src/serializer/toHTML');\n\nvar _document = require('pageobjectmodel/src/document');\n\nvar _emitter = require('pageobjectmodel/src/emitter');\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar DEFAULT_DOCUMENT = '#default';\n\nvar BACKSPACE = 8,\n    TAB = 9,\n    ENTER = 13,\n    SHIFT = 16,\n    CAPS = 20,\n    ESC = 27,\n    SPACE = 32,\n    UP = 38,\n    DOWN = 40,\n    DELETE = 46,\n    PREVENT = [ENTER];\n\n/**\n * @class\n * @name XHR\n */\n\nvar XHR = exports.XHR = function () {\n    function XHR() {\n        _classCallCheck(this, XHR);\n    }\n\n    _createClass(XHR, null, [{\n        key: 'ajax',\n\n        /**\n         * Rerform asynchrounous request\n         * @param   {stirng}  path   URL to resource\n         * @param   {string}  method HTTP method to be used\n         * @param   {mixed}   data   data to be sent in post or put\n         * @param   {boolean} raw    if should not parse response as JSON\n         * @returns {Promise}\n         */\n        value: function ajax(path, method, data, raw) {\n\n            return new Promise(function (resolve, reject) {\n\n                var xhr = new XMLHttpRequest(),\n                    httpMethod = method.toLowerCase();\n\n                xhr.open(httpMethod, path);\n                if (httpMethod === 'post' || httpMethod === 'put') {\n                    xhr.setRequestHeader('Content-type', 'application/json');\n                }\n\n                xhr.onreadystatechange = function () {\n                    var DONE = 4,\n                        // readyState 4 means the request is done.\n                    OK = 200; // status 200 is a successful return.\n                    if (xhr.readyState === DONE) {\n                        if (xhr.status === OK) {\n                            resolve(xhr.responseText); // 'This is the returned text.'\n                        } else if (xhr.status === '204') {\n                            resolve(null);\n                        } else {\n                            reject(new Error('Error: ' + xhr.status)); // An error occurred during the request.\n                        }\n                    }\n                };\n\n                xhr.send(data ? raw ? data : JSON.stringify(data) : null);\n            });\n        }\n        /**\n         * Performs GET request\n         * @param   {string}  path URL to resource\n         * @param   {boolean} raw   if should not parse response as JSON\n         * @returns {Promise}\n         */\n\n    }, {\n        key: 'get',\n        value: function get(path, raw) {\n            return XHR.ajax(path, 'get', null, raw);\n        }\n        /**\n         * Performs POST request\n         * @param   {string}  path URL to resource\n         * @param   {boolean} raw  if should not parse response as JSON\n         * @param   {mixed}   data data to be sent\n         * @returns {Promise}\n         */\n\n    }, {\n        key: 'post',\n        value: function post(path, data, raw) {\n            return XHR.ajax(path, 'post', data, raw);\n        }\n        /**\n         * Performs PUT request\n         * @param   {string}  path URL to resource\n         * @param   {boolean} raw  if should not parse response as JSON\n         * @param   {mixed}   data data to be sent\n         * @returns {Promise}\n         */\n\n    }, {\n        key: 'put',\n        value: function put(path, data, raw) {\n            return XHR.ajax(path, 'put', data, raw);\n        }\n        /**\n         * Performs DELETE request\n         * @param   {string}  path URL to resource\n         * @param   {boolean} raw   if should not parse response as JSON\n         * @returns {Promise}\n         */\n\n    }, {\n        key: 'delete',\n        value: function _delete(path, raw) {\n            return XHR.ajax(path, 'delete', null, raw);\n        }\n    }]);\n\n    return XHR;\n}();\n\n/**\n * @class\n * @name Repository\n * @extends Emitter\n */\n\n\nvar Repository = exports.Repository = function (_Emitter) {\n    _inherits(Repository, _Emitter);\n\n    function Repository() {\n        _classCallCheck(this, Repository);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(Repository).apply(this, arguments));\n    }\n\n    _createClass(Repository, null, [{\n        key: 'report',\n\n\n        /**\n         * Reports change/update in document\n         * @param {string} doc             name of document\n         * @param {string|undefined} path  path in document or undefined if whole document has updated\n         * @param {mixed}  value           new content\n         */\n        value: function report(doc, path, value) {\n            var docs = this.documents;\n\n            if (path === undefined) {\n                docs[doc] = value;\n            } else {\n                if (!docs.hasOwnProperty(doc)) {\n                    docs[doc] = new _document.Fields();\n                }\n                docs[doc].set(path, value);\n            }\n            this.emit('change', {\n                doc: doc,\n                path: path,\n                id: value.name\n            });\n            document.querySelector('#pom').innerText = JSON.stringify(this.documents, null, 2);\n        }\n    }, {\n        key: 'documents',\n\n\n        /**\n         * @property {object} documents hashmap\n         */\n        get: function get() {\n            this._documents = this._documents || {};\n            return this._documents;\n        }\n    }]);\n\n    return Repository;\n}(_emitter.Emitter);\n\nfunction attr(element, attribute, fallback) {\n    if (!element.hasAttribute(attribute)) {\n        return fallback;\n    }\n    return element.getAttribute(attribute).toString();\n}\n\nvar Skaryna = exports.Skaryna = function () {\n    _createClass(Skaryna, null, [{\n        key: 'initEditor',\n        value: function initEditor(element) {\n            var config = {\n                allow: attr(element, 'data-skaryna-allow', '*').split(/\\s*,\\s*/),\n                path: attr(element, 'data-skaryna-path'),\n                placeholder: attr(element, 'placeholder'),\n                doc: attr(element, 'data-skaryna-doc', DEFAULT_DOCUMENT),\n                variant: attr(element, 'data-skaryna-variant')\n            },\n                editor = new Skaryna(element, config);\n            Skaryna.editors.push(editor);\n            return editor;\n        }\n    }, {\n        key: 'load',\n        value: function load(path, asDocument) {\n            return XHR.get(path).then(function (content) {\n                return (0, _fromPOM.fromPOM)(JSON.parse(content));\n            }).then(function (pom) {\n                return Repository.report(asDocument || DEFAULT_DOCUMENT, undefined, pom);\n            });\n        }\n    }, {\n        key: 'editors',\n        get: function get() {\n            this._editors = this._editors || [];\n            return this._editors;\n        }\n    }]);\n\n    function Skaryna(element, config) {\n        _classCallCheck(this, Skaryna);\n\n        this._config = config;\n        this.element = element;\n        Repository.on('change', this.onRepositoryUpdate.bind(this));\n        this.ready = (0, _fromHTML.fromHTML)(element).then(function (content) {\n            Repository.report(config.doc, config.path, content);\n        });\n    }\n\n    _createClass(Skaryna, [{\n        key: 'redrawEditor',\n        value: function redrawEditor() {\n            var self = this,\n                node = Repository.documents[this._config.doc];\n\n            if (this._config.path) {\n                node = node.get(this._config.path);\n            }\n\n            if (node && node.type === 'Variants' && node.best) {\n                node = node.best(this._config.variant || '*');\n            }\n\n            if (!node) {\n                return;\n            }\n\n            return node.decorate(self.element).then(function () {\n                self.element.addEventListener('keydown', self.onKeyUp.bind(self));\n            });\n        }\n    }, {\n        key: 'getCurrentElement',\n        value: function getCurrentElement(element) {\n\n            var doc = element.ownerDocument || element.document,\n                win = doc.defaultView || doc.parentWindow,\n                sel = void 0,\n                node = void 0;\n\n            if (typeof win.getSelection != 'undefined') {\n                sel = win.getSelection();\n            } else {\n                sel = doc.selection;\n            }\n\n            node = sel.focusNode;\n\n            if (node === this.element) {\n                return this.element;\n            }\n            node = this.getEditableNode(node);\n            document.querySelector('#current-element').innerText = node.outerHTML;\n            return node;\n        }\n    }, {\n        key: 'getEditableNode',\n        value: function getEditableNode(node) {\n            while (node && (!node.hasAttribute || !node.hasAttribute('data-skaryna-id'))) {\n                node = node.parentNode;\n            }\n            return node;\n        }\n\n        /**\n         * Handles key up event\n         * @param {Event} event\n         */\n\n    }, {\n        key: 'onKeyUp',\n        value: function onKeyUp(event) {\n            var _this2 = this;\n\n            var current = this.getCurrentElement(event.target);\n            if (PREVENT.indexOf(event.keyCode) !== -1) {\n                event.stopPropagation();\n                event.preventDefault();\n                //this.ownAction(event.keyCode, current);\n            } else {\n                setTimeout(function () {\n                    return _this2.elementUpdated(current);\n                }, 0);\n            }\n        }\n    }, {\n        key: 'onRepositoryUpdate',\n        value: function onRepositoryUpdate(event) {\n            if (event.data.doc !== this._config.doc) return;\n            if (event.data.path === undefined) {\n                this.redrawEditor();\n            }\n        }\n    }, {\n        key: 'elementUpdated',\n        value: function elementUpdated(element) {\n            var self = this;\n            (0, _fromHTML.fromHTML)(element).then(function (pom) {\n                pom.name = element.getAttribute('data-skaryna-id').toString();\n                Repository.report(self._config.doc, '@' + pom.name, pom);\n            });\n        }\n    }]);\n\n    return Skaryna;\n}();\n\n},{\"pageobjectmodel/src/document\":1,\"pageobjectmodel/src/emitter\":2,\"pageobjectmodel/src/parser/fromHTML\":4,\"pageobjectmodel/src/parser/fromPOM\":5,\"pageobjectmodel/src/serializer/toHTML\":7}]},{},[9])\n\n","/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nimport {\n    Emitter\n}\nfrom './emitter';\nimport {\n    clone,\n    arraize\n}\nfrom './util';\nimport {\n    toHTML\n}\nfrom './serializer/toHTML';\n\nlet elementMap = {};\n\n\n/**\n * @see https://github.com/component/escape-regexp\n * @param   {string} str\n * @returns {string}\n */\nexport function escapeRegexp(str) {\n    return String(str).replace(/([.*+?=^!:${}()|[\\]\\/\\\\])/g, '\\\\$1');\n}\n\n/**\n * @see App\n * @param   {array} list\n * @param   {string}   filter\n * @returns {string}\n */\nexport function bestMatch(list, filter) {\n    var lowest = null,\n        best;\n\n    list.forEach(function (rule) {\n        var regexp = new RegExp(escapeRegexp(rule).replace(/\\\\\\*/g, '(.+)')),\n            weight = rule.split('*').filter(function (part) {\n                return part.length;\n            }).length,\n            match = filter.match(regexp);\n\n        if (match && (lowest === null || (match.length - weight) < lowest)) {\n            lowest = match.length - weight;\n            best = rule;\n        }\n    });\n    return best;\n}\n\nexport function getById(id) {\n    return elementMap[id];\n}\n\nexport function getByNode(element) {\n    if (!element) {\n        return null;\n    }\n    let id = element.getAttribute('data-skaryna-id');\n    return getById(id);\n}\n\nexport function randomID(setValue) {\n    var possible = 'abcdefghijklmnopqrstuvwxyz0123456789',\n        text = '';\n\n    for (let i = 0; i < 5; i++) {\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n\n    if (Object.keys(elementMap).indexOf(text) === -1) {\n        elementMap[text] = elementMap[text] || setValue;\n        return text;\n    }\n    return randomID(setValue);\n}\n\n/**\n * @class\n */\nexport class Node extends Emitter {\n\n    /**\n     * @constructs Node\n     */\n    constructor(id) {\n        super();\n\n        this.name = id || randomID(this);\n\n        this.__locked = false;\n    }\n\n    get locked() {\n        return this.__locked;\n    }\n\n    lock() {\n        this.__locked = true;\n    }\n\n    attr() {\n        return this.attrs;\n    }\n\n    get() {\n        throw new Error('Should be implemented');\n    }\n\n    set() {\n        throw new Error('Should be implemented');\n    }\n\n    /**\n     * @abstract\n     * @throws {Error}\n     */\n    toJSON() {\n        let error = new Error('Should be implemented');\n        throw error;\n    }\n\n    get defaultNewItem() {\n        return null;\n    }\n\n    get allowedNewItems() {\n        return [];\n    }\n}\n\n/**\n * @class\n * Defined for Image, Video, Embed, Table, HorizonalRule, Table, List or Component\n */\nexport class BlockNode extends Node {\n\n    constructor(type, items, attrs) {\n        super();\n        this._type = type;\n        this.items = items || [];\n        this.attrs = attrs;\n    }\n\n    get(path) {\n        let elements = path.split('.'),\n            index = elements.shift(),\n            rest = elements.join('.'),\n            child;\n\n        if (isNaN(index)) {\n            return null;\n        }\n\n        child = this.items[+index];\n\n        if (rest.length && child) {\n            return child.get(rest);\n        }\n\n        return child;\n\n    }\n\n    setById(id, value) {\n        let found = false;\n        this.items.forEach((child, index) => {\n            if (found) return;\n            if (child.name === id) {\n                this.items[index] = value;\n                found = true;\n                return;\n            }\n            found = child.setById ? child.setById(id, value) : false;\n        });\n        return found;\n    }\n\n    set(path, value) {\n\n        if (path[0] === '@') {\n            return this.setById(path.slice(1), value);\n        }\n\n        let elements = path.split('.'),\n            index = elements.shift(),\n            rest = elements.join('.'),\n            child;\n\n        if (isNaN(index)) {\n            return null;\n        }\n\n        if (rest.length && child) {\n            return this.items[+index].set(rest, value);\n        }\n\n        this.items.splice(+index, 0, value);\n\n    }\n\n    get empty() {\n        return this.items.length <= 0;\n    }\n\n    get type() {\n        return this._type;\n    }\n\n    toJSON() {\n        let output = {\n            type: this.type,\n            items: this.items.map((item) => item.toJSON())\n        };\n        if (this.attrs) {\n            output.attrs = JSON.parse(JSON.stringify(this.attrs));\n        }\n        return output;\n    }\n\n    decorate(element) {\n        return toHTML(this, {\n                edit: true\n            })\n            .then((html) => {\n                element.innerHTML = '';\n                arraize(html.children)\n                    .forEach((child) => {\n                        element.appendChild(child);\n                    });\n            });\n    }\n}\n\nexport class Document extends BlockNode {\n\n    constructor(items) {\n        super('document', items);\n    }\n\n    get defaultNewItem() {\n        return Paragraph;\n    }\n\n    get allowedNewItems() {\n        return [\n            Paragraph,\n            Image\n        ];\n    }\n\n}\n\nexport class Quote extends BlockNode {\n    constructor(items) {\n        super('quote', items);\n    }\n}\n\n/**\n * @class\n * Defined for Text, Paragraph, ListItem, Quote and Heading\n */\nexport class TextNode extends Node {\n\n    get type() {\n        return 'text';\n    }\n\n    static get type() {\n        return 'text';\n    }\n\n    get empty() {\n        return !this.text || !this.text.replace(/^([\\s\\n\\r\\t]+)|([\\s\\n\\r\\t]+)$/, '').length;\n    }\n\n    get absoluteEmpty() {\n        return this.text.length === 0;\n    }\n\n    attr() {\n        if (this.type === 'text') {\n            return {};\n        }\n        return super.attr();\n    }\n\n    constructor(text, formats, attrs) {\n        super();\n        this.text = (text && text.toString) ? text.toString() : '';\n        this.formats = formats || null;\n        this.attrs = attrs;\n    }\n\n    toJSON() {\n        let output = {\n            type: this.type,\n            text: this.text\n        };\n        if (this.formats) {\n            output.formats = JSON.parse(JSON.stringify(this.formats));\n        }\n        if (this.attrs && this.type !== 'text') {\n            output.attrs = JSON.parse(JSON.stringify(this.attrs));\n        }\n        return output;\n    }\n\n    append(node) {\n        if (!(node instanceof TextNode)) {\n            throw new Error('Only text nodes can be joined');\n        }\n        if (node.formats) {\n            this.formats = this.formats || [];\n            node.formats.forEach((format) => {\n                this.formats.push({\n                    slice: [format.slice[0] + this.text.length, format.slice[1]],\n                    apply: format.apply\n                });\n            });\n        }\n        this.text += node.text;\n    }\n\n    decorate(element) {\n        let self = this;\n        return toHTML(this, {\n                edit: true\n            })\n            .then((html) => {\n                element.setAttribute('contenteditable', true);\n                element.setAttribute('data-skaryna-id', self.name);\n                element.innerHTML = html.textContent;\n            });\n    }\n}\n\nexport class Paragraph extends TextNode {\n\n    get type() {\n        return 'paragraph';\n    }\n\n    static get type() {\n        return 'paragraph';\n    }\n\n    constructor(text, formats, attrs) {\n        super(text, formats, attrs);\n    }\n\n    get nextNodeType() {\n        return Paragraph;\n    }\n}\n\nexport class Image extends Node {\n\n    constructor(source, title, alt) {\n        super('image');\n        this.src = source;\n        this.title = title;\n        this.alt = alt;\n    }\n\n    get type() {\n        return 'image';\n    }\n\n    static get type() {\n        return 'image';\n    }\n\n    attr() {\n        let attributes = super.attr() || {};\n        if (this.src) {\n            attributes.src = this.src;\n        }\n        if (this.title) {\n            attributes.title = this.title;\n        }\n        if (this.alt) {\n            attributes.alt = this.title;\n        }\n        return attributes;\n    }\n\n    toJSON() {\n        let output = {\n            type: 'image',\n            src: this.src\n        };\n        if (this.title) {\n            output.title = this.title;\n        }\n        if (this.alt) {\n            output.alt = this.alt;\n        }\n        return output;\n    }\n}\n\nexport class Heading extends TextNode {\n\n    constructor(level, text, formats, attrs) {\n        super(text, formats, attrs);\n        this.level = Math.min(6, level || 1);\n    }\n\n    attr() {\n        return super.attr();\n    }\n    get type() {\n        return 'heading';\n    }\n\n    static get type() {\n        return 'heading';\n    }\n\n    toJSON() {\n        let json = super.toJSON();\n        json.level = this.level;\n        return json;\n    }\n}\n\nexport class StaticBlockNode extends BlockNode {\n    get locked() {\n        return true;\n    }\n\n    get defaultNewItem() {\n        return Paragraph;\n    }\n\n    get allowedNewItems() {\n        return [\n            Paragraph,\n            Image\n        ];\n    }\n}\n\nexport class Fields extends Node {\n\n    constructor(data) {\n        super();\n        this._map = data || {};\n    }\n\n    get type() {\n        return 'Fields';\n    }\n\n    static get type() {\n        return 'Fields';\n    }\n\n    get(path) {\n        let elements = path.split('.'),\n            index = elements.shift(),\n            rest = elements.join('.'),\n            child;\n\n        child = this._map[index];\n\n        if (rest.length && child) {\n            return child.get(rest);\n        }\n\n        return child;\n\n    }\n\n    set(path, value) {\n        let elements = path.split('.'),\n            index = elements.shift(),\n            rest = elements.join('.'),\n            child;\n\n        if (rest.length && child) {\n            return this._map[index].get(rest, value);\n        }\n\n        this._map[index] = value;\n\n    }\n\n    toJSON() {\n        return clone([\n            this._map,\n            {\n                type: 'Fields'\n            }\n        ]);\n    }\n}\n\nexport class Variants extends Node {\n\n    constructor(data) {\n        super();\n        this._variants = data;\n    }\n\n    get type() {\n        return 'Variants';\n    }\n\n    static get type() {\n        return 'Variants';\n    }\n\n\n    best(variant) {\n        let best = bestMatch(Object.keys(this._variants), variant);\n        return this._variants[best];\n\n    }\n\n    toJSON() {\n        return clone([\n            this._map,\n            {\n                type: 'Variants'\n            }\n        ]);\n    }\n}\n","/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\n/**\n * @namespace skaryna\n *\n * @class EventConfig\n * @property {function} fn listener\n * @property {object} context\n * @property {array} args arguments to be passed\n * @property {boolean} once if should be fired only once\n */\n\n/**\n * @class Event\n */\nexport class Event {\n    /**\n     * Contructor\n     * @constructs Event\n     * @param {string} name\n     * @param {mixed} data\n     * @param {object} source\n     * @param {Event} parent\n     */\n    constructor(name, data, source, parent) {\n        Object.defineProperties(this, {\n            /**\n             * @property {string}\n             * @name Event#name\n             */\n            name: {\n                value: name,\n                writable: false\n            },\n            /**\n             * @property {mixed}\n             * @name Event#data\n             */\n            data: {\n                value: data,\n                writable: false\n            },\n            /**\n             * @property {object}\n             * @name Event#source\n             */\n            source: {\n                value: source,\n                writable: false\n            },\n            /**\n             * @property {Event|null}\n             * @name Event#parent\n             */\n            parent: {\n                value: parent,\n                writable: false\n            }\n        });\n    }\n\n    toJSON() {\n        return {\n            name: this.name,\n            data: this.data,\n            source: this.source,\n            parent: this.parent\n        };\n    }\n\n    toString() {\n        return 'Event: ' + JSON.stringify(this.toJSON());\n    }\n}\n\n/**\n * [[Description]]\n * @param {Event} cofnig\n * @param {EventConfig} thisObject\n */\nfunction execute(event, config) {\n    let {\n        fn, context, args\n    } = config,\n    params = [event].concat(args);\n\n    fn.apply(context || null, params);\n}\n\n/**\n * Adds listener for an event\n * @param {string} eventName\n * @param {function} handler\n * @param {object} context\n * @param {array} args\n * @param {boolean} once\n */\nfunction on(eventName, handler, context, args, once) {\n    this.__listeners = this.__listeners || {};\n    this.__listeners[eventName] = this.__listeners[eventName] || [];\n    this.__listeners[eventName].push({\n        fn: handler,\n        context: context,\n        args: args,\n        once: !!once\n    });\n}\n\n/**\n * Adds listener for an event that should be called once\n * @param {string} eventName\n * @param {function} handler\n * @param {object} context\n * @param {array} args\n */\nfunction once(eventName, handler, context, args) {\n    this.on(eventName, handler, context, args, true);\n}\n\n/**\n * Adds listener for an event\n * @param {string} eventName\n * @param {function} handler\n * @param {object} context\n * @param {array} args\n * @param {boolean} once\n */\nfunction off(eventName, handler, context, args, once) {\n    if (!this.__listeners || !this.__listeners[eventName]) {\n        return;\n    }\n    this\n        .getListeners(eventName, handler, context, args, once)\n        .forEach((config) => {\n            this.__listeners[eventName].splice(this.__listeners[eventName].indexOf(config), 1);\n        });\n\n}\n\n/**\n * Emits an event\n * @param {string} eventName\n * @param {mixed} data\n * @param {Event|null} parent\n */\nfunction emit(eventName, data, parent) {\n    if (!this.__listeners || !this.__listeners[eventName]) {\n        return;\n    }\n\n    let self = this,\n        event = new Event(eventName, data, this, parent);\n\n    this\n        .getListeners(eventName)\n        .forEach((config) => {\n            if (config.once === true) {\n                self.off(eventName, config.fn, config.context, config.args, config.once);\n            }\n            execute(event, config);\n        });\n}\n\n/**\n * Bubbles event to other emitter\n * @param {string} eventName\n * @param {object} toEmitter\n */\nfunction bubbleEvent(eventName, toEmitter) {\n    this.on(eventName, (event) => {\n        toEmitter.emit(eventName, event.data, event);\n    });\n}\n\n/**\n * Gets all listeners that match criteria\n * @param   {string} eventName required\n * @param   {function} handler   if defined will be used for match\n * @param   {object} context   if defined will be used for match\n * @param   {array} args      if defined will be used for match\n * @returns {array<EventConfig>|null}\n */\nfunction getListeners(eventName, handler, context, args) {\n    if (!this.__listeners || !this.__listeners[eventName]) {\n        return null;\n    }\n\n    return this.__listeners[eventName]\n        .map((config) => {\n            if (handler !== undefined && config.fn !== handler) {\n                return false;\n            }\n            if (context !== undefined && config.context !== context) {\n                return false;\n            }\n            if (args !== undefined && config.args !== args) {\n                return false;\n            }\n            return config;\n        })\n        .filter((result) => !!result);\n}\n\n/*\n * @class Emitter\n */\nexport class Emitter {\n\n    static on() {\n        on.apply(this, arguments);\n    }\n\n    on() {\n        on.apply(this, arguments);\n    }\n\n    static once() {\n        once.apply(this, arguments);\n    }\n\n    once() {\n        once.apply(this, arguments);\n    }\n\n    static off() {\n        off.apply(this, arguments);\n    }\n\n    off() {\n        off.apply(this, arguments);\n    }\n\n    static emit() {\n        emit.apply(this,arguments);\n    }\n\n    emit() {\n        emit.apply(this,arguments);\n    }\n\n    static bubbleEvent() {\n        bubbleEvent.apply(this,arguments);\n    }\n\n    bubbleEvent() {\n        bubbleEvent.apply(this,arguments);\n    }\n\n    static getListeners() {\n        return getListeners.apply(this,arguments);\n    }\n\n    getListeners() {\n        return getListeners.apply(this,arguments);\n    }\n}\n","/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nclass Parser {\n\n    parse(format, token, data, options) {\n\n        if (!token) {\n            return Promise.reject(new Error('Model is empty'));\n        }\n\n        return this.handle(format, token, data, options);\n    }\n\n    on(format, token, handler) {\n        this._handlers = this._handlers || {};\n        this._handlers[format] = this._handlers[format] || {};\n        this._handlers[format][token] = handler;\n    }\n\n    handle(format, token, data, options) {\n\n        let handler = (this._handlers && this._handlers[format] && this._handlers[format][token]) ? this._handlers[format][token] : null;\n        if (!handler) {\n            handler = (this._handlers && this._handlers[format] && this._handlers[format]['*']) ? this._handlers[format]['*'] : null;\n            if (!handler) {\n                return Promise.reject(new Error('No handler defined for ' + format + ' : ' + token));\n            }\n        }\n\n        return handler(token, data, options)\n            .then((POM) => {\n                return POM;\n            });\n    }\n\n}\n\nexport var parser = new Parser();\n","/* jslint esnext:true, node:true */\n/* globals document */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nimport {\n    parser\n}\nfrom './../parser';\nimport {\n    arraize,\n    clone\n}\nfrom './../util';\nimport {\n    Document,\n    TextNode,\n    BlockNode,\n    Paragraph,\n    Heading,\n    Image,\n    Quote,\n    StaticBlockNode\n}\nfrom './../document';\n\nfunction whatWrapper(rootNode) {\n    switch (rootNode) {\n    case 'td':\n    case 'th':\n        return 'tr';\n    case 'tr':\n        return 'table';\n    default:\n        return 'div';\n    }\n}\n\nfunction editMode(node, element, options) {\n    if (options && options.edit) {\n        element.setAttribute('data-skaryna-id', node.name);\n        node.__element = element;\n    }\n    return node;\n}\n\nfunction processChildren(element, options) {\n    if (!element || !element.childNodes) {\n        return Promise.resolve([]);\n    }\n    return Promise\n        .all(arraize(element.childNodes)\n            .map((child) => {\n                if (child.nodeType === 1 || child.nodeType === 3) {\n                    return fromHTML(child, options);\n                } else {\n                    return null;\n                }\n            }))\n        .then((items) => items.filter((item) => {\n            if (item.constructor === TextNode) {\n                return !item.absoluteEmpty;\n            }\n            return item !== null;\n        }));\n}\n\n/**\n * Parse POM JSON representation\n * @param   {string|HTMLElement}   model\n * @param   {options} options\n * @returns {Promise<Node>}\n */\nexport function fromHTML(input, options) {\n\n    if (!input) {\n        return Promise.resolve(null);\n    }\n\n    if (typeof input === 'string') {\n        if (input.length === 0) {\n            return Promise.resolve(null);\n        }\n        let wrapper = document.createElement(whatWrapper(input.replace('/^(\\s*)<([a-zA-Z0-9_-]+)', '$2').toLowerCase()));\n        wrapper.innerHTML = input;\n        return processChildren(wrapper, options)\n            .then((children) => {\n\n                if (children.length === 1) {\n                    return children[0];\n                }\n                if (children\n                    .filter((item) => !(item instanceof TextNode || item instanceof InlineNode))\n                    .length\n                ) {\n                    if (children.map((item) => item instanceof BlockNode).length) {\n                        return new Document(children.map((item) => {\n                            if (item.type === 'text') {\n                                return new Paragraph(item.text, item.formats, item.attrs, options);\n                            }\n                            return item;\n                        }));\n                    }\n                    return new Document(children);\n                }\n                let items = children.map((item) => {\n                        if (item instanceof InlineNode) {\n                            let [text, formats] = stringify([item]);\n                            return new TextNode(text, formats, options);\n                        }\n\n                        return item;\n                    }),\n                    first = items.shift();\n                items.forEach((item) => {\n                    first.append(item);\n                });\n                return first;\n            });\n    }\n    return parser.parse('html', input.nodeType === 3 ? 'text' : input.nodeName, input);\n}\n\nclass InlineNode extends BlockNode {\n\n}\n\nfunction formatType(item, text) {\n    if (item.type === 'A') {\n        return {\n            type: 'A',\n            title: item.attrs.title || text,\n            href: item.attrs.href\n        };\n    }\n    return item.type;\n}\n\nfunction stringify(items) {\n    let text = '',\n        formats = [],\n        index = 0;\n\n    items.forEach((item) => {\n        if (item instanceof InlineNode) {\n            let [innerText, innerFormats] = stringify(item.items),\n                format = {\n                    slice: [index, innerText.length],\n                    apply: [formatType(item, innerText)]\n                };\n            formats.push(format);\n            innerFormats.forEach((format) => {\n                formats.push({\n                    slice: [index + format.slice[0], format.slice[1]],\n                    apply: format.apply\n                });\n            });\n            formats.forEach((format) => {\n                formats.forEach((otherFormat, idx) => {\n                    if (format !== otherFormat && format.slice[0] === otherFormat.slice[0] && format.slice[1] === otherFormat.slice[1]) {\n                        format.apply = format.apply.concat(otherFormat.apply);\n                        formats.splice(idx, 1);\n                    }\n                });\n            });\n            text += innerText;\n            index += innerText.length;\n        } else if (item instanceof TextNode) {\n            text += item.text;\n            index += item.text.length;\n        } else {\n\n        }\n    });\n\n    return [text, formats];\n}\n\nfunction heading(token, data, options) {\n\n    return processChildren(data, options)\n        .then((items) => {\n            let [text, formats] = stringify(items);\n            return Promise.resolve(new Heading(token[1].toLowerCase(), text || '', formats.length ? formats : null, options));\n        });\n}\n\nfunction paragraph(token, data, options) {\n    return processChildren(data, options)\n        .then((items) => {\n            let [text, formats] = stringify(items);\n            return Promise.resolve(new Paragraph(text, formats.length ? formats : null));\n        });\n}\n\nfunction attributes(input) {\n    let output = null;\n    arraize(input)\n        .forEach((attribute) => {\n            output = output || {};\n            if (attribute.value && attribute.value.length) {\n                output[attribute.name] = attribute.value;\n            }\n        });\n    return output;\n\n}\n\nfunction ifAttr(value) {\n    if (value && value.length) {\n        return value;\n    }\n    return null;\n}\n\nfunction quote(token, data, options) {\n    return processChildren(data, options)\n        .then((items) => {\n\n            let paragraphs = [],\n                lastParagraph = [];\n            items.forEach((item) => {\n                if (item instanceof Paragraph) {\n                    if (lastParagraph.length) {\n                        let [text, formats] = stringify(items);\n                        paragraphs.push(Promise.resolve(new Paragraph(text, formats.length ? formats : null, options)));\n                        lastParagraph = [];\n                    }\n                    paragraphs.push(Promise.resolve(item));\n                } else {\n                    lastParagraph.push(item);\n                }\n            });\n            if (lastParagraph.length) {\n                let [text, formats] = stringify(items);\n                paragraphs.push(Promise.resolve(new Paragraph(text, formats.length ? formats : null, options)));\n            }\n\n            return Promise.all(paragraphs);\n        })\n        .then((items) => {\n            return Promise.resolve(new Quote(items));\n        });\n}\n\nparser.on('html', 'text', (token, data, options) => {\n    return Promise.resolve(new TextNode(data.textContent, null, options));\n});\nparser.on('html', 'H1', heading);\nparser.on('html', 'H2', heading);\nparser.on('html', 'H3', heading);\nparser.on('html', 'H4', heading);\nparser.on('html', 'H5', heading);\nparser.on('html', 'H6', heading);\nparser.on('html', 'P', paragraph);\nparser.on('html', 'BLOCKQUOTE', quote);\n\nparser.on('html', 'IMG', (token, data, options) => {\n    return Promise.resolve(new Image(data.src, ifAttr(data.getAttribute('title')), ifAttr(data.getAttribute('alt')), clone([attributes(data.attributes)], ['src', 'title', 'alt'])), options);\n});\n\n['ADDRESS', 'ARTICLE', 'ASIDE', 'DIV', 'FIGURE', 'FOOTER', 'HEADER', 'MAIN', 'NAV', 'SECTION'].forEach((nodeName) => {\n    parser.on('html', nodeName, (token, data, options) => {\n        return processChildren(data, options)\n            .then((items) => {\n                return Promise.resolve(new StaticBlockNode(token, items, attributes(data.attributes)), options);\n            });\n    });\n});\n\nparser.on('html', '*', (token, data, options) => {\n    return processChildren(data, options)\n        .then((items) => {\n            return Promise.resolve(new InlineNode(token, items, attributes(data.attributes)), options);\n        });\n});\n/*\nparser.on('html', '#text', (token, data) => {\n    return Promise.resolve(new TextNode(data.textContent));\n});\n\n[\n    ['b', 'strong'],\n    ['big', 'strong'],\n    ['i', 'em'],\n    'small',\n    ['tt', 'code'],\n    ['abbr', 'semantic', 'abbr'],\n    ['acronym', 'abbr', 'abbr'],\n    ['cite', 'semantic', 'cite'],\n    'code',\n    ['dfn', 'semantic', 'definition'],\n    'em',\n    ['time', 'semantic', 'time'],\n    ['var', 'code', 'var'],\n    ['kbd', 'code', 'kbd'],\n    'strong',\n    ['samp', 'code', 'sample'],\n    'bdo',\n    'a',\n    //'br',\n    //'img,\n    //'map',\n    //'object',\n    ['q', 'semantic', 'quotation'],\n    //script\n    'span',\n    del,\n    s\n    'sub',\n    'sup',\n    //button\n    //input\n    //label\n    //select\n    //textarea\n].forEach((inlineRule) => {\n\n    let input = typeof inlineRule === 'string' ? inlineRule : inlineRule[0];\n\n    parser.on('html', input, (token, data) => {\n        return processChildren(data)\n            .then((items) => {\n\n            });\n    });\n\n});\n*/\n","/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nimport {\n    parser\n}\nfrom './../parser';\n\nimport {\n    TextNode,\n    Document,\n    Heading,\n    Paragraph,\n    Image,\n    Fields,\n    Variants\n}\nfrom './../document';\n\n/**\n * Parse POM JSON representation\n * @param   {object}   model\n * @param   {options} options\n * @returns {Promise<Node>}\n */\nexport function fromPOM(model) {\n    if (!model) {\n        return Promise.resolve(null);\n    }\n    return parser.parse('pom', model.type, model);\n}\n\nfunction processChildNodes(items) {\n    if (!Array.isArray(items)) {\n        return Promise.resolve([]);\n    }\n    return Promise.all(items.map((item) => {\n        return fromPOM(item);\n    })).then((items) => {\n        return items.filter((item) => !!item);\n    });\n}\n\nparser.on('pom', 'document', (token, data) => {\n    return processChildNodes(data.items)\n        .then((items) => {\n            return new Document(items);\n        });\n});\n\nparser.on('pom', 'heading', (token, data) => {\n    return Promise.resolve(new Heading(data.level, data.text, data.formats, data.attrs));\n});\n\nparser.on('pom', 'paragraph', (token, data) => {\n    return Promise.resolve(new Paragraph(data.text, data.formats, data.attrs));\n});\n\nparser.on('pom', 'text', (token, data) => {\n    return Promise.resolve(new TextNode(data.text, data.formats));\n});\n\nparser.on('pom', 'image', (token, data) => {\n    return Promise.resolve(new Image(data.src, data.title, data.alt));\n});\n\nparser.on('pom', 'Fields', (token, data) => {\n    let fields = {};\n    return Promise.all(Object\n            .keys(data)\n            .filter((key) => key !== 'type')\n            .map((key) => {\n                return fromPOM(data[key])\n                    .then((POM) => {\n                        fields[key] = POM;\n                    });\n            }))\n        .then(() => {\n            return Promise.resolve(new Fields(fields));\n        });\n});\n\nparser.on('pom', 'Variants', (token, data) => {\n    let variants = {};\n    return Promise.all(Object\n            .keys(data)\n            .filter((key) => key !== 'type')\n            .map((key) => {\n                return fromPOM(data[key])\n                    .then((POM) => {\n                        variants[key] = POM;\n                    });\n            }))\n        .then(() => {\n            return Promise.resolve(new Variants(variants));\n        });\n});\n","/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nclass Serializer {\n\n    serialize(format, node, options) {\n\n        if (!node) {\n            return Promise.reject(new Error('Model is empty'));\n        }\n\n        if (!node.type) {\n            return Promise.reject(new Error('Undefined node type'));\n        }\n\n        return this.handle(format, node.type, node, options);\n    }\n\n    on(format, nodeType, handler) {\n        this._handlers = this._handlers || {};\n        this._handlers[format] = this._handlers[format] || {};\n        this._handlers[format][nodeType] = handler;\n    }\n\n    handle(format, nodeType, node, options) {\n\n        let handler = (this._handlers && this._handlers[format] && this._handlers[format][nodeType]) ? this._handlers[format][nodeType] : null;\n        if (!handler) {\n            handler = (this._handlers && this._handlers[format] && this._handlers[format]['*']) ? this._handlers[format]['*'] : null;\n            if (!handler) {\n                return Promise.reject(new Error('No handler defined for ' + format + ' : ' + nodeType));\n            }\n        }\n        return handler(node, options)\n            .then((html) => {\n                return html;\n            });\n    }\n\n    handleContents(format, array, options) {\n        let self = this;\n        return Promise\n            .all(array.map((content) => {\n                return self.serialize('html', content, options);\n            }));\n\n    }\n}\n\nexport var serializer = new Serializer();\n","/* jslint esnext:true, node:true */\n/* globals document */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nimport {\n    serializer\n}\nfrom './../serializer';\n\nimport {\n    TextNode\n}\nfrom './../document';\nimport {\n    arraize\n}\nfrom './../util';\n\nexport function toHTML(model, options) {\n    return serializer.serialize('html', model, options);\n}\n\nfunction otherAttrs(object, except) {\n    let result = {};\n    Object\n        .keys(object)\n        .filter((key) => {\n            return except.indexOf(key) === -1;\n        })\n        .forEach((key) => {\n            result[key] = object[key];\n        });\n    return result;\n}\n\nfunction format(string, formats) {\n    let wrapper = document.createElement('p'),\n        slices = string.split('').map((char) => {\n            return {\n                char: char,\n                apply: []\n            };\n        });\n\n    slices.push({\n        char: '',\n        apply: []\n    });\n\n    formats.forEach((format) => {\n        let from = format.slice[0],\n            to = from + format.slice[1];\n\n        format.apply.forEach((apply) => {\n            if (slices[from].apply.indexOf(apply) == -1) {\n                slices[from].apply.push(apply);\n            }\n            if (slices[to].apply.indexOf('/' + apply) == -1) {\n                slices[to].apply.push('/' + apply);\n            }\n        });\n    });\n    wrapper.innerHTML = slices.map((char) => {\n        return char.apply.map((tag) => '<' + tag + '>').join('') + char.char;\n    }).join('');\n    return arraize(wrapper.childNodes);\n}\n\nexport function element(node, nodeType, attributes, content, options) {\n\n    let promise;\n\n    if (content) {\n\n        promise = serializer.handleContents('html', content || [], options);\n    } else {\n        promise = Promise.resolve(null);\n    }\n\n    return promise.then((content) => {\n\n        if (node.formats && node.formats.length) {\n            content = format(content[0].nodeValue, node.formats);\n        }\n\n        let elem = document.createElement(nodeType);\n        if (options && options.edit) {\n            elem.setAttribute('data-skaryna-id', node.name);\n            if(node instanceof TextNode) {\n                elem.setAttribute('contenteditable','true');\n            }\n        }\n        if (attributes) {\n            Object\n                .keys(attributes)\n                .forEach((attributeName) => {\n                    elem.setAttribute(attributeName, attributes[attributeName]);\n                });\n        }\n        if (Array.isArray(content)) {\n            content.forEach((child) => elem.appendChild(child));\n        }\n        return elem;\n    });\n}\n\nclass FakeDoc {\n\n    constructor() {\n        this.children = [];\n    }\n\n    appendChild(child) {\n        this.children.push(child);\n    }\n\n    get outerHTML() {\n        let str = '';\n        this.children.forEach((child) => {\n            if (child.nodeType === 1) {\n                str += child.outerHTML;\n            } else {\n                str += child.textContent;\n            }\n        });\n        return str;\n    }\n}\n\nserializer.on('html', 'document', (node, options) => {\n    return serializer\n        .handleContents('html', node.items || [], options)\n        .then((contents) => {\n            let output = new FakeDoc();\n            if (Array.isArray(contents)) {\n                contents.forEach((child) => output.appendChild(child));\n            }\n            return output;\n        });\n});\n\nserializer.on('html', 'heading', (node, options) => {\n    return element(node, 'h' + (node.level || 1), node.attr(), [new TextNode(node.text, node.formats)], options);\n});\n\nserializer.on('html', 'paragraph', (node, options) => {\n    return element(node, 'p', node.attr(), [new TextNode(node.text, node.formats)], options);\n});\n\nserializer.on('html', 'image', (node, options) => {\n    return element(node, 'img', node.attr(), null, options);\n});\n\nserializer.on('html', 'text', (node, options) => {\n    let element = document.createTextNode(node.text);\n    if (options && options.edit) {\n        //element.setAttribute('name', node.name);\n    }\n    return Promise.resolve(element);\n});\n\nserializer.on('html', '*', (node, options) => {\n    return element(node, node._type, node.attr(), node.items, options);\n});\n","/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\n/**\n * Convert iterable objects into arrays\n * @param   {Iterable} iterable\n * @returns {Array}\n */\nexport function arraize(iterable) {\n    return [].slice.apply(iterable);\n}\n\nexport function query(node, query) {\n    return arraize(node.querySelectorAll(query));\n}\n\nexport function clone(inputs, except) {\n    let result = {};\n    inputs\n        .forEach((input) => {\n            if (typeof input !== 'object') {\n                return;\n            }\n            Object\n                .keys(input)\n                .forEach((key) => {\n                    if (except && except.indexOf(key) !== -1) {\n                        return;\n                    }\n                    result[key] = JSON.parse(JSON.stringify(input[key]));\n                });\n        });\n    return result;\n}\n","/* jslint esnext:true, node:true, browser:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nimport {\n    Skaryna\n}\nfrom './skaryna';\n\nimport {\n    query\n}\nfrom 'pageobjectmodel/src/util';\n\nquery(document.body, '[data-skaryna]')\n    .forEach(element => Skaryna.initEditor(element));\n\nwindow.Skaryna = Skaryna;\n","/* jslint esnext:true, node:true, browser:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 Åukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nimport {\n    fromHTML\n}\nfrom 'pageobjectmodel/src/parser/fromHTML';\n\nimport {\n    fromPOM\n}\nfrom 'pageobjectmodel/src/parser/fromPOM';\n\nimport {\n    toHTML\n}\nfrom 'pageobjectmodel/src/serializer/toHTML';\n\nimport {\n    Fields\n}\nfrom 'pageobjectmodel/src/document';\n\nimport {\n    Emitter\n}\nfrom 'pageobjectmodel/src/emitter';\n\nconst DEFAULT_DOCUMENT = '#default';\n\nconst\n    BACKSPACE = 8,\n    TAB = 9,\n    ENTER = 13,\n    SHIFT = 16,\n    CAPS = 20,\n    ESC = 27,\n    SPACE = 32,\n    UP = 38,\n    DOWN = 40,\n    DELETE = 46,\n    PREVENT = [ENTER];\n\n/**\n * @class\n * @name XHR\n */\nexport class XHR {\n    /**\n     * Rerform asynchrounous request\n     * @param   {stirng}  path   URL to resource\n     * @param   {string}  method HTTP method to be used\n     * @param   {mixed}   data   data to be sent in post or put\n     * @param   {boolean} raw    if should not parse response as JSON\n     * @returns {Promise}\n     */\n    static ajax(path, method, data, raw) {\n\n            return new Promise((resolve, reject) => {\n\n                let xhr = new XMLHttpRequest(),\n                    httpMethod = method.toLowerCase();\n\n                xhr.open(httpMethod, path);\n                if (httpMethod === 'post' || httpMethod === 'put') {\n                    xhr.setRequestHeader('Content-type', 'application/json');\n                }\n\n                xhr.onreadystatechange = () => {\n                    let DONE = 4, // readyState 4 means the request is done.\n                        OK = 200; // status 200 is a successful return.\n                    if (xhr.readyState === DONE) {\n                        if (xhr.status === OK) {\n                            resolve(xhr.responseText); // 'This is the returned text.'\n                        } else if (xhr.status === '204') {\n                            resolve(null);\n                        } else {\n                            reject(new Error('Error: ' + xhr.status)); // An error occurred during the request.\n                        }\n                    }\n                };\n\n                xhr.send(data ? (raw ? data : JSON.stringify(data)) : null);\n\n            });\n        }\n        /**\n         * Performs GET request\n         * @param   {string}  path URL to resource\n         * @param   {boolean} raw   if should not parse response as JSON\n         * @returns {Promise}\n         */\n    static get(path, raw) {\n            return XHR.ajax(path, 'get', null, raw);\n        }\n        /**\n         * Performs POST request\n         * @param   {string}  path URL to resource\n         * @param   {boolean} raw  if should not parse response as JSON\n         * @param   {mixed}   data data to be sent\n         * @returns {Promise}\n         */\n    static post(path, data, raw) {\n            return XHR.ajax(path, 'post', data, raw);\n        }\n        /**\n         * Performs PUT request\n         * @param   {string}  path URL to resource\n         * @param   {boolean} raw  if should not parse response as JSON\n         * @param   {mixed}   data data to be sent\n         * @returns {Promise}\n         */\n    static put(path, data, raw) {\n            return XHR.ajax(path, 'put', data, raw);\n        }\n        /**\n         * Performs DELETE request\n         * @param   {string}  path URL to resource\n         * @param   {boolean} raw   if should not parse response as JSON\n         * @returns {Promise}\n         */\n    static delete(path, raw) {\n        return XHR.ajax(path, 'delete', null, raw);\n    }\n}\n\n\n/**\n * @class\n * @name Repository\n * @extends Emitter\n */\nexport class Repository extends Emitter {\n\n    /**\n     * @property {object} documents hashmap\n     */\n    static get documents() {\n        this._documents = this._documents || {};\n        return this._documents;\n    }\n\n    /**\n     * Reports change/update in document\n     * @param {string} doc             name of document\n     * @param {string|undefined} path  path in document or undefined if whole document has updated\n     * @param {mixed}  value           new content\n     */\n    static report(doc, path, value) {\n        let docs = this.documents;\n\n        if (path === undefined) {\n            docs[doc] = value;\n        } else {\n            if (!docs.hasOwnProperty(doc)) {\n                docs[doc] = new Fields();\n            }\n            docs[doc].set(path, value);\n        }\n        this.emit('change', {\n            doc: doc,\n            path: path,\n            id: value.name\n        });\n        document.querySelector('#pom').innerText = JSON.stringify(this.documents, null, 2);\n    }\n}\n\nfunction attr(element, attribute, fallback) {\n    if (!element.hasAttribute(attribute)) {\n        return fallback;\n    }\n    return element.getAttribute(attribute).toString();\n}\n\nexport class Skaryna {\n\n    static get editors() {\n        this._editors = this._editors || [];\n        return this._editors;\n    }\n\n    static initEditor(element) {\n        let config = {\n                allow: attr(element, 'data-skaryna-allow', '*').split(/\\s*,\\s*/),\n                path: attr(element, 'data-skaryna-path'),\n                placeholder: attr(element, 'placeholder'),\n                doc: attr(element, 'data-skaryna-doc', DEFAULT_DOCUMENT),\n                variant: attr(element, 'data-skaryna-variant')\n            },\n            editor = new Skaryna(element, config);\n        Skaryna.editors.push(editor);\n        return editor;\n    }\n\n    static load(path, asDocument) {\n        return XHR\n            .get(path)\n            .then(content => fromPOM(JSON.parse(content)))\n            .then(pom => Repository.report(asDocument || DEFAULT_DOCUMENT, undefined, pom));\n    }\n\n    constructor(element, config) {\n        this._config = config;\n        this.element = element;\n        Repository.on('change', this.onRepositoryUpdate.bind(this));\n        this.ready =\n            fromHTML(element)\n            .then(content => {\n                Repository.report(config.doc, config.path, content);\n            });\n    }\n\n    redrawEditor() {\n        let self = this,\n            node = Repository.documents[this._config.doc];\n\n        if (this._config.path) {\n            node = node.get(this._config.path);\n        }\n\n        if (node && node.type === 'Variants' && node.best) {\n            node = node.best(this._config.variant || '*');\n        }\n\n        if(!node) {\n            return;\n        }\n\n        return node.decorate(self.element)\n            .then(() => {\n                self.element.addEventListener('keydown', self.onKeyUp.bind(self));\n            });\n    }\n\n    getCurrentElement(element) {\n\n        let doc = element.ownerDocument || element.document,\n            win = doc.defaultView || doc.parentWindow,\n            sel,\n            node;\n\n        if (typeof win.getSelection != 'undefined') {\n            sel = win.getSelection();\n        } else {\n            sel = doc.selection;\n        }\n\n        node = sel.focusNode;\n\n        if (node === this.element) {\n            return this.element;\n        }\n        node = this.getEditableNode(node);\n        document.querySelector('#current-element').innerText = node.outerHTML;\n        return node;\n    }\n\n    getEditableNode(node) {\n        while (node && (!node.hasAttribute || !node.hasAttribute('data-skaryna-id'))) {\n            node = node.parentNode;\n        }\n        return node;\n    }\n\n    /**\n     * Handles key up event\n     * @param {Event} event\n     */\n    onKeyUp(event) {\n        let current = this.getCurrentElement(event.target);\n        if (PREVENT.indexOf(event.keyCode) !== -1) {\n            event.stopPropagation();\n            event.preventDefault();\n            //this.ownAction(event.keyCode, current);\n        } else {\n            setTimeout(() => this.elementUpdated(current), 0);\n        }\n    }\n\n    onRepositoryUpdate(event) {\n        if (event.data.doc !== this._config.doc) return;\n        if (event.data.path === undefined) {\n            this.redrawEditor();\n        }\n    }\n\n    elementUpdated(element) {\n        let self = this;\n        fromHTML(element)\n            .then(pom => {\n                pom.name = element.getAttribute('data-skaryna-id').toString();\n                Repository.report(self._config.doc, '@' + pom.name, pom);\n            });\n    }\n}\n"],"sourceRoot":"/source/"}