!function e(t,n,r){function i(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);var u=new Error("Cannot find module '"+a+"'");throw u.code="MODULE_NOT_FOUND",u}var c=n[a]={exports:{}};t[a][0].call(c.exports,function(e){var n=t[a][1][e];return i(n?n:e)},c,c.exports,e,t,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(e,t,n){var r=e("../pipe").Pipe,i=function(){};i.prototype.setResult=function(e){return this.result=e,this.hasResult=!0,this},i.prototype.exit=function(){return this.exiting=!0,this},i.prototype.switchTo=function(e,t){return"string"==typeof e||e instanceof r?this.nextPipe=e:(this.next=e,t&&(this.nextPipe=t)),this},i.prototype.push=function(e,t){return e.parent=this,"undefined"!=typeof t&&(e.childName=t),e.root=this.root||this,e.options=e.options||this.options,this.children?(this.children[this.children.length-1].next=e,this.children.push(e)):(this.children=[e],this.nextAfterChildren=this.next||null,this.next=e),e.next=this,this},n.Context=i},{"../pipe":15}],2:[function(e,t,n){var r=e("./context").Context,i=e("../date-reviver"),o=function(e,t){this.left=e,this.right=t,this.pipe="diff"};o.prototype=new r,o.prototype.setResult=function(e){if(this.options.cloneDiffValues){var t="function"==typeof this.options.cloneDiffValues?this.options.cloneDiffValues:function(e){return JSON.parse(JSON.stringify(e),i)};"object"==typeof e[0]&&(e[0]=t(e[0])),"object"==typeof e[1]&&(e[1]=t(e[1]))}return r.prototype.setResult.apply(this,arguments)},n.DiffContext=o},{"../date-reviver":5,"./context":1}],3:[function(e,t,n){var r=e("./context").Context,i=function(e,t){this.left=e,this.delta=t,this.pipe="patch"};i.prototype=new r,n.PatchContext=i},{"./context":1}],4:[function(e,t,n){var r=e("./context").Context,i=function(e){this.delta=e,this.pipe="reverse"};i.prototype=new r,n.ReverseContext=i},{"./context":1}],5:[function(e,t,n){t.exports=function(e,t){var n;return"string"==typeof t&&(n=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d*))?(Z|([+\-])(\d{2}):(\d{2}))$/.exec(t))?new Date(Date.UTC(+n[1],+n[2]-1,+n[3],+n[4],+n[5],+n[6],+(n[7]||0))):t}},{}],6:[function(e,t,n){var r=e("./processor").Processor,i=e("./pipe").Pipe,o=e("./contexts/diff").DiffContext,a=e("./contexts/patch").PatchContext,s=e("./contexts/reverse").ReverseContext,l=e("./filters/trivial"),u=e("./filters/nested"),c=e("./filters/arrays"),f=e("./filters/dates"),h=e("./filters/texts"),p=function(e){this.processor=new r(e),this.processor.pipe(new i("diff").append(u.collectChildrenDiffFilter,l.diffFilter,f.diffFilter,h.diffFilter,u.objectsDiffFilter,c.diffFilter).shouldHaveResult()),this.processor.pipe(new i("patch").append(u.collectChildrenPatchFilter,c.collectChildrenPatchFilter,l.patchFilter,h.patchFilter,u.patchFilter,c.patchFilter).shouldHaveResult()),this.processor.pipe(new i("reverse").append(u.collectChildrenReverseFilter,c.collectChildrenReverseFilter,l.reverseFilter,h.reverseFilter,u.reverseFilter,c.reverseFilter).shouldHaveResult())};p.prototype.options=function(){return this.processor.options.apply(this.processor,arguments)},p.prototype.diff=function(e,t){return this.processor.process(new o(e,t))},p.prototype.patch=function(e,t){return this.processor.process(new a(e,t))},p.prototype.reverse=function(e){return this.processor.process(new s(e))},p.prototype.unpatch=function(e,t){return this.patch(e,this.reverse(t))},n.DiffPatcher=p},{"./contexts/diff":2,"./contexts/patch":3,"./contexts/reverse":4,"./filters/arrays":8,"./filters/dates":9,"./filters/nested":11,"./filters/texts":12,"./filters/trivial":13,"./pipe":15,"./processor":16}],7:[function(e,t,n){n.isBrowser="undefined"!=typeof window},{}],8:[function(e,t,n){function r(e,t,n,r){for(var i=0;n>i;i++)for(var o=e[i],a=0;r>a;a++){var s=t[a];if(o===s)return!0}}function i(e,t,n,r,i){var o=e[n],a=t[r];if(o===a)return!0;if("object"!=typeof o||"object"!=typeof a)return!1;var s=i.objectHash;if(!s)return i.matchByPosition&&n===r;var l,u;return"number"==typeof n?(i.hashCache1=i.hashCache1||[],l=i.hashCache1[n],"undefined"==typeof l&&(i.hashCache1[n]=l=s(o,n))):l=s(o),"undefined"==typeof l?!1:("number"==typeof r?(i.hashCache2=i.hashCache2||[],u=i.hashCache2[r],"undefined"==typeof u&&(i.hashCache2[r]=u=s(a,r))):u=s(a),"undefined"==typeof u?!1:l===u)}var o=e("../contexts/diff").DiffContext,a=e("../contexts/patch").PatchContext,s=e("../contexts/reverse").ReverseContext,l=e("./lcs"),u=3,c="function"==typeof Array.isArray?Array.isArray:function(e){return e instanceof Array},f="function"==typeof Array.prototype.indexOf?function(e,t){return e.indexOf(t)}:function(e,t){for(var n=e.length,r=0;n>r;r++)if(e[r]===t)return r;return-1},h=function(e){if(e.leftIsArray){var t,n,a,s,c={objectHash:e.options&&e.options.objectHash,matchByPosition:e.options&&e.options.matchByPosition},h=0,p=0,d=e.left,y=e.right,v=d.length,m=y.length;for(v>0&&m>0&&!c.objectHash&&"boolean"!=typeof c.matchByPosition&&(c.matchByPosition=!r(d,y,v,m));v>h&&m>h&&i(d,y,h,h,c);)t=h,s=new o(e.left[t],e.right[t]),e.push(s,t),h++;for(;v>p+h&&m>p+h&&i(d,y,v-1-p,m-1-p,c);)n=v-1-p,a=m-1-p,s=new o(e.left[n],e.right[a]),e.push(s,a),p++;var g;if(h+p===v){if(v===m)return void e.setResult(void 0).exit();for(g=g||{_t:"a"},t=h;m-p>t;t++)g[t]=[y[t]];return void e.setResult(g).exit()}if(h+p===m){for(g=g||{_t:"a"},t=h;v-p>t;t++)g["_"+t]=[d[t],0,0];return void e.setResult(g).exit()}delete c.hashCache1,delete c.hashCache2;var b=d.slice(h,v-p),w=y.slice(h,m-p),x=l.get(b,w,i,c),k=[];for(g=g||{_t:"a"},t=h;v-p>t;t++)f(x.indices1,t-h)<0&&(g["_"+t]=[d[t],0,0],k.push(t));var _=!0;e.options&&e.options.arrays&&e.options.arrays.detectMove===!1&&(_=!1);var O=!1;e.options&&e.options.arrays&&e.options.arrays.includeValueOnMove&&(O=!0);var P=k.length;for(t=h;m-p>t;t++){var E=f(x.indices2,t-h);if(0>E){var N=!1;if(_&&P>0)for(var j=0;P>j;j++)if(n=k[j],i(b,w,n-h,t-h,c)){g["_"+n].splice(1,2,t,u),O||(g["_"+n][0]=""),a=t,s=new o(e.left[n],e.right[a]),e.push(s,a),k.splice(j,1),N=!0;break}N||(g[t]=[y[t]])}else n=x.indices1[E]+h,a=x.indices2[E]+h,s=new o(e.left[n],e.right[a]),e.push(s,a)}e.setResult(g).exit()}};h.filterName="arrays";var p={numerically:function(e,t){return e-t},numericallyBy:function(e){return function(t,n){return t[e]-n[e]}}},d=function(e){if(e.nested&&"a"===e.delta._t){var t,n,r=e.delta,i=e.left,o=[],s=[],l=[];for(t in r)if("_t"!==t)if("_"===t[0]){if(0!==r[t][2]&&r[t][2]!==u)throw new Error("only removal or move can be applied at original array indices, invalid diff type: "+r[t][2]);o.push(parseInt(t.slice(1),10))}else 1===r[t].length?s.push({index:parseInt(t,10),value:r[t][0]}):l.push({index:parseInt(t,10),delta:r[t]});for(o=o.sort(p.numerically),t=o.length-1;t>=0;t--){n=o[t];var c=r["_"+n],f=i.splice(n,1)[0];c[2]===u&&s.push({index:c[1],value:f})}s=s.sort(p.numericallyBy("index"));var h=s.length;for(t=0;h>t;t++){var d=s[t];i.splice(d.index,0,d.value)}var y,v=l.length;if(v>0)for(t=0;v>t;t++){var m=l[t];y=new a(e.left[m.index],m.delta),e.push(y,m.index)}return e.children?void e.exit():void e.setResult(e.left).exit()}};d.filterName="arrays";var y=function(e){if(e&&e.children&&"a"===e.delta._t){for(var t,n=e.children.length,r=0;n>r;r++)t=e.children[r],e.left[t.childName]=t.result;e.setResult(e.left).exit()}};y.filterName="arraysCollectChildren";var v=function(e){if(!e.nested)return void(e.delta[2]===u&&(e.newName="_"+e.delta[1],e.setResult([e.delta[0],parseInt(e.childName.substr(1),10),u]).exit()));if("a"===e.delta._t){var t,n;for(t in e.delta)"_t"!==t&&(n=new s(e.delta[t]),e.push(n,t));e.exit()}};v.filterName="arrays";var m=function(e,t,n){if("string"==typeof t&&"_"===t[0])return parseInt(t.substr(1),10);if(c(n)&&0===n[2])return"_"+t;var r=+t;for(var i in e){var o=e[i];if(c(o))if(o[2]===u){var a=parseInt(i.substr(1),10),s=o[1];if(s===+t)return a;r>=a&&s>r?r++:a>=r&&r>s&&r--}else if(0===o[2]){var l=parseInt(i.substr(1),10);r>=l&&r++}else 1===o.length&&r>=i&&r--}return r},g=function(e){if(e&&e.children&&"a"===e.delta._t){for(var t,n=e.children.length,r={_t:"a"},i=0;n>i;i++){t=e.children[i];var o=t.newName;"undefined"==typeof o&&(o=m(e.delta,t.childName,t.result)),r[o]!==t.result&&(r[o]=t.result)}e.setResult(r).exit()}};g.filterName="arraysCollectChildren",n.diffFilter=h,n.patchFilter=d,n.collectChildrenPatchFilter=y,n.reverseFilter=v,n.collectChildrenReverseFilter=g},{"../contexts/diff":2,"../contexts/patch":3,"../contexts/reverse":4,"./lcs":10}],9:[function(e,t,n){var r=function(e){e.left instanceof Date?(e.right instanceof Date?e.left.getTime()!==e.right.getTime()?e.setResult([e.left,e.right]):e.setResult(void 0):e.setResult([e.left,e.right]),e.exit()):e.right instanceof Date&&e.setResult([e.left,e.right]).exit()};r.filterName="dates",n.diffFilter=r},{}],10:[function(e,t,n){var r=function(e,t,n,r){return e[n]===t[r]},i=function(e,t,n,r){var i,o,a=e.length,s=t.length,l=[a+1];for(i=0;a+1>i;i++)for(l[i]=[s+1],o=0;s+1>o;o++)l[i][o]=0;for(l.match=n,i=1;a+1>i;i++)for(o=1;s+1>o;o++)n(e,t,i-1,o-1,r)?l[i][o]=l[i-1][o-1]+1:l[i][o]=Math.max(l[i-1][o],l[i][o-1]);return l},o=function(e,t,n,r,i,a){if(0===r||0===i)return{sequence:[],indices1:[],indices2:[]};if(e.match(t,n,r-1,i-1,a)){var s=o(e,t,n,r-1,i-1,a);return s.sequence.push(t[r-1]),s.indices1.push(r-1),s.indices2.push(i-1),s}return e[r][i-1]>e[r-1][i]?o(e,t,n,r,i-1,a):o(e,t,n,r-1,i,a)},a=function(e,t,n,a){a=a||{};var s=i(e,t,n||r,a),l=o(s,e,t,e.length,t.length,a);return"string"==typeof e&&"string"==typeof t&&(l.sequence=l.sequence.join("")),l};n.get=a},{}],11:[function(e,t,n){var r=e("../contexts/diff").DiffContext,i=e("../contexts/patch").PatchContext,o=e("../contexts/reverse").ReverseContext,a=function(e){if(e&&e.children){for(var t,n=e.children.length,r=e.result,i=0;n>i;i++)t=e.children[i],"undefined"!=typeof t.result&&(r=r||{},r[t.childName]=t.result);r&&e.leftIsArray&&(r._t="a"),e.setResult(r).exit()}};a.filterName="collectChildren";var s=function(e){if(!e.leftIsArray&&"object"===e.leftType){var t,n,i=e.options.propertyFilter;for(t in e.left)Object.prototype.hasOwnProperty.call(e.left,t)&&(i&&!i(t,e)||(n=new r(e.left[t],e.right[t]),e.push(n,t)));for(t in e.right)Object.prototype.hasOwnProperty.call(e.right,t)&&(i&&!i(t,e)||"undefined"==typeof e.left[t]&&(n=new r(void 0,e.right[t]),e.push(n,t)));return e.children&&0!==e.children.length?void e.exit():void e.setResult(void 0).exit()}};s.filterName="objects";var l=function(e){if(e.nested&&!e.delta._t){var t,n;for(t in e.delta)n=new i(e.left[t],e.delta[t]),e.push(n,t);e.exit()}};l.filterName="objects";var u=function(e){if(e&&e.children&&!e.delta._t){for(var t,n=e.children.length,r=0;n>r;r++)t=e.children[r],Object.prototype.hasOwnProperty.call(e.left,t.childName)&&void 0===t.result?delete e.left[t.childName]:e.left[t.childName]!==t.result&&(e.left[t.childName]=t.result);e.setResult(e.left).exit()}};u.filterName="collectChildren";var c=function(e){if(e.nested&&!e.delta._t){var t,n;for(t in e.delta)n=new o(e.delta[t]),e.push(n,t);e.exit()}};c.filterName="objects";var f=function(e){if(e&&e.children&&!e.delta._t){for(var t,n=e.children.length,r={},i=0;n>i;i++)t=e.children[i],r[t.childName]!==t.result&&(r[t.childName]=t.result);e.setResult(r).exit()}};f.filterName="collectChildren",n.collectChildrenDiffFilter=a,n.objectsDiffFilter=s,n.patchFilter=l,n.collectChildrenPatchFilter=u,n.reverseFilter=c,n.collectChildrenReverseFilter=f},{"../contexts/diff":2,"../contexts/patch":3,"../contexts/reverse":4}],12:[function(e,t,n){var r=2,i=60,o=null,a=function(t){if(!o){var n;if("undefined"!=typeof diff_match_patch)n="function"==typeof diff_match_patch?new diff_match_patch:new diff_match_patch.diff_match_patch;else if("function"==typeof e)try{var r="diff_match_patch_uncompressed",i=e("../../public/external/"+r);n=new i.diff_match_patch}catch(a){n=null}if(!n){if(!t)return null;var s=new Error("text diff_match_patch library not found");throw s.diff_match_patch_not_found=!0,s}o={diff:function(e,t){return n.patch_toText(n.patch_make(e,t))},patch:function(e,t){for(var r=n.patch_apply(n.patch_fromText(t),e),i=0;i<r[1].length;i++)if(!r[1][i]){var o=new Error("text patch failed");o.textPatchFailed=!0}return r[0]}}}return o},s=function(e){if("string"===e.leftType){var t=e.options&&e.options.textDiff&&e.options.textDiff.minLength||i;if(e.left.length<t||e.right.length<t)return void e.setResult([e.left,e.right]).exit();var n=a();if(!n)return void e.setResult([e.left,e.right]).exit();var o=n.diff;e.setResult([o(e.left,e.right),0,r]).exit()}};s.filterName="texts";var l=function(e){if(!e.nested&&e.delta[2]===r){var t=a(!0).patch;e.setResult(t(e.left,e.delta[0])).exit()}};l.filterName="texts";var u=function(e){var t,n,r,i,o,a,s,l,u=null,c=/^@@ +\-(\d+),(\d+) +\+(\d+),(\d+) +@@$/;for(r=e.split("\n"),t=0,n=r.length;n>t;t++){i=r[t];var f=i.slice(0,1);"@"===f?(u=c.exec(i),a=t,s=null,l=null,r[a]="@@ -"+u[3]+","+u[4]+" +"+u[1]+","+u[2]+" @@"):"+"===f?(s=t,r[t]="-"+r[t].slice(1),"+"===r[t-1].slice(0,1)&&(o=r[t],r[t]=r[t-1],r[t-1]=o)):"-"===f&&(l=t,r[t]="+"+r[t].slice(1))}return r.join("\n")},c=function(e){e.nested||e.delta[2]===r&&e.setResult([u(e.delta[0]),0,r]).exit()};c.filterName="texts",n.diffFilter=s,n.patchFilter=l,n.reverseFilter=c},{}],13:[function(e,t,n){var r="function"==typeof Array.isArray?Array.isArray:function(e){return e instanceof Array},i=function(e){if(e.left===e.right)return void e.setResult(void 0).exit();if("undefined"==typeof e.left){if("function"==typeof e.right)throw new Error("functions are not supported");return void e.setResult([e.right]).exit()}if("undefined"==typeof e.right)return void e.setResult([e.left,0,0]).exit();if("function"==typeof e.left||"function"==typeof e.right)throw new Error("functions are not supported");return e.leftType=null===e.left?"null":typeof e.left,e.rightType=null===e.right?"null":typeof e.right,e.leftType!==e.rightType?void e.setResult([e.left,e.right]).exit():"boolean"===e.leftType||"number"===e.leftType?void e.setResult([e.left,e.right]).exit():("object"===e.leftType&&(e.leftIsArray=r(e.left)),"object"===e.rightType&&(e.rightIsArray=r(e.right)),e.leftIsArray!==e.rightIsArray?void e.setResult([e.left,e.right]).exit():void 0)};i.filterName="trivial";var o=function(e){return"undefined"==typeof e.delta?void e.setResult(e.left).exit():(e.nested=!r(e.delta),e.nested?void 0:1===e.delta.length?void e.setResult(e.delta[0]).exit():2===e.delta.length?void e.setResult(e.delta[1]).exit():3===e.delta.length&&0===e.delta[2]?void e.setResult(void 0).exit():void 0)};o.filterName="trivial";var a=function(e){return"undefined"==typeof e.delta?void e.setResult(e.delta).exit():(e.nested=!r(e.delta),e.nested?void 0:1===e.delta.length?void e.setResult([e.delta[0],0,0]).exit():2===e.delta.length?void e.setResult([e.delta[1],e.delta[0]]).exit():3===e.delta.length&&0===e.delta[2]?void e.setResult([e.delta[0]]).exit():void 0)};a.filterName="trivial",n.diffFilter=i,n.patchFilter=o,n.reverseFilter=a},{}],14:[function(e,t,n){var r=e("./environment"),i=e("./diffpatcher").DiffPatcher;n.DiffPatcher=i,n.create=function(e){return new i(e)},n.dateReviver=e("./date-reviver");var o;if(n.diff=function(){return o||(o=new i),o.diff.apply(o,arguments)},n.patch=function(){return o||(o=new i),o.patch.apply(o,arguments)},n.unpatch=function(){return o||(o=new i),o.unpatch.apply(o,arguments)},n.reverse=function(){return o||(o=new i),o.reverse.apply(o,arguments)},r.isBrowser)n.homepage="{{package-homepage}}",n.version="{{package-version}}";else{var a="../package.json",s=e(a);n.homepage=s.homepage,n.version=s.version;var l="./formatters",u=e(l);n.formatters=u,n.console=u.console}},{"./date-reviver":5,"./diffpatcher":6,"./environment":7}],15:[function(e,t,n){var r=function(e){this.name=e,this.filters=[]};r.prototype.process=function(e){if(!this.processor)throw new Error("add this pipe to a processor before using it");for(var t=this.debug,n=this.filters.length,r=e,i=0;n>i;i++){var o=this.filters[i];if(t&&this.log("filter: "+o.filterName),o(r),"object"==typeof r&&r.exiting){r.exiting=!1;break}}!r.next&&this.resultCheck&&this.resultCheck(r)},r.prototype.log=function(e){console.log("[jsondiffpatch] "+this.name+" pipe, "+e)},r.prototype.append=function(){return this.filters.push.apply(this.filters,arguments),this},r.prototype.prepend=function(){return this.filters.unshift.apply(this.filters,arguments),this},r.prototype.indexOf=function(e){if(!e)throw new Error("a filter name is required");for(var t=0;t<this.filters.length;t++){var n=this.filters[t];if(n.filterName===e)return t}throw new Error("filter not found: "+e)},r.prototype.list=function(){for(var e=[],t=0;t<this.filters.length;t++){var n=this.filters[t];e.push(n.filterName)}return e},r.prototype.after=function(e){var t=this.indexOf(e),n=Array.prototype.slice.call(arguments,1);if(!n.length)throw new Error("a filter is required");return n.unshift(t+1,0),Array.prototype.splice.apply(this.filters,n),this},r.prototype.before=function(e){var t=this.indexOf(e),n=Array.prototype.slice.call(arguments,1);if(!n.length)throw new Error("a filter is required");return n.unshift(t,0),Array.prototype.splice.apply(this.filters,n),this},r.prototype.clear=function(){return this.filters.length=0,this},r.prototype.shouldHaveResult=function(e){if(e===!1)return void(this.resultCheck=null);if(!this.resultCheck){var t=this;return this.resultCheck=function(e){if(!e.hasResult){console.log(e);var n=new Error(t.name+" failed");throw n.noResult=!0,n}},this}},n.Pipe=r},{}],16:[function(e,t,n){var r=function(e){this.selfOptions=e||{},this.pipes={}};r.prototype.options=function(e){return e&&(this.selfOptions=e),this.selfOptions},r.prototype.pipe=function(e,t){if("string"==typeof e){if("undefined"==typeof t)return this.pipes[e];this.pipes[e]=t}if(e&&e.name){if(t=e,t.processor===this)return t;this.pipes[t.name]=t}return t.processor=this,t},r.prototype.process=function(e,t){var n=e;n.options=this.options();for(var r,i,o=t||e.pipe||"default";o;)"undefined"!=typeof n.nextAfterChildren&&(n.next=n.nextAfterChildren,n.nextAfterChildren=null),"string"==typeof o&&(o=this.pipe(o)),o.process(n),i=n,r=o,o=null,n&&n.next&&(n=n.next,o=i.nextPipe||n.pipe||r);return n.hasResult?n.result:void 0},n.Processor=r},{}],17:[function(e,t,n){"use strict";var r=e("./index"),i=e("./editor"),o=e("./repository"),a=e("./xhr");r.Skaryna.Editor=i.Editor,r.Skaryna.repository=o.repository,r.Skaryna.XHR=a.XHR,window.Skaryna=r.Skaryna,Array.isArray(window.___Skaryna)&&window.___Skaryna.forEach(function(e){e.apply(window)})},{"./editor":19,"./index":21,"./repository":26,"./xhr":32}],18:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){return String(e).replace(/([.*+?=^!:${}()|[\]\/\\])/g,"\\$1")}function s(e,t){var n,r=null;return e.forEach(function(e){var i=new RegExp(a(e).replace(/\\\*/g,"(.+)")),o=e.split("*").filter(function(e){return e.length}).length,s=t.match(i);s&&(null===r||s.length-o<r)&&(r=s.length-o,n=e)}),n}function l(e){return v[e]}function u(e){if(!e)return null;var t=e.getAttribute("data-skaryna-id");return l(t)}function c(e){for(var t="abcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;5>r;r++)n+=t.charAt(Math.floor(Math.random()*t.length));return-1===Object.keys(v).indexOf(n)?(v[n]=v[n]||e,n):c(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.Variants=n.Fields=n.StaticBlockNode=n.Heading=n.Image=n.Paragraph=n.TextNode=n.Quote=n.Document=n.BlockNode=n.Node=void 0;var f=function k(e,t,n){null===e&&(e=Function.prototype);var r=Object.getOwnPropertyDescriptor(e,t);if(void 0===r){var i=Object.getPrototypeOf(e);return null===i?void 0:k(i,t,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},h=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.escapeRegexp=a,n.bestMatch=s,n.getById=l,n.getByNode=u,n.randomID=c;var p=e("./emitter"),d=e("./util"),y=e("./serializer/toHTML"),v={},m=n.Node=function(e){function t(){r(this,t);var e=i(this,Object.getPrototypeOf(t).call(this));return e.name=c(e),e.__locked=!1,e}return o(t,e),h(t,[{key:"lock",value:function(){this.__locked=!0}},{key:"attr",value:function(){return this.attrs}},{key:"get",value:function(){throw new Error("Should be implemented")}},{key:"set",value:function(){throw new Error("Should be implemented")}},{key:"toJSON",value:function(){var e=new Error("Should be implemented");throw e}},{key:"locked",get:function(){return this.__locked}},{key:"defaultNewItem",get:function(){return null}},{key:"allowedNewItems",get:function(){return[]}}]),t}(p.Emitter),g=n.BlockNode=function(e){function t(e,n,o){r(this,t);var a=i(this,Object.getPrototypeOf(t).call(this));return a._type=e,a.items=n||[],a.attrs=o,a}return o(t,e),h(t,[{key:"get",value:function(e){var t=e.split("."),n=t.shift(),r=t.join("."),i=void 0;return isNaN(n)?null:(i=this.items[+n],r.length&&i?i.get(r):i)}},{key:"set",value:function(e,t){var n=e.split("."),r=n.shift(),i=n.join("."),o=void 0;return isNaN(r)?null:i.length&&o?this.items[+r].set(i,t):void this.items.splice(+r,0,t)}},{key:"toJSON",value:function(){var e={type:this.type,items:this.items.map(function(e){return e.toJSON()})};return this.attrs&&(e.attrs=JSON.parse(JSON.stringify(this.attrs))),e}},{key:"decorate",value:function(e){return(0,y.toHTML)(this,{edit:!0}).then(function(t){e.innerHTML="",(0,d.arraize)(t.children).forEach(function(t){e.appendChild(t)})})}},{key:"empty",get:function(){return this.items.length<=0}},{key:"type",get:function(){return this._type}}]),t}(m),b=(n.Document=function(e){function t(e){return r(this,t),i(this,Object.getPrototypeOf(t).call(this,"document",e))}return o(t,e),h(t,[{key:"defaultNewItem",get:function(){return w}},{key:"allowedNewItems",get:function(){return[w,x]}}]),t}(g),n.Quote=function(e){function t(e){return r(this,t),i(this,Object.getPrototypeOf(t).call(this,"quote",e))}return o(t,e),t}(g),n.TextNode=function(e){function t(e,n,o){r(this,t);var a=i(this,Object.getPrototypeOf(t).call(this));return a.text=e&&e.toString?e.toString():"",a.formats=n||null,a.attrs=o,a}return o(t,e),h(t,[{key:"attr",value:function(){return"text"===this.type?{}:f(Object.getPrototypeOf(t.prototype),"attr",this).call(this)}},{key:"type",get:function(){return"text"}},{key:"empty",get:function(){return!this.text||!this.text.replace(/^([\s\n\r\t]+)|([\s\n\r\t]+)$/,"").length}},{key:"absoluteEmpty",get:function(){return 0===this.text.length}}],[{key:"type",get:function(){return"text"}}]),h(t,[{key:"toJSON",value:function(){var e={type:this.type,text:this.text};return this.formats&&(e.formats=JSON.parse(JSON.stringify(this.formats))),this.attrs&&"text"!==this.type&&(e.attrs=JSON.parse(JSON.stringify(this.attrs))),e}},{key:"append",value:function(e){var n=this;if(!(e instanceof t))throw new Error("Only text nodes can be joined");e.formats&&(this.formats=this.formats||[],e.formats.forEach(function(e){n.formats.push({slice:[e.slice[0]+n.text.length,e.slice[1]],apply:e.apply})})),this.text+=e.text}},{key:"decorate",value:function(e){return(0,y.toHTML)(this,{edit:!0}).then(function(t){e.innerHTML=t.textContent})}}]),t}(m)),w=n.Paragraph=function(e){function t(e,n,o){return r(this,t),i(this,Object.getPrototypeOf(t).call(this,e,n,o))}return o(t,e),h(t,[{key:"type",get:function(){return"paragraph"}}],[{key:"type",get:function(){return"paragraph"}}]),h(t,[{key:"nextNodeType",get:function(){return t}}]),t}(b),x=n.Image=function(e){function t(e,n,o){r(this,t);var a=i(this,Object.getPrototypeOf(t).call(this,"image"));return a.src=e,a.title=n,a.alt=o,a}return o(t,e),h(t,[{key:"attr",value:function(){var e=f(Object.getPrototypeOf(t.prototype),"attr",this).call(this)||{};return this.src&&(e.src=this.src),this.title&&(e.title=this.title),this.alt&&(e.alt=this.title),e}},{key:"toJSON",value:function(){var e={type:"image",src:this.src};return this.title&&(e.title=this.title),this.alt&&(e.alt=this.alt),e}},{key:"type",get:function(){return"image"}}],[{key:"type",get:function(){return"image"}}]),t}(m);n.Heading=function(e){function t(e,n,o,a){r(this,t);var s=i(this,Object.getPrototypeOf(t).call(this,n,o,a));return s.level=Math.min(6,e||1),s}return o(t,e),h(t,[{key:"attr",value:function(){return f(Object.getPrototypeOf(t.prototype),"attr",this).call(this)}},{key:"toJSON",value:function(){var e=f(Object.getPrototypeOf(t.prototype),"toJSON",this).call(this);return e.level=this.level,e}},{key:"type",get:function(){return"heading"}}],[{key:"type",get:function(){return"heading"}}]),t}(b),n.StaticBlockNode=function(e){function t(){return r(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return o(t,e),h(t,[{key:"locked",get:function(){return!0}},{key:"defaultNewItem",get:function(){return w}},{key:"allowedNewItems",get:function(){return[w,x]}}]),t}(g),n.Fields=function(e){function t(e){r(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return n._map=e,n}return o(t,e),h(t,[{key:"get",value:function(e){var t=e.split("."),n=t.shift(),r=t.join("."),i=void 0;return i=this._map[n],r.length&&i?i.get(r):i}},{key:"set",value:function(e,t){var n=e.split("."),r=n.shift(),i=n.join("."),o=void 0;return i.length&&o?this._map[r].get(i,t):void(this._map[r]=t)}},{key:"toJSON",value:function(){return(0,d.clone)([this._map,{type:"Fields"}])}},{key:"type",get:function(){return"Fields"}}],[{key:"type",get:function(){return"Fields"}}]),t}(m),n.Variants=function(e){function t(e){r(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return n._variants=e,n}return o(t,e),h(t,[{key:"best",value:function n(e){var n=s(Object.keys(this._variants),e);return this._variants[n]}},{key:"toJSON",value:function(){return(0,d.clone)([this._map,{type:"Variants"}])}},{key:"type",get:function(){return"Variants"}}],[{key:"type",get:function(){return"Variants"}}]),t}(m)},{"./emitter":20,"./serializer/toHTML":28,"./util":31}],19:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.Editor=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./emitter"),l=e("./util"),u=e("./repository"),c=e("./serializer/toHTML"),f=(e("./serializer/toPOM"),e("./parser/fromHTML")),h=e("./parser/fromPOM"),p=e("./xhr"),d=e("./document"),y=e("./toolbar"),v=e("./injector"),m=13,g=[m],b=new y.Toolbar,w=void 0,x=(n.Editor=function(e){function t(e){r(this,t);var n=i(this,Object.getPrototypeOf(t).call(this));return n.element=e,n.documentPath=e.getAttribute("data-skaryna-path")||null,n.document=e.getAttribute("data-skaryna-doc")||u.DEFAULT_DOCUMENT,n.variant=e.getAttribute("data-skaryna-variant")||null,n._pendingState=null,n._rendering=!1,n.init(),n}return o(t,e),a(t,null,[{key:"factory",value:function(e){var n=new t(e);return n.inited}},{key:"initEditors",value:function(e){var n=this;return Promise.all((0,l.arraize)(e.querySelectorAll("[data-skaryna]")).map(function(e){return t.factory(e)})).then(function(e){return n.editors=e,e})}},{key:"registerDocument",value:function(e,t){u.repository.set(t||u.DEFAULT_DOCUMENT,e)}},{key:"load",value:function(e,t){return p.XHR.get(e).then(function(e){return(0,h.fromPOM)(JSON.parse(e))}).then(function(e){u.repository.set(t||u.DEFAULT_DOCUMENT,e)})}}]),a(t,[{key:"init",value:function(){var e=this;return this.inited?this.inited:void(this.inited=(0,f.fromHTML)(this.element,{edit:!0}).then(function(t){if(t.lock(),u.repository.has(e.document)){var n=u.repository.get(e.document);e.documentPath&&(n=n.get(e.documentPath),n&&"Variants"===n.type&&n.best&&(n=n.best(e.variant||"*"))),e.content=n}else t.empty||(u.repository.set(e.document,t),e.content=t)}).then(function(){return e.render()})["catch"](function(e){console.log(e),console.log(e.stack)}))}},{key:"getCaretCharacterOffsetWithin",value:function(e){var t=0,n=e.ownerDocument||e.document,r=n.defaultView||n.parentWindow,i=void 0;if("undefined"!=typeof r.getSelection){if(i=r.getSelection(),i.rangeCount>0){var o=r.getSelection().getRangeAt(0),a=o.cloneRange();a.selectNodeContents(e),a.setEnd(o.endContainer,o.endOffset),t=a.toString().length}}else if((i=n.selection)&&"Control"!=i.type){var s=i.createRange(),l=n.body.createTextRange();l.moveToElementText(e),l.setEndPoint("EndToEnd",s),t=l.text.length}return t}},{key:"getSelectionLength",value:function(){}},{key:"getCurrentElement",value:function(e){var t=e.ownerDocument||e.document,n=t.defaultView||t.parentWindow,r=void 0,i=void 0;return r="undefined"!=typeof n.getSelection?n.getSelection():t.selection,i=r.focusNode,i===this.element?this.element:this.getEditableNode(i)}},{key:"getEditableNode",value:function(e){for(;e&&(!e.hasAttribute||!e.hasAttribute("data-skaryna-id"));)e=e.parentNode;return e}},{key:"onDOM",value:function(e,t,n){var r=this;e=e instanceof HTMLElement?[e]:(0,l.arraize)(this.element.querySelectorAll(e)),e.forEach(function(e){e.addEventListener(t,function(e){n.apply(r,[e])},!0)})}},{key:"render",value:function(){var e=this;this._rendering=!0;var t=this,n=void 0;return this.content?n=this.content.decorate(this.element).then(function(){e._rendering=!1}):(this._rendering=!1,n=Promise.resolve()),n.then(function(){t.element.setAttribute("data-skaryna-id",t.content?t.content.name:(0,d.randomID)(!0)),t.element.setAttribute("contentEditable",""),t.element.addEventListener("keydown",function(e){t.onKeyUp(e)},!0),t.onDOM("[data-skaryna-id]","mouseup",t.focus),t.onDOM(t.element,"mouseup",t.focus),t.element.addEventListener("mouseup",function(e){var n=window.getSelection?window.getSelection().toString():document.selection.createRange().text;n&&n.length&&t.onSelect(e)},!0)}).then(function(){return t})}},{key:"onSelect",value:function(){this.showToolbar(),this.strong()}},{key:"showToolbar",value:function(){b.anchor()}},{key:"focus",value:function(e){var t=this,n=this.getEditableNode(e.target),r=(0,d.getByNode)(n),i=(0,d.getByNode)(n.parentNode),o=void 0,a=void 0;o=i?i.allowedNewItems:r.allowedNewItems,this.hideInjector(),o.length>0&&(a=i?this.showInjector(n,o):this.showInjector(n.parentNode.lastChild,o),a.on("injectnode",function(e){if(i){var n=i.items.indexOf(r);i.items.splice(n,0,new e.data)}else i.items.push(new e.data);t.render()}))}},{key:"showInjector",value:function(e,t){var n=new v.Injector(t),r=e.getBoundingClientRect();return document.body.appendChild(n.element),n.goTo(r.left,r.top),n}},{key:"hideInjector",value:function(){w&&(w.parentNode&&w.parentNode.removeChild(w),w=null)}},{key:"strong",value:function(){var e=this.getCurrentElement(event.target),t=window.getSelection?window.getSelection().toString():document.selection.createRange().text,n=t.length,r=this.getCaretCharacterOffsetWithin(e)-n;(0,f.fromHTML)(e).then(function(e){return e.formats=e.formats||[],e.formats.push({
slice:[r,n],apply:["strong"]}),(0,c.toHTML)(e)}).then(function(t){e.innerHTML=t.innerHTML})}},{key:"onExternalChange",value:function(){return this._rendering?void(this._pendingState=!0):void this.render()}},{key:"newItem",value:function(e){for(var n=e,r=(0,d.getByNode)(n),i=this,o=t.editors.reduce(function(e,t){return t.element===n?t:e},null);null!==r;){if(!r){if(o){var a=t.editors.indexOf(o)+1;a>=t.editors.length&&(a=0),i.editNode(t.editors[a].element)}return}if(r.defaultNewItem){var s=new r.defaultNewItem;return r.items.push(s),void(0,c.toHTML)(s,{edit:!0}).then(function(e){n.appendChild(e),i.editNode(e)})}n=n.parentNode,r=(0,d.getByNode)(n),o=o||t.editors.reduce(function(e,t){return t.element===n?t:e},null)}}},{key:"editNode",value:function(e){var t=document.createRange(),n=window.getSelection();t.setStart(e,0),t.collapse(!0),n.removeAllRanges(),n.addRange(t)}},{key:"ownAction",value:function(e,t){return e===m?this.newItem(t):void 0}},{key:"onKeyUp",value:function(e){var t=this,n=this.getCurrentElement(e.target);-1!==g.indexOf(e.keyCode)?(e.stopPropagation(),e.preventDefault(),this.ownAction(e.keyCode,n)):setTimeout(function(){return t.update(n)},0)}},{key:"update",value:function(e){var n=this,r=this,i=u.repository.get(r.document);r.documentPath&&(i=i.set(r.documentPath,r.content),u.repository.emit(u.CHANGE)),(0,f.fromHTML)(e).then(function(r){t.emit("selected",{editor:n,element:e,node:r})})}}]),t}(s.Emitter),document.createElement("style"));x.innerText="\n        p[data-skaryna-id]:empty {\n                display: block;\n                height: 1em;\n            }\n        }\n        ",document.body.appendChild(x)},{"./document":18,"./emitter":20,"./injector":22,"./parser/fromHTML":24,"./parser/fromPOM":25,"./repository":26,"./serializer/toHTML":28,"./serializer/toPOM":29,"./toolbar":30,"./util":31,"./xhr":32}],20:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){var n=t.fn,r=t.context,i=t.args,o=[e].concat(i);n.apply(r||null,o)}function o(e,t,n,r,i){this.__listeners=this.__listeners||{},this.__listeners[e]=this.__listeners[e]||[],this.__listeners[e].push({fn:t,context:n,args:r,once:!!i})}function a(e,t,n,r){this.on(e,t,n,r,!0)}function s(e,t,n,r,i){var o=this;this.__listeners&&this.__listeners[e]&&this.getListeners(e,t,n,r,i).forEach(function(t){o.__listeners[e].splice(o.__listeners[e].indexOf(t),1)})}function l(e,t,n){if(this.__listeners&&this.__listeners[e]){var r=this,o=new h(e,t,this,n);this.getListeners(e).forEach(function(t){t.once===!0&&r.off(e,t.fn,t.context,t.args,t.once),i(o,t)})}}function u(e,t){this.on(e,function(n){t.emit(e,n.data,n)})}function c(e,t,n,r){return this.__listeners&&this.__listeners[e]?this.__listeners[e].map(function(e){return void 0!==t&&e.fn!==t?!1:void 0!==n&&e.context!==n?!1:void 0!==r&&e.args!==r?!1:e}).filter(function(e){return!!e}):null}Object.defineProperty(n,"__esModule",{value:!0});var f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),h=n.Event=function(){function e(t,n,i,o){r(this,e),Object.defineProperties(this,{name:{value:t,writable:!1},data:{value:n,writable:!1},source:{value:i,writable:!1},parent:{value:o,writable:!1}})}return f(e,[{key:"toJSON",value:function(){return{name:this.name,data:this.data,source:this.source,parent:this.parent}}},{key:"toString",value:function(){return"Event: "+JSON.stringify(this.toJSON())}}]),e}();n.Emitter=function(){function e(){r(this,e)}return f(e,[{key:"on",value:function(){o.apply(this,arguments)}},{key:"once",value:function(){a.apply(this,arguments)}},{key:"off",value:function(){s.apply(this,arguments)}},{key:"emit",value:function(){l.apply(this,arguments)}},{key:"bubbleEvent",value:function(){u.apply(this,arguments)}},{key:"getListeners",value:function(){return c.apply(this,arguments)}}],[{key:"on",value:function(){o.apply(this,arguments)}},{key:"once",value:function(){a.apply(this,arguments)}},{key:"off",value:function(){s.apply(this,arguments)}},{key:"emit",value:function(){l.apply(this,arguments)}},{key:"bubbleEvent",value:function(){u.apply(this,arguments)}},{key:"getListeners",value:function(){return c.apply(this,arguments)}}]),e}()},{}],21:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=e("./emitter");Object.defineProperty(n,"Event",{enumerable:!0,get:function(){return i.Event}}),Object.defineProperty(n,"Emitter",{enumerable:!0,get:function(){return i.Emitter}});n.Skaryna=function o(){r(this,o)}},{"./emitter":20}],22:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.Injector=void 0;var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=e("./emitter"),l=void 0,u={paragraph:"M832 320v704q0 104-40.5 198.5t-109.5 163.5-163.5 109.5-198.5 40.5h-64q-26 0-45-19t-19-45v-128q0-26 19-45t45-19h64q106 0 181-75t75-181v-32q0-40-28-68t-68-28h-224q-80 0-136-56t-56-136v-384q0-80 56-136t136-56h384q80 0 136 56t56 136zm896 0v704q0 104-40.5 198.5t-109.5 163.5-163.5 109.5-198.5 40.5h-64q-26 0-45-19t-19-45v-128q0-26 19-45t45-19h64q106 0 181-75t75-181v-32q0-40-28-68t-68-28h-224q-80 0-136-56t-56-136v-384q0-80 56-136t136-56h384q80 0 136 56t56 136z",image:"M576 576q0 80-56 136t-136 56-136-56-56-136 56-136 136-56 136 56 56 136zm1024 384v448h-1408v-192l320-320 160 160 512-512zm96-704h-1600q-13 0-22.5 9.5t-9.5 22.5v1216q0 13 9.5 22.5t22.5 9.5h1600q13 0 22.5-9.5t9.5-22.5v-1216q0-13-9.5-22.5t-22.5-9.5zm160 32v1216q0 66-47 113t-113 47h-1600q-66 0-113-47t-47-113v-1216q0-66 47-113t113-47h1600q66 0 113 47t47 113z",dimensions:"0 0 1792 1792"};n.Injector=function(e){function t(e){r(this,t);var n=i(this,Object.getPrototypeOf(t).call(this)),o=n,a=document.createElement("div");return a.innerHTML='<skaryna><div data-skaryna-tooltip="left"><div></div><div></div></div></skaryna>',n.element=a.firstChild,a=n.element.firstChild,e.forEach(function(e){var t=document.createElement("a"),n=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("width",30),n.setAttribute("height",30),n.setAttribute("viewBox",u.dimensions),n.setAttribute("xmlns","http://www.w3.org/2000/svg"),r.setAttribute("d",u[e.type]),r.setAttribute("fill","#fff"),n.appendChild(r),t.appendChild(n),t.addEventListener("mousedown",function(t){t.preventDefault(),t.stopPropagation(),o.emit("injectnode",e)},!0),a.children[1].appendChild(t)}),l||(l=document.createElement("style"),l.innerText='\n        [data-skaryna-tooltip] {\n            position: absolute;\n            z-index: 1070;\n            display: block;\n            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;\n            font-size: 12px;\n            font-style: normal;\n            font-weight: 400;\n            line-height: 1.42857143;\n            text-align: left;\n            text-align: start;\n            text-decoration: none;\n            text-shadow: none;\n            text-transform: none;\n            letter-spacing: normal;\n            word-break: normal;\n            word-spacing: normal;\n            word-wrap: normal;\n            white-space: normal;\n            /*filter: alpha(opacity=0);\n            opacity: 0;*/\n            line-break: auto;\n            transition: opacity 0.5s;\n        }\n        [data-skaryna-tooltip] div:nth-child(2) {\n            max-width: 200px;\n            padding: 3px 8px;\n            color: #fff;\n            text-align: center;\n            background-color: #000;\n            border-radius: 4px;\n        }\n        [data-skaryna-tooltip] div:nth-child(1) {\n            position: absolute;\n            width: 0;\n            height: 0;\n            border-color: transparent;\n            border-style: solid;\n        }\n        [data-skaryna-tooltip="left"] {\n            padding: 0 5px;\n            margin-left: -3px;\n        }\n        [data-skaryna-tooltip="top"] {\n            padding: 5px 0;\n            margin-top: -3px;\n        }\n        [data-skaryna-tooltip="bottom"] {\n            padding: 5px 0;\n            margin-top: 3px;\n        }\n        [data-skaryna-tooltip="right"] {\n            padding: 0 5px;\n            margin-left: 3px;\n        }\n        [data-skaryna-tooltip="left"] div:nth-child(1) {\n            top: 50%;\n            right: 0;\n            margin-top: -5px;\n            border-width: 5px 0 5px 5px;\n            border-left-color: #000;\n        }\n        [data-skaryna-tooltip="top"] div:nth-child(1) {\n            bottom: 0;\n            left: 50%;\n            margin-left: -5px;\n            border-width: 5px 5px 0;\n            border-top-color: #000;\n        }\n        [data-skaryna-tooltip="bottom"] div:nth-child(1) {\n            top: 0;\n            left: 50%;\n            margin-left: -5px;\n            border-width: 0 5px 5px;\n            border-bottom-color: #000;\n        }\n        [data-skaryna-tooltip="right"] div:nth-child(1) {\n            top: 50%;\n            left: 0;\n            margin-top: -5px;\n            border-width: 5px 5px 5px 0;\n            border-right-color: #000;\n        }\n        [data-skaryna-tooltip] a {\n            margin-left: 10px;\n        }\n        [data-skaryna-tooltip] a:first-child{\n            margin-left: 0px;\n        }',document.body.appendChild(l)),n}return o(t,e),a(t,[{key:"goTo",value:function(e,t){var n=this;setTimeout(function(){var r=n.element.firstChild,i=r.getBoundingClientRect();r.style.top=t+"px",r.style.left=e-i.width+"px"},0)}}]),t}(s.Emitter)},{"./emitter":20}],23:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e)}return i(e,[{key:"parse",value:function(e,t,n,r){return t?this.handle(e,t,n,r):Promise.reject(new Error("Model is empty"))}},{key:"on",value:function(e,t,n){this._handlers=this._handlers||{},this._handlers[e]=this._handlers[e]||{},this._handlers[e][t]=n}},{key:"handle",value:function(e,t,n,r){var i=this._handlers&&this._handlers[e]&&this._handlers[e][t]?this._handlers[e][t]:null;return i||(i=this._handlers&&this._handlers[e]&&this._handlers[e]["*"]?this._handlers[e]["*"]:null)?i(t,n,r).then(function(e){return e}):Promise.reject(new Error("No handler defined for "+e+" : "+t))}}]),e}();n.parser=new o},{}],24:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){switch(e){case"td":case"th":return"tr";case"tr":return"table";default:return"div"}}function s(e,t){return e&&e.childNodes?Promise.all((0,g.arraize)(e.childNodes).map(function(e){return 1===e.nodeType||3===e.nodeType?l(e,t):null})).then(function(e){return e.filter(function(e){return e.constructor===b.TextNode?!e.absoluteEmpty:null!==e})}):Promise.resolve([])}function l(e,t){if(!e)return Promise.resolve(null);if("string"==typeof e){if(0===e.length)return Promise.resolve(null);var n=document.createElement(a(e.replace("/^(s*)<([a-zA-Z0-9_-]+)","$2").toLowerCase()));return n.innerHTML=e,s(n,t).then(function(e){if(1===e.length)return e[0];if(e.filter(function(e){return!(e instanceof b.TextNode||e instanceof w)}).length)return e.map(function(e){return e instanceof b.BlockNode}).length?new b.Document(e.map(function(e){return"text"===e.type?new b.Paragraph(e.text,e.formats,e.attrs,t):e})):new b.Document(e);var n=e.map(function(e){if(e instanceof w){var n=c([e]),r=v(n,2),i=r[0],o=r[1];return new b.TextNode(i,o,t)}return e}),r=n.shift();return n.forEach(function(e){r.append(e)}),r})}return m.parser.parse("html",3===e.nodeType?"text":e.nodeName,e)}function u(e,t){return"A"===e.type?{type:"A",title:e.attrs.title||t,href:e.attrs.href}:e.type}function c(e){var t="",n=[],r=0;return e.forEach(function(e){if(e instanceof w){var i=c(e.items),o=v(i,2),a=o[0],s=o[1],l={slice:[r,a.length],apply:[u(e,a)]};n.push(l),s.forEach(function(e){n.push({slice:[r+e.slice[0],e.slice[1]],apply:e.apply})}),n.forEach(function(e){n.forEach(function(t,r){e!==t&&e.slice[0]===t.slice[0]&&e.slice[1]===t.slice[1]&&(e.apply=e.apply.concat(t.apply),n.splice(r,1))})}),t+=a,r+=a.length}else e instanceof b.TextNode&&(t+=e.text,r+=e.text.length)}),[t,n]}function f(e,t,n){return s(t,n).then(function(t){var r=c(t),i=v(r,2),o=i[0],a=i[1];return Promise.resolve(new b.Heading(e[1].toLowerCase(),o||"",a.length?a:null,n))})}function h(e,t,n){return s(t,n).then(function(e){var t=c(e),n=v(t,2),r=n[0],i=n[1];return Promise.resolve(new b.Paragraph(r,i.length?i:null))})}function p(e){var t=null;return(0,g.arraize)(e).forEach(function(e){t=t||{},e.value&&e.value.length&&(t[e.name]=e.value)}),t}function d(e){return e&&e.length?e:null}function y(e,t,n){return s(t,n).then(function(e){var t=[],r=[];if(e.forEach(function(i){if(i instanceof b.Paragraph){if(r.length){var o=c(e),a=v(o,2),s=a[0],l=a[1];t.push(Promise.resolve(new b.Paragraph(s,l.length?l:null,n))),r=[]}t.push(Promise.resolve(i))}else r.push(i)}),r.length){var i=c(e),o=v(i,2),a=o[0],s=o[1];t.push(Promise.resolve(new b.Paragraph(a,s.length?s:null,n)))}return Promise.all(t)}).then(function(e){return Promise.resolve(new b.Quote(e))})}Object.defineProperty(n,"__esModule",{value:!0});var v=function(){function e(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(r=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(l){i=!0,o=l}finally{try{!r&&s["return"]&&s["return"]()}finally{if(i)throw o}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();n.fromHTML=l;var m=e("./../parser"),g=e("./../util"),b=e("./../document"),w=function(e){function t(){return r(this,t),i(this,Object.getPrototypeOf(t).apply(this,arguments))}return o(t,e),t}(b.BlockNode);m.parser.on("html","text",function(e,t,n){return Promise.resolve(new b.TextNode(t.textContent,null,n))}),m.parser.on("html","H1",f),m.parser.on("html","H2",f),m.parser.on("html","H3",f),m.parser.on("html","H4",f),m.parser.on("html","H5",f),m.parser.on("html","H6",f),m.parser.on("html","P",h),m.parser.on("html","BLOCKQUOTE",y),m.parser.on("html","IMG",function(e,t,n){return Promise.resolve(new b.Image(t.src,d(t.getAttribute("title")),d(t.getAttribute("alt")),(0,g.clone)([p(t.attributes)],["src","title","alt"])),n)}),["ADDRESS","ARTICLE","ASIDE","DIV","FIGURE","FOOTER","HEADER","MAIN","NAV","SECTION"].forEach(function(e){m.parser.on("html",e,function(e,t,n){return s(t,n).then(function(r){return Promise.resolve(new b.StaticBlockNode(e,r,p(t.attributes)),n)})})}),m.parser.on("html","*",function(e,t,n){return s(t,n).then(function(r){return Promise.resolve(new w(e,r,p(t.attributes)),n)})})},{"./../document":18,"./../parser":23,"./../util":31}],25:[function(e,t,n){"use strict";function r(e){return e?o.parser.parse("pom",e.type,e):Promise.resolve(null)}function i(e){return Array.isArray(e)?Promise.all(e.map(function(e){return r(e)})).then(function(e){return e.filter(function(e){return!!e})}):Promise.resolve([])}Object.defineProperty(n,"__esModule",{value:!0}),n.fromPOM=r;var o=e("./../parser"),a=e("./../document");o.parser.on("pom","document",function(e,t){return i(t.items).then(function(e){return new a.Document(e)})}),o.parser.on("pom","heading",function(e,t){return Promise.resolve(new a.Heading(t.level,t.text,t.formats,t.attrs))}),o.parser.on("pom","paragraph",function(e,t){return Promise.resolve(new a.Paragraph(t.text,t.formats,t.attrs))}),o.parser.on("pom","text",function(e,t){return Promise.resolve(new a.TextNode(t.text,t.formats))}),o.parser.on("pom","image",function(e,t){return Promise.resolve(new a.Image(t.src,t.title,t.alt))}),o.parser.on("pom","Fields",function(e,t){var n={};return Promise.all(Object.keys(t).filter(function(e){return"type"!==e}).map(function(e){return r(t[e]).then(function(t){n[e]=t})})).then(function(){return Promise.resolve(new a.Fields(n))})}),o.parser.on("pom","Variants",function(e,t){var n={};return Promise.all(Object.keys(t).filter(function(e){return"type"!==e}).map(function(e){return r(t[e]).then(function(t){n[e]=t})})).then(function(){return Promise.resolve(new a.Variants(n))})})},{"./../document":18,"./../parser":23}],26:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(n,"__esModule",{value:!0}),n.repository=n.DEFAULT_DOCUMENT=n.CHANGE=void 0;var a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=e("./emitter"),u=e("jsondiffpatch"),c=e("./serializer/toPOM"),f=n.CHANGE="change",h=n.DEFAULT_DOCUMENT="#default",p=function(e){function t(){r(this,t);var e=i(this,Object.getPrototypeOf(t).call(this));return e._documents={},e}return o(t,e),s(t,[{key:"get",value:function(e){return this._documents[e]?this._documents[e].content:void 0}},{key:"set",value:function(e,t){var n=this._documents[e]||{initial:(0,c.toPOM)(t)};this._documents[e]={initial:n.initial,content:t},this.emit(f,{id:e})}},{key:"has",value:function(e){return!!this._documents[e]}},{key:"diff",value:function(e){var t=this;if(!e){var n=function(){var e={},n=t;return{v:Promise.all(Object.keys(t._documents).map(function(t){return n.diff(t).then(function(n){e[t]=n})})).then(function(){return e})}}();if("object"===("undefined"==typeof n?"undefined":a(n)))return n.v}return Promise.all([this._documents[e].initial,(0,c.toPOM)(this._documents[e].content)]).then(function(e){return console.log(e),(0,u.diff)(e[0],e[1])})}},{key:"toJSON",value:function(){var e=this,t={};return Object.keys(this._documents).forEach(function(n){t[n]={id:n,content:e._documents[n].content.toJSON()}}),t}},{key:"main",get:function(){return this._documents[h]}}]),t}(l.Emitter);n.repository=new p},{"./emitter":20,"./serializer/toPOM":29,jsondiffpatch:14}],27:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e)}return i(e,[{key:"serialize",value:function(e,t,n){return t?t.type?this.handle(e,t.type,t,n):Promise.reject(new Error("Undefined node type")):Promise.reject(new Error("Model is empty"))}},{key:"on",value:function(e,t,n){this._handlers=this._handlers||{},this._handlers[e]=this._handlers[e]||{},this._handlers[e][t]=n}},{key:"handle",value:function(e,t,n,r){var i=this._handlers&&this._handlers[e]&&this._handlers[e][t]?this._handlers[e][t]:null;return i||(i=this._handlers&&this._handlers[e]&&this._handlers[e]["*"]?this._handlers[e]["*"]:null)?i(n,r).then(function(e){return e}):Promise.reject(new Error("No handler defined for "+e+" : "+t))}},{key:"handleContents",value:function(e,t,n){var r=this;return Promise.all(t.map(function(e){return r.serialize("html",e,n)}))}}]),e}();n.serializer=new o},{}],28:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){return l.serializer.serialize("html",e,t)}function o(e,t){var n=document.createElement("p"),r=e.split("").map(function(e){return{"char":e,apply:[]}});return r.push({"char":"",apply:[]}),t.forEach(function(e){var t=e.slice[0],n=t+e.slice[1];e.apply.forEach(function(e){-1==r[t].apply.indexOf(e)&&r[t].apply.push(e),-1==r[n].apply.indexOf("/"+e)&&r[n].apply.push("/"+e)})}),n.innerHTML=r.map(function(e){return e.apply.map(function(e){return"<"+e+">"}).join("")+e["char"]}).join(""),(0,c.arraize)(n.childNodes)}function a(e,t,n,r,i){var a=void 0;return a=r?l.serializer.handleContents("html",r||[],i):Promise.resolve(null),a.then(function(r){e.formats&&e.formats.length&&(r=o(r[0].nodeValue,e.formats));var a=document.createElement(t);return i&&i.edit&&a.setAttribute("data-skaryna-id",e.name),n&&Object.keys(n).forEach(function(e){a.setAttribute(e,n[e])}),Array.isArray(r)&&r.forEach(function(e){return a.appendChild(e)}),a})}Object.defineProperty(n,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.toHTML=i,n.element=a;var l=e("./../serializer"),u=e("./../document"),c=e("./../util"),f=function(){function e(){r(this,e),this.children=[]}return s(e,[{key:"appendChild",value:function(e){this.children.push(e)}},{key:"outerHTML",get:function(){var e="";return this.children.forEach(function(t){e+=1===t.nodeType?t.outerHTML:t.textContent}),e}}]),e}();l.serializer.on("html","document",function(e,t){return l.serializer.handleContents("html",e.items||[],t).then(function(e){var t=new f;return Array.isArray(e)&&e.forEach(function(e){return t.appendChild(e)}),t})}),l.serializer.on("html","heading",function(e,t){return a(e,"h"+(e.level||1),e.attr(),[new u.TextNode(e.text,e.formats)],t)}),l.serializer.on("html","paragraph",function(e,t){return a(e,"p",e.attr(),[new u.TextNode(e.text,e.formats)],t)}),l.serializer.on("html","image",function(e,t){return a(e,"img",e.attr(),null,t)}),l.serializer.on("html","text",function(e,t){var n=document.createTextNode(e.text);return t&&t.edit,Promise.resolve(n)}),l.serializer.on("html","*",function(e,t){return a(e,e._type,e.attr(),e.items,t)})},{"./../document":18,"./../serializer":27,"./../util":31}],29:[function(e,t,n){"use strict";function r(e,t){return i.serializer.serialize("pom",e,t)}Object.defineProperty(n,"__esModule",{value:!0}),n.toPOM=r;var i=e("./../serializer");i.serializer.on("pom","*",function(e){return Promise.resolve(e.toJSON())})},{"./../serializer":27}],30:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.Toolbar=function(){function e(){r(this,e),this.element=document.createElement("div"),this.element.setAttribute("data-skaryna-toolbar",""),this.element.innerHTML="<div data-skaryna-toolbar-actions>aaaaaaaaa</div><div data-skaryna-toolbar-arrow><span></span></div>",this.arrow=this.element.querySelector("[data-skaryna-toolbar-arrow]");var t=document.createElement("style");t.innerText="\n            [data-skaryna-toolbar] {\n                position: absolute;\n                visibility: hidden;\n                display: none;\n                z-index: 10000;\n                transition: none;\n                top: 0;\n                left: 0;\n            }\n\n            [data-skaryna-toolbar-actions] {\n                position: relative;\n                background-image: linear-gradient(to bottom,rgba(49,49,47,.99),#262625);\n                background-repeat: repeat-x;\n                border-radius: 5px;\n            }\n\n            [data-skaryna-toolbar-arrow] {\n                position: absolute;\n                bottom: -10px;\n                left: 50%;\n                clip: rect(10px 20px 20px 0);\n                margin-left: -10px;\n            }\n\n            [data-skaryna-toolbar-arrow] > span {\n                display: block;\n                width: 20px;\n                height: 20px;\n                background-color: #262625;\n                transform: rotate(45deg) scale(.5);\n            }\n            ",document.body.appendChild(t),document.body.appendChild(this.element)}return i(e,[{key:"getSelectionCoords",value:function(e){var t=e||window,n=t.document,r=n.selection,i=void 0,o=void 0,a=void 0,s=0,l=0;if(r)"Control"!=r.type&&(i=r.createRange(),i.collapse(!0),s=i.boundingLeft,l=i.boundingTop);else if(t.getSelection&&(r=t.getSelection(),r.rangeCount&&(i=r.getRangeAt(0).cloneRange(),i.getClientRects&&(i.collapse(!0),o=i.getClientRects(),o.length>0&&(a=o[0]),s=a.left,l=a.top),0==s&&0==l))){var u=n.createElement("span");if(u.getClientRects){u.appendChild(n.createTextNode("")),i.insertNode(u),a=u.getClientRects()[0],s=a.left,l=a.top;var c=u.parentNode;c.removeChild(u),c.normalize()}}return{x:s,y:l}}},{key:"anchor",value:function(){var e=this,t=this.getSelectionCoords(),n=void 0,r=void 0;this.element.style.display="block",this.element.style.visibility="visible",setTimeout(function(){n=e.element.getBoundingClientRect(),r=e.arrow.getBoundingClientRect(),e.show(t.x,t.y-n.height-10)},1)}},{key:"show",value:function(e,t){this.element.style.top=t+"px",this.element.style.left=e+"px"}},{key:"hide",value:function(){this.element.style.display=null,this.element.style.visibility=null}}]),e}()},{}],31:[function(e,t,n){"use strict";function r(e){return[].slice.apply(e)}function i(e,t){var n={};return e.forEach(function(e){"object"===("undefined"==typeof e?"undefined":o(e))&&Object.keys(e).forEach(function(r){t&&-1!==t.indexOf(r)||(n[r]=JSON.parse(JSON.stringify(e[r])))})}),n}Object.defineProperty(n,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};n.arraize=r,n.clone=i},{}],32:[function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n.XHR=function(){function e(){r(this,e)}return i(e,null,[{key:"ajax",value:function(e,t,n,r){return new Promise(function(i,o){var a=new XMLHttpRequest,s=t.toLowerCase();a.open(s,e),"post"!==s&&"put"!==s||a.setRequestHeader("Content-type","application/json"),a.onreadystatechange=function(){var e=4,t=200;a.readyState===e&&(a.status===t?i(a.responseText):"204"===a.status?i(null):o(new Error("Error: "+a.status)))},a.send(n?r?n:JSON.stringify(n):null)})}},{key:"get",value:function(t,n){return e.ajax(t,"get",null,n)}},{key:"post",value:function(t,n,r){return e.ajax(t,"post",n,r)}},{key:"put",value:function(t,n,r){return e.ajax(t,"put",n,r)}},{key:"delete",value:function(t,n){return e.ajax(t,"delete",null,n)}}]),e}()},{}]},{},[17]);
//# sourceMappingURL=skaryna.min.js.map
