{"version":3,"sources":["node_modules/browser-pack/_prelude.js","node_modules/jsondiffpatch/src/contexts/context.js","skaryna.min.js","node_modules/jsondiffpatch/src/contexts/diff.js","node_modules/jsondiffpatch/src/contexts/patch.js","node_modules/jsondiffpatch/src/contexts/reverse.js","node_modules/jsondiffpatch/src/date-reviver.js","node_modules/jsondiffpatch/src/diffpatcher.js","node_modules/jsondiffpatch/src/environment.js","node_modules/jsondiffpatch/src/filters/arrays.js","node_modules/jsondiffpatch/src/filters/dates.js","node_modules/jsondiffpatch/src/filters/lcs.js","node_modules/jsondiffpatch/src/filters/nested.js","node_modules/jsondiffpatch/src/filters/texts.js","node_modules/jsondiffpatch/src/filters/trivial.js","node_modules/jsondiffpatch/src/main.js","node_modules/jsondiffpatch/src/pipe.js","node_modules/jsondiffpatch/src/processor.js","src/browser.js","src/document.js","src/editor.js","src/emitter.js","src/index.js","src/injector.js","src/parser.js","src/parser/fromHTML.js","src/parser/fromPOM.js","src/repository.js","src/serializer.js","src/serializer/toHTML.js","src/serializer/toPOM.js","src/toolbar.js","src/util.js","src/xhr.js"],"names":["e","t","n","r","s","o","u","a","require","i","f","Error","code","l","exports","call","length","1","module","Pipe","Context","prototype","setResult","result","this","hasResult","exit","exiting","switchTo","next","pipe","nextPipe","push","child","name","parent","childName","root","options","children","nextAfterChildren","../pipe","2","dateReviver","DiffContext","left","right","cloneDiffValues","clone","value","JSON","parse","stringify","apply","arguments","../date-reviver","./context","3","PatchContext","delta","4","ReverseContext","5","key","parts","exec","Date","UTC","6","Processor","trivial","nested","arrays","dates","texts","DiffPatcher","processor","append","collectChildrenDiffFilter","diffFilter","objectsDiffFilter","shouldHaveResult","collectChildrenPatchFilter","patchFilter","collectChildrenReverseFilter","reverseFilter","diff","process","patch","reverse","unpatch","./contexts/diff","./contexts/patch","./contexts/reverse","./filters/arrays","./filters/dates","./filters/nested","./filters/texts","./filters/trivial","./pipe","./processor","7","isBrowser","window","8","arraysHaveMatchByRef","array1","array2","len1","len2","index1","val1","index2","val2","matchItems","context","value1","value2","objectHash","matchByPosition","hash1","hash2","hashCache1","hashCache2","lcs","ARRAY_MOVE","isArray","Array","arrayIndexOf","indexOf","array","item","leftIsArray","index","matchContext","commonHead","commonTail","undefined","_t","trimmed1","slice","trimmed2","seq","get","removedItems","indices1","detectMove","includeValueOnMove","removedItemsLength","indexOnArray2","indices2","isMove","removeItemIndex1","splice","filterName","compare","numerically","b","numericallyBy","toRemove","toInsert","toModify","parseInt","sort","indexDiff","removedValue","toInsertLength","insertion","toModifyLength","modification","newName","substr","reverseArrayDeltaIndex","itemDelta","reverseIndex","deltaIndex","deltaItem","moveFromIndex","moveToIndex","deleteIndex","../contexts/diff","../contexts/patch","../contexts/reverse","./lcs","9","getTime","10","defaultMatch","lengthMatrix","match","x","y","matrix","Math","max","backtrack","sequence","subsequence","join","11","leftType","propertyFilter","Object","hasOwnProperty","12","TEXT_DIFF","DEFAULT_MIN_LENGTH","cachedDiffPatch","getDiffMatchPatch","required","instance","diff_match_patch","dmpModuleName","dmp","err","error","diff_match_patch_not_found","txt1","txt2","patch_toText","patch_make","results","patch_apply","patch_fromText","textPatchFailed","minLength","textDiff","diffMatchPatch","textDeltaReverse","lines","line","lineTmp","lineHeader","lineAdd","lineRemove","header","headerRegex","split","lineStart","13","rightType","rightIsArray","14","environment","create","defaultInstance","homepage","version","packageInfoModuleName","packageInfo","formatterModuleName","formatters","console","./date-reviver","./diffpatcher","./environment","15","filters","input","debug","filter","log","resultCheck","msg","prepend","unshift","list","names","after","params","before","clear","should","noResult","16","selfOptions","pipes","lastPipe","lastContext","17","_index","_editor","_repository","_xhr","Skaryna","Editor","repository","XHR","___Skaryna","forEach","callback","./editor","./index","./repository","./xhr","18","_classCallCheck","Constructor","TypeError","_possibleConstructorReturn","self","ReferenceError","_inherits","subClass","superClass","constructor","enumerable","writable","configurable","setPrototypeOf","__proto__","escapeRegexp","str","String","replace","bestMatch","best","lowest","rule","regexp","RegExp","weight","part","getById","id","elementMap","getByNode","element","getAttribute","randomID","setValue","possible","text","charAt","floor","random","keys","defineProperty","Variants","Fields","StaticBlockNode","Heading","Image","Paragraph","TextNode","Quote","Document","BlockNode","Node","_get","object","property","receiver","Function","desc","getOwnPropertyDescriptor","getPrototypeOf","getter","_createClass","defineProperties","target","props","descriptor","protoProps","staticProps","_emitter","_util","_toHTML","_Emitter","_this","__locked","attrs","Emitter","_Node","type","items","_this2","_type","path","elements","shift","rest","isNaN","set","output","map","toJSON","toHTML","edit","then","html","innerHTML","arraize","appendChild","_BlockNode","_BlockNode2","_Node2","formats","_this5","toString","node","_this6","format","textContent","_TextNode","_Node3","source","title","alt","_this8","src","attributes","_TextNode2","level","_this9","min","json","_BlockNode3","_Node4","data","_this11","_map","_Node5","_this12","_variants","variant","./emitter","./serializer/toHTML","./util","19","_fromHTML","_fromPOM","_document","_toolbar","_injector","ENTER","PREVENT","toolbar","Toolbar","injector","styles","documentPath","document","DEFAULT_DOCUMENT","_pendingState","_rendering","init","editor","inited","Promise","all","querySelectorAll","factory","editors","documentBody","documentId","content","fromPOM","fromHTML","lock","has","doc","empty","render","stack","caretOffset","ownerDocument","win","defaultView","parentWindow","sel","getSelection","rangeCount","range","getRangeAt","preCaretRange","cloneRange","selectNodeContents","setEnd","endContainer","endOffset","selection","textRange","createRange","preCaretTextRange","body","createTextRange","moveToElementText","setEndPoint","focusNode","getEditableNode","hasAttribute","parentNode","selectorORElement","eventName","myMethod","HTMLElement","addEventListener","event","promise","decorate","resolve","setAttribute","onKeyUp","onDOM","focus","onSelect","showToolbar","strong","anchor","_this3","focusedNode","newItems","injectorObject","allowedNewItems","hideInjector","showInjector","lastChild","on","afterNode","possibleItems","Injector","box","getBoundingClientRect","goTo","top","removeChild","textNode","getCurrentElement","to","from","getCaretCharacterOffsetWithin","POM","HTML","currentTarget","asEditor","reduce","previous","current","editNode","defaultNewItem","newElement","htmlElement","setStart","collapse","removeAllRanges","addRange","newItem","_this4","keyCode","stopPropagation","preventDefault","ownAction","setTimeout","update","emit","CHANGE","createElement","innerText","./document","./injector","./parser/fromHTML","./parser/fromPOM","./serializer/toPOM","./toolbar","20","execute","config","fn","args","concat","_on","handler","once","__listeners","_once","_off","getListeners","_emit","Event","off","_bubbleEvent","toEmitter","_getListeners","21","22","SVGS","paragraph","image","dimensions","allowedNodes","div","firstChild","action","svg","createElementNS","injectorBox","style","width","23","Parser","token","handle","reject","_handlers","parser","24","whatWrapper","rootNode","processChildren","childNodes","nodeType","absoluteEmpty","wrapper","toLowerCase","InlineNode","_stringify","_stringify2","_slicedToArray","first","_parser","nodeName","formatType","href","_stringify3","_stringify4","innerFormats","otherFormat","idx","heading","_stringify5","_stringify6","_stringify7","_stringify8","attribute","ifAttr","quote","paragraphs","lastParagraph","_stringify9","_stringify10","_stringify11","_stringify12","sliceIterator","arr","_arr","_n","_d","_e","_s","_i","Symbol","iterator","done","./../document","./../parser","./../util","25","model","processChildNodes","fields","variants","26","_typeof","obj","_jsondiffpatch","_toPOM","Repository","_documents","initial","toPOM","_ret","v","jsondiffpatch","27","Serializer","serialize","serializer","28","_serializer","string","slices","char","tag","handleContents","nodeValue","elem","attributeName","FakeDoc","outerHTML","contents","attr","createTextNode","./../serializer","29","30","arrow","querySelector","theWindow","rects","rect","boundingLeft","boundingTop","getClientRects","span","insertNode","spanParent","normalize","coords","getSelectionCoords","display","visibility","show","height","31","iterable","inputs","except","32","method","raw","xhr","XMLHttpRequest","httpMethod","open","setRequestHeader","onreadystatechange","DONE","OK","readyState","status","responseText","send","ajax"],"mappings":"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","file":"skaryna.min.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","\nvar Pipe = require('../pipe').Pipe;\n\nvar Context = function Context(){\n};\n\nContext.prototype.setResult = function(result) {\n\tthis.result = result;\n\tthis.hasResult = true;\n\treturn this;\n};\n\nContext.prototype.exit = function() {\n\tthis.exiting = true;\n\treturn this;\n};\n\nContext.prototype.switchTo = function(next, pipe) {\n\tif (typeof next === 'string' || next instanceof Pipe) {\n\t\tthis.nextPipe = next;\n\t} else {\n\t\tthis.next = next;\n\t\tif (pipe) {\n\t\t\tthis.nextPipe = pipe;\n\t\t}\n\t}\n\treturn this;\n};\n\nContext.prototype.push = function(child, name) {\n\tchild.parent = this;\n\tif (typeof name !== 'undefined') {\n\t\tchild.childName = name;\n\t}\n\tchild.root = this.root || this;\n\tchild.options = child.options || this.options;\n\tif (!this.children) {\n\t\tthis.children = [child];\n\t\tthis.nextAfterChildren = this.next || null;\n\t\tthis.next = child;\n\t} else {\n\t\tthis.children[this.children.length - 1].next = child;\n\t\tthis.children.push(child);\n\t}\n\tchild.next = this;\n\treturn this;\n};\n\nexports.Context = Context;\n","(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){\n\nvar Pipe = require('../pipe').Pipe;\n\nvar Context = function Context(){\n};\n\nContext.prototype.setResult = function(result) {\n\tthis.result = result;\n\tthis.hasResult = true;\n\treturn this;\n};\n\nContext.prototype.exit = function() {\n\tthis.exiting = true;\n\treturn this;\n};\n\nContext.prototype.switchTo = function(next, pipe) {\n\tif (typeof next === 'string' || next instanceof Pipe) {\n\t\tthis.nextPipe = next;\n\t} else {\n\t\tthis.next = next;\n\t\tif (pipe) {\n\t\t\tthis.nextPipe = pipe;\n\t\t}\n\t}\n\treturn this;\n};\n\nContext.prototype.push = function(child, name) {\n\tchild.parent = this;\n\tif (typeof name !== 'undefined') {\n\t\tchild.childName = name;\n\t}\n\tchild.root = this.root || this;\n\tchild.options = child.options || this.options;\n\tif (!this.children) {\n\t\tthis.children = [child];\n\t\tthis.nextAfterChildren = this.next || null;\n\t\tthis.next = child;\n\t} else {\n\t\tthis.children[this.children.length - 1].next = child;\n\t\tthis.children.push(child);\n\t}\n\tchild.next = this;\n\treturn this;\n};\n\nexports.Context = Context;\n\n},{\"../pipe\":15}],2:[function(require,module,exports){\nvar Context = require('./context').Context;\nvar dateReviver = require('../date-reviver');\n\nvar DiffContext = function DiffContext(left, right) {\n  this.left = left;\n  this.right = right;\n  this.pipe = 'diff';\n};\n\nDiffContext.prototype = new Context();\n\nDiffContext.prototype.setResult = function(result) {\n  if (this.options.cloneDiffValues) {\n    var clone = typeof this.options.cloneDiffValues === 'function' ?\n      this.options.cloneDiffValues : function(value) {\n        return JSON.parse(JSON.stringify(value), dateReviver);\n      };\n    if (typeof result[0] === 'object') {\n      result[0] = clone(result[0]);\n    }\n    if (typeof result[1] === 'object') {\n      result[1] = clone(result[1]);\n    }\n  }\n  return Context.prototype.setResult.apply(this, arguments);\n};\n\nexports.DiffContext = DiffContext;\n\n},{\"../date-reviver\":5,\"./context\":1}],3:[function(require,module,exports){\nvar Context = require('./context').Context;\n\nvar PatchContext = function PatchContext(left, delta) {\n  this.left = left;\n  this.delta = delta;\n  this.pipe = 'patch';\n};\n\nPatchContext.prototype = new Context();\n\nexports.PatchContext = PatchContext;\n\n},{\"./context\":1}],4:[function(require,module,exports){\nvar Context = require('./context').Context;\n\nvar ReverseContext = function ReverseContext(delta) {\n  this.delta = delta;\n  this.pipe = 'reverse';\n};\n\nReverseContext.prototype = new Context();\n\nexports.ReverseContext = ReverseContext;\n\n},{\"./context\":1}],5:[function(require,module,exports){\n// use as 2nd parameter for JSON.parse to revive Date instances\nmodule.exports = function dateReviver(key, value) {\n  var parts;\n  if (typeof value === 'string') {\n    parts = /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})(?:\\.(\\d*))?(Z|([+\\-])(\\d{2}):(\\d{2}))$/.exec(value);\n    if (parts) {\n      return new Date(Date.UTC(+parts[1], +parts[2] - 1, +parts[3], +parts[4], +parts[5], +parts[6], +(parts[7] || 0)));\n    }\n  }\n  return value;\n};\n\n},{}],6:[function(require,module,exports){\nvar Processor = require('./processor').Processor;\nvar Pipe = require('./pipe').Pipe;\nvar DiffContext = require('./contexts/diff').DiffContext;\nvar PatchContext = require('./contexts/patch').PatchContext;\nvar ReverseContext = require('./contexts/reverse').ReverseContext;\n\nvar trivial = require('./filters/trivial');\nvar nested = require('./filters/nested');\nvar arrays = require('./filters/arrays');\nvar dates = require('./filters/dates');\nvar texts = require('./filters/texts');\n\nvar DiffPatcher = function DiffPatcher(options) {\n  this.processor = new Processor(options);\n  this.processor.pipe(new Pipe('diff').append(\n    nested.collectChildrenDiffFilter,\n    trivial.diffFilter,\n    dates.diffFilter,\n    texts.diffFilter,\n    nested.objectsDiffFilter,\n    arrays.diffFilter\n  ).shouldHaveResult());\n  this.processor.pipe(new Pipe('patch').append(\n    nested.collectChildrenPatchFilter,\n    arrays.collectChildrenPatchFilter,\n    trivial.patchFilter,\n    texts.patchFilter,\n    nested.patchFilter,\n    arrays.patchFilter\n  ).shouldHaveResult());\n  this.processor.pipe(new Pipe('reverse').append(\n    nested.collectChildrenReverseFilter,\n    arrays.collectChildrenReverseFilter,\n    trivial.reverseFilter,\n    texts.reverseFilter,\n    nested.reverseFilter,\n    arrays.reverseFilter\n  ).shouldHaveResult());\n};\n\nDiffPatcher.prototype.options = function() {\n  return this.processor.options.apply(this.processor, arguments);\n};\n\nDiffPatcher.prototype.diff = function(left, right) {\n  return this.processor.process(new DiffContext(left, right));\n};\n\nDiffPatcher.prototype.patch = function(left, delta) {\n  return this.processor.process(new PatchContext(left, delta));\n};\n\nDiffPatcher.prototype.reverse = function(delta) {\n  return this.processor.process(new ReverseContext(delta));\n};\n\nDiffPatcher.prototype.unpatch = function(right, delta) {\n  return this.patch(right, this.reverse(delta));\n};\n\nexports.DiffPatcher = DiffPatcher;\n\n},{\"./contexts/diff\":2,\"./contexts/patch\":3,\"./contexts/reverse\":4,\"./filters/arrays\":8,\"./filters/dates\":9,\"./filters/nested\":11,\"./filters/texts\":12,\"./filters/trivial\":13,\"./pipe\":15,\"./processor\":16}],7:[function(require,module,exports){\n\nexports.isBrowser = typeof window !== 'undefined';\n\n},{}],8:[function(require,module,exports){\nvar DiffContext = require('../contexts/diff').DiffContext;\nvar PatchContext = require('../contexts/patch').PatchContext;\nvar ReverseContext = require('../contexts/reverse').ReverseContext;\n\nvar lcs = require('./lcs');\n\nvar ARRAY_MOVE = 3;\n\nvar isArray = (typeof Array.isArray === 'function') ?\n  // use native function\n  Array.isArray :\n  // use instanceof operator\n  function(a) {\n    return a instanceof Array;\n  };\n\nvar arrayIndexOf = typeof Array.prototype.indexOf === 'function' ?\n  function(array, item) {\n    return array.indexOf(item);\n  } : function(array, item) {\n    var length = array.length;\n    for (var i = 0; i < length; i++) {\n      if (array[i] === item) {\n        return i;\n      }\n    }\n    return -1;\n  };\n\nfunction arraysHaveMatchByRef(array1, array2, len1, len2) {\n  for (var index1 = 0; index1 < len1; index1++) {\n    var val1 = array1[index1];\n    for (var index2 = 0; index2 < len2; index2++) {\n      var val2 = array2[index2];\n      if (val1 === val2) {\n        return true;\n      }\n    }\n  }\n}\n\nfunction matchItems(array1, array2, index1, index2, context) {\n  var value1 = array1[index1];\n  var value2 = array2[index2];\n  if (value1 === value2) {\n    return true;\n  }\n  if (typeof value1 !== 'object' || typeof value2 !== 'object') {\n    return false;\n  }\n  var objectHash = context.objectHash;\n  if (!objectHash) {\n    // no way to match objects was provided, try match by position\n    return context.matchByPosition && index1 === index2;\n  }\n  var hash1;\n  var hash2;\n  if (typeof index1 === 'number') {\n    context.hashCache1 = context.hashCache1 || [];\n    hash1 = context.hashCache1[index1];\n    if (typeof hash1 === 'undefined') {\n      context.hashCache1[index1] = hash1 = objectHash(value1, index1);\n    }\n  } else {\n    hash1 = objectHash(value1);\n  }\n  if (typeof hash1 === 'undefined') {\n    return false;\n  }\n  if (typeof index2 === 'number') {\n    context.hashCache2 = context.hashCache2 || [];\n    hash2 = context.hashCache2[index2];\n    if (typeof hash2 === 'undefined') {\n      context.hashCache2[index2] = hash2 = objectHash(value2, index2);\n    }\n  } else {\n    hash2 = objectHash(value2);\n  }\n  if (typeof hash2 === 'undefined') {\n    return false;\n  }\n  return hash1 === hash2;\n}\n\nvar diffFilter = function arraysDiffFilter(context) {\n  if (!context.leftIsArray) {\n    return;\n  }\n\n  var matchContext = {\n    objectHash: context.options && context.options.objectHash,\n    matchByPosition: context.options && context.options.matchByPosition\n  };\n  var commonHead = 0;\n  var commonTail = 0;\n  var index;\n  var index1;\n  var index2;\n  var array1 = context.left;\n  var array2 = context.right;\n  var len1 = array1.length;\n  var len2 = array2.length;\n\n  var child;\n\n  if (len1 > 0 && len2 > 0 && !matchContext.objectHash &&\n    typeof matchContext.matchByPosition !== 'boolean') {\n    matchContext.matchByPosition = !arraysHaveMatchByRef(array1, array2, len1, len2);\n  }\n\n  // separate common head\n  while (commonHead < len1 && commonHead < len2 &&\n    matchItems(array1, array2, commonHead, commonHead, matchContext)) {\n    index = commonHead;\n    child = new DiffContext(context.left[index], context.right[index]);\n    context.push(child, index);\n    commonHead++;\n  }\n  // separate common tail\n  while (commonTail + commonHead < len1 && commonTail + commonHead < len2 &&\n    matchItems(array1, array2, len1 - 1 - commonTail, len2 - 1 - commonTail, matchContext)) {\n    index1 = len1 - 1 - commonTail;\n    index2 = len2 - 1 - commonTail;\n    child = new DiffContext(context.left[index1], context.right[index2]);\n    context.push(child, index2);\n    commonTail++;\n  }\n  var result;\n  if (commonHead + commonTail === len1) {\n    if (len1 === len2) {\n      // arrays are identical\n      context.setResult(undefined).exit();\n      return;\n    }\n    // trivial case, a block (1 or more consecutive items) was added\n    result = result || {\n      _t: 'a'\n    };\n    for (index = commonHead; index < len2 - commonTail; index++) {\n      result[index] = [array2[index]];\n    }\n    context.setResult(result).exit();\n    return;\n  }\n  if (commonHead + commonTail === len2) {\n    // trivial case, a block (1 or more consecutive items) was removed\n    result = result || {\n      _t: 'a'\n    };\n    for (index = commonHead; index < len1 - commonTail; index++) {\n      result['_' + index] = [array1[index], 0, 0];\n    }\n    context.setResult(result).exit();\n    return;\n  }\n  // reset hash cache\n  delete matchContext.hashCache1;\n  delete matchContext.hashCache2;\n\n  // diff is not trivial, find the LCS (Longest Common Subsequence)\n  var trimmed1 = array1.slice(commonHead, len1 - commonTail);\n  var trimmed2 = array2.slice(commonHead, len2 - commonTail);\n  var seq = lcs.get(\n    trimmed1, trimmed2,\n    matchItems,\n    matchContext\n  );\n  var removedItems = [];\n  result = result || {\n    _t: 'a'\n  };\n  for (index = commonHead; index < len1 - commonTail; index++) {\n    if (arrayIndexOf(seq.indices1, index - commonHead) < 0) {\n      // removed\n      result['_' + index] = [array1[index], 0, 0];\n      removedItems.push(index);\n    }\n  }\n\n  var detectMove = true;\n  if (context.options && context.options.arrays && context.options.arrays.detectMove === false) {\n    detectMove = false;\n  }\n  var includeValueOnMove = false;\n  if (context.options && context.options.arrays && context.options.arrays.includeValueOnMove) {\n    includeValueOnMove = true;\n  }\n\n  var removedItemsLength = removedItems.length;\n  for (index = commonHead; index < len2 - commonTail; index++) {\n    var indexOnArray2 = arrayIndexOf(seq.indices2, index - commonHead);\n    if (indexOnArray2 < 0) {\n      // added, try to match with a removed item and register as position move\n      var isMove = false;\n      if (detectMove && removedItemsLength > 0) {\n        for (var removeItemIndex1 = 0; removeItemIndex1 < removedItemsLength; removeItemIndex1++) {\n          index1 = removedItems[removeItemIndex1];\n          if (matchItems(trimmed1, trimmed2, index1 - commonHead,\n            index - commonHead, matchContext)) {\n            // store position move as: [originalValue, newPosition, ARRAY_MOVE]\n            result['_' + index1].splice(1, 2, index, ARRAY_MOVE);\n            if (!includeValueOnMove) {\n              // don't include moved value on diff, to save bytes\n              result['_' + index1][0] = '';\n            }\n\n            index2 = index;\n            child = new DiffContext(context.left[index1], context.right[index2]);\n            context.push(child, index2);\n            removedItems.splice(removeItemIndex1, 1);\n            isMove = true;\n            break;\n          }\n        }\n      }\n      if (!isMove) {\n        // added\n        result[index] = [array2[index]];\n      }\n    } else {\n      // match, do inner diff\n      index1 = seq.indices1[indexOnArray2] + commonHead;\n      index2 = seq.indices2[indexOnArray2] + commonHead;\n      child = new DiffContext(context.left[index1], context.right[index2]);\n      context.push(child, index2);\n    }\n  }\n\n  context.setResult(result).exit();\n\n};\ndiffFilter.filterName = 'arrays';\n\nvar compare = {\n  numerically: function(a, b) {\n    return a - b;\n  },\n  numericallyBy: function(name) {\n    return function(a, b) {\n      return a[name] - b[name];\n    };\n  }\n};\n\nvar patchFilter = function nestedPatchFilter(context) {\n  if (!context.nested) {\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var index, index1;\n\n  var delta = context.delta;\n  var array = context.left;\n\n  // first, separate removals, insertions and modifications\n  var toRemove = [];\n  var toInsert = [];\n  var toModify = [];\n  for (index in delta) {\n    if (index !== '_t') {\n      if (index[0] === '_') {\n        // removed item from original array\n        if (delta[index][2] === 0 || delta[index][2] === ARRAY_MOVE) {\n          toRemove.push(parseInt(index.slice(1), 10));\n        } else {\n          throw new Error('only removal or move can be applied at original array indices' +\n            ', invalid diff type: ' + delta[index][2]);\n        }\n      } else {\n        if (delta[index].length === 1) {\n          // added item at new array\n          toInsert.push({\n            index: parseInt(index, 10),\n            value: delta[index][0]\n          });\n        } else {\n          // modified item at new array\n          toModify.push({\n            index: parseInt(index, 10),\n            delta: delta[index]\n          });\n        }\n      }\n    }\n  }\n\n  // remove items, in reverse order to avoid sawing our own floor\n  toRemove = toRemove.sort(compare.numerically);\n  for (index = toRemove.length - 1; index >= 0; index--) {\n    index1 = toRemove[index];\n    var indexDiff = delta['_' + index1];\n    var removedValue = array.splice(index1, 1)[0];\n    if (indexDiff[2] === ARRAY_MOVE) {\n      // reinsert later\n      toInsert.push({\n        index: indexDiff[1],\n        value: removedValue\n      });\n    }\n  }\n\n  // insert items, in reverse order to avoid moving our own floor\n  toInsert = toInsert.sort(compare.numericallyBy('index'));\n  var toInsertLength = toInsert.length;\n  for (index = 0; index < toInsertLength; index++) {\n    var insertion = toInsert[index];\n    array.splice(insertion.index, 0, insertion.value);\n  }\n\n  // apply modifications\n  var toModifyLength = toModify.length;\n  var child;\n  if (toModifyLength > 0) {\n    for (index = 0; index < toModifyLength; index++) {\n      var modification = toModify[index];\n      child = new PatchContext(context.left[modification.index], modification.delta);\n      context.push(child, modification.index);\n    }\n  }\n\n  if (!context.children) {\n    context.setResult(context.left).exit();\n    return;\n  }\n  context.exit();\n};\npatchFilter.filterName = 'arrays';\n\nvar collectChildrenPatchFilter = function collectChildrenPatchFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    context.left[child.childName] = child.result;\n  }\n  context.setResult(context.left).exit();\n};\ncollectChildrenPatchFilter.filterName = 'arraysCollectChildren';\n\nvar reverseFilter = function arraysReverseFilter(context) {\n  if (!context.nested) {\n    if (context.delta[2] === ARRAY_MOVE) {\n      context.newName = '_' + context.delta[1];\n      context.setResult([context.delta[0], parseInt(context.childName.substr(1), 10), ARRAY_MOVE]).exit();\n    }\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var name, child;\n  for (name in context.delta) {\n    if (name === '_t') {\n      continue;\n    }\n    child = new ReverseContext(context.delta[name]);\n    context.push(child, name);\n  }\n  context.exit();\n};\nreverseFilter.filterName = 'arrays';\n\nvar reverseArrayDeltaIndex = function(delta, index, itemDelta) {\n  if (typeof index === 'string' && index[0] === '_') {\n    return parseInt(index.substr(1), 10);\n  } else if (isArray(itemDelta) && itemDelta[2] === 0) {\n    return '_' + index;\n  }\n\n  var reverseIndex = +index;\n  for (var deltaIndex in delta) {\n    var deltaItem = delta[deltaIndex];\n    if (isArray(deltaItem)) {\n      if (deltaItem[2] === ARRAY_MOVE) {\n        var moveFromIndex = parseInt(deltaIndex.substr(1), 10);\n        var moveToIndex = deltaItem[1];\n        if (moveToIndex === +index) {\n          return moveFromIndex;\n        }\n        if (moveFromIndex <= reverseIndex && moveToIndex > reverseIndex) {\n          reverseIndex++;\n        } else if (moveFromIndex >= reverseIndex && moveToIndex < reverseIndex) {\n          reverseIndex--;\n        }\n      } else if (deltaItem[2] === 0) {\n        var deleteIndex = parseInt(deltaIndex.substr(1), 10);\n        if (deleteIndex <= reverseIndex) {\n          reverseIndex++;\n        }\n      } else if (deltaItem.length === 1 && deltaIndex <= reverseIndex) {\n        reverseIndex--;\n      }\n    }\n  }\n\n  return reverseIndex;\n};\n\nvar collectChildrenReverseFilter = function collectChildrenReverseFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  var delta = {\n    _t: 'a'\n  };\n\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    var name = child.newName;\n    if (typeof name === 'undefined') {\n      name = reverseArrayDeltaIndex(context.delta, child.childName, child.result);\n    }\n    if (delta[name] !== child.result) {\n      delta[name] = child.result;\n    }\n  }\n  context.setResult(delta).exit();\n};\ncollectChildrenReverseFilter.filterName = 'arraysCollectChildren';\n\nexports.diffFilter = diffFilter;\nexports.patchFilter = patchFilter;\nexports.collectChildrenPatchFilter = collectChildrenPatchFilter;\nexports.reverseFilter = reverseFilter;\nexports.collectChildrenReverseFilter = collectChildrenReverseFilter;\n\n},{\"../contexts/diff\":2,\"../contexts/patch\":3,\"../contexts/reverse\":4,\"./lcs\":10}],9:[function(require,module,exports){\nvar diffFilter = function datesDiffFilter(context) {\n  if (context.left instanceof Date) {\n    if (context.right instanceof Date) {\n      if (context.left.getTime() !== context.right.getTime()) {\n        context.setResult([context.left, context.right]);\n      } else {\n        context.setResult(undefined);\n      }\n    } else {\n      context.setResult([context.left, context.right]);\n    }\n    context.exit();\n  } else if (context.right instanceof Date) {\n    context.setResult([context.left, context.right]).exit();\n  }\n};\ndiffFilter.filterName = 'dates';\n\nexports.diffFilter = diffFilter;\n\n},{}],10:[function(require,module,exports){\n/*\n\nLCS implementation that supports arrays or strings\n\nreference: http://en.wikipedia.org/wiki/Longest_common_subsequence_problem\n\n*/\n\nvar defaultMatch = function(array1, array2, index1, index2) {\n  return array1[index1] === array2[index2];\n};\n\nvar lengthMatrix = function(array1, array2, match, context) {\n  var len1 = array1.length;\n  var len2 = array2.length;\n  var x, y;\n\n  // initialize empty matrix of len1+1 x len2+1\n  var matrix = [len1 + 1];\n  for (x = 0; x < len1 + 1; x++) {\n    matrix[x] = [len2 + 1];\n    for (y = 0; y < len2 + 1; y++) {\n      matrix[x][y] = 0;\n    }\n  }\n  matrix.match = match;\n  // save sequence lengths for each coordinate\n  for (x = 1; x < len1 + 1; x++) {\n    for (y = 1; y < len2 + 1; y++) {\n      if (match(array1, array2, x - 1, y - 1, context)) {\n        matrix[x][y] = matrix[x - 1][y - 1] + 1;\n      } else {\n        matrix[x][y] = Math.max(matrix[x - 1][y], matrix[x][y - 1]);\n      }\n    }\n  }\n  return matrix;\n};\n\nvar backtrack = function(matrix, array1, array2, index1, index2, context) {\n  if (index1 === 0 || index2 === 0) {\n    return {\n      sequence: [],\n      indices1: [],\n      indices2: []\n    };\n  }\n\n  if (matrix.match(array1, array2, index1 - 1, index2 - 1, context)) {\n    var subsequence = backtrack(matrix, array1, array2, index1 - 1, index2 - 1, context);\n    subsequence.sequence.push(array1[index1 - 1]);\n    subsequence.indices1.push(index1 - 1);\n    subsequence.indices2.push(index2 - 1);\n    return subsequence;\n  }\n\n  if (matrix[index1][index2 - 1] > matrix[index1 - 1][index2]) {\n    return backtrack(matrix, array1, array2, index1, index2 - 1, context);\n  } else {\n    return backtrack(matrix, array1, array2, index1 - 1, index2, context);\n  }\n};\n\nvar get = function(array1, array2, match, context) {\n  context = context || {};\n  var matrix = lengthMatrix(array1, array2, match || defaultMatch, context);\n  var result = backtrack(matrix, array1, array2, array1.length, array2.length, context);\n  if (typeof array1 === 'string' && typeof array2 === 'string') {\n    result.sequence = result.sequence.join('');\n  }\n  return result;\n};\n\nexports.get = get;\n\n},{}],11:[function(require,module,exports){\nvar DiffContext = require('../contexts/diff').DiffContext;\nvar PatchContext = require('../contexts/patch').PatchContext;\nvar ReverseContext = require('../contexts/reverse').ReverseContext;\n\nvar collectChildrenDiffFilter = function collectChildrenDiffFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  var result = context.result;\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    if (typeof child.result === 'undefined') {\n      continue;\n    }\n    result = result || {};\n    result[child.childName] = child.result;\n  }\n  if (result && context.leftIsArray) {\n    result._t = 'a';\n  }\n  context.setResult(result).exit();\n};\ncollectChildrenDiffFilter.filterName = 'collectChildren';\n\nvar objectsDiffFilter = function objectsDiffFilter(context) {\n  if (context.leftIsArray || context.leftType !== 'object') {\n    return;\n  }\n\n  var name, child, propertyFilter = context.options.propertyFilter;\n  for (name in context.left) {\n    if (!Object.prototype.hasOwnProperty.call(context.left, name)) {\n      continue;\n    }\n    if (propertyFilter && !propertyFilter(name, context)) {\n      continue;\n    }\n    child = new DiffContext(context.left[name], context.right[name]);\n    context.push(child, name);\n  }\n  for (name in context.right) {\n    if (!Object.prototype.hasOwnProperty.call(context.right, name)) {\n      continue;\n    }\n    if (propertyFilter && !propertyFilter(name, context)) {\n      continue;\n    }\n    if (typeof context.left[name] === 'undefined') {\n      child = new DiffContext(undefined, context.right[name]);\n      context.push(child, name);\n    }\n  }\n\n  if (!context.children || context.children.length === 0) {\n    context.setResult(undefined).exit();\n    return;\n  }\n  context.exit();\n};\nobjectsDiffFilter.filterName = 'objects';\n\nvar patchFilter = function nestedPatchFilter(context) {\n  if (!context.nested) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var name, child;\n  for (name in context.delta) {\n    child = new PatchContext(context.left[name], context.delta[name]);\n    context.push(child, name);\n  }\n  context.exit();\n};\npatchFilter.filterName = 'objects';\n\nvar collectChildrenPatchFilter = function collectChildrenPatchFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    if (Object.prototype.hasOwnProperty.call(context.left, child.childName) && child.result === undefined) {\n      delete context.left[child.childName];\n    } else if (context.left[child.childName] !== child.result) {\n      context.left[child.childName] = child.result;\n    }\n  }\n  context.setResult(context.left).exit();\n};\ncollectChildrenPatchFilter.filterName = 'collectChildren';\n\nvar reverseFilter = function nestedReverseFilter(context) {\n  if (!context.nested) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var name, child;\n  for (name in context.delta) {\n    child = new ReverseContext(context.delta[name]);\n    context.push(child, name);\n  }\n  context.exit();\n};\nreverseFilter.filterName = 'objects';\n\nvar collectChildrenReverseFilter = function collectChildrenReverseFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  var delta = {};\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    if (delta[child.childName] !== child.result) {\n      delta[child.childName] = child.result;\n    }\n  }\n  context.setResult(delta).exit();\n};\ncollectChildrenReverseFilter.filterName = 'collectChildren';\n\nexports.collectChildrenDiffFilter = collectChildrenDiffFilter;\nexports.objectsDiffFilter = objectsDiffFilter;\nexports.patchFilter = patchFilter;\nexports.collectChildrenPatchFilter = collectChildrenPatchFilter;\nexports.reverseFilter = reverseFilter;\nexports.collectChildrenReverseFilter = collectChildrenReverseFilter;\n\n},{\"../contexts/diff\":2,\"../contexts/patch\":3,\"../contexts/reverse\":4}],12:[function(require,module,exports){\n/* global diff_match_patch */\nvar TEXT_DIFF = 2;\nvar DEFAULT_MIN_LENGTH = 60;\nvar cachedDiffPatch = null;\n\nvar getDiffMatchPatch = function(required) {\n  /*jshint camelcase: false */\n\n  if (!cachedDiffPatch) {\n    var instance;\n    if (typeof diff_match_patch !== 'undefined') {\n      // already loaded, probably a browser\n      instance = typeof diff_match_patch === 'function' ?\n        new diff_match_patch() : new diff_match_patch.diff_match_patch();\n    } else if (typeof require === 'function') {\n      try {\n        var dmpModuleName = 'diff_match_patch_uncompressed';\n        var dmp = require('../../public/external/' + dmpModuleName);\n        instance = new dmp.diff_match_patch();\n      } catch (err) {\n        instance = null;\n      }\n    }\n    if (!instance) {\n      if (!required) {\n        return null;\n      }\n      var error = new Error('text diff_match_patch library not found');\n      error.diff_match_patch_not_found = true;\n      throw error;\n    }\n    cachedDiffPatch = {\n      diff: function(txt1, txt2) {\n        return instance.patch_toText(instance.patch_make(txt1, txt2));\n      },\n      patch: function(txt1, patch) {\n        var results = instance.patch_apply(instance.patch_fromText(patch), txt1);\n        for (var i = 0; i < results[1].length; i++) {\n          if (!results[1][i]) {\n            var error = new Error('text patch failed');\n            error.textPatchFailed = true;\n          }\n        }\n        return results[0];\n      }\n    };\n  }\n  return cachedDiffPatch;\n};\n\nvar diffFilter = function textsDiffFilter(context) {\n  if (context.leftType !== 'string') {\n    return;\n  }\n  var minLength = (context.options && context.options.textDiff &&\n    context.options.textDiff.minLength) || DEFAULT_MIN_LENGTH;\n  if (context.left.length < minLength ||\n    context.right.length < minLength) {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n  // large text, try to use a text-diff algorithm\n  var diffMatchPatch = getDiffMatchPatch();\n  if (!diffMatchPatch) {\n    // diff-match-patch library not available, fallback to regular string replace\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n  var diff = diffMatchPatch.diff;\n  context.setResult([diff(context.left, context.right), 0, TEXT_DIFF]).exit();\n};\ndiffFilter.filterName = 'texts';\n\nvar patchFilter = function textsPatchFilter(context) {\n  if (context.nested) {\n    return;\n  }\n  if (context.delta[2] !== TEXT_DIFF) {\n    return;\n  }\n\n  // text-diff, use a text-patch algorithm\n  var patch = getDiffMatchPatch(true).patch;\n  context.setResult(patch(context.left, context.delta[0])).exit();\n};\npatchFilter.filterName = 'texts';\n\nvar textDeltaReverse = function(delta) {\n  var i, l, lines, line, lineTmp, header = null,\n    headerRegex = /^@@ +\\-(\\d+),(\\d+) +\\+(\\d+),(\\d+) +@@$/,\n    lineHeader, lineAdd, lineRemove;\n  lines = delta.split('\\n');\n  for (i = 0, l = lines.length; i < l; i++) {\n    line = lines[i];\n    var lineStart = line.slice(0, 1);\n    if (lineStart === '@') {\n      header = headerRegex.exec(line);\n      lineHeader = i;\n      lineAdd = null;\n      lineRemove = null;\n\n      // fix header\n      lines[lineHeader] = '@@ -' + header[3] + ',' + header[4] + ' +' + header[1] + ',' + header[2] + ' @@';\n    } else if (lineStart === '+') {\n      lineAdd = i;\n      lines[i] = '-' + lines[i].slice(1);\n      if (lines[i - 1].slice(0, 1) === '+') {\n        // swap lines to keep default order (-+)\n        lineTmp = lines[i];\n        lines[i] = lines[i - 1];\n        lines[i - 1] = lineTmp;\n      }\n    } else if (lineStart === '-') {\n      lineRemove = i;\n      lines[i] = '+' + lines[i].slice(1);\n    }\n  }\n  return lines.join('\\n');\n};\n\nvar reverseFilter = function textsReverseFilter(context) {\n  if (context.nested) {\n    return;\n  }\n  if (context.delta[2] !== TEXT_DIFF) {\n    return;\n  }\n\n  // text-diff, use a text-diff algorithm\n  context.setResult([textDeltaReverse(context.delta[0]), 0, TEXT_DIFF]).exit();\n};\nreverseFilter.filterName = 'texts';\n\nexports.diffFilter = diffFilter;\nexports.patchFilter = patchFilter;\nexports.reverseFilter = reverseFilter;\n\n},{}],13:[function(require,module,exports){\nvar isArray = (typeof Array.isArray === 'function') ?\n  // use native function\n  Array.isArray :\n  // use instanceof operator\n  function(a) {\n    return a instanceof Array;\n  };\n\nvar diffFilter = function trivialMatchesDiffFilter(context) {\n  if (context.left === context.right) {\n    context.setResult(undefined).exit();\n    return;\n  }\n  if (typeof context.left === 'undefined') {\n    if (typeof context.right === 'function') {\n      throw new Error('functions are not supported');\n    }\n    context.setResult([context.right]).exit();\n    return;\n  }\n  if (typeof context.right === 'undefined') {\n    context.setResult([context.left, 0, 0]).exit();\n    return;\n  }\n  if (typeof context.left === 'function' || typeof context.right === 'function') {\n    throw new Error('functions are not supported');\n  }\n  context.leftType = context.left === null ? 'null' : typeof context.left;\n  context.rightType = context.right === null ? 'null' : typeof context.right;\n  if (context.leftType !== context.rightType) {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n  if (context.leftType === 'boolean' || context.leftType === 'number') {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n  if (context.leftType === 'object') {\n    context.leftIsArray = isArray(context.left);\n  }\n  if (context.rightType === 'object') {\n    context.rightIsArray = isArray(context.right);\n  }\n  if (context.leftIsArray !== context.rightIsArray) {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n};\ndiffFilter.filterName = 'trivial';\n\nvar patchFilter = function trivialMatchesPatchFilter(context) {\n  if (typeof context.delta === 'undefined') {\n    context.setResult(context.left).exit();\n    return;\n  }\n  context.nested = !isArray(context.delta);\n  if (context.nested) {\n    return;\n  }\n  if (context.delta.length === 1) {\n    context.setResult(context.delta[0]).exit();\n    return;\n  }\n  if (context.delta.length === 2) {\n    context.setResult(context.delta[1]).exit();\n    return;\n  }\n  if (context.delta.length === 3 && context.delta[2] === 0) {\n    context.setResult(undefined).exit();\n    return;\n  }\n};\npatchFilter.filterName = 'trivial';\n\nvar reverseFilter = function trivialReferseFilter(context) {\n  if (typeof context.delta === 'undefined') {\n    context.setResult(context.delta).exit();\n    return;\n  }\n  context.nested = !isArray(context.delta);\n  if (context.nested) {\n    return;\n  }\n  if (context.delta.length === 1) {\n    context.setResult([context.delta[0], 0, 0]).exit();\n    return;\n  }\n  if (context.delta.length === 2) {\n    context.setResult([context.delta[1], context.delta[0]]).exit();\n    return;\n  }\n  if (context.delta.length === 3 && context.delta[2] === 0) {\n    context.setResult([context.delta[0]]).exit();\n    return;\n  }\n};\nreverseFilter.filterName = 'trivial';\n\nexports.diffFilter = diffFilter;\nexports.patchFilter = patchFilter;\nexports.reverseFilter = reverseFilter;\n\n},{}],14:[function(require,module,exports){\n\nvar environment = require('./environment');\n\nvar DiffPatcher = require('./diffpatcher').DiffPatcher;\nexports.DiffPatcher = DiffPatcher;\n\nexports.create = function(options){\n  return new DiffPatcher(options);\n};\n\nexports.dateReviver = require('./date-reviver');\n\nvar defaultInstance;\n\nexports.diff = function() {\n  if (!defaultInstance) {\n    defaultInstance = new DiffPatcher();\n  }\n  return defaultInstance.diff.apply(defaultInstance, arguments);\n};\n\nexports.patch = function() {\n  if (!defaultInstance) {\n    defaultInstance = new DiffPatcher();\n  }\n  return defaultInstance.patch.apply(defaultInstance, arguments);\n};\n\nexports.unpatch = function() {\n  if (!defaultInstance) {\n    defaultInstance = new DiffPatcher();\n  }\n  return defaultInstance.unpatch.apply(defaultInstance, arguments);\n};\n\nexports.reverse = function() {\n  if (!defaultInstance) {\n    defaultInstance = new DiffPatcher();\n  }\n  return defaultInstance.reverse.apply(defaultInstance, arguments);\n};\n\nif (environment.isBrowser) {\n  exports.homepage = '{{package-homepage}}';\n  exports.version = '{{package-version}}';\n} else {\n  var packageInfoModuleName = '../package.json';\n  var packageInfo = require(packageInfoModuleName);\n  exports.homepage = packageInfo.homepage;\n  exports.version = packageInfo.version;\n\n  var formatterModuleName = './formatters';\n  var formatters = require(formatterModuleName);\n  exports.formatters = formatters;\n  // shortcut for console\n  exports.console = formatters.console;\n}\n\n},{\"./date-reviver\":5,\"./diffpatcher\":6,\"./environment\":7}],15:[function(require,module,exports){\nvar Pipe = function Pipe(name) {\n  this.name = name;\n  this.filters = [];\n};\n\nPipe.prototype.process = function(input) {\n  if (!this.processor) {\n    throw new Error('add this pipe to a processor before using it');\n  }\n  var debug = this.debug;\n  var length = this.filters.length;\n  var context = input;\n  for (var index = 0; index < length; index++) {\n    var filter = this.filters[index];\n    if (debug) {\n      this.log('filter: ' + filter.filterName);\n    }\n    filter(context);\n    if (typeof context === 'object' && context.exiting) {\n      context.exiting = false;\n      break;\n    }\n  }\n  if (!context.next && this.resultCheck) {\n    this.resultCheck(context);\n  }\n};\n\nPipe.prototype.log = function(msg) {\n  console.log('[jsondiffpatch] ' + this.name + ' pipe, ' + msg);\n};\n\nPipe.prototype.append = function() {\n  this.filters.push.apply(this.filters, arguments);\n  return this;\n};\n\nPipe.prototype.prepend = function() {\n  this.filters.unshift.apply(this.filters, arguments);\n  return this;\n};\n\nPipe.prototype.indexOf = function(filterName) {\n  if (!filterName) {\n    throw new Error('a filter name is required');\n  }\n  for (var index = 0; index < this.filters.length; index++) {\n    var filter = this.filters[index];\n    if (filter.filterName === filterName) {\n      return index;\n    }\n  }\n  throw new Error('filter not found: ' + filterName);\n};\n\nPipe.prototype.list = function() {\n  var names = [];\n  for (var index = 0; index < this.filters.length; index++) {\n    var filter = this.filters[index];\n    names.push(filter.filterName);\n  }\n  return names;\n};\n\nPipe.prototype.after = function(filterName) {\n  var index = this.indexOf(filterName);\n  var params = Array.prototype.slice.call(arguments, 1);\n  if (!params.length) {\n    throw new Error('a filter is required');\n  }\n  params.unshift(index + 1, 0);\n  Array.prototype.splice.apply(this.filters, params);\n  return this;\n};\n\nPipe.prototype.before = function(filterName) {\n  var index = this.indexOf(filterName);\n  var params = Array.prototype.slice.call(arguments, 1);\n  if (!params.length) {\n    throw new Error('a filter is required');\n  }\n  params.unshift(index, 0);\n  Array.prototype.splice.apply(this.filters, params);\n  return this;\n};\n\nPipe.prototype.clear = function() {\n  this.filters.length = 0;\n  return this;\n};\n\nPipe.prototype.shouldHaveResult = function(should) {\n  if (should === false) {\n    this.resultCheck = null;\n    return;\n  }\n  if (this.resultCheck) {\n    return;\n  }\n  var pipe = this;\n  this.resultCheck = function(context) {\n    if (!context.hasResult) {\n      console.log(context);\n      var error = new Error(pipe.name + ' failed');\n      error.noResult = true;\n      throw error;\n    }\n  };\n  return this;\n};\n\nexports.Pipe = Pipe;\n\n},{}],16:[function(require,module,exports){\n\nvar Processor = function Processor(options){\n  this.selfOptions = options || {};\n  this.pipes = {};\n};\n\nProcessor.prototype.options = function(options) {\n  if (options) {\n    this.selfOptions = options;\n  }\n  return this.selfOptions;\n};\n\nProcessor.prototype.pipe = function(name, pipe) {\n  if (typeof name === 'string') {\n    if (typeof pipe === 'undefined') {\n      return this.pipes[name];\n    } else {\n      this.pipes[name] = pipe;\n    }\n  }\n  if (name && name.name) {\n    pipe = name;\n    if (pipe.processor === this) { return pipe; }\n    this.pipes[pipe.name] = pipe;\n  }\n  pipe.processor = this;\n  return pipe;\n};\n\nProcessor.prototype.process = function(input, pipe) {\n  var context = input;\n  context.options = this.options();\n  var nextPipe = pipe || input.pipe || 'default';\n  var lastPipe, lastContext;\n  while (nextPipe) {\n    if (typeof context.nextAfterChildren !== 'undefined') {\n      // children processed and coming back to parent\n      context.next = context.nextAfterChildren;\n      context.nextAfterChildren = null;\n    }\n\n    if (typeof nextPipe === 'string') {\n      nextPipe = this.pipe(nextPipe);\n    }\n    nextPipe.process(context);\n    lastContext = context;\n    lastPipe = nextPipe;\n    nextPipe = null;\n    if (context) {\n      if (context.next) {\n        context = context.next;\n        nextPipe = lastContext.nextPipe || context.pipe || lastPipe;\n      }\n    }\n  }\n  return context.hasResult ? context.result : undefined;\n};\n\nexports.Processor = Processor;\n\n},{}],17:[function(require,module,exports){\n'use strict';\n\nvar _index = require('./index');\n\nvar _editor = require('./editor');\n\nvar _repository = require('./repository');\n\nvar _xhr = require('./xhr');\n\n/* jslint esnext:true, node:true, browser:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\n_index.Skaryna.Editor = _editor.Editor;\n_index.Skaryna.repository = _repository.repository;\n_index.Skaryna.XHR = _xhr.XHR;\n\nwindow.Skaryna = _index.Skaryna;\n\nif (Array.isArray(window.___Skaryna)) {\n    window.___Skaryna.forEach(function (callback) {\n        callback.apply(window);\n    });\n}\n\n},{\"./editor\":19,\"./index\":21,\"./repository\":26,\"./xhr\":32}],18:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.Variants = exports.Fields = exports.StaticBlockNode = exports.Heading = exports.Image = exports.Paragraph = exports.TextNode = exports.Quote = exports.Document = exports.BlockNode = exports.Node = undefined;\n\nvar _get = function get(object, property, receiver) { if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { return get(parent, property, receiver); } } else if (\"value\" in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nexports.escapeRegexp = escapeRegexp;\nexports.bestMatch = bestMatch;\nexports.getById = getById;\nexports.getByNode = getByNode;\nexports.randomID = randomID;\n\nvar _emitter = require('./emitter');\n\nvar _util = require('./util');\n\nvar _toHTML = require('./serializer/toHTML');\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; } /* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nvar elementMap = {};\n\n/**\n * @see https://github.com/component/escape-regexp\n * @param   {string} str\n * @returns {string}\n */\nfunction escapeRegexp(str) {\n    return String(str).replace(/([.*+?=^!:${}()|[\\]\\/\\\\])/g, '\\\\$1');\n}\n\n/**\n * @see App\n * @param   {array} list\n * @param   {string}   filter\n * @returns {string}\n */\nfunction bestMatch(list, filter) {\n    var lowest = null,\n        best;\n\n    list.forEach(function (rule) {\n        var regexp = new RegExp(escapeRegexp(rule).replace(/\\\\\\*/g, '(.+)')),\n            weight = rule.split('*').filter(function (part) {\n            return part.length;\n        }).length,\n            match = filter.match(regexp);\n\n        if (match && (lowest === null || match.length - weight < lowest)) {\n            lowest = match.length - weight;\n            best = rule;\n        }\n    });\n    return best;\n}\n\nfunction getById(id) {\n    return elementMap[id];\n}\n\nfunction getByNode(element) {\n    if (!element) {\n        return null;\n    }\n    var id = element.getAttribute('data-skaryna-id');\n    return getById(id);\n}\n\nfunction randomID(setValue) {\n    var possible = 'abcdefghijklmnopqrstuvwxyz0123456789',\n        text = '';\n\n    for (var i = 0; i < 5; i++) {\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n\n    if (Object.keys(elementMap).indexOf(text) === -1) {\n        elementMap[text] = elementMap[text] || setValue;\n        return text;\n    }\n    return randomID(setValue);\n}\n\n/**\n * @class\n */\n\nvar Node = exports.Node = function (_Emitter) {\n    _inherits(Node, _Emitter);\n\n    /**\n     * @constructs Node\n     */\n\n    function Node() {\n        _classCallCheck(this, Node);\n\n        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(Node).call(this));\n\n        _this.name = randomID(_this);\n\n        _this.__locked = false;\n        return _this;\n    }\n\n    _createClass(Node, [{\n        key: 'lock',\n        value: function lock() {\n            this.__locked = true;\n        }\n    }, {\n        key: 'attr',\n        value: function attr() {\n            return this.attrs;\n        }\n    }, {\n        key: 'get',\n        value: function get() {\n            throw new Error('Should be implemented');\n        }\n    }, {\n        key: 'set',\n        value: function set() {\n            throw new Error('Should be implemented');\n        }\n\n        /**\n         * @abstract\n         * @throws {Error}\n         */\n\n    }, {\n        key: 'toJSON',\n        value: function toJSON() {\n            var error = new Error('Should be implemented');\n            throw error;\n        }\n    }, {\n        key: 'locked',\n        get: function get() {\n            return this.__locked;\n        }\n    }, {\n        key: 'defaultNewItem',\n        get: function get() {\n            return null;\n        }\n    }, {\n        key: 'allowedNewItems',\n        get: function get() {\n            return [];\n        }\n    }]);\n\n    return Node;\n}(_emitter.Emitter);\n\n/**\n * @class\n * Defined for Image, Video, Embed, Table, HorizonalRule, Table, List or Component\n */\n\n\nvar BlockNode = exports.BlockNode = function (_Node) {\n    _inherits(BlockNode, _Node);\n\n    function BlockNode(type, items, attrs) {\n        _classCallCheck(this, BlockNode);\n\n        var _this2 = _possibleConstructorReturn(this, Object.getPrototypeOf(BlockNode).call(this));\n\n        _this2._type = type;\n        _this2.items = items || [];\n        _this2.attrs = attrs;\n        return _this2;\n    }\n\n    _createClass(BlockNode, [{\n        key: 'get',\n        value: function get(path) {\n            var elements = path.split('.'),\n                index = elements.shift(),\n                rest = elements.join('.'),\n                child = void 0;\n\n            if (isNaN(index)) {\n                return null;\n            }\n\n            child = this.items[+index];\n\n            if (rest.length && child) {\n                return child.get(rest);\n            }\n\n            return child;\n        }\n    }, {\n        key: 'set',\n        value: function set(path, value) {\n            var elements = path.split('.'),\n                index = elements.shift(),\n                rest = elements.join('.'),\n                child = void 0;\n\n            if (isNaN(index)) {\n                return null;\n            }\n\n            if (rest.length && child) {\n                return this.items[+index].set(rest, value);\n            }\n\n            this.items.splice(+index, 0, value);\n        }\n    }, {\n        key: 'toJSON',\n        value: function toJSON() {\n            var output = {\n                type: this.type,\n                items: this.items.map(function (item) {\n                    return item.toJSON();\n                })\n            };\n            if (this.attrs) {\n                output.attrs = JSON.parse(JSON.stringify(this.attrs));\n            }\n            return output;\n        }\n    }, {\n        key: 'decorate',\n        value: function decorate(element) {\n            return (0, _toHTML.toHTML)(this, {\n                edit: true\n            }).then(function (html) {\n                element.innerHTML = '';\n                (0, _util.arraize)(html.children).forEach(function (child) {\n                    element.appendChild(child);\n                });\n            });\n        }\n    }, {\n        key: 'empty',\n        get: function get() {\n            return this.items.length <= 0;\n        }\n    }, {\n        key: 'type',\n        get: function get() {\n            return this._type;\n        }\n    }]);\n\n    return BlockNode;\n}(Node);\n\nvar Document = exports.Document = function (_BlockNode) {\n    _inherits(Document, _BlockNode);\n\n    function Document(items) {\n        _classCallCheck(this, Document);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(Document).call(this, 'document', items));\n    }\n\n    _createClass(Document, [{\n        key: 'defaultNewItem',\n        get: function get() {\n            return Paragraph;\n        }\n    }, {\n        key: 'allowedNewItems',\n        get: function get() {\n            return [Paragraph, Image];\n        }\n    }]);\n\n    return Document;\n}(BlockNode);\n\nvar Quote = exports.Quote = function (_BlockNode2) {\n    _inherits(Quote, _BlockNode2);\n\n    function Quote(items) {\n        _classCallCheck(this, Quote);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(Quote).call(this, 'quote', items));\n    }\n\n    return Quote;\n}(BlockNode);\n\n/**\n * @class\n * Defined for Text, Paragraph, ListItem, Quote and Heading\n */\n\n\nvar TextNode = exports.TextNode = function (_Node2) {\n    _inherits(TextNode, _Node2);\n\n    _createClass(TextNode, [{\n        key: 'attr',\n        value: function attr() {\n            if (this.type === 'text') {\n                return {};\n            }\n            return _get(Object.getPrototypeOf(TextNode.prototype), 'attr', this).call(this);\n        }\n    }, {\n        key: 'type',\n        get: function get() {\n            return 'text';\n        }\n    }, {\n        key: 'empty',\n        get: function get() {\n            return !this.text || !this.text.replace(/^([\\s\\n\\r\\t]+)|([\\s\\n\\r\\t]+)$/, '').length;\n        }\n    }, {\n        key: 'absoluteEmpty',\n        get: function get() {\n            return this.text.length === 0;\n        }\n    }], [{\n        key: 'type',\n        get: function get() {\n            return 'text';\n        }\n    }]);\n\n    function TextNode(text, formats, attrs) {\n        _classCallCheck(this, TextNode);\n\n        var _this5 = _possibleConstructorReturn(this, Object.getPrototypeOf(TextNode).call(this));\n\n        _this5.text = text && text.toString ? text.toString() : '';\n        _this5.formats = formats || null;\n        _this5.attrs = attrs;\n        return _this5;\n    }\n\n    _createClass(TextNode, [{\n        key: 'toJSON',\n        value: function toJSON() {\n            var output = {\n                type: this.type,\n                text: this.text\n            };\n            if (this.formats) {\n                output.formats = JSON.parse(JSON.stringify(this.formats));\n            }\n            if (this.attrs && this.type !== 'text') {\n                output.attrs = JSON.parse(JSON.stringify(this.attrs));\n            }\n            return output;\n        }\n    }, {\n        key: 'append',\n        value: function append(node) {\n            var _this6 = this;\n\n            if (!(node instanceof TextNode)) {\n                throw new Error('Only text nodes can be joined');\n            }\n            if (node.formats) {\n                this.formats = this.formats || [];\n                node.formats.forEach(function (format) {\n                    _this6.formats.push({\n                        slice: [format.slice[0] + _this6.text.length, format.slice[1]],\n                        apply: format.apply\n                    });\n                });\n            }\n            this.text += node.text;\n        }\n    }, {\n        key: 'decorate',\n        value: function decorate(element) {\n            return (0, _toHTML.toHTML)(this, {\n                edit: true\n            }).then(function (html) {\n                element.innerHTML = html.textContent;\n            });\n        }\n    }]);\n\n    return TextNode;\n}(Node);\n\nvar Paragraph = exports.Paragraph = function (_TextNode) {\n    _inherits(Paragraph, _TextNode);\n\n    _createClass(Paragraph, [{\n        key: 'type',\n        get: function get() {\n            return 'paragraph';\n        }\n    }], [{\n        key: 'type',\n        get: function get() {\n            return 'paragraph';\n        }\n    }]);\n\n    function Paragraph(text, formats, attrs) {\n        _classCallCheck(this, Paragraph);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(Paragraph).call(this, text, formats, attrs));\n    }\n\n    _createClass(Paragraph, [{\n        key: 'nextNodeType',\n        get: function get() {\n            return Paragraph;\n        }\n    }]);\n\n    return Paragraph;\n}(TextNode);\n\nvar Image = exports.Image = function (_Node3) {\n    _inherits(Image, _Node3);\n\n    function Image(source, title, alt) {\n        _classCallCheck(this, Image);\n\n        var _this8 = _possibleConstructorReturn(this, Object.getPrototypeOf(Image).call(this, 'image'));\n\n        _this8.src = source;\n        _this8.title = title;\n        _this8.alt = alt;\n        return _this8;\n    }\n\n    _createClass(Image, [{\n        key: 'attr',\n        value: function attr() {\n            var attributes = _get(Object.getPrototypeOf(Image.prototype), 'attr', this).call(this) || {};\n            if (this.src) {\n                attributes.src = this.src;\n            }\n            if (this.title) {\n                attributes.title = this.title;\n            }\n            if (this.alt) {\n                attributes.alt = this.title;\n            }\n            return attributes;\n        }\n    }, {\n        key: 'toJSON',\n        value: function toJSON() {\n            var output = {\n                type: 'image',\n                src: this.src\n            };\n            if (this.title) {\n                output.title = this.title;\n            }\n            if (this.alt) {\n                output.alt = this.alt;\n            }\n            return output;\n        }\n    }, {\n        key: 'type',\n        get: function get() {\n            return 'image';\n        }\n    }], [{\n        key: 'type',\n        get: function get() {\n            return 'image';\n        }\n    }]);\n\n    return Image;\n}(Node);\n\nvar Heading = exports.Heading = function (_TextNode2) {\n    _inherits(Heading, _TextNode2);\n\n    function Heading(level, text, formats, attrs) {\n        _classCallCheck(this, Heading);\n\n        var _this9 = _possibleConstructorReturn(this, Object.getPrototypeOf(Heading).call(this, text, formats, attrs));\n\n        _this9.level = Math.min(6, level || 1);\n        return _this9;\n    }\n\n    _createClass(Heading, [{\n        key: 'attr',\n        value: function attr() {\n            return _get(Object.getPrototypeOf(Heading.prototype), 'attr', this).call(this);\n        }\n    }, {\n        key: 'toJSON',\n        value: function toJSON() {\n            var json = _get(Object.getPrototypeOf(Heading.prototype), 'toJSON', this).call(this);\n            json.level = this.level;\n            return json;\n        }\n    }, {\n        key: 'type',\n        get: function get() {\n            return 'heading';\n        }\n    }], [{\n        key: 'type',\n        get: function get() {\n            return 'heading';\n        }\n    }]);\n\n    return Heading;\n}(TextNode);\n\nvar StaticBlockNode = exports.StaticBlockNode = function (_BlockNode3) {\n    _inherits(StaticBlockNode, _BlockNode3);\n\n    function StaticBlockNode() {\n        _classCallCheck(this, StaticBlockNode);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(StaticBlockNode).apply(this, arguments));\n    }\n\n    _createClass(StaticBlockNode, [{\n        key: 'locked',\n        get: function get() {\n            return true;\n        }\n    }, {\n        key: 'defaultNewItem',\n        get: function get() {\n            return Paragraph;\n        }\n    }, {\n        key: 'allowedNewItems',\n        get: function get() {\n            return [Paragraph, Image];\n        }\n    }]);\n\n    return StaticBlockNode;\n}(BlockNode);\n\nvar Fields = exports.Fields = function (_Node4) {\n    _inherits(Fields, _Node4);\n\n    function Fields(data) {\n        _classCallCheck(this, Fields);\n\n        var _this11 = _possibleConstructorReturn(this, Object.getPrototypeOf(Fields).call(this));\n\n        _this11._map = data;\n        return _this11;\n    }\n\n    _createClass(Fields, [{\n        key: 'get',\n        value: function get(path) {\n            var elements = path.split('.'),\n                index = elements.shift(),\n                rest = elements.join('.'),\n                child = void 0;\n\n            child = this._map[index];\n\n            if (rest.length && child) {\n                return child.get(rest);\n            }\n\n            return child;\n        }\n    }, {\n        key: 'set',\n        value: function set(path, value) {\n            var elements = path.split('.'),\n                index = elements.shift(),\n                rest = elements.join('.'),\n                child = void 0;\n\n            if (rest.length && child) {\n                return this._map[index].get(rest, value);\n            }\n\n            this._map[index] = value;\n        }\n    }, {\n        key: 'toJSON',\n        value: function toJSON() {\n            return (0, _util.clone)([this._map, {\n                type: 'Fields'\n            }]);\n        }\n    }, {\n        key: 'type',\n        get: function get() {\n            return 'Fields';\n        }\n    }], [{\n        key: 'type',\n        get: function get() {\n            return 'Fields';\n        }\n    }]);\n\n    return Fields;\n}(Node);\n\nvar Variants = exports.Variants = function (_Node5) {\n    _inherits(Variants, _Node5);\n\n    function Variants(data) {\n        _classCallCheck(this, Variants);\n\n        var _this12 = _possibleConstructorReturn(this, Object.getPrototypeOf(Variants).call(this));\n\n        _this12._variants = data;\n        return _this12;\n    }\n\n    _createClass(Variants, [{\n        key: 'best',\n        value: function best(variant) {\n            var best = bestMatch(Object.keys(this._variants), variant);\n            return this._variants[best];\n        }\n    }, {\n        key: 'toJSON',\n        value: function toJSON() {\n            return (0, _util.clone)([this._map, {\n                type: 'Variants'\n            }]);\n        }\n    }, {\n        key: 'type',\n        get: function get() {\n            return 'Variants';\n        }\n    }], [{\n        key: 'type',\n        get: function get() {\n            return 'Variants';\n        }\n    }]);\n\n    return Variants;\n}(Node);\n\n},{\"./emitter\":20,\"./serializer/toHTML\":28,\"./util\":31}],19:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.Editor = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _emitter = require('./emitter');\n\nvar _util = require('./util');\n\nvar _repository = require('./repository');\n\nvar _toHTML = require('./serializer/toHTML');\n\nvar _toPOM = require('./serializer/toPOM');\n\nvar _fromHTML = require('./parser/fromHTML');\n\nvar _fromPOM = require('./parser/fromPOM');\n\nvar _xhr = require('./xhr');\n\nvar _document = require('./document');\n\nvar _toolbar = require('./toolbar');\n\nvar _injector = require('./injector');\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; } /* jslint esnext:true, node:true, browser:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nvar BACKSPACE = 8,\n    TAB = 9,\n    ENTER = 13,\n    SHIFT = 16,\n    CAPS = 20,\n    ESC = 27,\n    SPACE = 32,\n    UP = 38,\n    DOWN = 40,\n    DELETE = 46,\n    PREVENT = [ENTER];\n\nvar toolbar = new _toolbar.Toolbar(),\n    injector = void 0;\n\n/**\n * @class\n * @name Editor\n */\n\nvar Editor = exports.Editor = function (_Emitter) {\n    _inherits(Editor, _Emitter);\n\n    _createClass(Editor, null, [{\n        key: 'factory',\n\n\n        /**\n         * Creates new editor instance\n         * @param {HTMLElement} element\n         * @returns {Promise<Editor>} promise of fully loaded and rendered editor\n         */\n        value: function factory(element) {\n            var editor = new Editor(element);\n            return editor.inited;\n        }\n\n        /**\n         * [[Description]]\n         * @param {HTMLElement} element\n         * @returns {Promise} [[Description]]\n         */\n\n    }, {\n        key: 'initEditors',\n        value: function initEditors(element) {\n            var self = this;\n            return Promise.all((0, _util.arraize)(element.querySelectorAll('[data-skaryna]')).map(function (element) {\n                return Editor.factory(element);\n            })).then(function (editors) {\n                self.editors = editors;\n                return editors;\n            });\n        }\n\n        /**\n         * [[Description]]\n         * @param {Object} documentBody [[Description]]\n         * @param {[[Type]]} documentId   [[Description]]\n         */\n\n    }, {\n        key: 'registerDocument',\n        value: function registerDocument(documentBody, documentId) {\n            _repository.repository.set(documentId || _repository.DEFAULT_DOCUMENT, documentBody);\n        }\n\n        /**\n         * Loads data from REST endpoint\n         * @param   {string} path\n         * @param   {string} documentId\n         * @returns {Promise}\n         */\n\n    }, {\n        key: 'load',\n        value: function load(path, documentId) {\n            return _xhr.XHR.get(path).then(function (content) {\n                return (0, _fromPOM.fromPOM)(JSON.parse(content));\n            }).then(function (content) {\n                _repository.repository.set(documentId || _repository.DEFAULT_DOCUMENT, content);\n            });\n        }\n\n        /**\n         * @param {HTMLElement} element\n         */\n\n    }]);\n\n    function Editor(element) {\n        _classCallCheck(this, Editor);\n\n        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(Editor).call(this));\n\n        _this.element = element;\n        _this.documentPath = element.getAttribute('data-skaryna-path') || null;\n        _this.document = element.getAttribute('data-skaryna-doc') || _repository.DEFAULT_DOCUMENT;\n        _this.variant = element.getAttribute('data-skaryna-variant') || null;\n\n        _this._pendingState = null;\n        _this._rendering = false;\n\n        _this.init();\n\n        return _this;\n    }\n\n    /**\n     * Inits component\n     * @returns {Promise}\n     */\n\n\n    _createClass(Editor, [{\n        key: 'init',\n        value: function init() {\n            var self = this;\n            if (this.inited) {\n                return this.inited;\n            }\n            this.inited = (0, _fromHTML.fromHTML)(this.element, {\n                edit: true\n            }).then(function (content) {\n                content.lock();\n                if (_repository.repository.has(self.document)) {\n                    var doc = _repository.repository.get(self.document);\n                    if (self.documentPath) {\n                        doc = doc.get(self.documentPath);\n                        if (doc && doc.type === 'Variants' && doc.best) {\n                            doc = doc.best(self.variant || '*');\n                        }\n                    }\n                    self.content = doc;\n                } else if (!content.empty) {\n                    _repository.repository.set(self.document, content);\n                    self.content = content;\n                }\n            }).then(function () {\n                return self.render();\n            }).catch(function (error) {\n                console.log(error);\n                console.log(error.stack);\n            });\n        }\n    }, {\n        key: 'getCaretCharacterOffsetWithin',\n        value: function getCaretCharacterOffsetWithin(element) {\n            var caretOffset = 0,\n                doc = element.ownerDocument || element.document,\n                win = doc.defaultView || doc.parentWindow,\n                sel = void 0;\n            if (typeof win.getSelection != 'undefined') {\n                sel = win.getSelection();\n                if (sel.rangeCount > 0) {\n                    var range = win.getSelection().getRangeAt(0),\n                        preCaretRange = range.cloneRange();\n                    preCaretRange.selectNodeContents(element);\n                    preCaretRange.setEnd(range.endContainer, range.endOffset);\n                    caretOffset = preCaretRange.toString().length;\n                }\n            } else if ((sel = doc.selection) && sel.type != 'Control') {\n                var textRange = sel.createRange(),\n                    preCaretTextRange = doc.body.createTextRange();\n                preCaretTextRange.moveToElementText(element);\n                preCaretTextRange.setEndPoint('EndToEnd', textRange);\n                caretOffset = preCaretTextRange.text.length;\n            }\n            return caretOffset;\n        }\n    }, {\n        key: 'getSelectionLength',\n        value: function getSelectionLength() {}\n    }, {\n        key: 'getCurrentElement',\n        value: function getCurrentElement(element) {\n\n            var doc = element.ownerDocument || element.document,\n                win = doc.defaultView || doc.parentWindow,\n                sel = void 0,\n                node = void 0;\n\n            if (typeof win.getSelection != 'undefined') {\n                sel = win.getSelection();\n            } else {\n                sel = doc.selection;\n            }\n\n            node = sel.focusNode;\n\n            if (node === this.element) {\n                return this.element;\n            }\n            return this.getEditableNode(node);\n        }\n    }, {\n        key: 'getEditableNode',\n        value: function getEditableNode(node) {\n            while (node && (!node.hasAttribute || !node.hasAttribute('data-skaryna-id'))) {\n                node = node.parentNode;\n            }\n            return node;\n        }\n    }, {\n        key: 'onDOM',\n        value: function onDOM(selectorORElement, eventName, myMethod) {\n            var self = this;\n            if (selectorORElement instanceof HTMLElement) {\n                selectorORElement = [selectorORElement];\n            } else {\n                selectorORElement = (0, _util.arraize)(this.element.querySelectorAll(selectorORElement));\n            }\n            selectorORElement.forEach(function (element) {\n                element.addEventListener(eventName, function (event) {\n                    myMethod.apply(self, [event]);\n                }, true);\n            });\n        }\n\n        /**\n         * Renders UI\n         * @returns {Promise}\n         */\n\n    }, {\n        key: 'render',\n        value: function render() {\n            var _this2 = this;\n\n            this._rendering = true;\n            var self = this,\n                promise = void 0;\n\n            if (!this.content) {\n                this._rendering = false;\n                promise = Promise.resolve();\n            } else {\n                promise = this.content.decorate(this.element).then(function () {\n                    _this2._rendering = false;\n                });\n            }\n\n            return promise.then(function () {\n                self.element.setAttribute('data-skaryna-id', self.content ? self.content.name : (0, _document.randomID)(true));\n                self.element.setAttribute('contentEditable', '');\n                self.element.addEventListener('keydown', function (event) {\n                    self.onKeyUp(event);\n                }, true);\n                self.onDOM('[data-skaryna-id]', 'mouseup', self.focus);\n                self.onDOM(self.element, 'mouseup', self.focus);\n\n                self.element.addEventListener('mouseup', function (event) {\n                    var sel = window.getSelection ? window.getSelection().toString() : document.selection.createRange().text;\n                    if (sel && sel.length) {\n                        self.onSelect(event);\n                    }\n                }, true);\n            }).then(function () {\n                return self;\n            });\n        }\n    }, {\n        key: 'onSelect',\n        value: function onSelect() {\n            this.showToolbar();\n            this.strong();\n        }\n    }, {\n        key: 'showToolbar',\n        value: function showToolbar() {\n            toolbar.anchor();\n        }\n    }, {\n        key: 'focus',\n        value: function focus(event) {\n            var _this3 = this;\n\n            var node = this.getEditableNode(event.target),\n                focusedNode = (0, _document.getByNode)(node),\n                parentNode = (0, _document.getByNode)(node.parentNode),\n                newItems = void 0,\n                injectorObject = void 0;\n\n            newItems = parentNode ? parentNode.allowedNewItems : focusedNode.allowedNewItems;\n\n            this.hideInjector();\n\n            if (newItems.length > 0) {\n                if (!parentNode) {\n                    injectorObject = this.showInjector(node.parentNode.lastChild, newItems);\n                } else {\n                    injectorObject = this.showInjector(node, newItems);\n                }\n                injectorObject.on('injectnode', function (event) {\n                    if (parentNode) {\n                        var index = parentNode.items.indexOf(focusedNode);\n                        parentNode.items.splice(index, 0, new event.data());\n                    } else {\n                        parentNode.items.push(new event.data());\n                    }\n                    _this3.render();\n                });\n            }\n        }\n    }, {\n        key: 'showInjector',\n        value: function showInjector(afterNode, possibleItems) {\n            var injectorObject = new _injector.Injector(possibleItems),\n                box = afterNode.getBoundingClientRect();\n\n            document.body.appendChild(injectorObject.element);\n            injectorObject.goTo(box.left, box.top);\n            return injectorObject;\n        }\n    }, {\n        key: 'hideInjector',\n        value: function hideInjector() {\n            if (injector) {\n                if (injector.parentNode) {\n                    injector.parentNode.removeChild(injector);\n                }\n                injector = null;\n            }\n        }\n    }, {\n        key: 'strong',\n        value: function strong() {\n            var textNode = this.getCurrentElement(event.target),\n                sel = window.getSelection ? window.getSelection().toString() : document.selection.createRange().text,\n                to = sel.length,\n                from = this.getCaretCharacterOffsetWithin(textNode) - to;\n\n            (0, _fromHTML.fromHTML)(textNode).then(function (POM) {\n                POM.formats = POM.formats || [];\n                POM.formats.push({\n                    slice: [from, to],\n                    apply: ['strong']\n                });\n                return (0, _toHTML.toHTML)(POM);\n            }).then(function (HTML) {\n                textNode.innerHTML = HTML.innerHTML;\n            });\n        }\n\n        /**\n         * Handles external change\n         * @param {object} event\n         */\n\n    }, {\n        key: 'onExternalChange',\n        value: function onExternalChange() {\n            if (this._rendering) {\n                this._pendingState = true;\n                return;\n            }\n            this.render();\n        }\n    }, {\n        key: 'newItem',\n        value: function newItem(target) {\n            var currentTarget = target,\n                node = (0, _document.getByNode)(currentTarget),\n                self = this,\n                asEditor = Editor.editors.reduce(function (previous, current) {\n                if (current.element === currentTarget) {\n                    return current;\n                }\n                return previous;\n            }, null);\n\n            while (node !== null) {\n                if (!node) {\n                    if (asEditor) {\n                        var index = Editor.editors.indexOf(asEditor) + 1;\n                        if (index >= Editor.editors.length) {\n                            index = 0;\n                        }\n                        self.editNode(Editor.editors[index].element);\n                    }\n                    return;\n                }\n                if (node.defaultNewItem) {\n                    var newElement = new node.defaultNewItem();\n                    node.items.push(newElement);\n\n                    (0, _toHTML.toHTML)(newElement, {\n                        edit: true\n                    }).then(function (htmlElement) {\n                        currentTarget.appendChild(htmlElement);\n                        self.editNode(htmlElement);\n                    });\n                    return;\n                }\n                currentTarget = currentTarget.parentNode;\n                node = (0, _document.getByNode)(currentTarget);\n                asEditor = asEditor || Editor.editors.reduce(function (previous, current) {\n                    if (current.element === currentTarget) {\n                        return current;\n                    }\n                    return previous;\n                }, null);\n            }\n        }\n    }, {\n        key: 'editNode',\n        value: function editNode(node) {\n            var range = document.createRange(),\n                sel = window.getSelection();\n            range.setStart(node, 0);\n            range.collapse(true);\n            sel.removeAllRanges();\n            sel.addRange(range);\n        }\n    }, {\n        key: 'ownAction',\n        value: function ownAction(key, target) {\n            if (key === ENTER) {\n                return this.newItem(target);\n            }\n        }\n\n        /**\n         * Handles key up event\n         * @param {Event} event\n         */\n\n    }, {\n        key: 'onKeyUp',\n        value: function onKeyUp(event) {\n            var _this4 = this;\n\n            var current = this.getCurrentElement(event.target);\n            if (PREVENT.indexOf(event.keyCode) !== -1) {\n                event.stopPropagation();\n                event.preventDefault();\n                this.ownAction(event.keyCode, current);\n            } else {\n                setTimeout(function () {\n                    return _this4.update(current);\n                }, 0);\n            }\n        }\n    }, {\n        key: 'update',\n        value: function update(element) {\n            var _this5 = this;\n\n            var self = this,\n                doc = _repository.repository.get(self.document);\n\n            if (self.documentPath) {\n                doc = doc.set(self.documentPath, self.content);\n                _repository.repository.emit(_repository.CHANGE);\n            } else {\n                //TODO\n            }\n\n            (0, _fromHTML.fromHTML)(element).then(function (POM) {\n                Editor.emit('selected', {\n                    editor: _this5,\n                    element: element,\n                    node: POM\n                });\n            });\n        }\n    }]);\n\n    return Editor;\n}(_emitter.Emitter);\n\nvar styles = document.createElement('style');\nstyles.innerText = '\\n        p[data-skaryna-id]:empty {\\n                display: block;\\n                height: 1em;\\n            }\\n        }\\n        ';\n\ndocument.body.appendChild(styles);\n\n},{\"./document\":18,\"./emitter\":20,\"./injector\":22,\"./parser/fromHTML\":24,\"./parser/fromPOM\":25,\"./repository\":26,\"./serializer/toHTML\":28,\"./serializer/toPOM\":29,\"./toolbar\":30,\"./util\":31,\"./xhr\":32}],20:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\n/**\n * @namespace skaryna\n *\n * @class EventConfig\n * @property {function} fn listener\n * @property {object} context\n * @property {array} args arguments to be passed\n * @property {boolean} once if should be fired only once\n */\n\n/**\n * @class Event\n */\n\nvar Event = exports.Event = function () {\n    /**\n     * Contructor\n     * @constructs Event\n     * @param {string} name\n     * @param {mixed} data\n     * @param {object} source\n     * @param {Event} parent\n     */\n\n    function Event(name, data, source, parent) {\n        _classCallCheck(this, Event);\n\n        Object.defineProperties(this, {\n            /**\n             * @property {string}\n             * @name Event#name\n             */\n            name: {\n                value: name,\n                writable: false\n            },\n            /**\n             * @property {mixed}\n             * @name Event#data\n             */\n            data: {\n                value: data,\n                writable: false\n            },\n            /**\n             * @property {object}\n             * @name Event#source\n             */\n            source: {\n                value: source,\n                writable: false\n            },\n            /**\n             * @property {Event|null}\n             * @name Event#parent\n             */\n            parent: {\n                value: parent,\n                writable: false\n            }\n        });\n    }\n\n    _createClass(Event, [{\n        key: 'toJSON',\n        value: function toJSON() {\n            return {\n                name: this.name,\n                data: this.data,\n                source: this.source,\n                parent: this.parent\n            };\n        }\n    }, {\n        key: 'toString',\n        value: function toString() {\n            return 'Event: ' + JSON.stringify(this.toJSON());\n        }\n    }]);\n\n    return Event;\n}();\n\n/**\n * [[Description]]\n * @param {Event} cofnig\n * @param {EventConfig} thisObject\n */\n\n\nfunction execute(event, config) {\n    var fn = config.fn;\n    var context = config.context;\n    var args = config.args;\n    var params = [event].concat(args);\n\n    fn.apply(context || null, params);\n}\n\n/**\n * Adds listener for an event\n * @param {string} eventName\n * @param {function} handler\n * @param {object} context\n * @param {array} args\n * @param {boolean} once\n */\nfunction _on(eventName, handler, context, args, once) {\n    this.__listeners = this.__listeners || {};\n    this.__listeners[eventName] = this.__listeners[eventName] || [];\n    this.__listeners[eventName].push({\n        fn: handler,\n        context: context,\n        args: args,\n        once: !!once\n    });\n}\n\n/**\n * Adds listener for an event that should be called once\n * @param {string} eventName\n * @param {function} handler\n * @param {object} context\n * @param {array} args\n */\nfunction _once(eventName, handler, context, args) {\n    this.on(eventName, handler, context, args, true);\n}\n\n/**\n * Adds listener for an event\n * @param {string} eventName\n * @param {function} handler\n * @param {object} context\n * @param {array} args\n * @param {boolean} once\n */\nfunction _off(eventName, handler, context, args, once) {\n    var _this = this;\n\n    if (!this.__listeners || !this.__listeners[eventName]) {\n        return;\n    }\n    this.getListeners(eventName, handler, context, args, once).forEach(function (config) {\n        _this.__listeners[eventName].splice(_this.__listeners[eventName].indexOf(config), 1);\n    });\n}\n\n/**\n * Emits an event\n * @param {string} eventName\n * @param {mixed} data\n * @param {Event|null} parent\n */\nfunction _emit(eventName, data, parent) {\n    if (!this.__listeners || !this.__listeners[eventName]) {\n        return;\n    }\n\n    var self = this,\n        event = new Event(eventName, data, this, parent);\n\n    this.getListeners(eventName).forEach(function (config) {\n        if (config.once === true) {\n            self.off(eventName, config.fn, config.context, config.args, config.once);\n        }\n        execute(event, config);\n    });\n}\n\n/**\n * Bubbles event to other emitter\n * @param {string} eventName\n * @param {object} toEmitter\n */\nfunction _bubbleEvent(eventName, toEmitter) {\n    this.on(eventName, function (event) {\n        toEmitter.emit(eventName, event.data, event);\n    });\n}\n\n/**\n * Gets all listeners that match criteria\n * @param   {string} eventName required\n * @param   {function} handler   if defined will be used for match\n * @param   {object} context   if defined will be used for match\n * @param   {array} args      if defined will be used for match\n * @returns {array<EventConfig>|null}\n */\nfunction _getListeners(eventName, handler, context, args) {\n    if (!this.__listeners || !this.__listeners[eventName]) {\n        return null;\n    }\n\n    return this.__listeners[eventName].map(function (config) {\n        if (handler !== undefined && config.fn !== handler) {\n            return false;\n        }\n        if (context !== undefined && config.context !== context) {\n            return false;\n        }\n        if (args !== undefined && config.args !== args) {\n            return false;\n        }\n        return config;\n    }).filter(function (result) {\n        return !!result;\n    });\n}\n\n/*\n * @class Emitter\n */\n\nvar Emitter = exports.Emitter = function () {\n    function Emitter() {\n        _classCallCheck(this, Emitter);\n    }\n\n    _createClass(Emitter, [{\n        key: 'on',\n        value: function on() {\n            _on.apply(this, arguments);\n        }\n    }, {\n        key: 'once',\n        value: function once() {\n            _once.apply(this, arguments);\n        }\n    }, {\n        key: 'off',\n        value: function off() {\n            _off.apply(this, arguments);\n        }\n    }, {\n        key: 'emit',\n        value: function emit() {\n            _emit.apply(this, arguments);\n        }\n    }, {\n        key: 'bubbleEvent',\n        value: function bubbleEvent() {\n            _bubbleEvent.apply(this, arguments);\n        }\n    }, {\n        key: 'getListeners',\n        value: function getListeners() {\n            return _getListeners.apply(this, arguments);\n        }\n    }], [{\n        key: 'on',\n        value: function on() {\n            _on.apply(this, arguments);\n        }\n    }, {\n        key: 'once',\n        value: function once() {\n            _once.apply(this, arguments);\n        }\n    }, {\n        key: 'off',\n        value: function off() {\n            _off.apply(this, arguments);\n        }\n    }, {\n        key: 'emit',\n        value: function emit() {\n            _emit.apply(this, arguments);\n        }\n    }, {\n        key: 'bubbleEvent',\n        value: function bubbleEvent() {\n            _bubbleEvent.apply(this, arguments);\n        }\n    }, {\n        key: 'getListeners',\n        value: function getListeners() {\n            return _getListeners.apply(this, arguments);\n        }\n    }]);\n\n    return Emitter;\n}();\n\n},{}],21:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _emitter = require('./emitter');\n\nObject.defineProperty(exports, 'Event', {\n    enumerable: true,\n    get: function get() {\n        return _emitter.Event;\n    }\n});\nObject.defineProperty(exports, 'Emitter', {\n    enumerable: true,\n    get: function get() {\n        return _emitter.Emitter;\n    }\n});\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar Skaryna = exports.Skaryna = function Skaryna() {\n    _classCallCheck(this, Skaryna);\n};\n\n},{\"./emitter\":20}],22:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.Injector = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _emitter = require('./emitter');\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; } /* jslint esnext:true, node:true, browser:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\n\nvar styles = void 0;\n\nvar SVGS = {\n    paragraph: 'M832 320v704q0 104-40.5 198.5t-109.5 163.5-163.5 109.5-198.5 40.5h-64q-26 0-45-19t-19-45v-128q0-26 19-45t45-19h64q106 0 181-75t75-181v-32q0-40-28-68t-68-28h-224q-80 0-136-56t-56-136v-384q0-80 56-136t136-56h384q80 0 136 56t56 136zm896 0v704q0 104-40.5 198.5t-109.5 163.5-163.5 109.5-198.5 40.5h-64q-26 0-45-19t-19-45v-128q0-26 19-45t45-19h64q106 0 181-75t75-181v-32q0-40-28-68t-68-28h-224q-80 0-136-56t-56-136v-384q0-80 56-136t136-56h384q80 0 136 56t56 136z',\n    image: 'M576 576q0 80-56 136t-136 56-136-56-56-136 56-136 136-56 136 56 56 136zm1024 384v448h-1408v-192l320-320 160 160 512-512zm96-704h-1600q-13 0-22.5 9.5t-9.5 22.5v1216q0 13 9.5 22.5t22.5 9.5h1600q13 0 22.5-9.5t9.5-22.5v-1216q0-13-9.5-22.5t-22.5-9.5zm160 32v1216q0 66-47 113t-113 47h-1600q-66 0-113-47t-47-113v-1216q0-66 47-113t113-47h1600q66 0 113 47t47 113z',\n    dimensions: '0 0 1792 1792'\n};\n\nvar Injector = exports.Injector = function (_Emitter) {\n    _inherits(Injector, _Emitter);\n\n    function Injector(allowedNodes) {\n        _classCallCheck(this, Injector);\n\n        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(Injector).call(this));\n\n        var self = _this,\n            div = document.createElement('div');\n\n        div.innerHTML = '<skaryna><div data-skaryna-tooltip=\"left\"><div></div><div></div></div></skaryna>';\n\n        _this.element = div.firstChild;\n\n        div = _this.element.firstChild;\n\n        allowedNodes.forEach(function (node) {\n            var action = document.createElement('a'),\n                svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg'),\n                path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\n            svg.setAttribute('width', 30);\n            svg.setAttribute('height', 30);\n            svg.setAttribute('viewBox', SVGS.dimensions);\n            svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n            path.setAttribute('d', SVGS[node.type]);\n            path.setAttribute('fill', '#fff');\n\n            svg.appendChild(path);\n            action.appendChild(svg);\n\n            action.addEventListener('mousedown', function (event) {\n                event.preventDefault();\n                event.stopPropagation();\n                self.emit('injectnode', node);\n            }, true);\n            div.children[1].appendChild(action);\n        });\n\n        if (!styles) {\n            styles = document.createElement('style');\n            styles.innerText = '\\n        [data-skaryna-tooltip] {\\n            position: absolute;\\n            z-index: 1070;\\n            display: block;\\n            font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\\n            font-size: 12px;\\n            font-style: normal;\\n            font-weight: 400;\\n            line-height: 1.42857143;\\n            text-align: left;\\n            text-align: start;\\n            text-decoration: none;\\n            text-shadow: none;\\n            text-transform: none;\\n            letter-spacing: normal;\\n            word-break: normal;\\n            word-spacing: normal;\\n            word-wrap: normal;\\n            white-space: normal;\\n            /*filter: alpha(opacity=0);\\n            opacity: 0;*/\\n            line-break: auto;\\n            transition: opacity 0.5s;\\n        }\\n        [data-skaryna-tooltip] div:nth-child(2) {\\n            max-width: 200px;\\n            padding: 3px 8px;\\n            color: #fff;\\n            text-align: center;\\n            background-color: #000;\\n            border-radius: 4px;\\n        }\\n        [data-skaryna-tooltip] div:nth-child(1) {\\n            position: absolute;\\n            width: 0;\\n            height: 0;\\n            border-color: transparent;\\n            border-style: solid;\\n        }\\n        [data-skaryna-tooltip=\"left\"] {\\n            padding: 0 5px;\\n            margin-left: -3px;\\n        }\\n        [data-skaryna-tooltip=\"top\"] {\\n            padding: 5px 0;\\n            margin-top: -3px;\\n        }\\n        [data-skaryna-tooltip=\"bottom\"] {\\n            padding: 5px 0;\\n            margin-top: 3px;\\n        }\\n        [data-skaryna-tooltip=\"right\"] {\\n            padding: 0 5px;\\n            margin-left: 3px;\\n        }\\n        [data-skaryna-tooltip=\"left\"] div:nth-child(1) {\\n            top: 50%;\\n            right: 0;\\n            margin-top: -5px;\\n            border-width: 5px 0 5px 5px;\\n            border-left-color: #000;\\n        }\\n        [data-skaryna-tooltip=\"top\"] div:nth-child(1) {\\n            bottom: 0;\\n            left: 50%;\\n            margin-left: -5px;\\n            border-width: 5px 5px 0;\\n            border-top-color: #000;\\n        }\\n        [data-skaryna-tooltip=\"bottom\"] div:nth-child(1) {\\n            top: 0;\\n            left: 50%;\\n            margin-left: -5px;\\n            border-width: 0 5px 5px;\\n            border-bottom-color: #000;\\n        }\\n        [data-skaryna-tooltip=\"right\"] div:nth-child(1) {\\n            top: 50%;\\n            left: 0;\\n            margin-top: -5px;\\n            border-width: 5px 5px 5px 0;\\n            border-right-color: #000;\\n        }\\n        [data-skaryna-tooltip] a {\\n            margin-left: 10px;\\n        }\\n        [data-skaryna-tooltip] a:first-child{\\n            margin-left: 0px;\\n        }';\n\n            document.body.appendChild(styles);\n        }\n        return _this;\n    }\n\n    _createClass(Injector, [{\n        key: 'goTo',\n        value: function goTo(x, y) {\n            var _this2 = this;\n\n            setTimeout(function () {\n                var div = _this2.element.firstChild,\n                    injectorBox = div.getBoundingClientRect();\n                div.style.top = y + 'px';\n                div.style.left = x - injectorBox.width + 'px';\n            }, 0);\n        }\n    }]);\n\n    return Injector;\n}(_emitter.Emitter);\n\n},{\"./emitter\":20}],23:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nvar Parser = function () {\n    function Parser() {\n        _classCallCheck(this, Parser);\n    }\n\n    _createClass(Parser, [{\n        key: 'parse',\n        value: function parse(format, token, data, options) {\n\n            if (!token) {\n                return Promise.reject(new Error('Model is empty'));\n            }\n\n            return this.handle(format, token, data, options);\n        }\n    }, {\n        key: 'on',\n        value: function on(format, token, handler) {\n            this._handlers = this._handlers || {};\n            this._handlers[format] = this._handlers[format] || {};\n            this._handlers[format][token] = handler;\n        }\n    }, {\n        key: 'handle',\n        value: function handle(format, token, data, options) {\n\n            var handler = this._handlers && this._handlers[format] && this._handlers[format][token] ? this._handlers[format][token] : null;\n            if (!handler) {\n                handler = this._handlers && this._handlers[format] && this._handlers[format]['*'] ? this._handlers[format]['*'] : null;\n                if (!handler) {\n                    return Promise.reject(new Error('No handler defined for ' + format + ' : ' + token));\n                }\n            }\n\n            return handler(token, data, options).then(function (POM) {\n                return POM;\n            });\n        }\n    }]);\n\n    return Parser;\n}();\n\nvar parser = exports.parser = new Parser();\n\n},{}],24:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }(); /* jslint esnext:true, node:true */\n/* globals document */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nexports.fromHTML = fromHTML;\n\nvar _parser = require('./../parser');\n\nvar _util = require('./../util');\n\nvar _document = require('./../document');\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nfunction whatWrapper(rootNode) {\n    switch (rootNode) {\n        case 'td':\n        case 'th':\n            return 'tr';\n        case 'tr':\n            return 'table';\n        default:\n            return 'div';\n    }\n}\n\nfunction editMode(node, element, options) {\n    if (options && options.edit) {\n        element.setAttribute('data-skaryna-id', node.name);\n        node.__element = element;\n    }\n    return node;\n}\n\nfunction processChildren(element, options) {\n    if (!element || !element.childNodes) {\n        return Promise.resolve([]);\n    }\n    return Promise.all((0, _util.arraize)(element.childNodes).map(function (child) {\n        if (child.nodeType === 1 || child.nodeType === 3) {\n            return fromHTML(child, options);\n        } else {\n            return null;\n        }\n    })).then(function (items) {\n        return items.filter(function (item) {\n            if (item.constructor === _document.TextNode) {\n                return !item.absoluteEmpty;\n            }\n            return item !== null;\n        });\n    });\n}\n\n/**\n * Parse POM JSON representation\n * @param   {string|HTMLElement}   model\n * @param   {options} options\n * @returns {Promise<Node>}\n */\nfunction fromHTML(input, options) {\n\n    if (!input) {\n        return Promise.resolve(null);\n    }\n\n    if (typeof input === 'string') {\n        if (input.length === 0) {\n            return Promise.resolve(null);\n        }\n        var wrapper = document.createElement(whatWrapper(input.replace('/^(\\s*)<([a-zA-Z0-9_-]+)', '$2').toLowerCase()));\n        wrapper.innerHTML = input;\n        return processChildren(wrapper, options).then(function (children) {\n\n            if (children.length === 1) {\n                return children[0];\n            }\n            if (children.filter(function (item) {\n                return !(item instanceof _document.TextNode || item instanceof InlineNode);\n            }).length) {\n                if (children.map(function (item) {\n                    return item instanceof _document.BlockNode;\n                }).length) {\n                    return new _document.Document(children.map(function (item) {\n                        if (item.type === 'text') {\n                            return new _document.Paragraph(item.text, item.formats, item.attrs, options);\n                        }\n                        return item;\n                    }));\n                }\n                return new _document.Document(children);\n            }\n            var items = children.map(function (item) {\n                if (item instanceof InlineNode) {\n                    var _stringify = stringify([item]);\n\n                    var _stringify2 = _slicedToArray(_stringify, 2);\n\n                    var text = _stringify2[0];\n                    var formats = _stringify2[1];\n\n                    return new _document.TextNode(text, formats, options);\n                }\n\n                return item;\n            }),\n                first = items.shift();\n            items.forEach(function (item) {\n                first.append(item);\n            });\n            return first;\n        });\n    }\n    return _parser.parser.parse('html', input.nodeType === 3 ? 'text' : input.nodeName, input);\n}\n\nvar InlineNode = function (_BlockNode) {\n    _inherits(InlineNode, _BlockNode);\n\n    function InlineNode() {\n        _classCallCheck(this, InlineNode);\n\n        return _possibleConstructorReturn(this, Object.getPrototypeOf(InlineNode).apply(this, arguments));\n    }\n\n    return InlineNode;\n}(_document.BlockNode);\n\nfunction formatType(item, text) {\n    if (item.type === 'A') {\n        return {\n            type: 'A',\n            title: item.attrs.title || text,\n            href: item.attrs.href\n        };\n    }\n    return item.type;\n}\n\nfunction stringify(items) {\n    var text = '',\n        formats = [],\n        index = 0;\n\n    items.forEach(function (item) {\n        if (item instanceof InlineNode) {\n            var _stringify3 = stringify(item.items);\n\n            var _stringify4 = _slicedToArray(_stringify3, 2);\n\n            var innerText = _stringify4[0];\n            var innerFormats = _stringify4[1];\n            var format = {\n                slice: [index, innerText.length],\n                apply: [formatType(item, innerText)]\n            };\n            formats.push(format);\n            innerFormats.forEach(function (format) {\n                formats.push({\n                    slice: [index + format.slice[0], format.slice[1]],\n                    apply: format.apply\n                });\n            });\n            formats.forEach(function (format) {\n                formats.forEach(function (otherFormat, idx) {\n                    if (format !== otherFormat && format.slice[0] === otherFormat.slice[0] && format.slice[1] === otherFormat.slice[1]) {\n                        format.apply = format.apply.concat(otherFormat.apply);\n                        formats.splice(idx, 1);\n                    }\n                });\n            });\n            text += innerText;\n            index += innerText.length;\n        } else if (item instanceof _document.TextNode) {\n            text += item.text;\n            index += item.text.length;\n        } else {}\n    });\n\n    return [text, formats];\n}\n\nfunction heading(token, data, options) {\n\n    return processChildren(data, options).then(function (items) {\n        var _stringify5 = stringify(items);\n\n        var _stringify6 = _slicedToArray(_stringify5, 2);\n\n        var text = _stringify6[0];\n        var formats = _stringify6[1];\n\n        return Promise.resolve(new _document.Heading(token[1].toLowerCase(), text || '', formats.length ? formats : null, options));\n    });\n}\n\nfunction paragraph(token, data, options) {\n    return processChildren(data, options).then(function (items) {\n        var _stringify7 = stringify(items);\n\n        var _stringify8 = _slicedToArray(_stringify7, 2);\n\n        var text = _stringify8[0];\n        var formats = _stringify8[1];\n\n        return Promise.resolve(new _document.Paragraph(text, formats.length ? formats : null));\n    });\n}\n\nfunction attributes(input) {\n    var output = null;\n    (0, _util.arraize)(input).forEach(function (attribute) {\n        output = output || {};\n        if (attribute.value && attribute.value.length) {\n            output[attribute.name] = attribute.value;\n        }\n    });\n    return output;\n}\n\nfunction ifAttr(value) {\n    if (value && value.length) {\n        return value;\n    }\n    return null;\n}\n\nfunction quote(token, data, options) {\n    return processChildren(data, options).then(function (items) {\n\n        var paragraphs = [],\n            lastParagraph = [];\n        items.forEach(function (item) {\n            if (item instanceof _document.Paragraph) {\n                if (lastParagraph.length) {\n                    var _stringify9 = stringify(items);\n\n                    var _stringify10 = _slicedToArray(_stringify9, 2);\n\n                    var text = _stringify10[0];\n                    var formats = _stringify10[1];\n\n                    paragraphs.push(Promise.resolve(new _document.Paragraph(text, formats.length ? formats : null, options)));\n                    lastParagraph = [];\n                }\n                paragraphs.push(Promise.resolve(item));\n            } else {\n                lastParagraph.push(item);\n            }\n        });\n        if (lastParagraph.length) {\n            var _stringify11 = stringify(items);\n\n            var _stringify12 = _slicedToArray(_stringify11, 2);\n\n            var text = _stringify12[0];\n            var formats = _stringify12[1];\n\n            paragraphs.push(Promise.resolve(new _document.Paragraph(text, formats.length ? formats : null, options)));\n        }\n\n        return Promise.all(paragraphs);\n    }).then(function (items) {\n        return Promise.resolve(new _document.Quote(items));\n    });\n}\n\n_parser.parser.on('html', 'text', function (token, data, options) {\n    return Promise.resolve(new _document.TextNode(data.textContent, null, options));\n});\n_parser.parser.on('html', 'H1', heading);\n_parser.parser.on('html', 'H2', heading);\n_parser.parser.on('html', 'H3', heading);\n_parser.parser.on('html', 'H4', heading);\n_parser.parser.on('html', 'H5', heading);\n_parser.parser.on('html', 'H6', heading);\n_parser.parser.on('html', 'P', paragraph);\n_parser.parser.on('html', 'BLOCKQUOTE', quote);\n\n_parser.parser.on('html', 'IMG', function (token, data, options) {\n    return Promise.resolve(new _document.Image(data.src, ifAttr(data.getAttribute('title')), ifAttr(data.getAttribute('alt')), (0, _util.clone)([attributes(data.attributes)], ['src', 'title', 'alt'])), options);\n});\n\n['ADDRESS', 'ARTICLE', 'ASIDE', 'DIV', 'FIGURE', 'FOOTER', 'HEADER', 'MAIN', 'NAV', 'SECTION'].forEach(function (nodeName) {\n    _parser.parser.on('html', nodeName, function (token, data, options) {\n        return processChildren(data, options).then(function (items) {\n            return Promise.resolve(new _document.StaticBlockNode(token, items, attributes(data.attributes)), options);\n        });\n    });\n});\n\n_parser.parser.on('html', '*', function (token, data, options) {\n    return processChildren(data, options).then(function (items) {\n        return Promise.resolve(new InlineNode(token, items, attributes(data.attributes)), options);\n    });\n});\n/*\nparser.on('html', '#text', (token, data) => {\n    return Promise.resolve(new TextNode(data.textContent));\n});\n\n[\n    ['b', 'strong'],\n    ['big', 'strong'],\n    ['i', 'em'],\n    'small',\n    ['tt', 'code'],\n    ['abbr', 'semantic', 'abbr'],\n    ['acronym', 'abbr', 'abbr'],\n    ['cite', 'semantic', 'cite'],\n    'code',\n    ['dfn', 'semantic', 'definition'],\n    'em',\n    ['time', 'semantic', 'time'],\n    ['var', 'code', 'var'],\n    ['kbd', 'code', 'kbd'],\n    'strong',\n    ['samp', 'code', 'sample'],\n    'bdo',\n    'a',\n    //'br',\n    //'img,\n    //'map',\n    //'object',\n    ['q', 'semantic', 'quotation'],\n    //script\n    'span',\n    del,\n    s\n    'sub',\n    'sup',\n    //button\n    //input\n    //label\n    //select\n    //textarea\n].forEach((inlineRule) => {\n\n    let input = typeof inlineRule === 'string' ? inlineRule : inlineRule[0];\n\n    parser.on('html', input, (token, data) => {\n        return processChildren(data)\n            .then((items) => {\n\n            });\n    });\n\n});\n*/\n\n},{\"./../document\":18,\"./../parser\":23,\"./../util\":31}],25:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.fromPOM = fromPOM;\n\nvar _parser = require('./../parser');\n\nvar _document = require('./../document');\n\n/**\n * Parse POM JSON representation\n * @param   {object}   model\n * @param   {options} options\n * @returns {Promise<Node>}\n */\n/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nfunction fromPOM(model) {\n    if (!model) {\n        return Promise.resolve(null);\n    }\n    return _parser.parser.parse('pom', model.type, model);\n}\n\nfunction processChildNodes(items) {\n    if (!Array.isArray(items)) {\n        return Promise.resolve([]);\n    }\n    return Promise.all(items.map(function (item) {\n        return fromPOM(item);\n    })).then(function (items) {\n        return items.filter(function (item) {\n            return !!item;\n        });\n    });\n}\n\n_parser.parser.on('pom', 'document', function (token, data) {\n    return processChildNodes(data.items).then(function (items) {\n        return new _document.Document(items);\n    });\n});\n\n_parser.parser.on('pom', 'heading', function (token, data) {\n    return Promise.resolve(new _document.Heading(data.level, data.text, data.formats, data.attrs));\n});\n\n_parser.parser.on('pom', 'paragraph', function (token, data) {\n    return Promise.resolve(new _document.Paragraph(data.text, data.formats, data.attrs));\n});\n\n_parser.parser.on('pom', 'text', function (token, data) {\n    return Promise.resolve(new _document.TextNode(data.text, data.formats));\n});\n\n_parser.parser.on('pom', 'image', function (token, data) {\n    return Promise.resolve(new _document.Image(data.src, data.title, data.alt));\n});\n\n_parser.parser.on('pom', 'Fields', function (token, data) {\n    var fields = {};\n    return Promise.all(Object.keys(data).filter(function (key) {\n        return key !== 'type';\n    }).map(function (key) {\n        return fromPOM(data[key]).then(function (POM) {\n            fields[key] = POM;\n        });\n    })).then(function () {\n        return Promise.resolve(new _document.Fields(fields));\n    });\n});\n\n_parser.parser.on('pom', 'Variants', function (token, data) {\n    var variants = {};\n    return Promise.all(Object.keys(data).filter(function (key) {\n        return key !== 'type';\n    }).map(function (key) {\n        return fromPOM(data[key]).then(function (POM) {\n            variants[key] = POM;\n        });\n    })).then(function () {\n        return Promise.resolve(new _document.Variants(variants));\n    });\n});\n\n},{\"./../document\":18,\"./../parser\":23}],26:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.repository = exports.DEFAULT_DOCUMENT = exports.CHANGE = undefined;\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _emitter = require('./emitter');\n\nvar _jsondiffpatch = require('jsondiffpatch');\n\nvar _toPOM = require('./serializer/toPOM');\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; } /* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nvar CHANGE = exports.CHANGE = 'change';\nvar DEFAULT_DOCUMENT = exports.DEFAULT_DOCUMENT = '#default';\n\nvar Repository = function (_Emitter) {\n    _inherits(Repository, _Emitter);\n\n    function Repository() {\n        _classCallCheck(this, Repository);\n\n        var _this = _possibleConstructorReturn(this, Object.getPrototypeOf(Repository).call(this));\n\n        _this._documents = {};\n        return _this;\n    }\n\n    _createClass(Repository, [{\n        key: 'get',\n        value: function get(documentId) {\n            if (this._documents[documentId]) {\n                return this._documents[documentId].content;\n            }\n        }\n    }, {\n        key: 'set',\n        value: function set(documentId, value) {\n            var previous = this._documents[documentId] || {\n                initial: (0, _toPOM.toPOM)(value)\n            };\n            this._documents[documentId] = {\n                initial: previous.initial,\n                content: value\n            };\n            this.emit(CHANGE, {\n                id: documentId\n            });\n        }\n    }, {\n        key: 'has',\n        value: function has(documentId) {\n            return !!this._documents[documentId];\n        }\n    }, {\n        key: 'diff',\n        value: function diff(documentId) {\n            var _this2 = this;\n\n            if (!documentId) {\n                var _ret = function () {\n                    var result = {},\n                        self = _this2;\n                    return {\n                        v: Promise.all(Object.keys(_this2._documents).map(function (key) {\n                            return self.diff(key).then(function (delta) {\n                                result[key] = delta;\n                            });\n                        })).then(function () {\n                            return result;\n                        })\n                    };\n                }();\n\n                if ((typeof _ret === 'undefined' ? 'undefined' : _typeof(_ret)) === \"object\") return _ret.v;\n            }\n\n            return Promise.all([this._documents[documentId].initial, (0, _toPOM.toPOM)(this._documents[documentId].content)]).then(function (results) {\n                console.log(results);\n                return (0, _jsondiffpatch.diff)(results[0], results[1]);\n            });\n        }\n    }, {\n        key: 'toJSON',\n        value: function toJSON() {\n            var _this3 = this;\n\n            var data = {};\n            Object.keys(this._documents).forEach(function (key) {\n                //console.log(this._documents[key].content);\n                data[key] = {\n                    id: key,\n                    content: _this3._documents[key].content.toJSON()\n                };\n            });\n            return data;\n        }\n    }, {\n        key: 'main',\n        get: function get() {\n            return this._documents[DEFAULT_DOCUMENT];\n        }\n    }]);\n\n    return Repository;\n}(_emitter.Emitter);\n\nvar repository = exports.repository = new Repository();\n\n},{\"./emitter\":20,\"./serializer/toPOM\":29,\"jsondiffpatch\":14}],27:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nvar Serializer = function () {\n    function Serializer() {\n        _classCallCheck(this, Serializer);\n    }\n\n    _createClass(Serializer, [{\n        key: 'serialize',\n        value: function serialize(format, node, options) {\n\n            if (!node) {\n                return Promise.reject(new Error('Model is empty'));\n            }\n\n            if (!node.type) {\n                return Promise.reject(new Error('Undefined node type'));\n            }\n\n            return this.handle(format, node.type, node, options);\n        }\n    }, {\n        key: 'on',\n        value: function on(format, nodeType, handler) {\n            this._handlers = this._handlers || {};\n            this._handlers[format] = this._handlers[format] || {};\n            this._handlers[format][nodeType] = handler;\n        }\n    }, {\n        key: 'handle',\n        value: function handle(format, nodeType, node, options) {\n\n            var handler = this._handlers && this._handlers[format] && this._handlers[format][nodeType] ? this._handlers[format][nodeType] : null;\n            if (!handler) {\n                handler = this._handlers && this._handlers[format] && this._handlers[format]['*'] ? this._handlers[format]['*'] : null;\n                if (!handler) {\n                    return Promise.reject(new Error('No handler defined for ' + format + ' : ' + nodeType));\n                }\n            }\n            return handler(node, options).then(function (html) {\n                return html;\n            });\n        }\n    }, {\n        key: 'handleContents',\n        value: function handleContents(format, array, options) {\n            var self = this;\n            return Promise.all(array.map(function (content) {\n                return self.serialize('html', content, options);\n            }));\n        }\n    }]);\n\n    return Serializer;\n}();\n\nvar serializer = exports.serializer = new Serializer();\n\n},{}],28:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }(); /* jslint esnext:true, node:true */\n/* globals document */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nexports.toHTML = toHTML;\nexports.element = element;\n\nvar _serializer = require('./../serializer');\n\nvar _document = require('./../document');\n\nvar _util = require('./../util');\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction toHTML(model, options) {\n    return _serializer.serializer.serialize('html', model, options);\n}\n\nfunction otherAttrs(object, except) {\n    var result = {};\n    Object.keys(object).filter(function (key) {\n        return except.indexOf(key) === -1;\n    }).forEach(function (key) {\n        result[key] = object[key];\n    });\n    return result;\n}\n\nfunction format(string, formats) {\n    var wrapper = document.createElement('p'),\n        slices = string.split('').map(function (char) {\n        return {\n            char: char,\n            apply: []\n        };\n    });\n\n    slices.push({\n        char: '',\n        apply: []\n    });\n\n    formats.forEach(function (format) {\n        var from = format.slice[0],\n            to = from + format.slice[1];\n\n        format.apply.forEach(function (apply) {\n            if (slices[from].apply.indexOf(apply) == -1) {\n                slices[from].apply.push(apply);\n            }\n            if (slices[to].apply.indexOf('/' + apply) == -1) {\n                slices[to].apply.push('/' + apply);\n            }\n        });\n    });\n    wrapper.innerHTML = slices.map(function (char) {\n        return char.apply.map(function (tag) {\n            return '<' + tag + '>';\n        }).join('') + char.char;\n    }).join('');\n    return (0, _util.arraize)(wrapper.childNodes);\n}\n\nfunction element(node, nodeType, attributes, content, options) {\n\n    var promise = void 0;\n\n    if (content) {\n\n        promise = _serializer.serializer.handleContents('html', content || [], options);\n    } else {\n        promise = Promise.resolve(null);\n    }\n\n    return promise.then(function (content) {\n\n        if (node.formats && node.formats.length) {\n            content = format(content[0].nodeValue, node.formats);\n        }\n\n        var elem = document.createElement(nodeType);\n        if (options && options.edit) {\n            elem.setAttribute('data-skaryna-id', node.name);\n        }\n        if (attributes) {\n            Object.keys(attributes).forEach(function (attributeName) {\n                elem.setAttribute(attributeName, attributes[attributeName]);\n            });\n        }\n        if (Array.isArray(content)) {\n            content.forEach(function (child) {\n                return elem.appendChild(child);\n            });\n        }\n        return elem;\n    });\n}\n\nvar FakeDoc = function () {\n    function FakeDoc() {\n        _classCallCheck(this, FakeDoc);\n\n        this.children = [];\n    }\n\n    _createClass(FakeDoc, [{\n        key: 'appendChild',\n        value: function appendChild(child) {\n            this.children.push(child);\n        }\n    }, {\n        key: 'outerHTML',\n        get: function get() {\n            var str = '';\n            this.children.forEach(function (child) {\n                if (child.nodeType === 1) {\n                    str += child.outerHTML;\n                } else {\n                    str += child.textContent;\n                }\n            });\n            return str;\n        }\n    }]);\n\n    return FakeDoc;\n}();\n\n_serializer.serializer.on('html', 'document', function (node, options) {\n    return _serializer.serializer.handleContents('html', node.items || [], options).then(function (contents) {\n        var output = new FakeDoc();\n        if (Array.isArray(contents)) {\n            contents.forEach(function (child) {\n                return output.appendChild(child);\n            });\n        }\n        return output;\n    });\n});\n\n_serializer.serializer.on('html', 'heading', function (node, options) {\n    return element(node, 'h' + (node.level || 1), node.attr(), [new _document.TextNode(node.text, node.formats)], options);\n});\n\n_serializer.serializer.on('html', 'paragraph', function (node, options) {\n    return element(node, 'p', node.attr(), [new _document.TextNode(node.text, node.formats)], options);\n});\n\n_serializer.serializer.on('html', 'image', function (node, options) {\n    return element(node, 'img', node.attr(), null, options);\n});\n\n_serializer.serializer.on('html', 'text', function (node, options) {\n    var element = document.createTextNode(node.text);\n    if (options && options.edit) {\n        //element.setAttribute('name', node.name);\n    }\n    return Promise.resolve(element);\n});\n\n_serializer.serializer.on('html', '*', function (node, options) {\n    return element(node, node._type, node.attr(), node.items, options);\n});\n\n},{\"./../document\":18,\"./../serializer\":27,\"./../util\":31}],29:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.toPOM = toPOM;\n\nvar _serializer = require('./../serializer');\n\nfunction toPOM(model, options) {\n    return _serializer.serializer.serialize('pom', model, options);\n} /* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\n_serializer.serializer.on('pom', '*', function (node) {\n    return Promise.resolve(node.toJSON());\n});\n\n},{\"./../serializer\":27}],30:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nvar Toolbar = exports.Toolbar = function () {\n    function Toolbar() {\n        _classCallCheck(this, Toolbar);\n\n        //super();\n\n        this.element = document.createElement('div');\n        this.element.setAttribute('data-skaryna-toolbar', '');\n        this.element.innerHTML = '<div data-skaryna-toolbar-actions>aaaaaaaaa</div><div data-skaryna-toolbar-arrow><span></span></div>';\n        this.arrow = this.element.querySelector('[data-skaryna-toolbar-arrow]');\n\n        var styles = document.createElement('style');\n        styles.innerText = '\\n            [data-skaryna-toolbar] {\\n                position: absolute;\\n                visibility: hidden;\\n                display: none;\\n                z-index: 10000;\\n                transition: none;\\n                top: 0;\\n                left: 0;\\n            }\\n\\n            [data-skaryna-toolbar-actions] {\\n                position: relative;\\n                background-image: linear-gradient(to bottom,rgba(49,49,47,.99),#262625);\\n                background-repeat: repeat-x;\\n                border-radius: 5px;\\n            }\\n\\n            [data-skaryna-toolbar-arrow] {\\n                position: absolute;\\n                bottom: -10px;\\n                left: 50%;\\n                clip: rect(10px 20px 20px 0);\\n                margin-left: -10px;\\n            }\\n\\n            [data-skaryna-toolbar-arrow] > span {\\n                display: block;\\n                width: 20px;\\n                height: 20px;\\n                background-color: #262625;\\n                transform: rotate(45deg) scale(.5);\\n            }\\n            ';\n\n        document.body.appendChild(styles);\n        document.body.appendChild(this.element);\n    }\n\n    _createClass(Toolbar, [{\n        key: 'getSelectionCoords',\n        value: function getSelectionCoords(theWindow) {\n            var win = theWindow || window,\n                doc = win.document,\n                sel = doc.selection,\n                range = void 0,\n                rects = void 0,\n                rect = void 0,\n                x = 0,\n                y = 0;\n            if (sel) {\n                if (sel.type != \"Control\") {\n                    range = sel.createRange();\n                    range.collapse(true);\n                    x = range.boundingLeft;\n                    y = range.boundingTop;\n                }\n            } else if (win.getSelection) {\n                sel = win.getSelection();\n                if (sel.rangeCount) {\n                    range = sel.getRangeAt(0).cloneRange();\n                    if (range.getClientRects) {\n                        range.collapse(true);\n                        rects = range.getClientRects();\n\n                        if (rects.length > 0) {\n                            rect = rects[0];\n                        }\n                        x = rect.left;\n                        y = rect.top;\n                    }\n                    // Fall back to inserting a temporary element\n                    if (x == 0 && y == 0) {\n                        var span = doc.createElement(\"span\");\n                        if (span.getClientRects) {\n                            // Ensure span has dimensions and position by\n                            // adding a zero-width space character\n                            span.appendChild(doc.createTextNode(''));\n                            range.insertNode(span);\n                            rect = span.getClientRects()[0];\n                            x = rect.left;\n                            y = rect.top;\n                            var spanParent = span.parentNode;\n                            spanParent.removeChild(span);\n\n                            // Glue any broken text nodes back together\n                            spanParent.normalize();\n                        }\n                    }\n                }\n            }\n            return {\n                x: x,\n                y: y\n            };\n        }\n    }, {\n        key: 'anchor',\n        value: function anchor() {\n            var _this = this;\n\n            var coords = this.getSelectionCoords(),\n                self = this,\n                rect = void 0,\n                arrow = void 0;\n            this.element.style.display = 'block';\n            this.element.style.visibility = 'visible';\n\n            setTimeout(function () {\n                rect = _this.element.getBoundingClientRect();\n                arrow = _this.arrow.getBoundingClientRect();\n                _this.show(coords.x, coords.y - rect.height - 10);\n            }, 1);\n        }\n    }, {\n        key: 'show',\n        value: function show(x, y) {\n            this.element.style.top = y + 'px';\n            this.element.style.left = x + 'px';\n        }\n    }, {\n        key: 'hide',\n        value: function hide() {\n            this.element.style.display = null;\n            this.element.style.visibility = null;\n        }\n    }]);\n\n    return Toolbar;\n}();\n\n},{}],31:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol ? \"symbol\" : typeof obj; };\n\nexports.arraize = arraize;\nexports.clone = clone;\n/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\n/**\n * Convert iterable objects into arrays\n * @param   {Iterable} iterable\n * @returns {Array}\n */\nfunction arraize(iterable) {\n    return [].slice.apply(iterable);\n}\n\nfunction clone(inputs, except) {\n    var result = {};\n    inputs.forEach(function (input) {\n        if ((typeof input === 'undefined' ? 'undefined' : _typeof(input)) !== 'object') {\n            return;\n        }\n        Object.keys(input).forEach(function (key) {\n            if (except && except.indexOf(key) !== -1) {\n                return;\n            }\n            result[key] = JSON.parse(JSON.stringify(input[key]));\n        });\n    });\n    return result;\n}\n\n},{}],32:[function(require,module,exports){\n'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\n/* jslint esnext:true, node:true, browser:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nvar XHR = exports.XHR = function () {\n  function XHR() {\n    _classCallCheck(this, XHR);\n  }\n\n  _createClass(XHR, null, [{\n    key: 'ajax',\n    value: function ajax(path, method, data, raw) {\n\n      return new Promise(function (resolve, reject) {\n\n        var xhr = new XMLHttpRequest(),\n            httpMethod = method.toLowerCase();\n\n        xhr.open(httpMethod, path);\n        if (httpMethod === 'post' || httpMethod === 'put') {\n          xhr.setRequestHeader('Content-type', 'application/json');\n        }\n\n        xhr.onreadystatechange = function () {\n          var DONE = 4,\n              // readyState 4 means the request is done.\n          OK = 200; // status 200 is a successful return.\n          if (xhr.readyState === DONE) {\n            if (xhr.status === OK) {\n              resolve(xhr.responseText); // 'This is the returned text.'\n            } else if (xhr.status === '204') {\n                resolve(null);\n              } else {\n                reject(new Error('Error: ' + xhr.status)); // An error occurred during the request.\n              }\n          }\n        };\n\n        xhr.send(data ? raw ? data : JSON.stringify(data) : null);\n      });\n    }\n  }, {\n    key: 'get',\n    value: function get(path, raw) {\n      return XHR.ajax(path, 'get', null, raw);\n    }\n  }, {\n    key: 'post',\n    value: function post(path, data, raw) {\n      return XHR.ajax(path, 'post', data, raw);\n    }\n  }, {\n    key: 'put',\n    value: function put(path, data, raw) {\n      return XHR.ajax(path, 'put', data, raw);\n    }\n  }, {\n    key: 'delete',\n    value: function _delete(path, raw) {\n      return XHR.ajax(path, 'delete', null, raw);\n    }\n  }]);\n\n  return XHR;\n}();\n\n},{}]},{},[17])\n\n","var Context = require('./context').Context;\nvar dateReviver = require('../date-reviver');\n\nvar DiffContext = function DiffContext(left, right) {\n  this.left = left;\n  this.right = right;\n  this.pipe = 'diff';\n};\n\nDiffContext.prototype = new Context();\n\nDiffContext.prototype.setResult = function(result) {\n  if (this.options.cloneDiffValues) {\n    var clone = typeof this.options.cloneDiffValues === 'function' ?\n      this.options.cloneDiffValues : function(value) {\n        return JSON.parse(JSON.stringify(value), dateReviver);\n      };\n    if (typeof result[0] === 'object') {\n      result[0] = clone(result[0]);\n    }\n    if (typeof result[1] === 'object') {\n      result[1] = clone(result[1]);\n    }\n  }\n  return Context.prototype.setResult.apply(this, arguments);\n};\n\nexports.DiffContext = DiffContext;\n","var Context = require('./context').Context;\n\nvar PatchContext = function PatchContext(left, delta) {\n  this.left = left;\n  this.delta = delta;\n  this.pipe = 'patch';\n};\n\nPatchContext.prototype = new Context();\n\nexports.PatchContext = PatchContext;\n","var Context = require('./context').Context;\n\nvar ReverseContext = function ReverseContext(delta) {\n  this.delta = delta;\n  this.pipe = 'reverse';\n};\n\nReverseContext.prototype = new Context();\n\nexports.ReverseContext = ReverseContext;\n","// use as 2nd parameter for JSON.parse to revive Date instances\nmodule.exports = function dateReviver(key, value) {\n  var parts;\n  if (typeof value === 'string') {\n    parts = /^(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})(?:\\.(\\d*))?(Z|([+\\-])(\\d{2}):(\\d{2}))$/.exec(value);\n    if (parts) {\n      return new Date(Date.UTC(+parts[1], +parts[2] - 1, +parts[3], +parts[4], +parts[5], +parts[6], +(parts[7] || 0)));\n    }\n  }\n  return value;\n};\n","var Processor = require('./processor').Processor;\nvar Pipe = require('./pipe').Pipe;\nvar DiffContext = require('./contexts/diff').DiffContext;\nvar PatchContext = require('./contexts/patch').PatchContext;\nvar ReverseContext = require('./contexts/reverse').ReverseContext;\n\nvar trivial = require('./filters/trivial');\nvar nested = require('./filters/nested');\nvar arrays = require('./filters/arrays');\nvar dates = require('./filters/dates');\nvar texts = require('./filters/texts');\n\nvar DiffPatcher = function DiffPatcher(options) {\n  this.processor = new Processor(options);\n  this.processor.pipe(new Pipe('diff').append(\n    nested.collectChildrenDiffFilter,\n    trivial.diffFilter,\n    dates.diffFilter,\n    texts.diffFilter,\n    nested.objectsDiffFilter,\n    arrays.diffFilter\n  ).shouldHaveResult());\n  this.processor.pipe(new Pipe('patch').append(\n    nested.collectChildrenPatchFilter,\n    arrays.collectChildrenPatchFilter,\n    trivial.patchFilter,\n    texts.patchFilter,\n    nested.patchFilter,\n    arrays.patchFilter\n  ).shouldHaveResult());\n  this.processor.pipe(new Pipe('reverse').append(\n    nested.collectChildrenReverseFilter,\n    arrays.collectChildrenReverseFilter,\n    trivial.reverseFilter,\n    texts.reverseFilter,\n    nested.reverseFilter,\n    arrays.reverseFilter\n  ).shouldHaveResult());\n};\n\nDiffPatcher.prototype.options = function() {\n  return this.processor.options.apply(this.processor, arguments);\n};\n\nDiffPatcher.prototype.diff = function(left, right) {\n  return this.processor.process(new DiffContext(left, right));\n};\n\nDiffPatcher.prototype.patch = function(left, delta) {\n  return this.processor.process(new PatchContext(left, delta));\n};\n\nDiffPatcher.prototype.reverse = function(delta) {\n  return this.processor.process(new ReverseContext(delta));\n};\n\nDiffPatcher.prototype.unpatch = function(right, delta) {\n  return this.patch(right, this.reverse(delta));\n};\n\nexports.DiffPatcher = DiffPatcher;\n","\nexports.isBrowser = typeof window !== 'undefined';\n","var DiffContext = require('../contexts/diff').DiffContext;\nvar PatchContext = require('../contexts/patch').PatchContext;\nvar ReverseContext = require('../contexts/reverse').ReverseContext;\n\nvar lcs = require('./lcs');\n\nvar ARRAY_MOVE = 3;\n\nvar isArray = (typeof Array.isArray === 'function') ?\n  // use native function\n  Array.isArray :\n  // use instanceof operator\n  function(a) {\n    return a instanceof Array;\n  };\n\nvar arrayIndexOf = typeof Array.prototype.indexOf === 'function' ?\n  function(array, item) {\n    return array.indexOf(item);\n  } : function(array, item) {\n    var length = array.length;\n    for (var i = 0; i < length; i++) {\n      if (array[i] === item) {\n        return i;\n      }\n    }\n    return -1;\n  };\n\nfunction arraysHaveMatchByRef(array1, array2, len1, len2) {\n  for (var index1 = 0; index1 < len1; index1++) {\n    var val1 = array1[index1];\n    for (var index2 = 0; index2 < len2; index2++) {\n      var val2 = array2[index2];\n      if (val1 === val2) {\n        return true;\n      }\n    }\n  }\n}\n\nfunction matchItems(array1, array2, index1, index2, context) {\n  var value1 = array1[index1];\n  var value2 = array2[index2];\n  if (value1 === value2) {\n    return true;\n  }\n  if (typeof value1 !== 'object' || typeof value2 !== 'object') {\n    return false;\n  }\n  var objectHash = context.objectHash;\n  if (!objectHash) {\n    // no way to match objects was provided, try match by position\n    return context.matchByPosition && index1 === index2;\n  }\n  var hash1;\n  var hash2;\n  if (typeof index1 === 'number') {\n    context.hashCache1 = context.hashCache1 || [];\n    hash1 = context.hashCache1[index1];\n    if (typeof hash1 === 'undefined') {\n      context.hashCache1[index1] = hash1 = objectHash(value1, index1);\n    }\n  } else {\n    hash1 = objectHash(value1);\n  }\n  if (typeof hash1 === 'undefined') {\n    return false;\n  }\n  if (typeof index2 === 'number') {\n    context.hashCache2 = context.hashCache2 || [];\n    hash2 = context.hashCache2[index2];\n    if (typeof hash2 === 'undefined') {\n      context.hashCache2[index2] = hash2 = objectHash(value2, index2);\n    }\n  } else {\n    hash2 = objectHash(value2);\n  }\n  if (typeof hash2 === 'undefined') {\n    return false;\n  }\n  return hash1 === hash2;\n}\n\nvar diffFilter = function arraysDiffFilter(context) {\n  if (!context.leftIsArray) {\n    return;\n  }\n\n  var matchContext = {\n    objectHash: context.options && context.options.objectHash,\n    matchByPosition: context.options && context.options.matchByPosition\n  };\n  var commonHead = 0;\n  var commonTail = 0;\n  var index;\n  var index1;\n  var index2;\n  var array1 = context.left;\n  var array2 = context.right;\n  var len1 = array1.length;\n  var len2 = array2.length;\n\n  var child;\n\n  if (len1 > 0 && len2 > 0 && !matchContext.objectHash &&\n    typeof matchContext.matchByPosition !== 'boolean') {\n    matchContext.matchByPosition = !arraysHaveMatchByRef(array1, array2, len1, len2);\n  }\n\n  // separate common head\n  while (commonHead < len1 && commonHead < len2 &&\n    matchItems(array1, array2, commonHead, commonHead, matchContext)) {\n    index = commonHead;\n    child = new DiffContext(context.left[index], context.right[index]);\n    context.push(child, index);\n    commonHead++;\n  }\n  // separate common tail\n  while (commonTail + commonHead < len1 && commonTail + commonHead < len2 &&\n    matchItems(array1, array2, len1 - 1 - commonTail, len2 - 1 - commonTail, matchContext)) {\n    index1 = len1 - 1 - commonTail;\n    index2 = len2 - 1 - commonTail;\n    child = new DiffContext(context.left[index1], context.right[index2]);\n    context.push(child, index2);\n    commonTail++;\n  }\n  var result;\n  if (commonHead + commonTail === len1) {\n    if (len1 === len2) {\n      // arrays are identical\n      context.setResult(undefined).exit();\n      return;\n    }\n    // trivial case, a block (1 or more consecutive items) was added\n    result = result || {\n      _t: 'a'\n    };\n    for (index = commonHead; index < len2 - commonTail; index++) {\n      result[index] = [array2[index]];\n    }\n    context.setResult(result).exit();\n    return;\n  }\n  if (commonHead + commonTail === len2) {\n    // trivial case, a block (1 or more consecutive items) was removed\n    result = result || {\n      _t: 'a'\n    };\n    for (index = commonHead; index < len1 - commonTail; index++) {\n      result['_' + index] = [array1[index], 0, 0];\n    }\n    context.setResult(result).exit();\n    return;\n  }\n  // reset hash cache\n  delete matchContext.hashCache1;\n  delete matchContext.hashCache2;\n\n  // diff is not trivial, find the LCS (Longest Common Subsequence)\n  var trimmed1 = array1.slice(commonHead, len1 - commonTail);\n  var trimmed2 = array2.slice(commonHead, len2 - commonTail);\n  var seq = lcs.get(\n    trimmed1, trimmed2,\n    matchItems,\n    matchContext\n  );\n  var removedItems = [];\n  result = result || {\n    _t: 'a'\n  };\n  for (index = commonHead; index < len1 - commonTail; index++) {\n    if (arrayIndexOf(seq.indices1, index - commonHead) < 0) {\n      // removed\n      result['_' + index] = [array1[index], 0, 0];\n      removedItems.push(index);\n    }\n  }\n\n  var detectMove = true;\n  if (context.options && context.options.arrays && context.options.arrays.detectMove === false) {\n    detectMove = false;\n  }\n  var includeValueOnMove = false;\n  if (context.options && context.options.arrays && context.options.arrays.includeValueOnMove) {\n    includeValueOnMove = true;\n  }\n\n  var removedItemsLength = removedItems.length;\n  for (index = commonHead; index < len2 - commonTail; index++) {\n    var indexOnArray2 = arrayIndexOf(seq.indices2, index - commonHead);\n    if (indexOnArray2 < 0) {\n      // added, try to match with a removed item and register as position move\n      var isMove = false;\n      if (detectMove && removedItemsLength > 0) {\n        for (var removeItemIndex1 = 0; removeItemIndex1 < removedItemsLength; removeItemIndex1++) {\n          index1 = removedItems[removeItemIndex1];\n          if (matchItems(trimmed1, trimmed2, index1 - commonHead,\n            index - commonHead, matchContext)) {\n            // store position move as: [originalValue, newPosition, ARRAY_MOVE]\n            result['_' + index1].splice(1, 2, index, ARRAY_MOVE);\n            if (!includeValueOnMove) {\n              // don't include moved value on diff, to save bytes\n              result['_' + index1][0] = '';\n            }\n\n            index2 = index;\n            child = new DiffContext(context.left[index1], context.right[index2]);\n            context.push(child, index2);\n            removedItems.splice(removeItemIndex1, 1);\n            isMove = true;\n            break;\n          }\n        }\n      }\n      if (!isMove) {\n        // added\n        result[index] = [array2[index]];\n      }\n    } else {\n      // match, do inner diff\n      index1 = seq.indices1[indexOnArray2] + commonHead;\n      index2 = seq.indices2[indexOnArray2] + commonHead;\n      child = new DiffContext(context.left[index1], context.right[index2]);\n      context.push(child, index2);\n    }\n  }\n\n  context.setResult(result).exit();\n\n};\ndiffFilter.filterName = 'arrays';\n\nvar compare = {\n  numerically: function(a, b) {\n    return a - b;\n  },\n  numericallyBy: function(name) {\n    return function(a, b) {\n      return a[name] - b[name];\n    };\n  }\n};\n\nvar patchFilter = function nestedPatchFilter(context) {\n  if (!context.nested) {\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var index, index1;\n\n  var delta = context.delta;\n  var array = context.left;\n\n  // first, separate removals, insertions and modifications\n  var toRemove = [];\n  var toInsert = [];\n  var toModify = [];\n  for (index in delta) {\n    if (index !== '_t') {\n      if (index[0] === '_') {\n        // removed item from original array\n        if (delta[index][2] === 0 || delta[index][2] === ARRAY_MOVE) {\n          toRemove.push(parseInt(index.slice(1), 10));\n        } else {\n          throw new Error('only removal or move can be applied at original array indices' +\n            ', invalid diff type: ' + delta[index][2]);\n        }\n      } else {\n        if (delta[index].length === 1) {\n          // added item at new array\n          toInsert.push({\n            index: parseInt(index, 10),\n            value: delta[index][0]\n          });\n        } else {\n          // modified item at new array\n          toModify.push({\n            index: parseInt(index, 10),\n            delta: delta[index]\n          });\n        }\n      }\n    }\n  }\n\n  // remove items, in reverse order to avoid sawing our own floor\n  toRemove = toRemove.sort(compare.numerically);\n  for (index = toRemove.length - 1; index >= 0; index--) {\n    index1 = toRemove[index];\n    var indexDiff = delta['_' + index1];\n    var removedValue = array.splice(index1, 1)[0];\n    if (indexDiff[2] === ARRAY_MOVE) {\n      // reinsert later\n      toInsert.push({\n        index: indexDiff[1],\n        value: removedValue\n      });\n    }\n  }\n\n  // insert items, in reverse order to avoid moving our own floor\n  toInsert = toInsert.sort(compare.numericallyBy('index'));\n  var toInsertLength = toInsert.length;\n  for (index = 0; index < toInsertLength; index++) {\n    var insertion = toInsert[index];\n    array.splice(insertion.index, 0, insertion.value);\n  }\n\n  // apply modifications\n  var toModifyLength = toModify.length;\n  var child;\n  if (toModifyLength > 0) {\n    for (index = 0; index < toModifyLength; index++) {\n      var modification = toModify[index];\n      child = new PatchContext(context.left[modification.index], modification.delta);\n      context.push(child, modification.index);\n    }\n  }\n\n  if (!context.children) {\n    context.setResult(context.left).exit();\n    return;\n  }\n  context.exit();\n};\npatchFilter.filterName = 'arrays';\n\nvar collectChildrenPatchFilter = function collectChildrenPatchFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    context.left[child.childName] = child.result;\n  }\n  context.setResult(context.left).exit();\n};\ncollectChildrenPatchFilter.filterName = 'arraysCollectChildren';\n\nvar reverseFilter = function arraysReverseFilter(context) {\n  if (!context.nested) {\n    if (context.delta[2] === ARRAY_MOVE) {\n      context.newName = '_' + context.delta[1];\n      context.setResult([context.delta[0], parseInt(context.childName.substr(1), 10), ARRAY_MOVE]).exit();\n    }\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var name, child;\n  for (name in context.delta) {\n    if (name === '_t') {\n      continue;\n    }\n    child = new ReverseContext(context.delta[name]);\n    context.push(child, name);\n  }\n  context.exit();\n};\nreverseFilter.filterName = 'arrays';\n\nvar reverseArrayDeltaIndex = function(delta, index, itemDelta) {\n  if (typeof index === 'string' && index[0] === '_') {\n    return parseInt(index.substr(1), 10);\n  } else if (isArray(itemDelta) && itemDelta[2] === 0) {\n    return '_' + index;\n  }\n\n  var reverseIndex = +index;\n  for (var deltaIndex in delta) {\n    var deltaItem = delta[deltaIndex];\n    if (isArray(deltaItem)) {\n      if (deltaItem[2] === ARRAY_MOVE) {\n        var moveFromIndex = parseInt(deltaIndex.substr(1), 10);\n        var moveToIndex = deltaItem[1];\n        if (moveToIndex === +index) {\n          return moveFromIndex;\n        }\n        if (moveFromIndex <= reverseIndex && moveToIndex > reverseIndex) {\n          reverseIndex++;\n        } else if (moveFromIndex >= reverseIndex && moveToIndex < reverseIndex) {\n          reverseIndex--;\n        }\n      } else if (deltaItem[2] === 0) {\n        var deleteIndex = parseInt(deltaIndex.substr(1), 10);\n        if (deleteIndex <= reverseIndex) {\n          reverseIndex++;\n        }\n      } else if (deltaItem.length === 1 && deltaIndex <= reverseIndex) {\n        reverseIndex--;\n      }\n    }\n  }\n\n  return reverseIndex;\n};\n\nvar collectChildrenReverseFilter = function collectChildrenReverseFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t !== 'a') {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  var delta = {\n    _t: 'a'\n  };\n\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    var name = child.newName;\n    if (typeof name === 'undefined') {\n      name = reverseArrayDeltaIndex(context.delta, child.childName, child.result);\n    }\n    if (delta[name] !== child.result) {\n      delta[name] = child.result;\n    }\n  }\n  context.setResult(delta).exit();\n};\ncollectChildrenReverseFilter.filterName = 'arraysCollectChildren';\n\nexports.diffFilter = diffFilter;\nexports.patchFilter = patchFilter;\nexports.collectChildrenPatchFilter = collectChildrenPatchFilter;\nexports.reverseFilter = reverseFilter;\nexports.collectChildrenReverseFilter = collectChildrenReverseFilter;\n","var diffFilter = function datesDiffFilter(context) {\n  if (context.left instanceof Date) {\n    if (context.right instanceof Date) {\n      if (context.left.getTime() !== context.right.getTime()) {\n        context.setResult([context.left, context.right]);\n      } else {\n        context.setResult(undefined);\n      }\n    } else {\n      context.setResult([context.left, context.right]);\n    }\n    context.exit();\n  } else if (context.right instanceof Date) {\n    context.setResult([context.left, context.right]).exit();\n  }\n};\ndiffFilter.filterName = 'dates';\n\nexports.diffFilter = diffFilter;\n","/*\n\nLCS implementation that supports arrays or strings\n\nreference: http://en.wikipedia.org/wiki/Longest_common_subsequence_problem\n\n*/\n\nvar defaultMatch = function(array1, array2, index1, index2) {\n  return array1[index1] === array2[index2];\n};\n\nvar lengthMatrix = function(array1, array2, match, context) {\n  var len1 = array1.length;\n  var len2 = array2.length;\n  var x, y;\n\n  // initialize empty matrix of len1+1 x len2+1\n  var matrix = [len1 + 1];\n  for (x = 0; x < len1 + 1; x++) {\n    matrix[x] = [len2 + 1];\n    for (y = 0; y < len2 + 1; y++) {\n      matrix[x][y] = 0;\n    }\n  }\n  matrix.match = match;\n  // save sequence lengths for each coordinate\n  for (x = 1; x < len1 + 1; x++) {\n    for (y = 1; y < len2 + 1; y++) {\n      if (match(array1, array2, x - 1, y - 1, context)) {\n        matrix[x][y] = matrix[x - 1][y - 1] + 1;\n      } else {\n        matrix[x][y] = Math.max(matrix[x - 1][y], matrix[x][y - 1]);\n      }\n    }\n  }\n  return matrix;\n};\n\nvar backtrack = function(matrix, array1, array2, index1, index2, context) {\n  if (index1 === 0 || index2 === 0) {\n    return {\n      sequence: [],\n      indices1: [],\n      indices2: []\n    };\n  }\n\n  if (matrix.match(array1, array2, index1 - 1, index2 - 1, context)) {\n    var subsequence = backtrack(matrix, array1, array2, index1 - 1, index2 - 1, context);\n    subsequence.sequence.push(array1[index1 - 1]);\n    subsequence.indices1.push(index1 - 1);\n    subsequence.indices2.push(index2 - 1);\n    return subsequence;\n  }\n\n  if (matrix[index1][index2 - 1] > matrix[index1 - 1][index2]) {\n    return backtrack(matrix, array1, array2, index1, index2 - 1, context);\n  } else {\n    return backtrack(matrix, array1, array2, index1 - 1, index2, context);\n  }\n};\n\nvar get = function(array1, array2, match, context) {\n  context = context || {};\n  var matrix = lengthMatrix(array1, array2, match || defaultMatch, context);\n  var result = backtrack(matrix, array1, array2, array1.length, array2.length, context);\n  if (typeof array1 === 'string' && typeof array2 === 'string') {\n    result.sequence = result.sequence.join('');\n  }\n  return result;\n};\n\nexports.get = get;\n","var DiffContext = require('../contexts/diff').DiffContext;\nvar PatchContext = require('../contexts/patch').PatchContext;\nvar ReverseContext = require('../contexts/reverse').ReverseContext;\n\nvar collectChildrenDiffFilter = function collectChildrenDiffFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  var result = context.result;\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    if (typeof child.result === 'undefined') {\n      continue;\n    }\n    result = result || {};\n    result[child.childName] = child.result;\n  }\n  if (result && context.leftIsArray) {\n    result._t = 'a';\n  }\n  context.setResult(result).exit();\n};\ncollectChildrenDiffFilter.filterName = 'collectChildren';\n\nvar objectsDiffFilter = function objectsDiffFilter(context) {\n  if (context.leftIsArray || context.leftType !== 'object') {\n    return;\n  }\n\n  var name, child, propertyFilter = context.options.propertyFilter;\n  for (name in context.left) {\n    if (!Object.prototype.hasOwnProperty.call(context.left, name)) {\n      continue;\n    }\n    if (propertyFilter && !propertyFilter(name, context)) {\n      continue;\n    }\n    child = new DiffContext(context.left[name], context.right[name]);\n    context.push(child, name);\n  }\n  for (name in context.right) {\n    if (!Object.prototype.hasOwnProperty.call(context.right, name)) {\n      continue;\n    }\n    if (propertyFilter && !propertyFilter(name, context)) {\n      continue;\n    }\n    if (typeof context.left[name] === 'undefined') {\n      child = new DiffContext(undefined, context.right[name]);\n      context.push(child, name);\n    }\n  }\n\n  if (!context.children || context.children.length === 0) {\n    context.setResult(undefined).exit();\n    return;\n  }\n  context.exit();\n};\nobjectsDiffFilter.filterName = 'objects';\n\nvar patchFilter = function nestedPatchFilter(context) {\n  if (!context.nested) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var name, child;\n  for (name in context.delta) {\n    child = new PatchContext(context.left[name], context.delta[name]);\n    context.push(child, name);\n  }\n  context.exit();\n};\npatchFilter.filterName = 'objects';\n\nvar collectChildrenPatchFilter = function collectChildrenPatchFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    if (Object.prototype.hasOwnProperty.call(context.left, child.childName) && child.result === undefined) {\n      delete context.left[child.childName];\n    } else if (context.left[child.childName] !== child.result) {\n      context.left[child.childName] = child.result;\n    }\n  }\n  context.setResult(context.left).exit();\n};\ncollectChildrenPatchFilter.filterName = 'collectChildren';\n\nvar reverseFilter = function nestedReverseFilter(context) {\n  if (!context.nested) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var name, child;\n  for (name in context.delta) {\n    child = new ReverseContext(context.delta[name]);\n    context.push(child, name);\n  }\n  context.exit();\n};\nreverseFilter.filterName = 'objects';\n\nvar collectChildrenReverseFilter = function collectChildrenReverseFilter(context) {\n  if (!context || !context.children) {\n    return;\n  }\n  if (context.delta._t) {\n    return;\n  }\n  var length = context.children.length;\n  var child;\n  var delta = {};\n  for (var index = 0; index < length; index++) {\n    child = context.children[index];\n    if (delta[child.childName] !== child.result) {\n      delta[child.childName] = child.result;\n    }\n  }\n  context.setResult(delta).exit();\n};\ncollectChildrenReverseFilter.filterName = 'collectChildren';\n\nexports.collectChildrenDiffFilter = collectChildrenDiffFilter;\nexports.objectsDiffFilter = objectsDiffFilter;\nexports.patchFilter = patchFilter;\nexports.collectChildrenPatchFilter = collectChildrenPatchFilter;\nexports.reverseFilter = reverseFilter;\nexports.collectChildrenReverseFilter = collectChildrenReverseFilter;\n","/* global diff_match_patch */\nvar TEXT_DIFF = 2;\nvar DEFAULT_MIN_LENGTH = 60;\nvar cachedDiffPatch = null;\n\nvar getDiffMatchPatch = function(required) {\n  /*jshint camelcase: false */\n\n  if (!cachedDiffPatch) {\n    var instance;\n    if (typeof diff_match_patch !== 'undefined') {\n      // already loaded, probably a browser\n      instance = typeof diff_match_patch === 'function' ?\n        new diff_match_patch() : new diff_match_patch.diff_match_patch();\n    } else if (typeof require === 'function') {\n      try {\n        var dmpModuleName = 'diff_match_patch_uncompressed';\n        var dmp = require('../../public/external/' + dmpModuleName);\n        instance = new dmp.diff_match_patch();\n      } catch (err) {\n        instance = null;\n      }\n    }\n    if (!instance) {\n      if (!required) {\n        return null;\n      }\n      var error = new Error('text diff_match_patch library not found');\n      error.diff_match_patch_not_found = true;\n      throw error;\n    }\n    cachedDiffPatch = {\n      diff: function(txt1, txt2) {\n        return instance.patch_toText(instance.patch_make(txt1, txt2));\n      },\n      patch: function(txt1, patch) {\n        var results = instance.patch_apply(instance.patch_fromText(patch), txt1);\n        for (var i = 0; i < results[1].length; i++) {\n          if (!results[1][i]) {\n            var error = new Error('text patch failed');\n            error.textPatchFailed = true;\n          }\n        }\n        return results[0];\n      }\n    };\n  }\n  return cachedDiffPatch;\n};\n\nvar diffFilter = function textsDiffFilter(context) {\n  if (context.leftType !== 'string') {\n    return;\n  }\n  var minLength = (context.options && context.options.textDiff &&\n    context.options.textDiff.minLength) || DEFAULT_MIN_LENGTH;\n  if (context.left.length < minLength ||\n    context.right.length < minLength) {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n  // large text, try to use a text-diff algorithm\n  var diffMatchPatch = getDiffMatchPatch();\n  if (!diffMatchPatch) {\n    // diff-match-patch library not available, fallback to regular string replace\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n  var diff = diffMatchPatch.diff;\n  context.setResult([diff(context.left, context.right), 0, TEXT_DIFF]).exit();\n};\ndiffFilter.filterName = 'texts';\n\nvar patchFilter = function textsPatchFilter(context) {\n  if (context.nested) {\n    return;\n  }\n  if (context.delta[2] !== TEXT_DIFF) {\n    return;\n  }\n\n  // text-diff, use a text-patch algorithm\n  var patch = getDiffMatchPatch(true).patch;\n  context.setResult(patch(context.left, context.delta[0])).exit();\n};\npatchFilter.filterName = 'texts';\n\nvar textDeltaReverse = function(delta) {\n  var i, l, lines, line, lineTmp, header = null,\n    headerRegex = /^@@ +\\-(\\d+),(\\d+) +\\+(\\d+),(\\d+) +@@$/,\n    lineHeader, lineAdd, lineRemove;\n  lines = delta.split('\\n');\n  for (i = 0, l = lines.length; i < l; i++) {\n    line = lines[i];\n    var lineStart = line.slice(0, 1);\n    if (lineStart === '@') {\n      header = headerRegex.exec(line);\n      lineHeader = i;\n      lineAdd = null;\n      lineRemove = null;\n\n      // fix header\n      lines[lineHeader] = '@@ -' + header[3] + ',' + header[4] + ' +' + header[1] + ',' + header[2] + ' @@';\n    } else if (lineStart === '+') {\n      lineAdd = i;\n      lines[i] = '-' + lines[i].slice(1);\n      if (lines[i - 1].slice(0, 1) === '+') {\n        // swap lines to keep default order (-+)\n        lineTmp = lines[i];\n        lines[i] = lines[i - 1];\n        lines[i - 1] = lineTmp;\n      }\n    } else if (lineStart === '-') {\n      lineRemove = i;\n      lines[i] = '+' + lines[i].slice(1);\n    }\n  }\n  return lines.join('\\n');\n};\n\nvar reverseFilter = function textsReverseFilter(context) {\n  if (context.nested) {\n    return;\n  }\n  if (context.delta[2] !== TEXT_DIFF) {\n    return;\n  }\n\n  // text-diff, use a text-diff algorithm\n  context.setResult([textDeltaReverse(context.delta[0]), 0, TEXT_DIFF]).exit();\n};\nreverseFilter.filterName = 'texts';\n\nexports.diffFilter = diffFilter;\nexports.patchFilter = patchFilter;\nexports.reverseFilter = reverseFilter;\n","var isArray = (typeof Array.isArray === 'function') ?\n  // use native function\n  Array.isArray :\n  // use instanceof operator\n  function(a) {\n    return a instanceof Array;\n  };\n\nvar diffFilter = function trivialMatchesDiffFilter(context) {\n  if (context.left === context.right) {\n    context.setResult(undefined).exit();\n    return;\n  }\n  if (typeof context.left === 'undefined') {\n    if (typeof context.right === 'function') {\n      throw new Error('functions are not supported');\n    }\n    context.setResult([context.right]).exit();\n    return;\n  }\n  if (typeof context.right === 'undefined') {\n    context.setResult([context.left, 0, 0]).exit();\n    return;\n  }\n  if (typeof context.left === 'function' || typeof context.right === 'function') {\n    throw new Error('functions are not supported');\n  }\n  context.leftType = context.left === null ? 'null' : typeof context.left;\n  context.rightType = context.right === null ? 'null' : typeof context.right;\n  if (context.leftType !== context.rightType) {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n  if (context.leftType === 'boolean' || context.leftType === 'number') {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n  if (context.leftType === 'object') {\n    context.leftIsArray = isArray(context.left);\n  }\n  if (context.rightType === 'object') {\n    context.rightIsArray = isArray(context.right);\n  }\n  if (context.leftIsArray !== context.rightIsArray) {\n    context.setResult([context.left, context.right]).exit();\n    return;\n  }\n};\ndiffFilter.filterName = 'trivial';\n\nvar patchFilter = function trivialMatchesPatchFilter(context) {\n  if (typeof context.delta === 'undefined') {\n    context.setResult(context.left).exit();\n    return;\n  }\n  context.nested = !isArray(context.delta);\n  if (context.nested) {\n    return;\n  }\n  if (context.delta.length === 1) {\n    context.setResult(context.delta[0]).exit();\n    return;\n  }\n  if (context.delta.length === 2) {\n    context.setResult(context.delta[1]).exit();\n    return;\n  }\n  if (context.delta.length === 3 && context.delta[2] === 0) {\n    context.setResult(undefined).exit();\n    return;\n  }\n};\npatchFilter.filterName = 'trivial';\n\nvar reverseFilter = function trivialReferseFilter(context) {\n  if (typeof context.delta === 'undefined') {\n    context.setResult(context.delta).exit();\n    return;\n  }\n  context.nested = !isArray(context.delta);\n  if (context.nested) {\n    return;\n  }\n  if (context.delta.length === 1) {\n    context.setResult([context.delta[0], 0, 0]).exit();\n    return;\n  }\n  if (context.delta.length === 2) {\n    context.setResult([context.delta[1], context.delta[0]]).exit();\n    return;\n  }\n  if (context.delta.length === 3 && context.delta[2] === 0) {\n    context.setResult([context.delta[0]]).exit();\n    return;\n  }\n};\nreverseFilter.filterName = 'trivial';\n\nexports.diffFilter = diffFilter;\nexports.patchFilter = patchFilter;\nexports.reverseFilter = reverseFilter;\n","\nvar environment = require('./environment');\n\nvar DiffPatcher = require('./diffpatcher').DiffPatcher;\nexports.DiffPatcher = DiffPatcher;\n\nexports.create = function(options){\n  return new DiffPatcher(options);\n};\n\nexports.dateReviver = require('./date-reviver');\n\nvar defaultInstance;\n\nexports.diff = function() {\n  if (!defaultInstance) {\n    defaultInstance = new DiffPatcher();\n  }\n  return defaultInstance.diff.apply(defaultInstance, arguments);\n};\n\nexports.patch = function() {\n  if (!defaultInstance) {\n    defaultInstance = new DiffPatcher();\n  }\n  return defaultInstance.patch.apply(defaultInstance, arguments);\n};\n\nexports.unpatch = function() {\n  if (!defaultInstance) {\n    defaultInstance = new DiffPatcher();\n  }\n  return defaultInstance.unpatch.apply(defaultInstance, arguments);\n};\n\nexports.reverse = function() {\n  if (!defaultInstance) {\n    defaultInstance = new DiffPatcher();\n  }\n  return defaultInstance.reverse.apply(defaultInstance, arguments);\n};\n\nif (environment.isBrowser) {\n  exports.homepage = '{{package-homepage}}';\n  exports.version = '{{package-version}}';\n} else {\n  var packageInfoModuleName = '../package.json';\n  var packageInfo = require(packageInfoModuleName);\n  exports.homepage = packageInfo.homepage;\n  exports.version = packageInfo.version;\n\n  var formatterModuleName = './formatters';\n  var formatters = require(formatterModuleName);\n  exports.formatters = formatters;\n  // shortcut for console\n  exports.console = formatters.console;\n}\n","var Pipe = function Pipe(name) {\n  this.name = name;\n  this.filters = [];\n};\n\nPipe.prototype.process = function(input) {\n  if (!this.processor) {\n    throw new Error('add this pipe to a processor before using it');\n  }\n  var debug = this.debug;\n  var length = this.filters.length;\n  var context = input;\n  for (var index = 0; index < length; index++) {\n    var filter = this.filters[index];\n    if (debug) {\n      this.log('filter: ' + filter.filterName);\n    }\n    filter(context);\n    if (typeof context === 'object' && context.exiting) {\n      context.exiting = false;\n      break;\n    }\n  }\n  if (!context.next && this.resultCheck) {\n    this.resultCheck(context);\n  }\n};\n\nPipe.prototype.log = function(msg) {\n  console.log('[jsondiffpatch] ' + this.name + ' pipe, ' + msg);\n};\n\nPipe.prototype.append = function() {\n  this.filters.push.apply(this.filters, arguments);\n  return this;\n};\n\nPipe.prototype.prepend = function() {\n  this.filters.unshift.apply(this.filters, arguments);\n  return this;\n};\n\nPipe.prototype.indexOf = function(filterName) {\n  if (!filterName) {\n    throw new Error('a filter name is required');\n  }\n  for (var index = 0; index < this.filters.length; index++) {\n    var filter = this.filters[index];\n    if (filter.filterName === filterName) {\n      return index;\n    }\n  }\n  throw new Error('filter not found: ' + filterName);\n};\n\nPipe.prototype.list = function() {\n  var names = [];\n  for (var index = 0; index < this.filters.length; index++) {\n    var filter = this.filters[index];\n    names.push(filter.filterName);\n  }\n  return names;\n};\n\nPipe.prototype.after = function(filterName) {\n  var index = this.indexOf(filterName);\n  var params = Array.prototype.slice.call(arguments, 1);\n  if (!params.length) {\n    throw new Error('a filter is required');\n  }\n  params.unshift(index + 1, 0);\n  Array.prototype.splice.apply(this.filters, params);\n  return this;\n};\n\nPipe.prototype.before = function(filterName) {\n  var index = this.indexOf(filterName);\n  var params = Array.prototype.slice.call(arguments, 1);\n  if (!params.length) {\n    throw new Error('a filter is required');\n  }\n  params.unshift(index, 0);\n  Array.prototype.splice.apply(this.filters, params);\n  return this;\n};\n\nPipe.prototype.clear = function() {\n  this.filters.length = 0;\n  return this;\n};\n\nPipe.prototype.shouldHaveResult = function(should) {\n  if (should === false) {\n    this.resultCheck = null;\n    return;\n  }\n  if (this.resultCheck) {\n    return;\n  }\n  var pipe = this;\n  this.resultCheck = function(context) {\n    if (!context.hasResult) {\n      console.log(context);\n      var error = new Error(pipe.name + ' failed');\n      error.noResult = true;\n      throw error;\n    }\n  };\n  return this;\n};\n\nexports.Pipe = Pipe;\n","\nvar Processor = function Processor(options){\n  this.selfOptions = options || {};\n  this.pipes = {};\n};\n\nProcessor.prototype.options = function(options) {\n  if (options) {\n    this.selfOptions = options;\n  }\n  return this.selfOptions;\n};\n\nProcessor.prototype.pipe = function(name, pipe) {\n  if (typeof name === 'string') {\n    if (typeof pipe === 'undefined') {\n      return this.pipes[name];\n    } else {\n      this.pipes[name] = pipe;\n    }\n  }\n  if (name && name.name) {\n    pipe = name;\n    if (pipe.processor === this) { return pipe; }\n    this.pipes[pipe.name] = pipe;\n  }\n  pipe.processor = this;\n  return pipe;\n};\n\nProcessor.prototype.process = function(input, pipe) {\n  var context = input;\n  context.options = this.options();\n  var nextPipe = pipe || input.pipe || 'default';\n  var lastPipe, lastContext;\n  while (nextPipe) {\n    if (typeof context.nextAfterChildren !== 'undefined') {\n      // children processed and coming back to parent\n      context.next = context.nextAfterChildren;\n      context.nextAfterChildren = null;\n    }\n\n    if (typeof nextPipe === 'string') {\n      nextPipe = this.pipe(nextPipe);\n    }\n    nextPipe.process(context);\n    lastContext = context;\n    lastPipe = nextPipe;\n    nextPipe = null;\n    if (context) {\n      if (context.next) {\n        context = context.next;\n        nextPipe = lastContext.nextPipe || context.pipe || lastPipe;\n      }\n    }\n  }\n  return context.hasResult ? context.result : undefined;\n};\n\nexports.Processor = Processor;\n","/* jslint esnext:true, node:true, browser:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nimport {\n    Skaryna\n}\nfrom './index';\nimport {\n    Editor\n}\nfrom './editor';\nimport {\n    repository\n}\nfrom './repository';\nimport {\n    XHR\n}\nfrom './xhr';\n\nSkaryna.Editor = Editor;\nSkaryna.repository = repository;\nSkaryna.XHR = XHR;\n\nwindow.Skaryna = Skaryna;\n\nif (Array.isArray(window.___Skaryna)) {\n    window.___Skaryna.forEach((callback) => {\n        callback.apply(window);\n    });\n}\n","/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nimport {\n    Emitter\n}\nfrom './emitter';\nimport {\n    clone,\n    arraize\n}\nfrom './util';\nimport {\n    toHTML\n}\nfrom './serializer/toHTML';\n\nlet elementMap = {};\n\n\n/**\n * @see https://github.com/component/escape-regexp\n * @param   {string} str\n * @returns {string}\n */\nexport function escapeRegexp(str) {\n    return String(str).replace(/([.*+?=^!:${}()|[\\]\\/\\\\])/g, '\\\\$1');\n}\n\n/**\n * @see App\n * @param   {array} list\n * @param   {string}   filter\n * @returns {string}\n */\nexport function bestMatch(list, filter) {\n    var lowest = null,\n        best;\n\n    list.forEach(function (rule) {\n        var regexp = new RegExp(escapeRegexp(rule).replace(/\\\\\\*/g, '(.+)')),\n            weight = rule.split('*').filter(function (part) {\n                return part.length;\n            }).length,\n            match = filter.match(regexp);\n\n        if (match && (lowest === null || (match.length - weight) < lowest)) {\n            lowest = match.length - weight;\n            best = rule;\n        }\n    });\n    return best;\n}\n\nexport function getById(id) {\n    return elementMap[id];\n}\n\nexport function getByNode(element) {\n    if (!element) {\n        return null;\n    }\n    let id = element.getAttribute('data-skaryna-id');\n    return getById(id);\n}\n\nexport function randomID(setValue) {\n    var possible = 'abcdefghijklmnopqrstuvwxyz0123456789',\n        text = '';\n\n    for (let i = 0; i < 5; i++) {\n        text += possible.charAt(Math.floor(Math.random() * possible.length));\n    }\n\n    if (Object.keys(elementMap).indexOf(text) === -1) {\n        elementMap[text] = elementMap[text] || setValue;\n        return text;\n    }\n    return randomID(setValue);\n}\n\n/**\n * @class\n */\nexport class Node extends Emitter {\n\n    /**\n     * @constructs Node\n     */\n    constructor() {\n        super();\n\n        this.name = randomID(this);\n\n        this.__locked = false;\n    }\n\n    get locked() {\n        return this.__locked;\n    }\n\n    lock() {\n        this.__locked = true;\n    }\n\n    attr() {\n        return this.attrs;\n    }\n\n    get() {\n        throw new Error('Should be implemented');\n    }\n\n    set() {\n        throw new Error('Should be implemented');\n    }\n\n    /**\n     * @abstract\n     * @throws {Error}\n     */\n    toJSON() {\n        let error = new Error('Should be implemented');\n        throw error;\n    }\n\n    get defaultNewItem() {\n        return null;\n    }\n\n    get allowedNewItems() {\n        return [];\n    }\n}\n\n/**\n * @class\n * Defined for Image, Video, Embed, Table, HorizonalRule, Table, List or Component\n */\nexport class BlockNode extends Node {\n\n    constructor(type, items, attrs) {\n        super();\n        this._type = type;\n        this.items = items || [];\n        this.attrs = attrs;\n    }\n\n    get(path) {\n        let elements = path.split('.'),\n            index = elements.shift(),\n            rest = elements.join('.'),\n            child;\n\n        if (isNaN(index)) {\n            return null;\n        }\n\n        child = this.items[+index];\n\n        if (rest.length && child) {\n            return child.get(rest);\n        }\n\n        return child;\n\n    }\n\n    set(path, value) {\n        let elements = path.split('.'),\n            index = elements.shift(),\n            rest = elements.join('.'),\n            child;\n\n        if (isNaN(index)) {\n            return null;\n        }\n\n        if (rest.length && child) {\n            return this.items[+index].set(rest, value);\n        }\n\n        this.items.splice(+index, 0, value);\n\n    }\n\n    get empty() {\n        return this.items.length <= 0;\n    }\n\n    get type() {\n        return this._type;\n    }\n\n    toJSON() {\n        let output = {\n            type: this.type,\n            items: this.items.map((item) => item.toJSON())\n        };\n        if (this.attrs) {\n            output.attrs = JSON.parse(JSON.stringify(this.attrs));\n        }\n        return output;\n    }\n\n    decorate(element) {\n        return toHTML(this, {\n                edit: true\n            })\n            .then((html) => {\n                element.innerHTML = '';\n                arraize(html.children)\n                    .forEach((child) => {\n                        element.appendChild(child);\n                    });\n            });\n    }\n}\n\nexport class Document extends BlockNode {\n\n    constructor(items) {\n        super('document', items);\n    }\n\n    get defaultNewItem() {\n        return Paragraph;\n    }\n\n    get allowedNewItems() {\n        return [\n            Paragraph,\n            Image\n        ];\n    }\n\n}\n\nexport class Quote extends BlockNode {\n    constructor(items) {\n        super('quote', items);\n    }\n}\n\n/**\n * @class\n * Defined for Text, Paragraph, ListItem, Quote and Heading\n */\nexport class TextNode extends Node {\n\n    get type() {\n        return 'text';\n    }\n\n    static get type() {\n        return 'text';\n    }\n\n    get empty() {\n        return !this.text || !this.text.replace(/^([\\s\\n\\r\\t]+)|([\\s\\n\\r\\t]+)$/, '').length;\n    }\n\n    get absoluteEmpty() {\n        return this.text.length === 0;\n    }\n\n    attr() {\n        if (this.type === 'text') {\n            return {};\n        }\n        return super.attr();\n    }\n\n    constructor(text, formats, attrs) {\n        super();\n        this.text = (text && text.toString) ? text.toString() : '';\n        this.formats = formats || null;\n        this.attrs = attrs;\n    }\n\n    toJSON() {\n        let output = {\n            type: this.type,\n            text: this.text\n        };\n        if (this.formats) {\n            output.formats = JSON.parse(JSON.stringify(this.formats));\n        }\n        if (this.attrs && this.type !== 'text') {\n            output.attrs = JSON.parse(JSON.stringify(this.attrs));\n        }\n        return output;\n    }\n\n    append(node) {\n        if (!(node instanceof TextNode)) {\n            throw new Error('Only text nodes can be joined');\n        }\n        if (node.formats) {\n            this.formats = this.formats || [];\n            node.formats.forEach((format) => {\n                this.formats.push({\n                    slice: [format.slice[0] + this.text.length, format.slice[1]],\n                    apply: format.apply\n                });\n            });\n        }\n        this.text += node.text;\n    }\n\n    decorate(element) {\n        return toHTML(this, {\n                edit: true\n            })\n            .then((html) => {\n                element.innerHTML = html.textContent;\n            });\n    }\n}\n\nexport class Paragraph extends TextNode {\n\n    get type() {\n        return 'paragraph';\n    }\n\n    static get type() {\n        return 'paragraph';\n    }\n\n    constructor(text, formats, attrs) {\n        super(text, formats, attrs);\n    }\n\n    get nextNodeType() {\n        return Paragraph;\n    }\n}\n\nexport class Image extends Node {\n\n    constructor(source, title, alt) {\n        super('image');\n        this.src = source;\n        this.title = title;\n        this.alt = alt;\n    }\n\n    get type() {\n        return 'image';\n    }\n\n    static get type() {\n        return 'image';\n    }\n\n    attr() {\n        let attributes = super.attr() || {};\n        if (this.src) {\n            attributes.src = this.src;\n        }\n        if (this.title) {\n            attributes.title = this.title;\n        }\n        if (this.alt) {\n            attributes.alt = this.title;\n        }\n        return attributes;\n    }\n\n    toJSON() {\n        let output = {\n            type: 'image',\n            src: this.src\n        };\n        if (this.title) {\n            output.title = this.title;\n        }\n        if (this.alt) {\n            output.alt = this.alt;\n        }\n        return output;\n    }\n}\n\nexport class Heading extends TextNode {\n\n    constructor(level, text, formats, attrs) {\n        super(text, formats, attrs);\n        this.level = Math.min(6, level || 1);\n    }\n\n    attr() {\n        return super.attr();\n    }\n    get type() {\n        return 'heading';\n    }\n\n    static get type() {\n        return 'heading';\n    }\n\n    toJSON() {\n        let json = super.toJSON();\n        json.level = this.level;\n        return json;\n    }\n}\n\nexport class StaticBlockNode extends BlockNode {\n    get locked() {\n        return true;\n    }\n\n    get defaultNewItem() {\n        return Paragraph;\n    }\n\n    get allowedNewItems() {\n        return [\n            Paragraph,\n            Image\n        ];\n    }\n}\n\nexport class Fields extends Node {\n\n    constructor(data) {\n        super();\n        this._map = data;\n    }\n\n    get type() {\n        return 'Fields';\n    }\n\n    static get type() {\n        return 'Fields';\n    }\n\n    get(path) {\n        let elements = path.split('.'),\n            index = elements.shift(),\n            rest = elements.join('.'),\n            child;\n\n        child = this._map[index];\n\n        if (rest.length && child) {\n            return child.get(rest);\n        }\n\n        return child;\n\n    }\n\n    set(path, value) {\n        let elements = path.split('.'),\n            index = elements.shift(),\n            rest = elements.join('.'),\n            child;\n\n        if (rest.length && child) {\n            return this._map[index].get(rest, value);\n        }\n\n        this._map[index] = value;\n\n    }\n\n    toJSON() {\n        return clone([\n            this._map,\n            {\n                type: 'Fields'\n            }\n        ]);\n    }\n}\n\nexport class Variants extends Node {\n\n    constructor(data) {\n        super();\n        this._variants = data;\n    }\n\n    get type() {\n        return 'Variants';\n    }\n\n    static get type() {\n        return 'Variants';\n    }\n\n\n    best(variant) {\n        let best = bestMatch(Object.keys(this._variants), variant);\n        return this._variants[best];\n\n    }\n\n    toJSON() {\n        return clone([\n            this._map,\n            {\n                type: 'Variants'\n            }\n        ]);\n    }\n}\n","/* jslint esnext:true, node:true, browser:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nimport {\n    Event, Emitter\n}\nfrom './emitter';\n\nimport {\n    arraize\n}\nfrom './util';\nimport {\n    repository, CHANGE, DEFAULT_DOCUMENT\n}\nfrom './repository';\nimport {\n    toHTML\n}\nfrom './serializer/toHTML';\nimport {\n    toPOM\n}\nfrom './serializer/toPOM';\nimport {\n    fromHTML\n}\nfrom './parser/fromHTML';\nimport {\n    fromPOM\n}\nfrom './parser/fromPOM';\nimport {\n    XHR\n}\nfrom './xhr';\nimport {\n    Variants,\n    randomID,\n    getById,\n    getByNode\n}\nfrom './document';\n\nconst BACKSPACE = 8,\n    TAB = 9,\n    ENTER = 13,\n    SHIFT = 16,\n    CAPS = 20,\n    ESC = 27,\n    SPACE = 32,\n    UP = 38,\n    DOWN = 40,\n    DELETE = 46,\n    PREVENT = [ENTER];\n\nimport {\n    Toolbar\n}\nfrom './toolbar';\nimport {\n    Injector\n}\nfrom './injector';\n\nlet toolbar = new Toolbar(),\n    injector;\n\n/**\n * @class\n * @name Editor\n */\nexport class Editor extends Emitter {\n\n    /**\n     * Creates new editor instance\n     * @param {HTMLElement} element\n     * @returns {Promise<Editor>} promise of fully loaded and rendered editor\n     */\n    static factory(element) {\n        let editor = new Editor(element);\n        return editor.inited;\n    }\n\n    /**\n     * [[Description]]\n     * @param {HTMLElement} element\n     * @returns {Promise} [[Description]]\n     */\n    static initEditors(element) {\n        let self = this;\n        return Promise.all(arraize(element.querySelectorAll('[data-skaryna]'))\n                .map((element) => Editor.factory(element)))\n            .then(editors => {\n                self.editors = editors;\n                return editors;\n            });\n    }\n\n    /**\n     * [[Description]]\n     * @param {Object} documentBody [[Description]]\n     * @param {[[Type]]} documentId   [[Description]]\n     */\n    static registerDocument(documentBody, documentId) {\n        repository.set(documentId || DEFAULT_DOCUMENT, documentBody);\n    }\n\n    /**\n     * Loads data from REST endpoint\n     * @param   {string} path\n     * @param   {string} documentId\n     * @returns {Promise}\n     */\n    static load(path, documentId) {\n        return XHR\n            .get(path)\n            .then((content) => {\n                return fromPOM(JSON.parse(content));\n            })\n            .then((content) => {\n                repository.set(documentId || DEFAULT_DOCUMENT, content);\n            });\n    }\n\n    /**\n     * @param {HTMLElement} element\n     */\n    constructor(element) {\n        super();\n\n        this.element = element;\n        this.documentPath = element.getAttribute('data-skaryna-path') || null;\n        this.document = element.getAttribute('data-skaryna-doc') || DEFAULT_DOCUMENT;\n        this.variant = element.getAttribute('data-skaryna-variant') || null;\n\n        this._pendingState = null;\n        this._rendering = false;\n\n        this.init();\n\n    }\n\n    /**\n     * Inits component\n     * @returns {Promise}\n     */\n    init() {\n        let self = this;\n        if (this.inited) {\n            return this.inited;\n        }\n        this.inited = fromHTML(this.element, {\n                edit: true\n            })\n            .then((content) => {\n                content.lock();\n                if (repository.has(self.document)) {\n                    let doc = repository.get(self.document);\n                    if (self.documentPath) {\n                        doc = doc.get(self.documentPath);\n                        if (doc && doc.type === 'Variants' && doc.best) {\n                            doc = doc.best(self.variant || '*');\n                        }\n                    }\n                    self.content = doc;\n                } else if (!content.empty) {\n                    repository.set(self.document, content);\n                    self.content = content;\n                }\n            })\n            .then(() => {\n                return self.render();\n            })\n            .catch((error) => {\n                console.log(error);\n                console.log(error.stack);\n            });\n    }\n\n    getCaretCharacterOffsetWithin(element) {\n        let caretOffset = 0,\n            doc = element.ownerDocument || element.document,\n            win = doc.defaultView || doc.parentWindow,\n            sel;\n        if (typeof win.getSelection != 'undefined') {\n            sel = win.getSelection();\n            if (sel.rangeCount > 0) {\n                let range = win.getSelection().getRangeAt(0),\n                    preCaretRange = range.cloneRange();\n                preCaretRange.selectNodeContents(element);\n                preCaretRange.setEnd(range.endContainer, range.endOffset);\n                caretOffset = preCaretRange.toString().length;\n            }\n        } else if ((sel = doc.selection) && sel.type != 'Control') {\n            let textRange = sel.createRange(),\n                preCaretTextRange = doc.body.createTextRange();\n            preCaretTextRange.moveToElementText(element);\n            preCaretTextRange.setEndPoint('EndToEnd', textRange);\n            caretOffset = preCaretTextRange.text.length;\n        }\n        return caretOffset;\n    }\n\n    getSelectionLength() {\n\n    }\n\n    getCurrentElement(element) {\n\n        let doc = element.ownerDocument || element.document,\n            win = doc.defaultView || doc.parentWindow,\n            sel,\n            node;\n\n        if (typeof win.getSelection != 'undefined') {\n            sel = win.getSelection();\n        } else {\n            sel = doc.selection;\n        }\n\n        node = sel.focusNode;\n\n        if (node === this.element) {\n            return this.element;\n        }\n        return this.getEditableNode(node);\n    }\n\n    getEditableNode(node) {\n        while (node && (!node.hasAttribute || !node.hasAttribute('data-skaryna-id'))) {\n            node = node.parentNode;\n        }\n        return node;\n    }\n\n    onDOM(selectorORElement, eventName, myMethod) {\n        let self = this;\n        if (selectorORElement instanceof HTMLElement) {\n            selectorORElement = [selectorORElement];\n        } else {\n            selectorORElement = arraize(this.element.querySelectorAll(selectorORElement));\n        }\n        selectorORElement\n            .forEach(element => {\n                element.addEventListener(eventName, event => {\n                    myMethod.apply(self, [event]);\n                }, true);\n            });\n    }\n\n    /**\n     * Renders UI\n     * @returns {Promise}\n     */\n    render() {\n        this._rendering = true;\n        let self = this,\n            promise;\n\n        if (!this.content) {\n            this._rendering = false;\n            promise = Promise.resolve();\n        } else {\n            promise = this.content\n                .decorate(this.element)\n                .then(() => {\n                    this._rendering = false;\n                });\n        }\n\n        return promise\n            .then(() => {\n                self.element.setAttribute('data-skaryna-id', self.content ? self.content.name : randomID(true));\n                self.element.setAttribute('contentEditable', '');\n                self.element.addEventListener('keydown', (event) => {\n                    self.onKeyUp(event);\n                }, true);\n                self.onDOM('[data-skaryna-id]', 'mouseup', self.focus);\n                self.onDOM(self.element, 'mouseup', self.focus);\n\n                self.element.addEventListener('mouseup', (event) => {\n                    let sel = window.getSelection ? window.getSelection().toString() : document.selection.createRange().text;\n                    if (sel && sel.length) {\n                        self.onSelect(event);\n                    }\n                }, true);\n            })\n            .then(() => self);\n    }\n\n    onSelect() {\n        this.showToolbar();\n        this.strong();\n    }\n\n    showToolbar() {\n        toolbar.anchor();\n    }\n\n    focus(event) {\n        let node = this.getEditableNode(event.target),\n            focusedNode = getByNode(node),\n            parentNode = getByNode(node.parentNode),\n            newItems,\n            injectorObject;\n\n        newItems = parentNode ? parentNode.allowedNewItems : focusedNode.allowedNewItems;\n\n        this.hideInjector();\n\n        if (newItems.length > 0) {\n            if (!parentNode) {\n                injectorObject = this.showInjector(node.parentNode.lastChild, newItems);\n            } else {\n                injectorObject = this.showInjector(node, newItems);\n            }\n            injectorObject.on('injectnode', event => {\n                if (parentNode) {\n                    let index = parentNode.items.indexOf(focusedNode);\n                    parentNode.items.splice(index, 0, new event.data());\n                } else {\n                    parentNode.items.push(new event.data());\n                }\n                this.render();\n            });\n        }\n    }\n\n    showInjector(afterNode, possibleItems) {\n        let injectorObject = new Injector(possibleItems),\n            box = afterNode.getBoundingClientRect();\n\n        document.body.appendChild(injectorObject.element);\n        injectorObject.goTo(box.left, box.top);\n        return injectorObject;\n\n    }\n\n    hideInjector() {\n        if (injector) {\n            if (injector.parentNode) {\n                injector.parentNode.removeChild(injector);\n            }\n            injector = null;\n        }\n    }\n\n    strong() {\n        let textNode = this.getCurrentElement(event.target),\n            sel = window.getSelection ? window.getSelection().toString() : document.selection.createRange().text,\n            to = sel.length,\n            from = this.getCaretCharacterOffsetWithin(textNode) - to;\n\n\n        fromHTML(textNode)\n            .then((POM) => {\n                POM.formats = POM.formats || [];\n                POM.formats.push({\n                    slice: [from, to],\n                    apply: ['strong']\n                });\n                return toHTML(POM);\n            })\n            .then((HTML) => {\n                textNode.innerHTML = HTML.innerHTML;\n            });\n    }\n\n    /**\n     * Handles external change\n     * @param {object} event\n     */\n    onExternalChange() {\n        if (this._rendering) {\n            this._pendingState = true;\n            return;\n        }\n        this.render();\n    }\n\n    newItem(target) {\n        let currentTarget = target,\n            node = getByNode(currentTarget),\n            self = this,\n            asEditor = Editor.editors.reduce((previous, current) => {\n                if (current.element === currentTarget) {\n                    return current;\n                }\n                return previous;\n            }, null);\n\n        while (node !== null) {\n            if (!node) {\n                if (asEditor) {\n                    let index = Editor.editors.indexOf(asEditor) + 1;\n                    if (index >= Editor.editors.length) {\n                        index = 0;\n                    }\n                    self.editNode(Editor.editors[index].element);\n                }\n                return;\n            }\n            if (node.defaultNewItem) {\n                let newElement = new(node.defaultNewItem)();\n                node.items.push(newElement);\n\n                toHTML(newElement, {\n                        edit: true\n                    })\n                    .then(htmlElement => {\n                        currentTarget.appendChild(htmlElement);\n                        self.editNode(htmlElement);\n                    });\n                return;\n            }\n            currentTarget = currentTarget.parentNode;\n            node = getByNode(currentTarget);\n            asEditor = asEditor || Editor.editors.reduce((previous, current) => {\n                if (current.element === currentTarget) {\n                    return current;\n                }\n                return previous;\n            }, null);\n        }\n    }\n\n    editNode(node) {\n        let range = document.createRange(),\n            sel = window.getSelection();\n        range.setStart(node, 0);\n        range.collapse(true);\n        sel.removeAllRanges();\n        sel.addRange(range);\n    }\n\n    ownAction(key, target) {\n        if (key === ENTER) {\n            return this.newItem(target);\n        }\n    }\n\n    /**\n     * Handles key up event\n     * @param {Event} event\n     */\n    onKeyUp(event) {\n        let current = this.getCurrentElement(event.target);\n        if (PREVENT.indexOf(event.keyCode) !== -1) {\n            event.stopPropagation();\n            event.preventDefault();\n            this.ownAction(event.keyCode, current);\n        } else {\n            setTimeout(() => this.update(current), 0);\n        }\n    }\n\n    update(element) {\n        let\n            self = this,\n            doc = repository.get(self.document);\n\n        if (self.documentPath) {\n            doc = doc.set(self.documentPath, self.content);\n            repository.emit(CHANGE);\n        } else {\n            //TODO\n        }\n\n        fromHTML(element)\n            .then(POM => {\n                Editor.emit('selected', {\n                    editor: this,\n                    element: element,\n                    node: POM\n                });\n            });\n    }\n}\n\nlet styles = document.createElement('style');\nstyles.innerText = `\n        p[data-skaryna-id]:empty {\n                display: block;\n                height: 1em;\n            }\n        }\n        `;\n\ndocument.body.appendChild(styles);\n","/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\n/**\n * @namespace skaryna\n *\n * @class EventConfig\n * @property {function} fn listener\n * @property {object} context\n * @property {array} args arguments to be passed\n * @property {boolean} once if should be fired only once\n */\n\n/**\n * @class Event\n */\nexport class Event {\n    /**\n     * Contructor\n     * @constructs Event\n     * @param {string} name\n     * @param {mixed} data\n     * @param {object} source\n     * @param {Event} parent\n     */\n    constructor(name, data, source, parent) {\n        Object.defineProperties(this, {\n            /**\n             * @property {string}\n             * @name Event#name\n             */\n            name: {\n                value: name,\n                writable: false\n            },\n            /**\n             * @property {mixed}\n             * @name Event#data\n             */\n            data: {\n                value: data,\n                writable: false\n            },\n            /**\n             * @property {object}\n             * @name Event#source\n             */\n            source: {\n                value: source,\n                writable: false\n            },\n            /**\n             * @property {Event|null}\n             * @name Event#parent\n             */\n            parent: {\n                value: parent,\n                writable: false\n            }\n        });\n    }\n\n    toJSON() {\n        return {\n            name: this.name,\n            data: this.data,\n            source: this.source,\n            parent: this.parent\n        };\n    }\n\n    toString() {\n        return 'Event: ' + JSON.stringify(this.toJSON());\n    }\n}\n\n/**\n * [[Description]]\n * @param {Event} cofnig\n * @param {EventConfig} thisObject\n */\nfunction execute(event, config) {\n    let {\n        fn, context, args\n    } = config,\n    params = [event].concat(args);\n\n    fn.apply(context || null, params);\n}\n\n/**\n * Adds listener for an event\n * @param {string} eventName\n * @param {function} handler\n * @param {object} context\n * @param {array} args\n * @param {boolean} once\n */\nfunction on(eventName, handler, context, args, once) {\n    this.__listeners = this.__listeners || {};\n    this.__listeners[eventName] = this.__listeners[eventName] || [];\n    this.__listeners[eventName].push({\n        fn: handler,\n        context: context,\n        args: args,\n        once: !!once\n    });\n}\n\n/**\n * Adds listener for an event that should be called once\n * @param {string} eventName\n * @param {function} handler\n * @param {object} context\n * @param {array} args\n */\nfunction once(eventName, handler, context, args) {\n    this.on(eventName, handler, context, args, true);\n}\n\n/**\n * Adds listener for an event\n * @param {string} eventName\n * @param {function} handler\n * @param {object} context\n * @param {array} args\n * @param {boolean} once\n */\nfunction off(eventName, handler, context, args, once) {\n    if (!this.__listeners || !this.__listeners[eventName]) {\n        return;\n    }\n    this\n        .getListeners(eventName, handler, context, args, once)\n        .forEach((config) => {\n            this.__listeners[eventName].splice(this.__listeners[eventName].indexOf(config), 1);\n        });\n\n}\n\n/**\n * Emits an event\n * @param {string} eventName\n * @param {mixed} data\n * @param {Event|null} parent\n */\nfunction emit(eventName, data, parent) {\n    if (!this.__listeners || !this.__listeners[eventName]) {\n        return;\n    }\n\n    let self = this,\n        event = new Event(eventName, data, this, parent);\n\n    this\n        .getListeners(eventName)\n        .forEach((config) => {\n            if (config.once === true) {\n                self.off(eventName, config.fn, config.context, config.args, config.once);\n            }\n            execute(event, config);\n        });\n}\n\n/**\n * Bubbles event to other emitter\n * @param {string} eventName\n * @param {object} toEmitter\n */\nfunction bubbleEvent(eventName, toEmitter) {\n    this.on(eventName, (event) => {\n        toEmitter.emit(eventName, event.data, event);\n    });\n}\n\n/**\n * Gets all listeners that match criteria\n * @param   {string} eventName required\n * @param   {function} handler   if defined will be used for match\n * @param   {object} context   if defined will be used for match\n * @param   {array} args      if defined will be used for match\n * @returns {array<EventConfig>|null}\n */\nfunction getListeners(eventName, handler, context, args) {\n    if (!this.__listeners || !this.__listeners[eventName]) {\n        return null;\n    }\n\n    return this.__listeners[eventName]\n        .map((config) => {\n            if (handler !== undefined && config.fn !== handler) {\n                return false;\n            }\n            if (context !== undefined && config.context !== context) {\n                return false;\n            }\n            if (args !== undefined && config.args !== args) {\n                return false;\n            }\n            return config;\n        })\n        .filter((result) => !!result);\n}\n\n/*\n * @class Emitter\n */\nexport class Emitter {\n\n    static on() {\n        on.apply(this, arguments);\n    }\n\n    on() {\n        on.apply(this, arguments);\n    }\n\n    static once() {\n        once.apply(this, arguments);\n    }\n\n    once() {\n        once.apply(this, arguments);\n    }\n\n    static off() {\n        off.apply(this, arguments);\n    }\n\n    off() {\n        off.apply(this, arguments);\n    }\n\n    static emit() {\n        emit.apply(this,arguments);\n    }\n\n    emit() {\n        emit.apply(this,arguments);\n    }\n\n    static bubbleEvent() {\n        bubbleEvent.apply(this,arguments);\n    }\n\n    bubbleEvent() {\n        bubbleEvent.apply(this,arguments);\n    }\n\n    static getListeners() {\n        return getListeners.apply(this,arguments);\n    }\n\n    getListeners() {\n        return getListeners.apply(this,arguments);\n    }\n}\n","/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nexport {Event, Emitter} from './emitter';\n\nexport class Skaryna {\n}\n","/* jslint esnext:true, node:true, browser:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\nimport {\n    Emitter\n}\nfrom './emitter';\n\nlet styles;\n\nconst SVGS = {\n    paragraph: 'M832 320v704q0 104-40.5 198.5t-109.5 163.5-163.5 109.5-198.5 40.5h-64q-26 0-45-19t-19-45v-128q0-26 19-45t45-19h64q106 0 181-75t75-181v-32q0-40-28-68t-68-28h-224q-80 0-136-56t-56-136v-384q0-80 56-136t136-56h384q80 0 136 56t56 136zm896 0v704q0 104-40.5 198.5t-109.5 163.5-163.5 109.5-198.5 40.5h-64q-26 0-45-19t-19-45v-128q0-26 19-45t45-19h64q106 0 181-75t75-181v-32q0-40-28-68t-68-28h-224q-80 0-136-56t-56-136v-384q0-80 56-136t136-56h384q80 0 136 56t56 136z',\n    image: 'M576 576q0 80-56 136t-136 56-136-56-56-136 56-136 136-56 136 56 56 136zm1024 384v448h-1408v-192l320-320 160 160 512-512zm96-704h-1600q-13 0-22.5 9.5t-9.5 22.5v1216q0 13 9.5 22.5t22.5 9.5h1600q13 0 22.5-9.5t9.5-22.5v-1216q0-13-9.5-22.5t-22.5-9.5zm160 32v1216q0 66-47 113t-113 47h-1600q-66 0-113-47t-47-113v-1216q0-66 47-113t113-47h1600q66 0 113 47t47 113z',\n    dimensions: '0 0 1792 1792'\n};\n\nexport class Injector extends Emitter {\n\n    constructor(allowedNodes) {\n        super();\n\n        let\n            self = this,\n            div = document.createElement('div');\n\n        div.innerHTML = '<skaryna><div data-skaryna-tooltip=\"left\"><div></div><div></div></div></skaryna>';\n\n        this.element = div.firstChild;\n\n        div = this.element.firstChild;\n\n        allowedNodes.forEach(node => {\n            let action = document.createElement('a'),\n                svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg'),\n                path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n\n            svg.setAttribute('width', 30);\n            svg.setAttribute('height', 30);\n            svg.setAttribute('viewBox', SVGS.dimensions);\n            svg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n            path.setAttribute('d', SVGS[node.type]);\n            path.setAttribute('fill', '#fff');\n\n            svg.appendChild(path);\n            action.appendChild(svg);\n\n            action.addEventListener('mousedown', (event) => {\n                event.preventDefault();\n                event.stopPropagation();\n                self.emit('injectnode', node);\n\n            }, true);\n            div.children[1].appendChild(action);\n        });\n\n        if (!styles) {\n            styles = document.createElement('style');\n            styles.innerText = `\n        [data-skaryna-tooltip] {\n            position: absolute;\n            z-index: 1070;\n            display: block;\n            font-family: \"Helvetica Neue\", Helvetica, Arial, sans-serif;\n            font-size: 12px;\n            font-style: normal;\n            font-weight: 400;\n            line-height: 1.42857143;\n            text-align: left;\n            text-align: start;\n            text-decoration: none;\n            text-shadow: none;\n            text-transform: none;\n            letter-spacing: normal;\n            word-break: normal;\n            word-spacing: normal;\n            word-wrap: normal;\n            white-space: normal;\n            /*filter: alpha(opacity=0);\n            opacity: 0;*/\n            line-break: auto;\n            transition: opacity 0.5s;\n        }\n        [data-skaryna-tooltip] div:nth-child(2) {\n            max-width: 200px;\n            padding: 3px 8px;\n            color: #fff;\n            text-align: center;\n            background-color: #000;\n            border-radius: 4px;\n        }\n        [data-skaryna-tooltip] div:nth-child(1) {\n            position: absolute;\n            width: 0;\n            height: 0;\n            border-color: transparent;\n            border-style: solid;\n        }\n        [data-skaryna-tooltip=\"left\"] {\n            padding: 0 5px;\n            margin-left: -3px;\n        }\n        [data-skaryna-tooltip=\"top\"] {\n            padding: 5px 0;\n            margin-top: -3px;\n        }\n        [data-skaryna-tooltip=\"bottom\"] {\n            padding: 5px 0;\n            margin-top: 3px;\n        }\n        [data-skaryna-tooltip=\"right\"] {\n            padding: 0 5px;\n            margin-left: 3px;\n        }\n        [data-skaryna-tooltip=\"left\"] div:nth-child(1) {\n            top: 50%;\n            right: 0;\n            margin-top: -5px;\n            border-width: 5px 0 5px 5px;\n            border-left-color: #000;\n        }\n        [data-skaryna-tooltip=\"top\"] div:nth-child(1) {\n            bottom: 0;\n            left: 50%;\n            margin-left: -5px;\n            border-width: 5px 5px 0;\n            border-top-color: #000;\n        }\n        [data-skaryna-tooltip=\"bottom\"] div:nth-child(1) {\n            top: 0;\n            left: 50%;\n            margin-left: -5px;\n            border-width: 0 5px 5px;\n            border-bottom-color: #000;\n        }\n        [data-skaryna-tooltip=\"right\"] div:nth-child(1) {\n            top: 50%;\n            left: 0;\n            margin-top: -5px;\n            border-width: 5px 5px 5px 0;\n            border-right-color: #000;\n        }\n        [data-skaryna-tooltip] a {\n            margin-left: 10px;\n        }\n        [data-skaryna-tooltip] a:first-child{\n            margin-left: 0px;\n        }`;\n\n            document.body.appendChild(styles);\n        }\n    }\n\n    goTo(x, y) {\n        setTimeout(() => {\n            let\n                div = this.element.firstChild,\n                injectorBox = div.getBoundingClientRect();\n            div.style.top = y + 'px';\n            div.style.left = (x - injectorBox.width) + 'px';\n        }, 0);\n\n    }\n}\n","/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nclass Parser {\n\n    parse(format, token, data, options) {\n\n        if (!token) {\n            return Promise.reject(new Error('Model is empty'));\n        }\n\n        return this.handle(format, token, data, options);\n    }\n\n    on(format, token, handler) {\n        this._handlers = this._handlers || {};\n        this._handlers[format] = this._handlers[format] || {};\n        this._handlers[format][token] = handler;\n    }\n\n    handle(format, token, data, options) {\n\n        let handler = (this._handlers && this._handlers[format] && this._handlers[format][token]) ? this._handlers[format][token] : null;\n        if (!handler) {\n            handler = (this._handlers && this._handlers[format] && this._handlers[format]['*']) ? this._handlers[format]['*'] : null;\n            if (!handler) {\n                return Promise.reject(new Error('No handler defined for ' + format + ' : ' + token));\n            }\n        }\n\n        return handler(token, data, options)\n            .then((POM) => {\n                return POM;\n            });\n    }\n\n}\n\nexport var parser = new Parser();\n","/* jslint esnext:true, node:true */\n/* globals document */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nimport {\n    parser\n}\nfrom './../parser';\nimport {\n    arraize,\n    clone\n}\nfrom './../util';\nimport {\n    Document,\n    TextNode,\n    BlockNode,\n    Paragraph,\n    Heading,\n    Image,\n    Quote,\n    StaticBlockNode\n}\nfrom './../document';\n\nfunction whatWrapper(rootNode) {\n    switch (rootNode) {\n    case 'td':\n    case 'th':\n        return 'tr';\n    case 'tr':\n        return 'table';\n    default:\n        return 'div';\n    }\n}\n\nfunction editMode(node, element, options) {\n    if (options && options.edit) {\n        element.setAttribute('data-skaryna-id', node.name);\n        node.__element = element;\n    }\n    return node;\n}\n\nfunction processChildren(element, options) {\n    if (!element || !element.childNodes) {\n        return Promise.resolve([]);\n    }\n    return Promise\n        .all(arraize(element.childNodes)\n            .map((child) => {\n                if (child.nodeType === 1 || child.nodeType === 3) {\n                    return fromHTML(child, options);\n                } else {\n                    return null;\n                }\n            }))\n        .then((items) => items.filter((item) => {\n            if (item.constructor === TextNode) {\n                return !item.absoluteEmpty;\n            }\n            return item !== null;\n        }));\n}\n\n/**\n * Parse POM JSON representation\n * @param   {string|HTMLElement}   model\n * @param   {options} options\n * @returns {Promise<Node>}\n */\nexport function fromHTML(input, options) {\n\n    if (!input) {\n        return Promise.resolve(null);\n    }\n\n    if (typeof input === 'string') {\n        if (input.length === 0) {\n            return Promise.resolve(null);\n        }\n        let wrapper = document.createElement(whatWrapper(input.replace('/^(\\s*)<([a-zA-Z0-9_-]+)', '$2').toLowerCase()));\n        wrapper.innerHTML = input;\n        return processChildren(wrapper, options)\n            .then((children) => {\n\n                if (children.length === 1) {\n                    return children[0];\n                }\n                if (children\n                    .filter((item) => !(item instanceof TextNode || item instanceof InlineNode))\n                    .length\n                ) {\n                    if (children.map((item) => item instanceof BlockNode).length) {\n                        return new Document(children.map((item) => {\n                            if (item.type === 'text') {\n                                return new Paragraph(item.text, item.formats, item.attrs, options);\n                            }\n                            return item;\n                        }));\n                    }\n                    return new Document(children);\n                }\n                let items = children.map((item) => {\n                        if (item instanceof InlineNode) {\n                            let [text, formats] = stringify([item]);\n                            return new TextNode(text, formats, options);\n                        }\n\n                        return item;\n                    }),\n                    first = items.shift();\n                items.forEach((item) => {\n                    first.append(item);\n                });\n                return first;\n            });\n    }\n    return parser.parse('html', input.nodeType === 3 ? 'text' : input.nodeName, input);\n}\n\nclass InlineNode extends BlockNode {\n\n}\n\nfunction formatType(item, text) {\n    if (item.type === 'A') {\n        return {\n            type: 'A',\n            title: item.attrs.title || text,\n            href: item.attrs.href\n        };\n    }\n    return item.type;\n}\n\nfunction stringify(items) {\n    let text = '',\n        formats = [],\n        index = 0;\n\n    items.forEach((item) => {\n        if (item instanceof InlineNode) {\n            let [innerText, innerFormats] = stringify(item.items),\n                format = {\n                    slice: [index, innerText.length],\n                    apply: [formatType(item, innerText)]\n                };\n            formats.push(format);\n            innerFormats.forEach((format) => {\n                formats.push({\n                    slice: [index + format.slice[0], format.slice[1]],\n                    apply: format.apply\n                });\n            });\n            formats.forEach((format) => {\n                formats.forEach((otherFormat, idx) => {\n                    if (format !== otherFormat && format.slice[0] === otherFormat.slice[0] && format.slice[1] === otherFormat.slice[1]) {\n                        format.apply = format.apply.concat(otherFormat.apply);\n                        formats.splice(idx, 1);\n                    }\n                });\n            });\n            text += innerText;\n            index += innerText.length;\n        } else if (item instanceof TextNode) {\n            text += item.text;\n            index += item.text.length;\n        } else {\n\n        }\n    });\n\n    return [text, formats];\n}\n\nfunction heading(token, data, options) {\n\n    return processChildren(data, options)\n        .then((items) => {\n            let [text, formats] = stringify(items);\n            return Promise.resolve(new Heading(token[1].toLowerCase(), text || '', formats.length ? formats : null, options));\n        });\n}\n\nfunction paragraph(token, data, options) {\n    return processChildren(data, options)\n        .then((items) => {\n            let [text, formats] = stringify(items);\n            return Promise.resolve(new Paragraph(text, formats.length ? formats : null));\n        });\n}\n\nfunction attributes(input) {\n    let output = null;\n    arraize(input)\n        .forEach((attribute) => {\n            output = output || {};\n            if (attribute.value && attribute.value.length) {\n                output[attribute.name] = attribute.value;\n            }\n        });\n    return output;\n\n}\n\nfunction ifAttr(value) {\n    if (value && value.length) {\n        return value;\n    }\n    return null;\n}\n\nfunction quote(token, data, options) {\n    return processChildren(data, options)\n        .then((items) => {\n\n            let paragraphs = [],\n                lastParagraph = [];\n            items.forEach((item) => {\n                if (item instanceof Paragraph) {\n                    if (lastParagraph.length) {\n                        let [text, formats] = stringify(items);\n                        paragraphs.push(Promise.resolve(new Paragraph(text, formats.length ? formats : null, options)));\n                        lastParagraph = [];\n                    }\n                    paragraphs.push(Promise.resolve(item));\n                } else {\n                    lastParagraph.push(item);\n                }\n            });\n            if (lastParagraph.length) {\n                let [text, formats] = stringify(items);\n                paragraphs.push(Promise.resolve(new Paragraph(text, formats.length ? formats : null, options)));\n            }\n\n            return Promise.all(paragraphs);\n        })\n        .then((items) => {\n            return Promise.resolve(new Quote(items));\n        });\n}\n\nparser.on('html', 'text', (token, data, options) => {\n    return Promise.resolve(new TextNode(data.textContent, null, options));\n});\nparser.on('html', 'H1', heading);\nparser.on('html', 'H2', heading);\nparser.on('html', 'H3', heading);\nparser.on('html', 'H4', heading);\nparser.on('html', 'H5', heading);\nparser.on('html', 'H6', heading);\nparser.on('html', 'P', paragraph);\nparser.on('html', 'BLOCKQUOTE', quote);\n\nparser.on('html', 'IMG', (token, data, options) => {\n    return Promise.resolve(new Image(data.src, ifAttr(data.getAttribute('title')), ifAttr(data.getAttribute('alt')), clone([attributes(data.attributes)], ['src', 'title', 'alt'])), options);\n});\n\n['ADDRESS', 'ARTICLE', 'ASIDE', 'DIV', 'FIGURE', 'FOOTER', 'HEADER', 'MAIN', 'NAV', 'SECTION'].forEach((nodeName) => {\n    parser.on('html', nodeName, (token, data, options) => {\n        return processChildren(data, options)\n            .then((items) => {\n                return Promise.resolve(new StaticBlockNode(token, items, attributes(data.attributes)), options);\n            });\n    });\n});\n\nparser.on('html', '*', (token, data, options) => {\n    return processChildren(data, options)\n        .then((items) => {\n            return Promise.resolve(new InlineNode(token, items, attributes(data.attributes)), options);\n        });\n});\n/*\nparser.on('html', '#text', (token, data) => {\n    return Promise.resolve(new TextNode(data.textContent));\n});\n\n[\n    ['b', 'strong'],\n    ['big', 'strong'],\n    ['i', 'em'],\n    'small',\n    ['tt', 'code'],\n    ['abbr', 'semantic', 'abbr'],\n    ['acronym', 'abbr', 'abbr'],\n    ['cite', 'semantic', 'cite'],\n    'code',\n    ['dfn', 'semantic', 'definition'],\n    'em',\n    ['time', 'semantic', 'time'],\n    ['var', 'code', 'var'],\n    ['kbd', 'code', 'kbd'],\n    'strong',\n    ['samp', 'code', 'sample'],\n    'bdo',\n    'a',\n    //'br',\n    //'img,\n    //'map',\n    //'object',\n    ['q', 'semantic', 'quotation'],\n    //script\n    'span',\n    del,\n    s\n    'sub',\n    'sup',\n    //button\n    //input\n    //label\n    //select\n    //textarea\n].forEach((inlineRule) => {\n\n    let input = typeof inlineRule === 'string' ? inlineRule : inlineRule[0];\n\n    parser.on('html', input, (token, data) => {\n        return processChildren(data)\n            .then((items) => {\n\n            });\n    });\n\n});\n*/\n","/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nimport {\n    parser\n}\nfrom './../parser';\n\nimport {\n    TextNode,\n    Document,\n    Heading,\n    Paragraph,\n    Image,\n    Fields,\n    Variants\n}\nfrom './../document';\n\n/**\n * Parse POM JSON representation\n * @param   {object}   model\n * @param   {options} options\n * @returns {Promise<Node>}\n */\nexport function fromPOM(model) {\n    if (!model) {\n        return Promise.resolve(null);\n    }\n    return parser.parse('pom', model.type, model);\n}\n\nfunction processChildNodes(items) {\n    if (!Array.isArray(items)) {\n        return Promise.resolve([]);\n    }\n    return Promise.all(items.map((item) => {\n        return fromPOM(item);\n    })).then((items) => {\n        return items.filter((item) => !!item);\n    });\n}\n\nparser.on('pom', 'document', (token, data) => {\n    return processChildNodes(data.items)\n        .then((items) => {\n            return new Document(items);\n        });\n});\n\nparser.on('pom', 'heading', (token, data) => {\n    return Promise.resolve(new Heading(data.level, data.text, data.formats, data.attrs));\n});\n\nparser.on('pom', 'paragraph', (token, data) => {\n    return Promise.resolve(new Paragraph(data.text, data.formats, data.attrs));\n});\n\nparser.on('pom', 'text', (token, data) => {\n    return Promise.resolve(new TextNode(data.text, data.formats));\n});\n\nparser.on('pom', 'image', (token, data) => {\n    return Promise.resolve(new Image(data.src, data.title, data.alt));\n});\n\nparser.on('pom', 'Fields', (token, data) => {\n    let fields = {};\n    return Promise.all(Object\n            .keys(data)\n            .filter((key) => key !== 'type')\n            .map((key) => {\n                return fromPOM(data[key])\n                    .then((POM) => {\n                        fields[key] = POM;\n                    });\n            }))\n        .then(() => {\n            return Promise.resolve(new Fields(fields));\n        });\n});\n\nparser.on('pom', 'Variants', (token, data) => {\n    let variants = {};\n    return Promise.all(Object\n            .keys(data)\n            .filter((key) => key !== 'type')\n            .map((key) => {\n                return fromPOM(data[key])\n                    .then((POM) => {\n                        variants[key] = POM;\n                    });\n            }))\n        .then(() => {\n            return Promise.resolve(new Variants(variants));\n        });\n});\n","/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nimport {\n    Event, Emitter\n}\nfrom './emitter';\n\nimport {\n    diff\n}\nfrom 'jsondiffpatch';\nimport {\n    toPOM\n}\nfrom './serializer/toPOM';\n\nexport const CHANGE = 'change';\nexport const DEFAULT_DOCUMENT = '#default';\n\nclass Repository extends Emitter {\n\n    constructor() {\n        super();\n        this._documents = {};\n    }\n\n    get main() {\n        return this._documents[DEFAULT_DOCUMENT];\n    }\n\n    get(documentId) {\n        if (this._documents[documentId]) {\n            return this._documents[documentId].content;\n        }\n    }\n\n    set(documentId, value) {\n        let previous = this._documents[documentId] || {\n            initial: toPOM(value)\n        };\n        this._documents[documentId] = {\n            initial: previous.initial,\n            content: value\n        };\n        this.emit(CHANGE, {\n            id: documentId\n        });\n    }\n\n    has(documentId) {\n        return !!this._documents[documentId];\n    }\n\n    diff(documentId) {\n        if (!documentId) {\n            let result = {},\n                self = this;\n            return Promise\n                .all(Object\n                    .keys(this._documents)\n                    .map(key => {\n                        return self\n                            .diff(key)\n                            .then(delta => {\n                                result[key] = delta;\n                            });\n                    }))\n                .then(() => result);\n        }\n\n        return Promise\n            .all([\n            this._documents[documentId].initial,\n            toPOM(this._documents[documentId].content)\n        ])\n            .then(results => {\n                console.log(results);\n                return diff(results[0], results[1]);\n            });\n    }\n\n    toJSON() {\n        let data = {};\n        Object\n            .keys(this._documents)\n            .forEach((key) => {\n                //console.log(this._documents[key].content);\n                data[key] = {\n                    id: key,\n                    content: this._documents[key].content.toJSON()\n                };\n            });\n        return data;\n    }\n}\n\n\nexport var repository = new Repository();\n","/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nclass Serializer {\n\n    serialize(format, node, options) {\n\n        if (!node) {\n            return Promise.reject(new Error('Model is empty'));\n        }\n\n        if (!node.type) {\n            return Promise.reject(new Error('Undefined node type'));\n        }\n\n        return this.handle(format, node.type, node, options);\n    }\n\n    on(format, nodeType, handler) {\n        this._handlers = this._handlers || {};\n        this._handlers[format] = this._handlers[format] || {};\n        this._handlers[format][nodeType] = handler;\n    }\n\n    handle(format, nodeType, node, options) {\n\n        let handler = (this._handlers && this._handlers[format] && this._handlers[format][nodeType]) ? this._handlers[format][nodeType] : null;\n        if (!handler) {\n            handler = (this._handlers && this._handlers[format] && this._handlers[format]['*']) ? this._handlers[format]['*'] : null;\n            if (!handler) {\n                return Promise.reject(new Error('No handler defined for ' + format + ' : ' + nodeType));\n            }\n        }\n        return handler(node, options)\n            .then((html) => {\n                return html;\n            });\n    }\n\n    handleContents(format, array, options) {\n        let self = this;\n        return Promise\n            .all(array.map((content) => {\n                return self.serialize('html', content, options);\n            }));\n\n    }\n}\n\nexport var serializer = new Serializer();\n","/* jslint esnext:true, node:true */\n/* globals document */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nimport {\n    serializer\n}\nfrom './../serializer';\n\nimport {\n    TextNode\n}\nfrom './../document';\nimport {\n    arraize\n}\nfrom './../util';\n\nexport function toHTML(model, options) {\n    return serializer.serialize('html', model, options);\n}\n\nfunction otherAttrs(object, except) {\n    let result = {};\n    Object\n        .keys(object)\n        .filter((key) => {\n            return except.indexOf(key) === -1;\n        })\n        .forEach((key) => {\n            result[key] = object[key];\n        });\n    return result;\n}\n\nfunction format(string, formats) {\n    let wrapper = document.createElement('p'),\n        slices = string.split('').map((char) => {\n            return {\n                char: char,\n                apply: []\n            };\n        });\n\n    slices.push({\n        char: '',\n        apply: []\n    });\n\n    formats.forEach((format) => {\n        let from = format.slice[0],\n            to = from + format.slice[1];\n\n        format.apply.forEach((apply) => {\n            if (slices[from].apply.indexOf(apply) == -1) {\n                slices[from].apply.push(apply);\n            }\n            if (slices[to].apply.indexOf('/' + apply) == -1) {\n                slices[to].apply.push('/' + apply);\n            }\n        });\n    });\n    wrapper.innerHTML = slices.map((char) => {\n        return char.apply.map((tag) => '<' + tag + '>').join('') + char.char;\n    }).join('');\n    return arraize(wrapper.childNodes);\n}\n\nexport function element(node, nodeType, attributes, content, options) {\n\n    let promise;\n\n    if (content) {\n\n        promise = serializer.handleContents('html', content || [], options);\n    } else {\n        promise = Promise.resolve(null);\n    }\n\n    return promise.then((content) => {\n\n        if (node.formats && node.formats.length) {\n            content = format(content[0].nodeValue, node.formats);\n        }\n\n        let elem = document.createElement(nodeType);\n        if (options && options.edit) {\n            elem.setAttribute('data-skaryna-id', node.name);\n        }\n        if (attributes) {\n            Object\n                .keys(attributes)\n                .forEach((attributeName) => {\n                    elem.setAttribute(attributeName, attributes[attributeName]);\n                });\n        }\n        if (Array.isArray(content)) {\n            content.forEach((child) => elem.appendChild(child));\n        }\n        return elem;\n    });\n}\n\nclass FakeDoc {\n\n    constructor() {\n        this.children = [];\n    }\n\n    appendChild(child) {\n        this.children.push(child);\n    }\n\n    get outerHTML() {\n        let str = '';\n        this.children.forEach((child) => {\n            if (child.nodeType === 1) {\n                str += child.outerHTML;\n            } else {\n                str += child.textContent;\n            }\n        });\n        return str;\n    }\n}\n\nserializer.on('html', 'document', (node, options) => {\n    return serializer\n        .handleContents('html', node.items || [], options)\n        .then((contents) => {\n            let output = new FakeDoc();\n            if (Array.isArray(contents)) {\n                contents.forEach((child) => output.appendChild(child));\n            }\n            return output;\n        });\n});\n\nserializer.on('html', 'heading', (node, options) => {\n    return element(node, 'h' + (node.level || 1), node.attr(), [new TextNode(node.text, node.formats)], options);\n});\n\nserializer.on('html', 'paragraph', (node, options) => {\n    return element(node, 'p', node.attr(), [new TextNode(node.text, node.formats)], options);\n});\n\nserializer.on('html', 'image', (node, options) => {\n    return element(node, 'img', node.attr(), null, options);\n});\n\nserializer.on('html', 'text', (node, options) => {\n    let element = document.createTextNode(node.text);\n    if (options && options.edit) {\n        //element.setAttribute('name', node.name);\n    }\n    return Promise.resolve(element);\n});\n\nserializer.on('html', '*', (node, options) => {\n    return element(node, node._type, node.attr(), node.items, options);\n});\n","/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nimport {\n    serializer\n}\nfrom './../serializer';\n\nexport function toPOM(model, options) {\n    return serializer.serialize('pom', model, options);\n}\n\nserializer.on('pom', '*', (node) => Promise.resolve(node.toJSON()));\n\n","/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\nexport class Toolbar {\n\n    constructor() {\n        //super();\n\n        this.element = document.createElement('div');\n        this.element.setAttribute('data-skaryna-toolbar', '');\n        this.element.innerHTML = '<div data-skaryna-toolbar-actions>aaaaaaaaa</div><div data-skaryna-toolbar-arrow><span></span></div>';\n        this.arrow = this.element.querySelector('[data-skaryna-toolbar-arrow]');\n\n        let styles = document.createElement('style');\n        styles.innerText = `\n            [data-skaryna-toolbar] {\n                position: absolute;\n                visibility: hidden;\n                display: none;\n                z-index: 10000;\n                transition: none;\n                top: 0;\n                left: 0;\n            }\n\n            [data-skaryna-toolbar-actions] {\n                position: relative;\n                background-image: linear-gradient(to bottom,rgba(49,49,47,.99),#262625);\n                background-repeat: repeat-x;\n                border-radius: 5px;\n            }\n\n            [data-skaryna-toolbar-arrow] {\n                position: absolute;\n                bottom: -10px;\n                left: 50%;\n                clip: rect(10px 20px 20px 0);\n                margin-left: -10px;\n            }\n\n            [data-skaryna-toolbar-arrow] > span {\n                display: block;\n                width: 20px;\n                height: 20px;\n                background-color: #262625;\n                transform: rotate(45deg) scale(.5);\n            }\n            `;\n\n        document.body.appendChild(styles);\n        document.body.appendChild(this.element);\n    }\n\n    getSelectionCoords(theWindow) {\n        let win = theWindow || window,\n            doc = win.document,\n            sel = doc.selection,\n            range, rects, rect,\n            x = 0,\n            y = 0;\n        if (sel) {\n            if (sel.type != \"Control\") {\n                range = sel.createRange();\n                range.collapse(true);\n                x = range.boundingLeft;\n                y = range.boundingTop;\n            }\n        } else if (win.getSelection) {\n            sel = win.getSelection();\n            if (sel.rangeCount) {\n                range = sel.getRangeAt(0).cloneRange();\n                if (range.getClientRects) {\n                    range.collapse(true);\n                    rects = range.getClientRects();\n\n                    if (rects.length > 0) {\n                        rect = rects[0];\n                    }\n                    x = rect.left;\n                    y = rect.top;\n                }\n                // Fall back to inserting a temporary element\n                if (x == 0 && y == 0) {\n                    var span = doc.createElement(\"span\");\n                    if (span.getClientRects) {\n                        // Ensure span has dimensions and position by\n                        // adding a zero-width space character\n                        span.appendChild(doc.createTextNode(\"\\u200b\"));\n                        range.insertNode(span);\n                        rect = span.getClientRects()[0];\n                        x = rect.left;\n                        y = rect.top;\n                        var spanParent = span.parentNode;\n                        spanParent.removeChild(span);\n\n                        // Glue any broken text nodes back together\n                        spanParent.normalize();\n                    }\n                }\n            }\n        }\n        return {\n            x: x,\n            y: y\n        };\n    }\n\n    anchor() {\n        let coords = this.getSelectionCoords(),\n            self = this,\n            rect,\n            arrow;\n        this.element.style.display = 'block';\n        this.element.style.visibility = 'visible';\n\n        setTimeout(() => {\n            rect = this.element.getBoundingClientRect();\n            arrow = this.arrow.getBoundingClientRect();\n            this.show(coords.x, coords.y - rect.height - 10);\n        }, 1);\n    }\n\n    show(x, y) {\n        this.element.style.top = y + 'px';\n        this.element.style.left = x + 'px';\n    }\n    hide() {\n        this.element.style.display = null;\n        this.element.style.visibility = null;\n    }\n}\n","/* jslint esnext:true, node:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\n\n/**\n * Convert iterable objects into arrays\n * @param   {Iterable} iterable\n * @returns {Array}\n */\nexport function arraize(iterable) {\n    return [].slice.apply(iterable);\n}\n\nexport function clone(inputs, except) {\n    let result = {};\n    inputs\n        .forEach((input) => {\n            if (typeof input !== 'object') {\n                return;\n            }\n            Object\n                .keys(input)\n                .forEach((key) => {\n                    if (except && except.indexOf(key) !== -1) {\n                        return;\n                    }\n                    result[key] = JSON.parse(JSON.stringify(input[key]));\n                });\n        });\n    return result;\n}\n","/* jslint esnext:true, node:true, browser:true */\n/**\n    The MIT License (MIT)\n\n    Copyright (c) 2016 ukasz Marek Sielski\n\n    Permission is hereby granted, free of charge, to any person obtaining a copy\n    of this software and associated documentation files (the \"Software\"), to deal\n    in the Software without restriction, including without limitation the rights\n    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n    copies of the Software, and to permit persons to whom the Software is\n    furnished to do so, subject to the following conditions:\n\n    The above copyright notice and this permission notice shall be included in all\n    copies or substantial portions of the Software.\n\n    THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n    SOFTWARE.\n*/\nexport class XHR {\n  static ajax(path, method, data, raw) {\n\n    return new Promise((resolve, reject) => {\n\n      let xhr = new XMLHttpRequest(),\n        httpMethod = method.toLowerCase();\n\n      xhr.open(httpMethod, path);\n      if (httpMethod === 'post' || httpMethod === 'put') {\n        xhr.setRequestHeader('Content-type', 'application/json');\n      }\n\n      xhr.onreadystatechange = () => {\n        let DONE = 4, // readyState 4 means the request is done.\n          OK = 200; // status 200 is a successful return.\n        if (xhr.readyState === DONE) {\n          if (xhr.status === OK) {\n            resolve(xhr.responseText); // 'This is the returned text.'\n          } else if (xhr.status === '204') {\n            resolve(null);\n          } else {\n            reject(new Error('Error: ' + xhr.status)); // An error occurred during the request.\n          }\n        }\n      };\n\n      xhr.send(data ? (raw ? data : JSON.stringify(data)) : null);\n\n    });\n  }\n  static get(path, raw) {\n    return XHR.ajax(path, 'get', null, raw);\n  }\n  static post(path, data, raw) {\n    return XHR.ajax(path, 'post', data, raw);\n  }\n  static put(path, data, raw) {\n    return XHR.ajax(path, 'put', data, raw);\n  }\n  static delete(path, raw) {\n    return XHR.ajax(path, 'delete', null, raw);\n  }\n}\n"],"sourceRoot":"/source/"}