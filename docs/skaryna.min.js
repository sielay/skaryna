!function t(e,n,r){function i(s,a){if(!n[s]){if(!e[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var f=n[s]={exports:{}};e[s][0].call(f.exports,function(t){var n=e[s][1][t];return i(n?n:t)},f,f.exports,t,e,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){return String(t).replace(/([.*+?=^!:${}()|[\]\/\\])/g,"\\$1")}function a(t,e){var n,r=null;return t.forEach(function(t){var i=new RegExp(s(t).replace(/\\\*/g,"(.+)")),o=t.split("*").filter(function(t){return t.length}).length,a=e.match(i);a&&(null===r||a.length-o<r)&&(r=a.length-o,n=t)}),n}function u(t){return v[t]}function l(t){if(!t)return null;var e=t.getAttribute("data-skaryna-id");return u(e)}function f(t){for(var e="abcdefghijklmnopqrstuvwxyz0123456789",n="",r=0;r<5;r++)n+=e.charAt(Math.floor(Math.random()*e.length));return Object.keys(v).indexOf(n)===-1?(v[n]=v[n]||t,n):f(t)}Object.defineProperty(n,"__esModule",{value:!0}),n.Variants=n.Fields=n.StaticBlockNode=n.Heading=n.Image=n.Paragraph=n.TextNode=n.Quote=n.Document=n.BlockNode=n.Node=void 0;var c=function _(t,e,n){null===t&&(t=Function.prototype);var r=Object.getOwnPropertyDescriptor(t,e);if(void 0===r){var i=Object.getPrototypeOf(t);return null===i?void 0:_(i,e,n)}if("value"in r)return r.value;var o=r.get;if(void 0!==o)return o.call(n)},h=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.escapeRegexp=s,n.bestMatch=a,n.getById=u,n.getByNode=l,n.randomID=f;var p=t("./emitter"),d=t("./util"),y=t("./serializer/toHTML"),v={},m=n.Node=function(t){function e(t){r(this,e);var n=i(this,Object.getPrototypeOf(e).call(this));return n.name=t||f(n),n.__locked=!1,n}return o(e,t),h(e,[{key:"lock",value:function(){this.__locked=!0}},{key:"attr",value:function(){return this.attrs}},{key:"get",value:function(){throw new Error("Should be implemented")}},{key:"set",value:function(){throw new Error("Should be implemented")}},{key:"toJSON",value:function(){var t=new Error("Should be implemented");throw t}},{key:"locked",get:function(){return this.__locked}},{key:"defaultNewItem",get:function(){return null}},{key:"allowedNewItems",get:function(){return[]}}]),e}(p.Emitter),g=n.BlockNode=function(t){function e(t,n,o){r(this,e);var s=i(this,Object.getPrototypeOf(e).call(this));return s._type=t,s.items=n||[],s.attrs=o,s}return o(e,t),h(e,[{key:"get",value:function(t){var e=t.split("."),n=e.shift(),r=e.join("."),i=void 0;return isNaN(n)?null:(i=this.items[+n],r.length&&i?i.get(r):i)}},{key:"setById",value:function(t,e){var n=this,r=!1;return this.items.forEach(function(i,o){if(!r)return i.name===t?(n.items[o]=e,void(r=!0)):void(r=!!i.setById&&i.setById(t,e))}),r}},{key:"set",value:function(t,e){if("@"===t[0])return this.setById(t.slice(1),e);var n=t.split("."),r=n.shift(),i=n.join("."),o=void 0;return isNaN(r)?null:i.length&&o?this.items[+r].set(i,e):void this.items.splice(+r,0,e)}},{key:"toJSON",value:function(){var t={type:this.type,items:this.items.map(function(t){return t.toJSON()})};return this.attrs&&(t.attrs=JSON.parse(JSON.stringify(this.attrs))),t}},{key:"decorate",value:function(t){return(0,y.toHTML)(this,{edit:!0}).then(function(e){t.innerHTML="",(0,d.arraize)(e.children).forEach(function(e){t.appendChild(e)})})}},{key:"empty",get:function(){return this.items.length<=0}},{key:"type",get:function(){return this._type}}]),e}(m),b=(n.Document=function(t){function e(t){return r(this,e),i(this,Object.getPrototypeOf(e).call(this,"document",t))}return o(e,t),h(e,[{key:"defaultNewItem",get:function(){return x}},{key:"allowedNewItems",get:function(){return[x,w]}}]),e}(g),n.Quote=function(t){function e(t){return r(this,e),i(this,Object.getPrototypeOf(e).call(this,"quote",t))}return o(e,t),e}(g),n.TextNode=function(t){function e(t,n,o){r(this,e);var s=i(this,Object.getPrototypeOf(e).call(this));return s.text=t&&t.toString?t.toString():"",s.formats=n||null,s.attrs=o,s}return o(e,t),h(e,[{key:"attr",value:function(){return"text"===this.type?{}:c(Object.getPrototypeOf(e.prototype),"attr",this).call(this)}},{key:"type",get:function(){return"text"}},{key:"empty",get:function(){return!this.text||!this.text.replace(/^([\s\n\r\t]+)|([\s\n\r\t]+)$/,"").length}},{key:"absoluteEmpty",get:function(){return 0===this.text.length}}],[{key:"type",get:function(){return"text"}}]),h(e,[{key:"toJSON",value:function(){var t={type:this.type,text:this.text};return this.formats&&(t.formats=JSON.parse(JSON.stringify(this.formats))),this.attrs&&"text"!==this.type&&(t.attrs=JSON.parse(JSON.stringify(this.attrs))),t}},{key:"append",value:function(t){var n=this;if(!(t instanceof e))throw new Error("Only text nodes can be joined");t.formats&&(this.formats=this.formats||[],t.formats.forEach(function(t){n.formats.push({slice:[t.slice[0]+n.text.length,t.slice[1]],apply:t.apply})})),this.text+=t.text}},{key:"decorate",value:function(t){var e=this;return(0,y.toHTML)(this,{edit:!0}).then(function(n){t.setAttribute("contenteditable",!0),t.setAttribute("data-skaryna-id",e.name),t.innerHTML=n.textContent})}}]),e}(m)),x=n.Paragraph=function(t){function e(t,n,o){return r(this,e),i(this,Object.getPrototypeOf(e).call(this,t,n,o))}return o(e,t),h(e,[{key:"type",get:function(){return"paragraph"}}],[{key:"type",get:function(){return"paragraph"}}]),h(e,[{key:"nextNodeType",get:function(){return e}}]),e}(b),w=n.Image=function(t){function e(t,n,o){r(this,e);var s=i(this,Object.getPrototypeOf(e).call(this,"image"));return s.src=t,s.title=n,s.alt=o,s}return o(e,t),h(e,[{key:"attr",value:function(){var t=c(Object.getPrototypeOf(e.prototype),"attr",this).call(this)||{};return this.src&&(t.src=this.src),this.title&&(t.title=this.title),this.alt&&(t.alt=this.title),t}},{key:"toJSON",value:function(){var t={type:"image",src:this.src};return this.title&&(t.title=this.title),this.alt&&(t.alt=this.alt),t}},{key:"type",get:function(){return"image"}}],[{key:"type",get:function(){return"image"}}]),e}(m);n.Heading=function(t){function e(t,n,o,s){r(this,e);var a=i(this,Object.getPrototypeOf(e).call(this,n,o,s));return a.level=Math.min(6,t||1),a}return o(e,t),h(e,[{key:"attr",value:function(){return c(Object.getPrototypeOf(e.prototype),"attr",this).call(this)}},{key:"toJSON",value:function(){var t=c(Object.getPrototypeOf(e.prototype),"toJSON",this).call(this);return t.level=this.level,t}},{key:"type",get:function(){return"heading"}}],[{key:"type",get:function(){return"heading"}}]),e}(b),n.StaticBlockNode=function(t){function e(){return r(this,e),i(this,Object.getPrototypeOf(e).apply(this,arguments))}return o(e,t),h(e,[{key:"locked",get:function(){return!0}},{key:"defaultNewItem",get:function(){return x}},{key:"allowedNewItems",get:function(){return[x,w]}}]),e}(g),n.Fields=function(t){function e(t){r(this,e);var n=i(this,Object.getPrototypeOf(e).call(this));return n._map=t||{},n}return o(e,t),h(e,[{key:"get",value:function(t){var e=t.split("."),n=e.shift(),r=e.join("."),i=void 0;return i=this._map[n],r.length&&i?i.get(r):i}},{key:"set",value:function(t,e){var n=t.split("."),r=n.shift(),i=n.join("."),o=void 0;return i.length&&o?this._map[r].get(i,e):void(this._map[r]=e)}},{key:"toJSON",value:function(){return(0,d.clone)([this._map,{type:"Fields"}])}},{key:"type",get:function(){return"Fields"}}],[{key:"type",get:function(){return"Fields"}}]),e}(m),n.Variants=function(t){function e(t){r(this,e);var n=i(this,Object.getPrototypeOf(e).call(this));return n._variants=t,n}return o(e,t),h(e,[{key:"best",value:function n(t){var n=a(Object.keys(this._variants),t);return this._variants[n]}},{key:"toJSON",value:function(){return(0,d.clone)([this._map,{type:"Variants"}])}},{key:"type",get:function(){return"Variants"}}],[{key:"type",get:function(){return"Variants"}}]),e}(m)},{"./emitter":2,"./serializer/toHTML":7,"./util":8}],2:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){var n=e.fn,r=e.context,i=e.args,o=[t].concat(i);n.apply(r||null,o)}function o(t,e,n,r,i){this.__listeners=this.__listeners||{},this.__listeners[t]=this.__listeners[t]||[],this.__listeners[t].push({fn:e,context:n,args:r,once:!!i})}function s(t,e,n,r){this.on(t,e,n,r,!0)}function a(t,e,n,r,i){var o=this;this.__listeners&&this.__listeners[t]&&this.getListeners(t,e,n,r,i).forEach(function(e){o.__listeners[t].splice(o.__listeners[t].indexOf(e),1)})}function u(t,e,n){if(this.__listeners&&this.__listeners[t]){var r=this,o=new h(t,e,this,n);this.getListeners(t).forEach(function(e){e.once===!0&&r.off(t,e.fn,e.context,e.args,e.once),i(o,e)})}}function l(t,e){this.on(t,function(n){e.emit(t,n.data,n)})}function f(t,e,n,r){return this.__listeners&&this.__listeners[t]?this.__listeners[t].map(function(t){return(void 0===e||t.fn===e)&&((void 0===n||t.context===n)&&((void 0===r||t.args===r)&&t))}).filter(function(t){return!!t}):null}Object.defineProperty(n,"__esModule",{value:!0});var c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),h=n.Event=function(){function t(e,n,i,o){r(this,t),Object.defineProperties(this,{name:{value:e,writable:!1},data:{value:n,writable:!1},source:{value:i,writable:!1},parent:{value:o,writable:!1}})}return c(t,[{key:"toJSON",value:function(){return{name:this.name,data:this.data,source:this.source,parent:this.parent}}},{key:"toString",value:function(){return"Event: "+JSON.stringify(this.toJSON())}}]),t}();n.Emitter=function(){function t(){r(this,t)}return c(t,[{key:"on",value:function(){o.apply(this,arguments)}},{key:"once",value:function(){s.apply(this,arguments)}},{key:"off",value:function(){a.apply(this,arguments)}},{key:"emit",value:function(){u.apply(this,arguments)}},{key:"bubbleEvent",value:function(){l.apply(this,arguments)}},{key:"getListeners",value:function(){return f.apply(this,arguments)}}],[{key:"on",value:function(){o.apply(this,arguments)}},{key:"once",value:function(){s.apply(this,arguments)}},{key:"off",value:function(){a.apply(this,arguments)}},{key:"emit",value:function(){u.apply(this,arguments)}},{key:"bubbleEvent",value:function(){l.apply(this,arguments)}},{key:"getListeners",value:function(){return f.apply(this,arguments)}}]),t}()},{}],3:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(){r(this,t)}return i(t,[{key:"parse",value:function(t,e,n,r){return e?this.handle(t,e,n,r):Promise.reject(new Error("Model is empty"))}},{key:"on",value:function(t,e,n){this._handlers=this._handlers||{},this._handlers[t]=this._handlers[t]||{},this._handlers[t][e]=n}},{key:"handle",value:function(t,e,n,r){var i=this._handlers&&this._handlers[t]&&this._handlers[t][e]?this._handlers[t][e]:null;return i||(i=this._handlers&&this._handlers[t]&&this._handlers[t]["*"]?this._handlers[t]["*"]:null)?i(e,n,r).then(function(t){return t}):Promise.reject(new Error("No handler defined for "+t+" : "+e))}}]),t}();n.parser=new o},{}],4:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function s(t){switch(t){case"td":case"th":return"tr";case"tr":return"table";default:return"div"}}function a(t,e){return t&&t.childNodes?Promise.all((0,g.arraize)(t.childNodes).map(function(t){return 1===t.nodeType||3===t.nodeType?u(t,e):null})).then(function(t){return t.filter(function(t){return t.constructor===b.TextNode?!t.absoluteEmpty:null!==t})}):Promise.resolve([])}function u(t,e){if(!t)return Promise.resolve(null);if("string"==typeof t){if(0===t.length)return Promise.resolve(null);var n=document.createElement(s(t.replace("/^(s*)<([a-zA-Z0-9_-]+)","$2").toLowerCase()));return n.innerHTML=t,a(n,e).then(function(t){if(1===t.length)return t[0];if(t.filter(function(t){return!(t instanceof b.TextNode||t instanceof x)}).length)return t.map(function(t){return t instanceof b.BlockNode}).length?new b.Document(t.map(function(t){return"text"===t.type?new b.Paragraph(t.text,t.formats,t.attrs,e):t})):new b.Document(t);var n=t.map(function(t){if(t instanceof x){var n=f([t]),r=v(n,2),i=r[0],o=r[1];return new b.TextNode(i,o,e)}return t}),r=n.shift();return n.forEach(function(t){r.append(t)}),r})}return m.parser.parse("html",3===t.nodeType?"text":t.nodeName,t)}function l(t,e){return"A"===t.type?{type:"A",title:t.attrs.title||e,href:t.attrs.href}:t.type}function f(t){var e="",n=[],r=0;return t.forEach(function(t){if(t instanceof x){var i=f(t.items),o=v(i,2),s=o[0],a=o[1],u={slice:[r,s.length],apply:[l(t,s)]};n.push(u),a.forEach(function(t){n.push({slice:[r+t.slice[0],t.slice[1]],apply:t.apply})}),n.forEach(function(t){n.forEach(function(e,r){t!==e&&t.slice[0]===e.slice[0]&&t.slice[1]===e.slice[1]&&(t.apply=t.apply.concat(e.apply),n.splice(r,1))})}),e+=s,r+=s.length}else t instanceof b.TextNode&&(e+=t.text,r+=t.text.length)}),[e,n]}function c(t,e,n){return a(e,n).then(function(e){var r=f(e),i=v(r,2),o=i[0],s=i[1];return Promise.resolve(new b.Heading(t[1].toLowerCase(),o||"",s.length?s:null,n))})}function h(t,e,n){return a(e,n).then(function(t){var e=f(t),n=v(e,2),r=n[0],i=n[1];return Promise.resolve(new b.Paragraph(r,i.length?i:null))})}function p(t){var e=null;return(0,g.arraize)(t).forEach(function(t){e=e||{},t.value&&t.value.length&&(e[t.name]=t.value)}),e}function d(t){return t&&t.length?t:null}function y(t,e,n){return a(e,n).then(function(t){var e=[],r=[];if(t.forEach(function(i){if(i instanceof b.Paragraph){if(r.length){var o=f(t),s=v(o,2),a=s[0],u=s[1];e.push(Promise.resolve(new b.Paragraph(a,u.length?u:null,n))),r=[]}e.push(Promise.resolve(i))}else r.push(i)}),r.length){var i=f(t),o=v(i,2),s=o[0],a=o[1];e.push(Promise.resolve(new b.Paragraph(s,a.length?a:null,n)))}return Promise.all(e)}).then(function(t){return Promise.resolve(new b.Quote(t))})}Object.defineProperty(n,"__esModule",{value:!0});var v=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);r=!0);}catch(u){i=!0,o=u}finally{try{!r&&a["return"]&&a["return"]()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();n.fromHTML=u;var m=t("./../parser"),g=t("./../util"),b=t("./../document"),x=function(t){function e(){return r(this,e),i(this,Object.getPrototypeOf(e).apply(this,arguments))}return o(e,t),e}(b.BlockNode);m.parser.on("html","text",function(t,e,n){return Promise.resolve(new b.TextNode(e.textContent,null,n))}),m.parser.on("html","H1",c),m.parser.on("html","H2",c),m.parser.on("html","H3",c),m.parser.on("html","H4",c),m.parser.on("html","H5",c),m.parser.on("html","H6",c),m.parser.on("html","P",h),m.parser.on("html","BLOCKQUOTE",y),m.parser.on("html","IMG",function(t,e,n){return Promise.resolve(new b.Image(e.src,d(e.getAttribute("title")),d(e.getAttribute("alt")),(0,g.clone)([p(e.attributes)],["src","title","alt"])),n)}),["ADDRESS","ARTICLE","ASIDE","DIV","FIGURE","FOOTER","HEADER","MAIN","NAV","SECTION"].forEach(function(t){m.parser.on("html",t,function(t,e,n){return a(e,n).then(function(r){return Promise.resolve(new b.StaticBlockNode(t,r,p(e.attributes)),n)})})}),m.parser.on("html","*",function(t,e,n){return a(e,n).then(function(r){return Promise.resolve(new x(t,r,p(e.attributes)),n)})})},{"./../document":1,"./../parser":3,"./../util":8}],5:[function(t,e,n){"use strict";function r(t){return t?o.parser.parse("pom",t.type,t):Promise.resolve(null)}function i(t){return Array.isArray(t)?Promise.all(t.map(function(t){return r(t)})).then(function(t){return t.filter(function(t){return!!t})}):Promise.resolve([])}Object.defineProperty(n,"__esModule",{value:!0}),n.fromPOM=r;var o=t("./../parser"),s=t("./../document");o.parser.on("pom","document",function(t,e){return i(e.items).then(function(t){return new s.Document(t)})}),o.parser.on("pom","heading",function(t,e){return Promise.resolve(new s.Heading(e.level,e.text,e.formats,e.attrs))}),o.parser.on("pom","paragraph",function(t,e){return Promise.resolve(new s.Paragraph(e.text,e.formats,e.attrs))}),o.parser.on("pom","text",function(t,e){return Promise.resolve(new s.TextNode(e.text,e.formats))}),o.parser.on("pom","image",function(t,e){return Promise.resolve(new s.Image(e.src,e.title,e.alt))}),o.parser.on("pom","Fields",function(t,e){var n={};return Promise.all(Object.keys(e).filter(function(t){return"type"!==t}).map(function(t){return r(e[t]).then(function(e){n[t]=e})})).then(function(){return Promise.resolve(new s.Fields(n))})}),o.parser.on("pom","Variants",function(t,e){var n={};return Promise.all(Object.keys(e).filter(function(t){return"type"!==t}).map(function(t){return r(e[t]).then(function(e){n[t]=e})})).then(function(){return Promise.resolve(new s.Variants(n))})})},{"./../document":1,"./../parser":3}],6:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),o=function(){function t(){r(this,t)}return i(t,[{key:"serialize",value:function(t,e,n){return e?e.type?this.handle(t,e.type,e,n):Promise.reject(new Error("Undefined node type")):Promise.reject(new Error("Model is empty"))}},{key:"on",value:function(t,e,n){this._handlers=this._handlers||{},this._handlers[t]=this._handlers[t]||{},this._handlers[t][e]=n}},{key:"handle",value:function(t,e,n,r){var i=this._handlers&&this._handlers[t]&&this._handlers[t][e]?this._handlers[t][e]:null;return i||(i=this._handlers&&this._handlers[t]&&this._handlers[t]["*"]?this._handlers[t]["*"]:null)?i(n,r).then(function(t){return t}):Promise.reject(new Error("No handler defined for "+t+" : "+e))}},{key:"handleContents",value:function(t,e,n){var r=this;return Promise.all(e.map(function(t){return r.serialize("html",t,n)}))}}]),t}();n.serializer=new o},{}],7:[function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){return u.serializer.serialize("html",t,e)}function o(t,e){var n=document.createElement("p"),r=t.split("").map(function(t){return{"char":t,apply:[]}});return r.push({"char":"",apply:[]}),e.forEach(function(t){var e=t.slice[0],n=e+t.slice[1];t.apply.forEach(function(t){r[e].apply.indexOf(t)==-1&&r[e].apply.push(t),r[n].apply.indexOf("/"+t)==-1&&r[n].apply.push("/"+t)})}),n.innerHTML=r.map(function(t){return t.apply.map(function(t){return"<"+t+">"}).join("")+t["char"]}).join(""),(0,f.arraize)(n.childNodes)}function s(t,e,n,r,i){var s=void 0;return s=r?u.serializer.handleContents("html",r||[],i):Promise.resolve(null),s.then(function(r){t.formats&&t.formats.length&&(r=o(r[0].nodeValue,t.formats));var s=document.createElement(e);return i&&i.edit&&(s.setAttribute("data-skaryna-id",t.name),t instanceof l.TextNode&&s.setAttribute("contenteditable","true")),n&&Object.keys(n).forEach(function(t){s.setAttribute(t,n[t])}),Array.isArray(r)&&r.forEach(function(t){return s.appendChild(t)}),s})}Object.defineProperty(n,"__esModule",{value:!0});var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}();n.toHTML=i,n.element=s;var u=t("./../serializer"),l=t("./../document"),f=t("./../util"),c=function(){function t(){r(this,t),this.children=[]}return a(t,[{key:"appendChild",value:function(t){this.children.push(t)}},{key:"outerHTML",get:function(){var t="";return this.children.forEach(function(e){t+=1===e.nodeType?e.outerHTML:e.textContent}),t}}]),t}();u.serializer.on("html","document",function(t,e){return u.serializer.handleContents("html",t.items||[],e).then(function(t){var e=new c;return Array.isArray(t)&&t.forEach(function(t){return e.appendChild(t)}),e})}),u.serializer.on("html","heading",function(t,e){return s(t,"h"+(t.level||1),t.attr(),[new l.TextNode(t.text,t.formats)],e)}),u.serializer.on("html","paragraph",function(t,e){return s(t,"p",t.attr(),[new l.TextNode(t.text,t.formats)],e)}),u.serializer.on("html","image",function(t,e){return s(t,"img",t.attr(),null,e)}),u.serializer.on("html","text",function(t,e){var n=document.createTextNode(t.text);return e&&e.edit,Promise.resolve(n)}),u.serializer.on("html","*",function(t,e){return s(t,t._type,t.attr(),t.items,e)})},{"./../document":1,"./../serializer":6,"./../util":8}],8:[function(t,e,n){"use strict";function r(t){return[].slice.apply(t)}function i(t,e){return r(t.querySelectorAll(e))}function o(t,e){var n={};return t.forEach(function(t){"object"===("undefined"==typeof t?"undefined":s(t))&&Object.keys(t).forEach(function(r){e&&e.indexOf(r)!==-1||(n[r]=JSON.parse(JSON.stringify(t[r])))})}),n}Object.defineProperty(n,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t};n.arraize=r,n.query=i,n.clone=o},{}],9:[function(t,e,n){"use strict";var r=t("../pipe").Pipe,i=function(){};i.prototype.setResult=function(t){return this.result=t,this.hasResult=!0,this},i.prototype.exit=function(){return this.exiting=!0,this},i.prototype.switchTo=function(t,e){return"string"==typeof t||t instanceof r?this.nextPipe=t:(this.next=t,e&&(this.nextPipe=e)),this},i.prototype.push=function(t,e){return t.parent=this,"undefined"!=typeof e&&(t.childName=e),t.root=this.root||this,t.options=t.options||this.options,this.children?(this.children[this.children.length-1].next=t,this.children.push(t)):(this.children=[t],this.nextAfterChildren=this.next||null,this.next=t),t.next=this,this},n.Context=i},{"../pipe":23}],10:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},i=t("./context").Context,o=t("../date-reviver"),s=function(t,e){this.left=t,this.right=e,this.pipe="diff"};s.prototype=new i,s.prototype.setResult=function(t){if(this.options.cloneDiffValues){var e="function"==typeof this.options.cloneDiffValues?this.options.cloneDiffValues:function(t){return JSON.parse(JSON.stringify(t),o)};"object"===r(t[0])&&(t[0]=e(t[0])),"object"===r(t[1])&&(t[1]=e(t[1]))}return i.prototype.setResult.apply(this,arguments)},n.DiffContext=s},{"../date-reviver":13,"./context":9}],11:[function(t,e,n){"use strict";var r=t("./context").Context,i=function(t,e){this.left=t,this.delta=e,this.pipe="patch"};i.prototype=new r,n.PatchContext=i},{"./context":9}],12:[function(t,e,n){"use strict";var r=t("./context").Context,i=function(t){this.delta=t,this.pipe="reverse"};i.prototype=new r,n.ReverseContext=i},{"./context":9}],13:[function(t,e,n){"use strict";e.exports=function(t,e){var n;return"string"==typeof e&&(n=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2})(?:\.(\d*))?(Z|([+\-])(\d{2}):(\d{2}))$/.exec(e))?new Date(Date.UTC(+n[1],+n[2]-1,+n[3],+n[4],+n[5],+n[6],+(n[7]||0))):e}},{}],14:[function(t,e,n){"use strict";var r=t("./processor").Processor,i=t("./pipe").Pipe,o=t("./contexts/diff").DiffContext,s=t("./contexts/patch").PatchContext,a=t("./contexts/reverse").ReverseContext,u=t("./filters/trivial"),l=t("./filters/nested"),f=t("./filters/arrays"),c=t("./filters/dates"),h=t("./filters/texts"),p=function(t){this.processor=new r(t),this.processor.pipe(new i("diff").append(l.collectChildrenDiffFilter,u.diffFilter,c.diffFilter,h.diffFilter,l.objectsDiffFilter,f.diffFilter).shouldHaveResult()),this.processor.pipe(new i("patch").append(l.collectChildrenPatchFilter,f.collectChildrenPatchFilter,u.patchFilter,h.patchFilter,l.patchFilter,f.patchFilter).shouldHaveResult()),this.processor.pipe(new i("reverse").append(l.collectChildrenReverseFilter,f.collectChildrenReverseFilter,u.reverseFilter,h.reverseFilter,l.reverseFilter,f.reverseFilter).shouldHaveResult())};p.prototype.options=function(){return this.processor.options.apply(this.processor,arguments)},p.prototype.diff=function(t,e){return this.processor.process(new o(t,e))},p.prototype.patch=function(t,e){return this.processor.process(new s(t,e))},p.prototype.reverse=function(t){return this.processor.process(new a(t))},p.prototype.unpatch=function(t,e){return this.patch(t,this.reverse(e))},n.DiffPatcher=p},{"./contexts/diff":10,"./contexts/patch":11,"./contexts/reverse":12,"./filters/arrays":16,"./filters/dates":17,"./filters/nested":19,"./filters/texts":20,"./filters/trivial":21,"./pipe":23,"./processor":24}],15:[function(t,e,n){"use strict";n.isBrowser="undefined"!=typeof window},{}],16:[function(t,e,n){"use strict";function r(t,e,n,r){for(var i=0;i<n;i++)for(var o=t[i],s=0;s<r;s++){var a=e[s];if(o===a)return!0}}function i(t,e,n,r,i){var s=t[n],a=e[r];if(s===a)return!0;if("object"!==("undefined"==typeof s?"undefined":o(s))||"object"!==("undefined"==typeof a?"undefined":o(a)))return!1;var u=i.objectHash;if(!u)return i.matchByPosition&&n===r;var l,f;return"number"==typeof n?(i.hashCache1=i.hashCache1||[],l=i.hashCache1[n],"undefined"==typeof l&&(i.hashCache1[n]=l=u(s,n))):l=u(s),"undefined"!=typeof l&&("number"==typeof r?(i.hashCache2=i.hashCache2||[],f=i.hashCache2[r],"undefined"==typeof f&&(i.hashCache2[r]=f=u(a,r))):f=u(a),"undefined"!=typeof f&&l===f)}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},s=t("../contexts/diff").DiffContext,a=t("../contexts/patch").PatchContext,u=t("../contexts/reverse").ReverseContext,l=t("./lcs"),f=3,c="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array},h="function"==typeof Array.prototype.indexOf?function(t,e){return t.indexOf(e)}:function(t,e){for(var n=t.length,r=0;r<n;r++)if(t[r]===e)return r;return-1},p=function(t){if(t.leftIsArray){var e,n,o,a,u={objectHash:t.options&&t.options.objectHash,matchByPosition:t.options&&t.options.matchByPosition},c=0,p=0,d=t.left,y=t.right,v=d.length,m=y.length;for(v>0&&m>0&&!u.objectHash&&"boolean"!=typeof u.matchByPosition&&(u.matchByPosition=!r(d,y,v,m));c<v&&c<m&&i(d,y,c,c,u);)e=c,a=new s(t.left[e],t.right[e]),t.push(a,e),c++;for(;p+c<v&&p+c<m&&i(d,y,v-1-p,m-1-p,u);)n=v-1-p,o=m-1-p,a=new s(t.left[n],t.right[o]),t.push(a,o),p++;var g;if(c+p===v){if(v===m)return void t.setResult(void 0).exit();for(g=g||{_t:"a"},e=c;e<m-p;e++)g[e]=[y[e]];return void t.setResult(g).exit()}if(c+p===m){for(g=g||{_t:"a"},e=c;e<v-p;e++)g["_"+e]=[d[e],0,0];return void t.setResult(g).exit()}delete u.hashCache1,delete u.hashCache2;var b=d.slice(c,v-p),x=y.slice(c,m-p),w=l.get(b,x,i,u),_=[];for(g=g||{_t:"a"},e=c;e<v-p;e++)h(w.indices1,e-c)<0&&(g["_"+e]=[d[e],0,0],_.push(e));var k=!0;t.options&&t.options.arrays&&t.options.arrays.detectMove===!1&&(k=!1);var O=!1;t.options&&t.options.arrays&&t.options.arrays.includeValueOnMove&&(O=!0);var P=_.length;for(e=c;e<m-p;e++){var N=h(w.indices2,e-c);if(N<0){var j=!1;if(k&&P>0)for(var E=0;E<P;E++)if(n=_[E],i(b,x,n-c,e-c,u)){g["_"+n].splice(1,2,e,f),O||(g["_"+n][0]=""),o=e,a=new s(t.left[n],t.right[o]),t.push(a,o),_.splice(E,1),j=!0;break}j||(g[e]=[y[e]])}else n=w.indices1[N]+c,o=w.indices2[N]+c,a=new s(t.left[n],t.right[o]),t.push(a,o)}t.setResult(g).exit()}};p.filterName="arrays";var d={numerically:function(t,e){return t-e},numericallyBy:function(t){return function(e,n){return e[t]-n[t]}}},y=function(t){if(t.nested&&"a"===t.delta._t){var e,n,r=t.delta,i=t.left,o=[],s=[],u=[];for(e in r)if("_t"!==e)if("_"===e[0]){if(0!==r[e][2]&&r[e][2]!==f)throw new Error("only removal or move can be applied at original array indices, invalid diff type: "+r[e][2]);o.push(parseInt(e.slice(1),10))}else 1===r[e].length?s.push({index:parseInt(e,10),value:r[e][0]}):u.push({index:parseInt(e,10),delta:r[e]});for(o=o.sort(d.numerically),e=o.length-1;e>=0;e--){n=o[e];var l=r["_"+n],c=i.splice(n,1)[0];l[2]===f&&s.push({index:l[1],value:c})}s=s.sort(d.numericallyBy("index"));var h=s.length;for(e=0;e<h;e++){var p=s[e];i.splice(p.index,0,p.value)}var y,v=u.length;if(v>0)for(e=0;e<v;e++){var m=u[e];y=new a(t.left[m.index],m.delta),t.push(y,m.index)}return t.children?void t.exit():void t.setResult(t.left).exit()}};y.filterName="arrays";var v=function(t){if(t&&t.children&&"a"===t.delta._t){for(var e,n=t.children.length,r=0;r<n;r++)e=t.children[r],t.left[e.childName]=e.result;t.setResult(t.left).exit()}};v.filterName="arraysCollectChildren";var m=function(t){if(!t.nested)return void(t.delta[2]===f&&(t.newName="_"+t.delta[1],t.setResult([t.delta[0],parseInt(t.childName.substr(1),10),f]).exit()));if("a"===t.delta._t){var e,n;for(e in t.delta)"_t"!==e&&(n=new u(t.delta[e]),t.push(n,e));t.exit()}};m.filterName="arrays";var g=function(t,e,n){if("string"==typeof e&&"_"===e[0])return parseInt(e.substr(1),10);if(c(n)&&0===n[2])return"_"+e;var r=+e;for(var i in t){var o=t[i];if(c(o))if(o[2]===f){var s=parseInt(i.substr(1),10),a=o[1];if(a===+e)return s;s<=r&&a>r?r++:s>=r&&a<r&&r--}else if(0===o[2]){var u=parseInt(i.substr(1),10);u<=r&&r++}else 1===o.length&&i<=r&&r--}return r},b=function(t){if(t&&t.children&&"a"===t.delta._t){for(var e,n=t.children.length,r={_t:"a"},i=0;i<n;i++){e=t.children[i];var o=e.newName;"undefined"==typeof o&&(o=g(t.delta,e.childName,e.result)),r[o]!==e.result&&(r[o]=e.result)}t.setResult(r).exit()}};b.filterName="arraysCollectChildren",n.diffFilter=p,n.patchFilter=y,n.collectChildrenPatchFilter=v,n.reverseFilter=m,n.collectChildrenReverseFilter=b},{"../contexts/diff":10,"../contexts/patch":11,"../contexts/reverse":12,"./lcs":18}],17:[function(t,e,n){"use strict";var r=function(t){t.left instanceof Date?(t.right instanceof Date?t.left.getTime()!==t.right.getTime()?t.setResult([t.left,t.right]):t.setResult(void 0):t.setResult([t.left,t.right]),t.exit()):t.right instanceof Date&&t.setResult([t.left,t.right]).exit()};r.filterName="dates",n.diffFilter=r},{}],18:[function(t,e,n){"use strict";
var r=function(t,e,n,r){return t[n]===e[r]},i=function(t,e,n,r){var i,o,s=t.length,a=e.length,u=[s+1];for(i=0;i<s+1;i++)for(u[i]=[a+1],o=0;o<a+1;o++)u[i][o]=0;for(u.match=n,i=1;i<s+1;i++)for(o=1;o<a+1;o++)n(t,e,i-1,o-1,r)?u[i][o]=u[i-1][o-1]+1:u[i][o]=Math.max(u[i-1][o],u[i][o-1]);return u},o=function a(t,e,n,r,i,o){if(0===r||0===i)return{sequence:[],indices1:[],indices2:[]};if(t.match(e,n,r-1,i-1,o)){var s=a(t,e,n,r-1,i-1,o);return s.sequence.push(e[r-1]),s.indices1.push(r-1),s.indices2.push(i-1),s}return t[r][i-1]>t[r-1][i]?a(t,e,n,r,i-1,o):a(t,e,n,r-1,i,o)},s=function(t,e,n,s){s=s||{};var a=i(t,e,n||r,s),u=o(a,t,e,t.length,e.length,s);return"string"==typeof t&&"string"==typeof e&&(u.sequence=u.sequence.join("")),u};n.get=s},{}],19:[function(t,e,n){"use strict";var r=t("../contexts/diff").DiffContext,i=t("../contexts/patch").PatchContext,o=t("../contexts/reverse").ReverseContext,s=function(t){if(t&&t.children){for(var e,n=t.children.length,r=t.result,i=0;i<n;i++)e=t.children[i],"undefined"!=typeof e.result&&(r=r||{},r[e.childName]=e.result);r&&t.leftIsArray&&(r._t="a"),t.setResult(r).exit()}};s.filterName="collectChildren";var a=function(t){if(!t.leftIsArray&&"object"===t.leftType){var e,n,i=t.options.propertyFilter;for(e in t.left)Object.prototype.hasOwnProperty.call(t.left,e)&&(i&&!i(e,t)||(n=new r(t.left[e],t.right[e]),t.push(n,e)));for(e in t.right)Object.prototype.hasOwnProperty.call(t.right,e)&&(i&&!i(e,t)||"undefined"==typeof t.left[e]&&(n=new r((void 0),t.right[e]),t.push(n,e)));return t.children&&0!==t.children.length?void t.exit():void t.setResult(void 0).exit()}};a.filterName="objects";var u=function(t){if(t.nested&&!t.delta._t){var e,n;for(e in t.delta)n=new i(t.left[e],t.delta[e]),t.push(n,e);t.exit()}};u.filterName="objects";var l=function(t){if(t&&t.children&&!t.delta._t){for(var e,n=t.children.length,r=0;r<n;r++)e=t.children[r],Object.prototype.hasOwnProperty.call(t.left,e.childName)&&void 0===e.result?delete t.left[e.childName]:t.left[e.childName]!==e.result&&(t.left[e.childName]=e.result);t.setResult(t.left).exit()}};l.filterName="collectChildren";var f=function(t){if(t.nested&&!t.delta._t){var e,n;for(e in t.delta)n=new o(t.delta[e]),t.push(n,e);t.exit()}};f.filterName="objects";var c=function(t){if(t&&t.children&&!t.delta._t){for(var e,n=t.children.length,r={},i=0;i<n;i++)e=t.children[i],r[e.childName]!==e.result&&(r[e.childName]=e.result);t.setResult(r).exit()}};c.filterName="collectChildren",n.collectChildrenDiffFilter=s,n.objectsDiffFilter=a,n.patchFilter=u,n.collectChildrenPatchFilter=l,n.reverseFilter=f,n.collectChildrenReverseFilter=c},{"../contexts/diff":10,"../contexts/patch":11,"../contexts/reverse":12}],20:[function(t,e,n){"use strict";var r=2,i=60,o=null,s=function(e){if(!o){var n;if("undefined"!=typeof diff_match_patch)n="function"==typeof diff_match_patch?new diff_match_patch:new diff_match_patch.diff_match_patch;else if("function"==typeof t)try{var r="diff_match_patch_uncompressed",i=t("../../public/external/"+r);n=new i.diff_match_patch}catch(s){n=null}if(!n){if(!e)return null;var a=new Error("text diff_match_patch library not found");throw a.diff_match_patch_not_found=!0,a}o={diff:function(t,e){return n.patch_toText(n.patch_make(t,e))},patch:function(t,e){for(var r=n.patch_apply(n.patch_fromText(e),t),i=0;i<r[1].length;i++)if(!r[1][i]){var o=new Error("text patch failed");o.textPatchFailed=!0}return r[0]}}}return o},a=function(t){if("string"===t.leftType){var e=t.options&&t.options.textDiff&&t.options.textDiff.minLength||i;if(t.left.length<e||t.right.length<e)return void t.setResult([t.left,t.right]).exit();var n=s();if(!n)return void t.setResult([t.left,t.right]).exit();var o=n.diff;t.setResult([o(t.left,t.right),0,r]).exit()}};a.filterName="texts";var u=function(t){if(!t.nested&&t.delta[2]===r){var e=s(!0).patch;t.setResult(e(t.left,t.delta[0])).exit()}};u.filterName="texts";var l=function(t){var e,n,r,i,o,s,a,u,l=null,f=/^@@ +\-(\d+),(\d+) +\+(\d+),(\d+) +@@$/;for(r=t.split("\n"),e=0,n=r.length;e<n;e++){i=r[e];var c=i.slice(0,1);"@"===c?(l=f.exec(i),s=e,a=null,u=null,r[s]="@@ -"+l[3]+","+l[4]+" +"+l[1]+","+l[2]+" @@"):"+"===c?(a=e,r[e]="-"+r[e].slice(1),"+"===r[e-1].slice(0,1)&&(o=r[e],r[e]=r[e-1],r[e-1]=o)):"-"===c&&(u=e,r[e]="+"+r[e].slice(1))}return r.join("\n")},f=function(t){t.nested||t.delta[2]===r&&t.setResult([l(t.delta[0]),0,r]).exit()};f.filterName="texts",n.diffFilter=a,n.patchFilter=u,n.reverseFilter=f},{}],21:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},i="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array},o=function(t){if(t.left===t.right)return void t.setResult(void 0).exit();if("undefined"==typeof t.left){if("function"==typeof t.right)throw new Error("functions are not supported");return void t.setResult([t.right]).exit()}if("undefined"==typeof t.right)return void t.setResult([t.left,0,0]).exit();if("function"==typeof t.left||"function"==typeof t.right)throw new Error("functions are not supported");return t.leftType=null===t.left?"null":r(t.left),t.rightType=null===t.right?"null":r(t.right),t.leftType!==t.rightType?void t.setResult([t.left,t.right]).exit():"boolean"===t.leftType||"number"===t.leftType?void t.setResult([t.left,t.right]).exit():("object"===t.leftType&&(t.leftIsArray=i(t.left)),"object"===t.rightType&&(t.rightIsArray=i(t.right)),t.leftIsArray!==t.rightIsArray?void t.setResult([t.left,t.right]).exit():void 0)};o.filterName="trivial";var s=function(t){return"undefined"==typeof t.delta?void t.setResult(t.left).exit():(t.nested=!i(t.delta),t.nested?void 0:1===t.delta.length?void t.setResult(t.delta[0]).exit():2===t.delta.length?void t.setResult(t.delta[1]).exit():3===t.delta.length&&0===t.delta[2]?void t.setResult(void 0).exit():void 0)};s.filterName="trivial";var a=function(t){return"undefined"==typeof t.delta?void t.setResult(t.delta).exit():(t.nested=!i(t.delta),t.nested?void 0:1===t.delta.length?void t.setResult([t.delta[0],0,0]).exit():2===t.delta.length?void t.setResult([t.delta[1],t.delta[0]]).exit():3===t.delta.length&&0===t.delta[2]?void t.setResult([t.delta[0]]).exit():void 0)};a.filterName="trivial",n.diffFilter=o,n.patchFilter=s,n.reverseFilter=a},{}],22:[function(t,e,n){"use strict";var r=t("./environment"),i=t("./diffpatcher").DiffPatcher;n.DiffPatcher=i,n.create=function(t){return new i(t)},n.dateReviver=t("./date-reviver");var o;if(n.diff=function(){return o||(o=new i),o.diff.apply(o,arguments)},n.patch=function(){return o||(o=new i),o.patch.apply(o,arguments)},n.unpatch=function(){return o||(o=new i),o.unpatch.apply(o,arguments)},n.reverse=function(){return o||(o=new i),o.reverse.apply(o,arguments)},r.isBrowser)n.homepage="{{package-homepage}}",n.version="{{package-version}}";else{var s="../package.json",a=t(s);n.homepage=a.homepage,n.version=a.version;var u="./formatters",l=t(u);n.formatters=l,n.console=l.console}},{"./date-reviver":13,"./diffpatcher":14,"./environment":15}],23:[function(t,e,n){"use strict";var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},i=function(t){this.name=t,this.filters=[]};i.prototype.process=function(t){if(!this.processor)throw new Error("add this pipe to a processor before using it");for(var e=this.debug,n=this.filters.length,i=t,o=0;o<n;o++){var s=this.filters[o];if(e&&this.log("filter: "+s.filterName),s(i),"object"===("undefined"==typeof i?"undefined":r(i))&&i.exiting){i.exiting=!1;break}}!i.next&&this.resultCheck&&this.resultCheck(i)},i.prototype.log=function(t){console.log("[jsondiffpatch] "+this.name+" pipe, "+t)},i.prototype.append=function(){return this.filters.push.apply(this.filters,arguments),this},i.prototype.prepend=function(){return this.filters.unshift.apply(this.filters,arguments),this},i.prototype.indexOf=function(t){if(!t)throw new Error("a filter name is required");for(var e=0;e<this.filters.length;e++){var n=this.filters[e];if(n.filterName===t)return e}throw new Error("filter not found: "+t)},i.prototype.list=function(){for(var t=[],e=0;e<this.filters.length;e++){var n=this.filters[e];t.push(n.filterName)}return t},i.prototype.after=function(t){var e=this.indexOf(t),n=Array.prototype.slice.call(arguments,1);if(!n.length)throw new Error("a filter is required");return n.unshift(e+1,0),Array.prototype.splice.apply(this.filters,n),this},i.prototype.before=function(t){var e=this.indexOf(t),n=Array.prototype.slice.call(arguments,1);if(!n.length)throw new Error("a filter is required");return n.unshift(e,0),Array.prototype.splice.apply(this.filters,n),this},i.prototype.clear=function(){return this.filters.length=0,this},i.prototype.shouldHaveResult=function(t){if(t===!1)return void(this.resultCheck=null);if(!this.resultCheck){var e=this;return this.resultCheck=function(t){if(!t.hasResult){console.log(t);var n=new Error(e.name+" failed");throw n.noResult=!0,n}},this}},n.Pipe=i},{}],24:[function(t,e,n){"use strict";var r=function(t){this.selfOptions=t||{},this.pipes={}};r.prototype.options=function(t){return t&&(this.selfOptions=t),this.selfOptions},r.prototype.pipe=function(t,e){if("string"==typeof t){if("undefined"==typeof e)return this.pipes[t];this.pipes[t]=e}if(t&&t.name){if(e=t,e.processor===this)return e;this.pipes[e.name]=e}return e.processor=this,e},r.prototype.process=function(t,e){var n=t;n.options=this.options();for(var r,i,o=e||t.pipe||"default";o;)"undefined"!=typeof n.nextAfterChildren&&(n.next=n.nextAfterChildren,n.nextAfterChildren=null),"string"==typeof o&&(o=this.pipe(o)),o.process(n),i=n,r=o,o=null,n&&n.next&&(n=n.next,o=i.nextPipe||n.pipe||r);return n.hasResult?n.result:void 0},n.Processor=r},{}],25:[function(t,e,n){"use strict";var r=t("./skaryna"),i=t("pageobjectmodel/src/util");(0,i.query)(document.body,"[data-skaryna]").forEach(function(t){return r.Skaryna.initEditor(t)}),window.Skaryna=r.Skaryna},{"./skaryna":26,"pageobjectmodel/src/util":8}],26:[function(t,e,n){"use strict";function r(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e,n){return t.hasAttribute(e)?t.getAttribute(e).toString():n}Object.defineProperty(n,"__esModule",{value:!0}),n.Skaryna=n.Repository=n.XHR=void 0;var a=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),u=t("pageobjectmodel/src/parser/fromHTML"),l=t("pageobjectmodel/src/parser/fromPOM"),f=(t("pageobjectmodel/src/serializer/toHTML"),t("pageobjectmodel/src/document")),c=t("pageobjectmodel/src/emitter"),h=t("jsondiffpatch"),p="#default",d=13,y=[d],v="\n[data-skaryna], [data-skaryna] * { outline: none; }\n";!function(){var t=document.createElement("style");t.innerText=v,document.body.appendChild(t)}();var m=n.XHR=function(){function t(){o(this,t)}return a(t,null,[{key:"ajax",value:function(t,e,n,r){return new Promise(function(i,o){var s=new XMLHttpRequest,a=e.toLowerCase();s.open(a,t),"post"!==a&&"put"!==a||s.setRequestHeader("Content-type","application/json"),s.onreadystatechange=function(){var t=4,e=200;s.readyState===t&&(s.status===e?i(s.responseText):"204"===s.status?i(null):o(new Error("Error: "+s.status)))},s.send(n?r?n:JSON.stringify(n):null)})}},{key:"get",value:function(e,n){return t.ajax(e,"get",null,n)}},{key:"post",value:function(e,n,r){return t.ajax(e,"post",n,r)}},{key:"put",value:function(e,n,r){return t.ajax(e,"put",n,r)}},{key:"delete",value:function(e,n){return t.ajax(e,"delete",null,n)}}]),t}(),g=n.Repository=function(t){function e(){return o(this,e),r(this,Object.getPrototypeOf(e).apply(this,arguments))}return i(e,t),a(e,null,[{key:"report",value:function(t,e,n,r){var i=this.documents,o=this.cache;void 0===e?(i[t]=n,o[t]=n.toJSON()):(i.hasOwnProperty(t)||(i[t]=new f.Fields,o[t]=i[t].toJSON()),i[t].set(e,n)),this.emit("change",{doc:t,path:e,id:n.name}),document.querySelector("#pom").innerText=JSON.stringify(this.documents,null,2)}},{key:"documents",get:function(){return this._documents=this._documents||{},this._documents}},{key:"cache",get:function(){return this._cache=this._cache||{},this._cache}}]),e}(c.Emitter);n.Skaryna=function(){function t(e,n){o(this,t),this._config=n,this.element=e,g.on("change",this.onRepositoryUpdate.bind(this)),this.ready=(0,u.fromHTML)(e).then(function(t){g.report(n.doc,n.path,t)})}return a(t,null,[{key:"initEditor",value:function(e){var n={allow:s(e,"data-skaryna-allow","*").split(/\s*,\s*/),path:s(e,"data-skaryna-path"),placeholder:s(e,"placeholder"),doc:s(e,"data-skaryna-doc",p),variant:s(e,"data-skaryna-variant")},r=new t(e,n);return t.editors.push(r),r}},{key:"load",value:function(t,e){return m.get(t).then(function(t){return(0,l.fromPOM)(JSON.parse(t))}).then(function(t){return g.report(e||p,void 0,t)})}},{key:"editors",get:function(){return this._editors=this._editors||[],this._editors}}]),a(t,[{key:"redrawEditor",value:function(){var t=this,e=g.documents[this._config.doc];if(this._config.path&&(e=e.get(this._config.path)),e&&"Variants"===e.type&&e.best&&(e=e.best(this._config.variant||"*")),e)return e.decorate(t.element).then(function(){t.element.addEventListener("keydown",t.onKeyUp.bind(t)),t.element.addEventListener("mouseup",t.onMouseDown.bind(t))})}},{key:"getCurrentElement",value:function(t){var e=t.ownerDocument||t.document,n=e.defaultView||e.parentWindow,r=void 0,i=void 0;return r="undefined"!=typeof n.getSelection?n.getSelection():e.selection,i=r.focusNode,i===this.element?this.element:(i=this.getEditableNode(i),document.querySelector("#current-element").innerText=i.outerHTML,(0,u.fromHTML)(i).then(function(t){document.querySelector("#current-node").innerText=JSON.stringify(t,null,2),document.querySelector("#diff").innerHTML=JSON.stringify((0,h.diff)(JSON.parse(JSON.stringify(g.documents)),g.cache))}),i)}},{key:"getEditableNode",value:function(t){for(;t&&(!t.hasAttribute||!t.hasAttribute("data-skaryna-id"));)t=t.parentNode;return t}},{key:"onKeyUp",value:function(t){var e=this,n=this.getCurrentElement(t.target);y.indexOf(t.keyCode)!==-1?(t.stopPropagation(),t.preventDefault()):setTimeout(function(){return e.elementUpdated(n)},0)}},{key:"onMouseDown",value:function(t){this.getCurrentElement(t.target)}},{key:"onRepositoryUpdate",value:function(t){t.data.doc===this._config.doc&&void 0===t.data.path&&this.redrawEditor()}},{key:"elementUpdated",value:function(t){var e=this;(0,u.fromHTML)(t).then(function(n){n.name=t.getAttribute("data-skaryna-id").toString(),g.report(e._config.doc,"@"+n.name,n)})}}]),t}()},{jsondiffpatch:22,"pageobjectmodel/src/document":1,"pageobjectmodel/src/emitter":2,"pageobjectmodel/src/parser/fromHTML":4,"pageobjectmodel/src/parser/fromPOM":5,"pageobjectmodel/src/serializer/toHTML":7}]},{},[25]);
//# sourceMappingURL=skaryna.min.js.map
